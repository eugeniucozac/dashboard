{"ast":null,"code":"import _objectSpread from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _regeneratorRuntime from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"E:\\\\MPHASIS\\\\claims-page\\\\Mphasis-Edge\\\\src\\\\forms\\\\AddEditUser\\\\AddEditUser.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport * as Yup from 'yup';\nimport debounce from 'lodash/debounce'; // app\n\nimport { Loader } from 'components';\nimport config from 'config';\nimport { createUser, createUserProgrammes, editUser, getCarriersProgrammes, getClientsProgrammes, getParentOfficeListAll, getProductsProgrammes, selectAdminOffices, selectRefDataDepartments, getUserProgrammes, selectProgrammesCarriersSorted, selectProgrammesClientsSorted, selectProgrammesProductsSorted, emailSearch, patchUserProgrammes } from 'stores';\nimport { AddEditUserView } from './AddEditUser.view';\nimport * as utils from 'utils';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function AddUser(_ref) {\n  _s();\n\n  var handleClose = _ref.handleClose,\n      _ref$user = _ref.user,\n      user = _ref$user === void 0 ? {} : _ref$user;\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      userProgrammesData = _useState2[0],\n      setUserProgrammesData = _useState2[1];\n\n  var _useState3 = useState(user === null || user === void 0 ? void 0 : user.programmesUserId),\n      _useState4 = _slicedToArray(_useState3, 2),\n      programmesUserId = _useState4[0],\n      setProgrammesUserId = _useState4[1];\n\n  var _useState5 = useState(true),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isLoading = _useState6[0],\n      setIsLoading = _useState6[1];\n\n  var _useState7 = useState(),\n      _useState8 = _slicedToArray(_useState7, 2),\n      isLoadingProgrammesUser = _useState8[0],\n      setIsLoadingProgrammesUser = _useState8[1];\n\n  var emailId = user.emailId;\n  var dispatch = useDispatch();\n  var refDataDepartments = useSelector(selectRefDataDepartments);\n  var officeList = useSelector(selectAdminOffices);\n  var isLoadingOffice = useSelector(function (state) {\n    return state.admin.parentOfficeListAll.loading;\n  });\n  var userEdgeId = user === null || user === void 0 ? void 0 : user.id;\n  var programmesProducts = useSelector(selectProgrammesProductsSorted) || [];\n  var programmesClients = useSelector(selectProgrammesClientsSorted) || [];\n  var programmesCarriers = useSelector(selectProgrammesCarriersSorted) || [];\n  var isLoadingProducts = useSelector(function (state) {\n    return state.admin.programmesProductsList.loading;\n  });\n  var isLoadingClients = useSelector(function (state) {\n    return state.admin.programmesClientList.loading;\n  });\n  var isLoadingCarriers = useSelector(function (state) {\n    return state.admin.programmesCarriersList.loading;\n  });\n  useEffect(function () {\n    var allFieldsLoaded = [isLoadingOffice, isLoadingProducts, isLoadingClients, isLoadingCarriers, isLoadingProgrammesUser].every(function (v) {\n      return v === false;\n    });\n    setIsLoading(!allFieldsLoaded);\n  }, [isLoadingOffice, isLoadingProducts, isLoadingClients, isLoadingCarriers, isLoadingProgrammesUser]);\n  useEffect(function () {\n    dispatch(getParentOfficeListAll());\n  }, [] // eslint-disable-line react-hooks/exhaustive-deps\n  );\n  useEffect(function () {\n    if (programmesUserId) {\n      var getUserProgrammesData = /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n          var userData, carriers, clients, products, coverholder, id;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.next = 2;\n                  return dispatch(getUserProgrammes(programmesUserId));\n\n                case 2:\n                  userData = _context.sent;\n                  carriers = userData.carriers, clients = userData.clients, products = userData.products, coverholder = userData.coverholder, id = userData.id;\n                  setUserProgrammesData({\n                    carriers: carriers,\n                    clients: clients,\n                    products: products,\n                    coverholder: coverholder,\n                    id: id\n                  });\n                  setIsLoadingProgrammesUser(false);\n\n                case 6:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function getUserProgrammesData() {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n\n      setIsLoadingProgrammesUser(true);\n      getUserProgrammesData();\n    } else setIsLoadingProgrammesUser(false);\n  }, [] // eslint-disable-line react-hooks/exhaustive-deps\n  );\n  useEffect(function () {\n    if (programmesUserId) {\n      !utils.generic.isValidArray(programmesProducts, true) && dispatch(getProductsProgrammes());\n      !utils.generic.isValidArray(programmesClients, true) && dispatch(getClientsProgrammes());\n      !utils.generic.isValidArray(programmesCarriers, true) && dispatch(getCarriersProgrammes());\n    }\n  }, [programmesUserId] // eslint-disable-line react-hooks/exhaustive-deps\n  );\n\n  var handleAddToProgrammes = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var result;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!user.id) {\n                _context2.next = 5;\n                break;\n              }\n\n              _context2.next = 3;\n              return dispatch(createUserProgrammes(user.id));\n\n            case 3:\n              result = _context2.sent;\n              setProgrammesUserId(result.programmesUserId);\n\n            case 5:\n              return _context2.abrupt(\"return\");\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleAddToProgrammes() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var handleSubmit = function handleSubmit(updatedUser) {\n    if (user.id) {\n      if (programmesUserId) {\n        var products = updatedUser.products,\n            clients = updatedUser.clients,\n            carriers = updatedUser.carriers,\n            coverholder = updatedUser.coverholder,\n            isAdmin = updatedUser.isAdmin,\n            firstName = updatedUser.firstName,\n            lastName = updatedUser.lastName,\n            _emailId = updatedUser.emailId,\n            role = updatedUser.role;\n\n        var programmesData = _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, products && {\n          products: products.map(function (product) {\n            return product.value;\n          })\n        }), clients && {\n          clients: clients.map(function (client) {\n            return client.id;\n          })\n        }), carriers && {\n          carriers: carriers.map(function (carrier) {\n            return carrier.id;\n          })\n        }), {}, {\n          emailId: _emailId,\n          coverholder: coverholder,\n          fullName: \"\".concat(firstName, \" \").concat(lastName),\n          isAdmin: isAdmin,\n          role: role\n        });\n\n        dispatch(patchUserProgrammes(programmesUserId, programmesData));\n      }\n\n      return dispatch(editUser(updatedUser, user));\n    } else {\n      return dispatch(createUser(updatedUser));\n    }\n  };\n\n  var handleCancel = function handleCancel() {\n    if (utils.generic.isFunction(handleClose)) {\n      handleClose();\n    }\n  };\n\n  var emailCheck = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(value, resolve) {\n      var existingAccounts;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (value) {\n                _context3.next = 2;\n                break;\n              }\n\n              return _context3.abrupt(\"return\", resolve(false));\n\n            case 2:\n              if (!(value === emailId)) {\n                _context3.next = 4;\n                break;\n              }\n\n              return _context3.abrupt(\"return\", resolve(true));\n\n            case 4:\n              _context3.prev = 4;\n              _context3.next = 7;\n              return dispatch(emailSearch(value));\n\n            case 7:\n              existingAccounts = _context3.sent;\n              resolve(existingAccounts.length === 0);\n              _context3.next = 14;\n              break;\n\n            case 11:\n              _context3.prev = 11;\n              _context3.t0 = _context3[\"catch\"](4);\n              resolve(false);\n\n            case 14:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[4, 11]]);\n    }));\n\n    return function emailCheck(_x, _x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var emailCheckDebounced = debounce(emailCheck, config.ui.autocomplete.delay);\n  var userFields = [{\n    name: 'firstName',\n    label: utils.string.t('admin.form.firstName.label'),\n    value: user.firstName || '',\n    type: 'text',\n    validation: Yup.string().required(utils.string.t('validation.required'))\n  }, {\n    name: 'lastName',\n    label: utils.string.t('admin.form.lastName.label'),\n    value: user.lastName || '',\n    type: 'text',\n    validation: Yup.string().required(utils.string.t('validation.required'))\n  }, {\n    name: 'departments',\n    label: utils.string.t('admin.form.departments.label'),\n    type: 'autocomplete',\n    value: user.departmentIds && user.departmentIds.map(function (id) {\n      return utils.referenceData.departments.getById(refDataDepartments, id);\n    }) || [],\n    options: refDataDepartments,\n    optionKey: 'id',\n    optionLabel: 'name',\n    muiComponentProps: {\n      multiple: true,\n      'data-testid': 'department'\n    },\n    innerComponentProps: {\n      isMulti: true,\n      maxMenuHeight: 120\n    }\n  }, {\n    name: 'role',\n    label: utils.string.t('admin.form.role.label'),\n    value: user.role || '',\n    type: 'select',\n    options: utils.user.getRolesString(),\n    validation: Yup.string().required(utils.string.t('validation.required'))\n  }, {\n    name: 'isAdmin',\n    type: 'switch',\n    value: user.isAdmin || false,\n    title: utils.string.t('admin.form.admin.label')\n  }, {\n    name: 'isReportAdmin',\n    type: 'switch',\n    value: user.isReportAdmin || false,\n    title: utils.string.t('admin.form.reportsAdmin.label')\n  }, {\n    name: 'emailId',\n    label: utils.string.t('admin.form.email.label'),\n    value: user.emailId || '',\n    type: 'text',\n    validation: Yup.string().email(utils.string.t('validation.email')).required(utils.string.t('validation.required')).test('emailId', utils.string.t('validation.emailAlreadyInUse'), /*#__PURE__*/function () {\n      var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(value) {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                return _context4.abrupt(\"return\", new Promise(function (resolve) {\n                  return emailCheckDebounced(value, resolve);\n                }));\n\n              case 1:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n\n      return function (_x3) {\n        return _ref5.apply(this, arguments);\n      };\n    }())\n  }, {\n    name: 'contactPhone',\n    label: utils.string.t('admin.form.phone.label'),\n    value: user.contactPhone || '',\n    type: 'text'\n  }, {\n    name: 'offices',\n    label: utils.string.t('admin.form.clientOffice.label'),\n    type: 'autocomplete',\n    value: user.offices && user.offices.map(function (office) {\n      return utils.client.offices.getById(officeList, office.id);\n    }) || [],\n    options: officeList,\n    optionKey: 'id',\n    optionLabel: 'name',\n    muiComponentProps: {\n      multiple: true,\n      'data-testid': 'offices'\n    },\n    innerComponentProps: {\n      isMulti: true,\n      maxMenuHeight: 80\n    }\n  }];\n  var userProgrammesProducts = (userProgrammesData === null || userProgrammesData === void 0 ? void 0 : userProgrammesData.products) && programmesProducts ? programmesProducts === null || programmesProducts === void 0 ? void 0 : programmesProducts.filter(function (product) {\n    return userProgrammesData.products.includes(product.value);\n  }) : [];\n  var userProgrammesClients = (userProgrammesData === null || userProgrammesData === void 0 ? void 0 : userProgrammesData.clients) && programmesClients ? programmesClients === null || programmesClients === void 0 ? void 0 : programmesClients.filter(function (client) {\n    return userProgrammesData.clients.includes(client.id);\n  }) : [];\n  var userProgrammesCarriers = (userProgrammesData === null || userProgrammesData === void 0 ? void 0 : userProgrammesData.carriers) && programmesCarriers ? programmesCarriers === null || programmesCarriers === void 0 ? void 0 : programmesCarriers.filter(function (carrier) {\n    return userProgrammesData.carriers.includes(carrier.id);\n  }) : [];\n  var programmesFields = [{\n    name: 'coverholder',\n    title: utils.string.t('admin.form.coverholderRole.label'),\n    value: (userProgrammesData === null || userProgrammesData === void 0 ? void 0 : userProgrammesData.coverholder) ? true : false,\n    type: 'switch'\n  }, {\n    name: 'products',\n    label: utils.string.t('admin.form.products.labelProducts'),\n    type: 'autocomplete',\n    key: \"products-\".concat(programmesProducts.length, \"-\").concat(userProgrammesProducts.length),\n    defaultValue: userProgrammesProducts,\n    options: programmesProducts,\n    optionKey: 'value',\n    optionLabel: 'label',\n    muiComponentProps: {\n      multiple: true,\n      'data-testid': 'products'\n    },\n    innerComponentProps: {\n      isMulti: true,\n      maxMenuHeight: 120\n    },\n    validation: Yup.array().required(utils.string.t('validation.required'))\n  }, {\n    key: \"clients-\".concat(programmesClients.length, \"--\").concat(userProgrammesClients.length),\n    name: 'clients',\n    label: utils.string.t('admin.form.clients.label'),\n    type: 'autocomplete',\n    defaultValue: userProgrammesClients,\n    options: programmesClients || [],\n    optionKey: 'id',\n    optionLabel: 'name',\n    muiComponentProps: {\n      multiple: true,\n      'data-testid': 'clients'\n    },\n    innerComponentProps: {\n      isMulti: true,\n      maxMenuHeight: 120\n    },\n    validation: Yup.array().test('clients', utils.string.t('validation.requiredClientOrCarrier'), function (value) {\n      return utils.generic.isValidArray(this.options.parent.carriers, true) || utils.generic.isValidArray(value, true) ? true : false;\n    })\n  }, {\n    key: \"carriers-\".concat(programmesCarriers.length, \"--\").concat(userProgrammesCarriers.length),\n    name: 'carriers',\n    label: utils.string.t('admin.form.carriers.label'),\n    type: 'autocomplete',\n    defaultValue: userProgrammesCarriers,\n    options: programmesCarriers || [],\n    optionKey: 'id',\n    optionLabel: 'name',\n    muiComponentProps: {\n      multiple: true,\n      'data-testid': 'carriers'\n    },\n    innerComponentProps: {\n      isMulti: true,\n      maxMenuHeight: 120\n    },\n    validation: Yup.array().test('carriers', utils.string.t('validation.requiredClientOrCarrier'), function (value) {\n      return utils.generic.isValidArray(this.options.parent.clients, true) || utils.generic.isValidArray(value, true) ? true : false;\n    })\n  }];\n  var actions = [{\n    name: 'submit',\n    label: user.id ? utils.string.t('app.save') : utils.string.t('app.create'),\n    handler: handleSubmit\n  }, {\n    name: 'cancel',\n    label: utils.string.t('app.cancel'),\n    handler: handleCancel\n  }];\n  var fields = programmesUserId ? [].concat(userFields, programmesFields) : [].concat(userFields);\n  return isLoading ? /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      height: 500\n    },\n    children: /*#__PURE__*/_jsxDEV(Loader, {\n      visible: isLoading,\n      absolute: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 335,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 334,\n    columnNumber: 5\n  }, this) : /*#__PURE__*/_jsxDEV(AddEditUserView, {\n    actions: actions,\n    fields: fields,\n    userId: userEdgeId,\n    programmes: {\n      programmesUserId: programmesUserId,\n      handleAddToProgrammes: handleAddToProgrammes\n    },\n    isLoading: isLoading\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 338,\n    columnNumber: 5\n  }, this);\n}\n\n_s(AddUser, \"iptAqlZHpaqUhSn7PdsCvemlRys=\", false, function () {\n  return [useDispatch, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector];\n});\n\n_c = AddUser;\nAddUser.__docgenInfo = {\n  \"description\": \"\",\n  \"methods\": [],\n  \"displayName\": \"AddUser\",\n  \"props\": {\n    \"user\": {\n      \"defaultValue\": {\n        \"value\": \"{}\",\n        \"computed\": false\n      },\n      \"required\": false\n    }\n  }\n};\n\nif (typeof STORYBOOK_REACT_CLASSES !== \"undefined\") {\n  STORYBOOK_REACT_CLASSES[\"src\\\\forms\\\\AddEditUser\\\\AddEditUser.js\"] = {\n    name: \"AddUser\",\n    docgenInfo: AddUser.__docgenInfo,\n    path: \"src\\\\forms\\\\AddEditUser\\\\AddEditUser.js\"\n  };\n}\n\nvar _c;\n\n$RefreshReg$(_c, \"AddUser\");","map":{"version":3,"sources":["E:/MPHASIS/claims-page/Mphasis-Edge/src/forms/AddEditUser/AddEditUser.js"],"names":["React","useEffect","useState","useDispatch","useSelector","Yup","debounce","Loader","config","createUser","createUserProgrammes","editUser","getCarriersProgrammes","getClientsProgrammes","getParentOfficeListAll","getProductsProgrammes","selectAdminOffices","selectRefDataDepartments","getUserProgrammes","selectProgrammesCarriersSorted","selectProgrammesClientsSorted","selectProgrammesProductsSorted","emailSearch","patchUserProgrammes","AddEditUserView","utils","AddUser","handleClose","user","userProgrammesData","setUserProgrammesData","programmesUserId","setProgrammesUserId","isLoading","setIsLoading","isLoadingProgrammesUser","setIsLoadingProgrammesUser","emailId","dispatch","refDataDepartments","officeList","isLoadingOffice","state","admin","parentOfficeListAll","loading","userEdgeId","id","programmesProducts","programmesClients","programmesCarriers","isLoadingProducts","programmesProductsList","isLoadingClients","programmesClientList","isLoadingCarriers","programmesCarriersList","allFieldsLoaded","every","v","getUserProgrammesData","userData","carriers","clients","products","coverholder","generic","isValidArray","handleAddToProgrammes","result","handleSubmit","updatedUser","isAdmin","firstName","lastName","role","programmesData","map","product","value","client","carrier","fullName","handleCancel","isFunction","emailCheck","resolve","existingAccounts","length","emailCheckDebounced","ui","autocomplete","delay","userFields","name","label","string","t","type","validation","required","departmentIds","referenceData","departments","getById","options","optionKey","optionLabel","muiComponentProps","multiple","innerComponentProps","isMulti","maxMenuHeight","getRolesString","title","isReportAdmin","email","test","Promise","contactPhone","offices","office","userProgrammesProducts","filter","includes","userProgrammesClients","userProgrammesCarriers","programmesFields","key","defaultValue","array","parent","actions","handler","fields","height"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport * as Yup from 'yup';\r\nimport debounce from 'lodash/debounce';\r\n\r\n// app\r\nimport { Loader } from 'components';\r\nimport config from 'config';\r\nimport {\r\n  createUser,\r\n  createUserProgrammes,\r\n  editUser,\r\n  getCarriersProgrammes,\r\n  getClientsProgrammes,\r\n  getParentOfficeListAll,\r\n  getProductsProgrammes,\r\n  selectAdminOffices,\r\n  selectRefDataDepartments,\r\n  getUserProgrammes,\r\n  selectProgrammesCarriersSorted,\r\n  selectProgrammesClientsSorted,\r\n  selectProgrammesProductsSorted,\r\n  emailSearch,\r\n  patchUserProgrammes,\r\n} from 'stores';\r\nimport { AddEditUserView } from './AddEditUser.view';\r\nimport * as utils from 'utils';\r\n\r\nexport default function AddUser({ handleClose, user = {} }) {\r\n  const [userProgrammesData, setUserProgrammesData] = useState(null);\r\n  const [programmesUserId, setProgrammesUserId] = useState(user?.programmesUserId);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isLoadingProgrammesUser, setIsLoadingProgrammesUser] = useState();\r\n\r\n  const { emailId } = user;\r\n  const dispatch = useDispatch();\r\n  const refDataDepartments = useSelector(selectRefDataDepartments);\r\n  const officeList = useSelector(selectAdminOffices);\r\n  const isLoadingOffice = useSelector((state) => state.admin.parentOfficeListAll.loading);\r\n\r\n  const userEdgeId = user?.id;\r\n\r\n  const programmesProducts = useSelector(selectProgrammesProductsSorted) || [];\r\n  const programmesClients = useSelector(selectProgrammesClientsSorted) || [];\r\n  const programmesCarriers = useSelector(selectProgrammesCarriersSorted) || [];\r\n  const isLoadingProducts = useSelector((state) => state.admin.programmesProductsList.loading);\r\n  const isLoadingClients = useSelector((state) => state.admin.programmesClientList.loading);\r\n  const isLoadingCarriers = useSelector((state) => state.admin.programmesCarriersList.loading);\r\n\r\n  useEffect(() => {\r\n    const allFieldsLoaded = [isLoadingOffice, isLoadingProducts, isLoadingClients, isLoadingCarriers, isLoadingProgrammesUser].every(\r\n      (v) => v === false\r\n    );\r\n    setIsLoading(!allFieldsLoaded);\r\n  }, [isLoadingOffice, isLoadingProducts, isLoadingClients, isLoadingCarriers, isLoadingProgrammesUser]);\r\n\r\n  useEffect(\r\n    () => {\r\n      dispatch(getParentOfficeListAll());\r\n    },\r\n    [] // eslint-disable-line react-hooks/exhaustive-deps\r\n  );\r\n\r\n  useEffect(\r\n    () => {\r\n      if (programmesUserId) {\r\n        const getUserProgrammesData = async () => {\r\n          const userData = await dispatch(getUserProgrammes(programmesUserId));\r\n          const { carriers, clients, products, coverholder, id } = userData;\r\n          setUserProgrammesData({ carriers, clients, products, coverholder, id });\r\n          setIsLoadingProgrammesUser(false);\r\n        };\r\n        setIsLoadingProgrammesUser(true);\r\n        getUserProgrammesData();\r\n      } else setIsLoadingProgrammesUser(false);\r\n    },\r\n    [] // eslint-disable-line react-hooks/exhaustive-deps\r\n  );\r\n\r\n  useEffect(\r\n    () => {\r\n      if (programmesUserId) {\r\n        !utils.generic.isValidArray(programmesProducts, true) && dispatch(getProductsProgrammes());\r\n        !utils.generic.isValidArray(programmesClients, true) && dispatch(getClientsProgrammes());\r\n        !utils.generic.isValidArray(programmesCarriers, true) && dispatch(getCarriersProgrammes());\r\n      }\r\n    },\r\n    [programmesUserId] // eslint-disable-line react-hooks/exhaustive-deps\r\n  );\r\n\r\n  const handleAddToProgrammes = async () => {\r\n    if (user.id) {\r\n      const result = await dispatch(createUserProgrammes(user.id));\r\n      setProgrammesUserId(result.programmesUserId);\r\n    }\r\n    return;\r\n  };\r\n\r\n  const handleSubmit = (updatedUser) => {\r\n    if (user.id) {\r\n      if (programmesUserId) {\r\n        const { products, clients, carriers, coverholder, isAdmin, firstName, lastName, emailId, role } = updatedUser;\r\n        const programmesData = {\r\n          ...(products && { products: products.map((product) => product.value) }),\r\n          ...(clients && { clients: clients.map((client) => client.id) }),\r\n          ...(carriers && { carriers: carriers.map((carrier) => carrier.id) }),\r\n          emailId,\r\n          coverholder,\r\n          fullName: `${firstName} ${lastName}`,\r\n          isAdmin,\r\n          role,\r\n        };\r\n        dispatch(patchUserProgrammes(programmesUserId, programmesData));\r\n      }\r\n      return dispatch(editUser(updatedUser, user));\r\n    } else {\r\n      return dispatch(createUser(updatedUser));\r\n    }\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    if (utils.generic.isFunction(handleClose)) {\r\n      handleClose();\r\n    }\r\n  };\r\n\r\n  const emailCheck = async (value, resolve) => {\r\n    if (!value) return resolve(false);\r\n    if (value === emailId) return resolve(true);\r\n\r\n    try {\r\n      const existingAccounts = await dispatch(emailSearch(value));\r\n      resolve(existingAccounts.length === 0);\r\n    } catch (error) {\r\n      resolve(false);\r\n    }\r\n  };\r\n\r\n  const emailCheckDebounced = debounce(emailCheck, config.ui.autocomplete.delay);\r\n\r\n  const userFields = [\r\n    {\r\n      name: 'firstName',\r\n      label: utils.string.t('admin.form.firstName.label'),\r\n      value: user.firstName || '',\r\n      type: 'text',\r\n      validation: Yup.string().required(utils.string.t('validation.required')),\r\n    },\r\n    {\r\n      name: 'lastName',\r\n      label: utils.string.t('admin.form.lastName.label'),\r\n      value: user.lastName || '',\r\n      type: 'text',\r\n      validation: Yup.string().required(utils.string.t('validation.required')),\r\n    },\r\n    {\r\n      name: 'departments',\r\n      label: utils.string.t('admin.form.departments.label'),\r\n      type: 'autocomplete',\r\n      value: (user.departmentIds && user.departmentIds.map((id) => utils.referenceData.departments.getById(refDataDepartments, id))) || [],\r\n      options: refDataDepartments,\r\n      optionKey: 'id',\r\n      optionLabel: 'name',\r\n      muiComponentProps: {\r\n        multiple: true,\r\n        'data-testid': 'department',\r\n      },\r\n      innerComponentProps: {\r\n        isMulti: true,\r\n        maxMenuHeight: 120,\r\n      },\r\n    },\r\n    {\r\n      name: 'role',\r\n      label: utils.string.t('admin.form.role.label'),\r\n      value: user.role || '',\r\n      type: 'select',\r\n      options: utils.user.getRolesString(),\r\n      validation: Yup.string().required(utils.string.t('validation.required')),\r\n    },\r\n    {\r\n      name: 'isAdmin',\r\n      type: 'switch',\r\n      value: user.isAdmin || false,\r\n      title: utils.string.t('admin.form.admin.label'),\r\n    },\r\n    {\r\n      name: 'isReportAdmin',\r\n      type: 'switch',\r\n      value: user.isReportAdmin || false,\r\n      title: utils.string.t('admin.form.reportsAdmin.label'),\r\n    },\r\n    {\r\n      name: 'emailId',\r\n      label: utils.string.t('admin.form.email.label'),\r\n      value: user.emailId || '',\r\n      type: 'text',\r\n      validation: Yup.string()\r\n        .email(utils.string.t('validation.email'))\r\n        .required(utils.string.t('validation.required'))\r\n        .test(\r\n          'emailId',\r\n          utils.string.t('validation.emailAlreadyInUse'),\r\n          async (value) => new Promise((resolve) => emailCheckDebounced(value, resolve))\r\n        ),\r\n    },\r\n    {\r\n      name: 'contactPhone',\r\n      label: utils.string.t('admin.form.phone.label'),\r\n      value: user.contactPhone || '',\r\n      type: 'text',\r\n    },\r\n    {\r\n      name: 'offices',\r\n      label: utils.string.t('admin.form.clientOffice.label'),\r\n      type: 'autocomplete',\r\n      value: (user.offices && user.offices.map((office) => utils.client.offices.getById(officeList, office.id))) || [],\r\n      options: officeList,\r\n      optionKey: 'id',\r\n      optionLabel: 'name',\r\n      muiComponentProps: {\r\n        multiple: true,\r\n        'data-testid': 'offices',\r\n      },\r\n\r\n      innerComponentProps: {\r\n        isMulti: true,\r\n        maxMenuHeight: 80,\r\n      },\r\n    },\r\n  ];\r\n\r\n  const userProgrammesProducts =\r\n    userProgrammesData?.products && programmesProducts\r\n      ? programmesProducts?.filter((product) => userProgrammesData.products.includes(product.value))\r\n      : [];\r\n\r\n  const userProgrammesClients =\r\n    userProgrammesData?.clients && programmesClients\r\n      ? programmesClients?.filter((client) => userProgrammesData.clients.includes(client.id))\r\n      : [];\r\n\r\n  const userProgrammesCarriers =\r\n    userProgrammesData?.carriers && programmesCarriers\r\n      ? programmesCarriers?.filter((carrier) => userProgrammesData.carriers.includes(carrier.id))\r\n      : [];\r\n\r\n  const programmesFields = [\r\n    {\r\n      name: 'coverholder',\r\n      title: utils.string.t('admin.form.coverholderRole.label'),\r\n      value: userProgrammesData?.coverholder ? true : false,\r\n      type: 'switch',\r\n    },\r\n    {\r\n      name: 'products',\r\n      label: utils.string.t('admin.form.products.labelProducts'),\r\n      type: 'autocomplete',\r\n      key: `products-${programmesProducts.length}-${userProgrammesProducts.length}`,\r\n      defaultValue: userProgrammesProducts,\r\n      options: programmesProducts,\r\n      optionKey: 'value',\r\n      optionLabel: 'label',\r\n      muiComponentProps: {\r\n        multiple: true,\r\n        'data-testid': 'products',\r\n      },\r\n      innerComponentProps: {\r\n        isMulti: true,\r\n        maxMenuHeight: 120,\r\n      },\r\n      validation: Yup.array().required(utils.string.t('validation.required')),\r\n    },\r\n    {\r\n      key: `clients-${programmesClients.length}--${userProgrammesClients.length}`,\r\n      name: 'clients',\r\n      label: utils.string.t('admin.form.clients.label'),\r\n      type: 'autocomplete',\r\n      defaultValue: userProgrammesClients,\r\n      options: programmesClients || [],\r\n      optionKey: 'id',\r\n      optionLabel: 'name',\r\n      muiComponentProps: {\r\n        multiple: true,\r\n        'data-testid': 'clients',\r\n      },\r\n      innerComponentProps: {\r\n        isMulti: true,\r\n        maxMenuHeight: 120,\r\n      },\r\n      validation: Yup.array().test('clients', utils.string.t('validation.requiredClientOrCarrier'), function (value) {\r\n        return utils.generic.isValidArray(this.options.parent.carriers, true) || utils.generic.isValidArray(value, true) ? true : false;\r\n      }),\r\n    },\r\n    {\r\n      key: `carriers-${programmesCarriers.length}--${userProgrammesCarriers.length}`,\r\n      name: 'carriers',\r\n      label: utils.string.t('admin.form.carriers.label'),\r\n      type: 'autocomplete',\r\n      defaultValue: userProgrammesCarriers,\r\n      options: programmesCarriers || [],\r\n      optionKey: 'id',\r\n      optionLabel: 'name',\r\n      muiComponentProps: {\r\n        multiple: true,\r\n        'data-testid': 'carriers',\r\n      },\r\n      innerComponentProps: {\r\n        isMulti: true,\r\n        maxMenuHeight: 120,\r\n      },\r\n      validation: Yup.array().test('carriers', utils.string.t('validation.requiredClientOrCarrier'), function (value) {\r\n        return utils.generic.isValidArray(this.options.parent.clients, true) || utils.generic.isValidArray(value, true) ? true : false;\r\n      }),\r\n    },\r\n  ];\r\n\r\n  const actions = [\r\n    {\r\n      name: 'submit',\r\n      label: user.id ? utils.string.t('app.save') : utils.string.t('app.create'),\r\n      handler: handleSubmit,\r\n    },\r\n    {\r\n      name: 'cancel',\r\n      label: utils.string.t('app.cancel'),\r\n      handler: handleCancel,\r\n    },\r\n  ];\r\n\r\n  const fields = programmesUserId ? [...userFields, ...programmesFields] : [...userFields];\r\n\r\n  return isLoading ? (\r\n    <div style={{ height: 500 }}>\r\n      <Loader visible={isLoading} absolute />\r\n    </div>\r\n  ) : (\r\n    <AddEditUserView\r\n      actions={actions}\r\n      fields={fields}\r\n      userId={userEdgeId}\r\n      programmes={{ programmesUserId, handleAddToProgrammes }}\r\n      isLoading={isLoading}\r\n    />\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}