{"ast":null,"code":"import _objectSpread from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _s = $RefreshSig$();\n\nimport { useEffect, useState, useRef } from 'react';\nimport { useForm, useFieldArray } from 'react-hook-form';\nimport { useSelector, useDispatch } from 'react-redux'; // app\n\nimport { hideModal, showModal, removeFileUpload, getUploadedFiles, fetchDocumentMetaData, getDocumentMetaData, uploadFiles, getDmsContext, postDmsDocuments, getDocumentUploaded, selectRefDataNewDocumentTypesByContextSource, setDmsContext, selectSettlementCurrency, resetFileUpload, selectRefDataXbInstances, resetPostStatus, updateUploadDocumentDto, updateFileName, selectorDmsViewFiles } from 'stores';\nimport * as utils from 'utils';\nimport * as constants from 'consts';\n\nvar useDmsUpload = function useDmsUpload(documentTypeKey, selectedSourceId, metaDataSectionRef, postDmsDocumentsSuccess) {\n  _s();\n\n  var dispatch = useDispatch();\n  var errorRef = useRef(); // form\n\n  var _useForm = useForm(),\n      control = _useForm.control,\n      formState = _useForm.formState,\n      handleSubmit = _useForm.handleSubmit,\n      register = _useForm.register,\n      setValue = _useForm.setValue,\n      setError = _useForm.setError,\n      getValues = _useForm.getValues,\n      clearErrors = _useForm.clearErrors; // state\n\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      selectedItem = _useState2[0],\n      setSelectedItem = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      rowIndex = _useState4[0],\n      setRowIndex = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      indexDocTypeUnfilled = _useState6[0],\n      setRowIndexDocType = _useState6[1];\n\n  var _useState7 = useState(null),\n      _useState8 = _slicedToArray(_useState7, 2),\n      postSubmissionRowIndex = _useState8[0],\n      setPostSubmissionRowIndex = _useState8[1];\n\n  var _useState9 = useState(''),\n      _useState10 = _slicedToArray(_useState9, 2),\n      selectedItemClassification = _useState10[0],\n      setSelectedItemClassification = _useState10[1];\n\n  var _useState11 = useState(\"filesClassification\".concat('3')),\n      _useState12 = _slicedToArray(_useState11, 2),\n      rowIndexClassification = _useState12[0],\n      setRowIndexClassification = _useState12[1]; // redux\n\n\n  var uploadedFiles = useSelector(getUploadedFiles);\n\n  var _useSelector = useSelector(getDocumentMetaData),\n      documentMetaData = _useSelector.documentMetaData;\n\n  var dmsContext = useSelector(getDmsContext);\n  var refDataXbInstances = useSelector(selectRefDataXbInstances);\n\n  var _useSelector2 = useSelector(getDocumentUploaded),\n      isFulfilled = _useSelector2.isFulfilled,\n      isPending = _useSelector2.isPending,\n      isRejected = _useSelector2.isRejected,\n      documentDto = _useSelector2.documentDto,\n      refDocumentDto = _useSelector2.refDocumentDto;\n\n  var documentDetails = useSelector(selectorDmsViewFiles);\n  var sourceId = selectedSourceId ? selectedSourceId : constants.DMS_CLAIM_SOURCE_ID;\n\n  var _utils$dmsFormatter$g = utils.dmsFormatter.getDocumentTypeFilterKeys(dmsContext, sourceId, documentTypeKey),\n      dmsSectionKey = _utils$dmsFormatter$g.dmsSectionKey;\n\n  var isDmsFromPi = utils.dmsFormatter.isDmsFromPi(documentTypeKey);\n\n  var _ref = isDmsFromPi && utils.dmsFormatter.getDocumentTypeInfo(documentTypeKey),\n      documentTypeDescription = _ref.documentTypeDescription,\n      sectionKey = _ref.sectionKey,\n      dmsSourceID = _ref.dmsSourceID;\n\n  var documentTypesBeforeFilter = useSelector(selectRefDataNewDocumentTypesByContextSource(dmsSectionKey, sourceId));\n  var documentTypesAfterFilter = (dmsContext === constants.DMS_CONTEXT_POLICY || dmsContext === constants.DMS_CONTEXT_PROCESSING_INSTRUCTION) && isDmsFromPi ? documentTypesBeforeFilter === null || documentTypesBeforeFilter === void 0 ? void 0 : documentTypesBeforeFilter.filter(function (type) {\n    return type.documentTypeDescription === documentTypeDescription && type.sectionKey === sectionKey && type.sourceID === dmsSourceID;\n  }) : documentTypesBeforeFilter;\n  var currencies = useSelector(selectSettlementCurrency);\n  currencies = currencies.map(function (currency) {\n    return _objectSpread(_objectSpread({}, currency), {}, {\n      name: \"\".concat(currency.id, \" - \").concat(currency.name)\n    });\n  });\n  var docClassificationTypes = [{\n    id: 1,\n    value: utils.string.t('dms.upload.modalItems.classificationType.low')\n  }, {\n    id: 2,\n    value: utils.string.t('dms.upload.modalItems.classificationType.guarded')\n  }, {\n    id: 3,\n    value: utils.string.t('dms.upload.modalItems.classificationType.high')\n  }, {\n    id: 4,\n    value: utils.string.t('dms.upload.modalItems.classificationType.severe')\n  }];\n\n  var _utils$dmsFormatter$f = utils.dmsFormatter.formatDocumentMetaData(documentMetaData, dmsContext, refDataXbInstances),\n      commonInfo = _utils$dmsFormatter$f.commonInfo,\n      lossInfo = _utils$dmsFormatter$f.lossInfo,\n      claimInfo = _utils$dmsFormatter$f.claimInfo,\n      policyInfo = _utils$dmsFormatter$f.policyInfo;\n\n  var cols = [{\n    id: 'fileName',\n    label: utils.string.t('claims.lossInformation.dmsUploadDocument.cols.fileName')\n  }, {\n    id: 'documentType',\n    label: utils.string.t('claims.lossInformation.dmsUploadDocument.cols.documentType')\n  }, {\n    id: 'documentClassification',\n    label: utils.string.t('claims.lossInformation.dmsUploadDocument.cols.documentClassification')\n  }, {\n    id: 'tag',\n    label: utils.string.t('claims.lossInformation.dmsUploadDocument.cols.tag')\n  }, {\n    id: 'removeDoc',\n    empty: true\n  }];\n\n  var _useFieldArray = useFieldArray({\n    control: control,\n    name: 'files'\n  }),\n      fieldsArray = _useFieldArray.fields,\n      appendFieldArray = _useFieldArray.append,\n      removeFieldArray = _useFieldArray.remove;\n\n  var getFileKey = utils.dmsFormatter.getFileKey;\n  var duplicateIndex = utils.dmsFormatter.getDuplicateIndexes(fieldsArray, documentDetails);\n\n  var handleCancel = function handleCancel() {\n    return function () {\n      dispatch(hideModal(constants.DMS_MODULE));\n    };\n  };\n\n  var handleShowModal = function handleShowModal(newContext) {\n    return function (files) {\n      dispatch(setDmsContext(newContext));\n      dispatch(showModal({\n        component: 'DMS_UPLOAD',\n        props: {\n          fullWidth: true,\n          title: utils.string.t('dms.upload.modalItems.uploadDocuments'),\n          maxWidth: 'xl',\n          componentProps: {\n            confirmLabel: utils.string.t('app.ok'),\n            cancelLabel: utils.string.t('app.goBack'),\n            confirmMessage: utils.string.t('processingInstructions.documentsWillNotBeSaved'),\n            buttonColors: {\n              confirm: 'secondary',\n              cancel: 'primary'\n            }\n          }\n        }\n      }));\n      var uniqueFiles = utils.dmsFormatter.getUniqueFiles(files, uploadedFiles);\n      dispatch(uploadFiles(uniqueFiles));\n    };\n  };\n\n  var handleSubmitUpload = function handleSubmitUpload(formValues) {\n    var hasSingleDocumentType = (documentTypesAfterFilter === null || documentTypesAfterFilter === void 0 ? void 0 : documentTypesAfterFilter.length) === 1;\n\n    if (hasSingleDocumentType) {\n      formValues = _objectSpread(_objectSpread({}, formValues), {}, {\n        files0: documentTypesAfterFilter[0]\n      });\n    }\n\n    utils.dmsFormatter.getInvalidInputs(fieldsArray, formValues, setError);\n    var isDocTypeVaild = !hasSingleDocumentType && utils.dmsFormatter.getSelectedDocumentType(formValues, uploadedFiles).length > 0;\n    if (!hasSingleDocumentType) setRowIndexDocType(utils.dmsFormatter.getSelectedDocumentType(formValues, uploadedFiles));\n\n    if (!isDocTypeVaild || isFulfilled && formState.isSubmitSuccessful) {\n      var _documentTypesAfterFi;\n\n      var metaData = {\n        catCodesID: documentMetaData === null || documentMetaData === void 0 ? void 0 : documentMetaData.catCodesID,\n        year: documentMetaData === null || documentMetaData === void 0 ? void 0 : documentMetaData.year,\n        lossName: documentMetaData === null || documentMetaData === void 0 ? void 0 : documentMetaData.lossName,\n        documentTypeId: hasSingleDocumentType ? (_documentTypesAfterFi = documentTypesAfterFilter[0]) === null || _documentTypesAfterFi === void 0 ? void 0 : _documentTypesAfterFi.documentTypeID : selectedItem === null || selectedItem === void 0 ? void 0 : selectedItem.documentTypeID,\n        sourceId: documentMetaData === null || documentMetaData === void 0 ? void 0 : documentMetaData.xbInstanceId,\n        documentTypeDescription: selectedItem === null || selectedItem === void 0 ? void 0 : selectedItem.documentTypeDescription,\n        claimId: documentMetaData === null || documentMetaData === void 0 ? void 0 : documentMetaData.claimId\n      };\n\n      if (!errorRef.current) {\n        dispatch(postDmsDocuments({\n          fieldsArray: fieldsArray,\n          metaData: metaData,\n          formValues: formValues,\n          documentTypeKey: documentTypeKey\n        })).then(function (data) {\n          var _data$status;\n\n          if ((data === null || data === void 0 ? void 0 : (_data$status = data.status) === null || _data$status === void 0 ? void 0 : _data$status.toLowerCase()) === constants.API_RESPONSE_OK.toLowerCase()) postDmsDocumentsSuccess(data);\n        });\n      }\n    }\n  };\n\n  var isActionDispatched = utils.dmsFormatter.getActionDispatched(isPending, isFulfilled, isRejected);\n  var hasPaymentDocumentType = utils.dmsFormatter.getPaymentDocumentType(selectedItem);\n  var getIcons = utils.dmsFormatter.getIcons;\n\n  var handleRemoveFiles = function handleRemoveFiles(fileName) {\n    return function (index) {\n      if (isActionDispatched || !formState.isSubmitSuccessful) {\n        removeFieldArray(index);\n        dispatch(removeFileUpload(fileName));\n      }\n    };\n  };\n\n  var handleSelectDocClassification = function handleSelectDocClassification(selectedItemClassification, index) {\n    setSelectedItemClassification(selectedItemClassification);\n    setValue(\"filesClassification\".concat(index), selectedItemClassification);\n    setRowIndexClassification(index);\n  };\n\n  var handleResetFilter = function handleResetFilter() {\n    fieldsArray === null || fieldsArray === void 0 ? void 0 : fieldsArray.forEach(function (data, index) {\n      setValue(\"files\".concat(index), undefined);\n    });\n    setSelectedItem('');\n  };\n\n  var handleSelectedItem = function handleSelectedItem(selectedItem, index) {\n    setSelectedItem(selectedItem);\n    setValue(\"files\".concat(index), selectedItem);\n    setRowIndex(index);\n    var hasSignleDocumentType = (documentTypesAfterFilter === null || documentTypesAfterFilter === void 0 ? void 0 : documentTypesAfterFilter.length) === 1;\n\n    if (!hasSignleDocumentType && indexDocTypeUnfilled.includes(index)) {\n      var arr = indexDocTypeUnfilled;\n      setRowIndexDocType(arr.filter(function (data) {\n        return data !== index;\n      }));\n    }\n  };\n\n  var handleInputChange = function handleInputChange(name, index) {\n    return function (e) {\n      setValue(name, e.target.value);\n      dispatch(updateFileName({\n        fileName: e.target.value,\n        fileIndex: index\n      }));\n\n      if (errorRef.current) {\n        clearErrors(name);\n      }\n    };\n  };\n\n  var handleSingleFileSubmission = function handleSingleFileSubmission(index) {\n    setPostSubmissionRowIndex(index);\n    return utils.dmsFormatter.setCurrentFieldValues(index, getValues);\n  };\n\n  useEffect(function () {\n    if (isFulfilled) {\n      documentDto.forEach(function (item, i) {\n        if (item.documentUploaded) {\n          dispatch(removeFileUpload(item.documentName));\n          dispatch(updateUploadDocumentDto(item.documentName));\n        }\n      });\n    }\n  }, [isFulfilled, documentDto, dispatch]);\n  useEffect(function () {\n    dispatch(fetchDocumentMetaData(sourceId, metaDataSectionRef));\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(function () {\n    removeFieldArray(fieldsArray);\n    appendFieldArray(uploadedFiles); // TODO - remove this rule in the next PR\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [uploadedFiles === null || uploadedFiles === void 0 ? void 0 : uploadedFiles.length]);\n  useEffect(function () {\n    if (Object.keys(formState.errors).length > 0) {\n      errorRef.current = true;\n    } else {\n      errorRef.current = false;\n    }\n  }, [formState.errors]);\n  useEffect(function () {\n    return function () {\n      if (!isActionDispatched) {\n        dispatch(resetFileUpload());\n      }\n    };\n  }, [isActionDispatched, dispatch]);\n  return {\n    uploadedFiles: uploadedFiles,\n    getFileKey: getFileKey,\n    handleRemoveFiles: handleRemoveFiles,\n    fieldsArray: fieldsArray,\n    formState: formState,\n    control: control,\n    cols: cols,\n    handleShowModal: handleShowModal,\n    commonInfo: commonInfo,\n    lossInfo: lossInfo,\n    claimInfo: claimInfo,\n    policyInfo: policyInfo,\n    handleSubmit: handleSubmit,\n    handleSubmitUpload: handleSubmitUpload,\n    isPending: isPending,\n    isRejected: isRejected,\n    isFulfilled: isFulfilled,\n    getIcons: getIcons,\n    dmsContext: dmsContext,\n    handleCancel: handleCancel,\n    documentTypes: documentTypesAfterFilter,\n    hasPaymentDocumentType: hasPaymentDocumentType,\n    rowIndex: rowIndex,\n    handleSelectedItem: handleSelectedItem,\n    selectedItem: selectedItem,\n    documentDto: documentDto,\n    register: register,\n    getValues: getValues,\n    duplicateIndex: duplicateIndex,\n    handleSelectDocClassification: handleSelectDocClassification,\n    selectedItemClassification: selectedItemClassification,\n    rowIndexClassification: rowIndexClassification,\n    docClassificationTypes: docClassificationTypes,\n    indexDocTypeUnfilled: indexDocTypeUnfilled,\n    setValue: setValue,\n    currencies: currencies,\n    handleInputChange: handleInputChange,\n    resetPostStatus: resetPostStatus,\n    handleSingleFileSubmission: handleSingleFileSubmission,\n    isActionDispatched: isActionDispatched,\n    handleResetFilter: handleResetFilter,\n    postSubmissionRowIndex: postSubmissionRowIndex,\n    refDocumentDto: refDocumentDto,\n    isDmsFromPi: isDmsFromPi\n  };\n};\n\n_s(useDmsUpload, \"Z5jOyWrw7qU3OhxU+Ir7NJtADFU=\", false, function () {\n  return [useDispatch, useForm, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useFieldArray];\n});\n\nexport default useDmsUpload;","map":{"version":3,"sources":["E:/MPHASIS/claims-page/Mphasis-Edge/src/forms/DmsUpload/useDmsUpload.js"],"names":["useEffect","useState","useRef","useForm","useFieldArray","useSelector","useDispatch","hideModal","showModal","removeFileUpload","getUploadedFiles","fetchDocumentMetaData","getDocumentMetaData","uploadFiles","getDmsContext","postDmsDocuments","getDocumentUploaded","selectRefDataNewDocumentTypesByContextSource","setDmsContext","selectSettlementCurrency","resetFileUpload","selectRefDataXbInstances","resetPostStatus","updateUploadDocumentDto","updateFileName","selectorDmsViewFiles","utils","constants","useDmsUpload","documentTypeKey","selectedSourceId","metaDataSectionRef","postDmsDocumentsSuccess","dispatch","errorRef","control","formState","handleSubmit","register","setValue","setError","getValues","clearErrors","selectedItem","setSelectedItem","rowIndex","setRowIndex","indexDocTypeUnfilled","setRowIndexDocType","postSubmissionRowIndex","setPostSubmissionRowIndex","selectedItemClassification","setSelectedItemClassification","rowIndexClassification","setRowIndexClassification","uploadedFiles","documentMetaData","dmsContext","refDataXbInstances","isFulfilled","isPending","isRejected","documentDto","refDocumentDto","documentDetails","sourceId","DMS_CLAIM_SOURCE_ID","dmsFormatter","getDocumentTypeFilterKeys","dmsSectionKey","isDmsFromPi","getDocumentTypeInfo","documentTypeDescription","sectionKey","dmsSourceID","documentTypesBeforeFilter","documentTypesAfterFilter","DMS_CONTEXT_POLICY","DMS_CONTEXT_PROCESSING_INSTRUCTION","filter","type","sourceID","currencies","map","currency","name","id","docClassificationTypes","value","string","t","formatDocumentMetaData","commonInfo","lossInfo","claimInfo","policyInfo","cols","label","empty","fieldsArray","fields","appendFieldArray","append","removeFieldArray","remove","getFileKey","duplicateIndex","getDuplicateIndexes","handleCancel","DMS_MODULE","handleShowModal","newContext","files","component","props","fullWidth","title","maxWidth","componentProps","confirmLabel","cancelLabel","confirmMessage","buttonColors","confirm","cancel","uniqueFiles","getUniqueFiles","handleSubmitUpload","formValues","hasSingleDocumentType","length","files0","getInvalidInputs","isDocTypeVaild","getSelectedDocumentType","isSubmitSuccessful","metaData","catCodesID","year","lossName","documentTypeId","documentTypeID","xbInstanceId","claimId","current","then","data","status","toLowerCase","API_RESPONSE_OK","isActionDispatched","getActionDispatched","hasPaymentDocumentType","getPaymentDocumentType","getIcons","handleRemoveFiles","fileName","index","handleSelectDocClassification","handleResetFilter","forEach","undefined","handleSelectedItem","hasSignleDocumentType","includes","arr","handleInputChange","e","target","fileIndex","handleSingleFileSubmission","setCurrentFieldValues","item","i","documentUploaded","documentName","Object","keys","errors","documentTypes"],"mappings":"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","sourcesContent":["import { useEffect, useState, useRef } from 'react';\r\nimport { useForm, useFieldArray } from 'react-hook-form';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\n\r\n// app\r\nimport {\r\n  hideModal,\r\n  showModal,\r\n  removeFileUpload,\r\n  getUploadedFiles,\r\n  fetchDocumentMetaData,\r\n  getDocumentMetaData,\r\n  uploadFiles,\r\n  getDmsContext,\r\n  postDmsDocuments,\r\n  getDocumentUploaded,\r\n  selectRefDataNewDocumentTypesByContextSource,\r\n  setDmsContext,\r\n  selectSettlementCurrency,\r\n  resetFileUpload,\r\n  selectRefDataXbInstances,\r\n  resetPostStatus,\r\n  updateUploadDocumentDto,\r\n  updateFileName,\r\n  selectorDmsViewFiles,\r\n} from 'stores';\r\nimport * as utils from 'utils';\r\nimport * as constants from 'consts';\r\n\r\nconst useDmsUpload = (documentTypeKey, selectedSourceId, metaDataSectionRef, postDmsDocumentsSuccess) => {\r\n  const dispatch = useDispatch();\r\n  const errorRef = useRef();\r\n\r\n  // form\r\n  const { control, formState, handleSubmit, register, setValue, setError, getValues, clearErrors } = useForm();\r\n\r\n  // state\r\n  const [selectedItem, setSelectedItem] = useState('');\r\n  const [rowIndex, setRowIndex] = useState(null);\r\n  const [indexDocTypeUnfilled, setRowIndexDocType] = useState([]);\r\n  const [postSubmissionRowIndex, setPostSubmissionRowIndex] = useState(null);\r\n  const [selectedItemClassification, setSelectedItemClassification] = useState('');\r\n  const [rowIndexClassification, setRowIndexClassification] = useState(`filesClassification${'3'}`);\r\n\r\n  // redux\r\n  const uploadedFiles = useSelector(getUploadedFiles);\r\n  const { documentMetaData } = useSelector(getDocumentMetaData);\r\n  const dmsContext = useSelector(getDmsContext);\r\n  const refDataXbInstances = useSelector(selectRefDataXbInstances);\r\n  const { isFulfilled, isPending, isRejected, documentDto, refDocumentDto } = useSelector(getDocumentUploaded);\r\n  const documentDetails = useSelector(selectorDmsViewFiles);\r\n\r\n  const sourceId = selectedSourceId ? selectedSourceId : constants.DMS_CLAIM_SOURCE_ID;\r\n\r\n  const { dmsSectionKey } = utils.dmsFormatter.getDocumentTypeFilterKeys(dmsContext, sourceId, documentTypeKey);\r\n  const isDmsFromPi = utils.dmsFormatter.isDmsFromPi(documentTypeKey);\r\n  const { documentTypeDescription, sectionKey, dmsSourceID } = isDmsFromPi && utils.dmsFormatter.getDocumentTypeInfo(documentTypeKey);\r\n\r\n  const documentTypesBeforeFilter = useSelector(selectRefDataNewDocumentTypesByContextSource(dmsSectionKey, sourceId));\r\n  const documentTypesAfterFilter =\r\n    (dmsContext === constants.DMS_CONTEXT_POLICY || dmsContext === constants.DMS_CONTEXT_PROCESSING_INSTRUCTION) && isDmsFromPi\r\n      ? documentTypesBeforeFilter?.filter(\r\n          (type) =>\r\n            type.documentTypeDescription === documentTypeDescription && type.sectionKey === sectionKey && type.sourceID === dmsSourceID\r\n        )\r\n      : documentTypesBeforeFilter;\r\n\r\n  let currencies = useSelector(selectSettlementCurrency);\r\n  currencies = currencies.map((currency) => ({ ...currency, name: `${currency.id} - ${currency.name}` }));\r\n\r\n  const docClassificationTypes = [\r\n    { id: 1, value: utils.string.t('dms.upload.modalItems.classificationType.low') },\r\n    { id: 2, value: utils.string.t('dms.upload.modalItems.classificationType.guarded') },\r\n    { id: 3, value: utils.string.t('dms.upload.modalItems.classificationType.high') },\r\n    { id: 4, value: utils.string.t('dms.upload.modalItems.classificationType.severe') },\r\n  ];\r\n  const { commonInfo, lossInfo, claimInfo, policyInfo } = utils.dmsFormatter.formatDocumentMetaData(\r\n    documentMetaData,\r\n    dmsContext,\r\n    refDataXbInstances\r\n  );\r\n\r\n  const cols = [\r\n    {\r\n      id: 'fileName',\r\n      label: utils.string.t('claims.lossInformation.dmsUploadDocument.cols.fileName'),\r\n    },\r\n    {\r\n      id: 'documentType',\r\n      label: utils.string.t('claims.lossInformation.dmsUploadDocument.cols.documentType'),\r\n    },\r\n    {\r\n      id: 'documentClassification',\r\n      label: utils.string.t('claims.lossInformation.dmsUploadDocument.cols.documentClassification'),\r\n    },\r\n    {\r\n      id: 'tag',\r\n      label: utils.string.t('claims.lossInformation.dmsUploadDocument.cols.tag'),\r\n    },\r\n    {\r\n      id: 'removeDoc',\r\n      empty: true,\r\n    },\r\n  ];\r\n\r\n  const {\r\n    fields: fieldsArray,\r\n    append: appendFieldArray,\r\n    remove: removeFieldArray,\r\n  } = useFieldArray({\r\n    control,\r\n    name: 'files',\r\n  });\r\n\r\n  const getFileKey = utils.dmsFormatter.getFileKey;\r\n  const duplicateIndex = utils.dmsFormatter.getDuplicateIndexes(fieldsArray, documentDetails);\r\n\r\n  const handleCancel = () => () => {\r\n    dispatch(hideModal(constants.DMS_MODULE));\r\n  };\r\n\r\n  const handleShowModal = (newContext) => (files) => {\r\n    dispatch(setDmsContext(newContext));\r\n    dispatch(\r\n      showModal({\r\n        component: 'DMS_UPLOAD',\r\n        props: {\r\n          fullWidth: true,\r\n          title: utils.string.t('dms.upload.modalItems.uploadDocuments'),\r\n          maxWidth: 'xl',\r\n          componentProps: {\r\n            confirmLabel: utils.string.t('app.ok'),\r\n            cancelLabel: utils.string.t('app.goBack'),\r\n            confirmMessage: utils.string.t('processingInstructions.documentsWillNotBeSaved'),\r\n            buttonColors: { confirm: 'secondary', cancel: 'primary' },\r\n          },\r\n        },\r\n      })\r\n    );\r\n    const uniqueFiles = utils.dmsFormatter.getUniqueFiles(files, uploadedFiles);\r\n    dispatch(uploadFiles(uniqueFiles));\r\n  };\r\n\r\n  const handleSubmitUpload = (formValues) => {\r\n    const hasSingleDocumentType = documentTypesAfterFilter?.length === 1;\r\n    if (hasSingleDocumentType) {\r\n      formValues = { ...formValues, files0: documentTypesAfterFilter[0] };\r\n    }\r\n    utils.dmsFormatter.getInvalidInputs(fieldsArray, formValues, setError);\r\n    const isDocTypeVaild = !hasSingleDocumentType && utils.dmsFormatter.getSelectedDocumentType(formValues, uploadedFiles).length > 0;\r\n    if (!hasSingleDocumentType) setRowIndexDocType(utils.dmsFormatter.getSelectedDocumentType(formValues, uploadedFiles));\r\n\r\n    if (!isDocTypeVaild || (isFulfilled && formState.isSubmitSuccessful)) {\r\n      const metaData = {\r\n        catCodesID: documentMetaData?.catCodesID,\r\n        year: documentMetaData?.year,\r\n        lossName: documentMetaData?.lossName,\r\n        documentTypeId: hasSingleDocumentType ? documentTypesAfterFilter[0]?.documentTypeID : selectedItem?.documentTypeID,\r\n        sourceId: documentMetaData?.xbInstanceId,\r\n        documentTypeDescription: selectedItem?.documentTypeDescription,\r\n        claimId: documentMetaData?.claimId,\r\n      };\r\n\r\n      if (!errorRef.current) {\r\n        dispatch(postDmsDocuments({ fieldsArray, metaData, formValues, documentTypeKey })).then((data) => {\r\n          if (data?.status?.toLowerCase() === constants.API_RESPONSE_OK.toLowerCase()) postDmsDocumentsSuccess(data);\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n  const isActionDispatched = utils.dmsFormatter.getActionDispatched(isPending, isFulfilled, isRejected);\r\n  const hasPaymentDocumentType = utils.dmsFormatter.getPaymentDocumentType(selectedItem);\r\n  const getIcons = utils.dmsFormatter.getIcons;\r\n\r\n  const handleRemoveFiles = (fileName) => (index) => {\r\n    if (isActionDispatched || !formState.isSubmitSuccessful) {\r\n      removeFieldArray(index);\r\n      dispatch(removeFileUpload(fileName));\r\n    }\r\n  };\r\n\r\n  const handleSelectDocClassification = (selectedItemClassification, index) => {\r\n    setSelectedItemClassification(selectedItemClassification);\r\n    setValue(`filesClassification${index}`, selectedItemClassification);\r\n    setRowIndexClassification(index);\r\n  };\r\n  const handleResetFilter = () => {\r\n    fieldsArray?.forEach((data, index) => {\r\n      setValue(`files${index}`, undefined);\r\n    });\r\n    setSelectedItem('');\r\n  };\r\n  const handleSelectedItem = (selectedItem, index) => {\r\n    setSelectedItem(selectedItem);\r\n    setValue(`files${index}`, selectedItem);\r\n    setRowIndex(index);\r\n    const hasSignleDocumentType = documentTypesAfterFilter?.length === 1;\r\n    if (!hasSignleDocumentType && indexDocTypeUnfilled.includes(index)) {\r\n      const arr = indexDocTypeUnfilled;\r\n      setRowIndexDocType(arr.filter((data) => data !== index));\r\n    }\r\n  };\r\n\r\n  const handleInputChange = (name, index) => (e) => {\r\n    setValue(name, e.target.value);\r\n    dispatch(updateFileName({ fileName: e.target.value, fileIndex: index }));\r\n\r\n    if (errorRef.current) {\r\n      clearErrors(name);\r\n    }\r\n  };\r\n\r\n  const handleSingleFileSubmission = (index) => {\r\n    setPostSubmissionRowIndex(index);\r\n\r\n    return utils.dmsFormatter.setCurrentFieldValues(index, getValues);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isFulfilled) {\r\n      documentDto.forEach((item, i) => {\r\n        if (item.documentUploaded) {\r\n          dispatch(removeFileUpload(item.documentName));\r\n          dispatch(updateUploadDocumentDto(item.documentName));\r\n        }\r\n      });\r\n    }\r\n  }, [isFulfilled, documentDto, dispatch]);\r\n\r\n  useEffect(() => {\r\n    dispatch(fetchDocumentMetaData(sourceId, metaDataSectionRef));\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    removeFieldArray(fieldsArray);\r\n    appendFieldArray(uploadedFiles);\r\n    // TODO - remove this rule in the next PR\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [uploadedFiles?.length]);\r\n\r\n  useEffect(() => {\r\n    if (Object.keys(formState.errors).length > 0) {\r\n      errorRef.current = true;\r\n    } else {\r\n      errorRef.current = false;\r\n    }\r\n  }, [formState.errors]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (!isActionDispatched) {\r\n        dispatch(resetFileUpload());\r\n      }\r\n    };\r\n  }, [isActionDispatched, dispatch]);\r\n\r\n  return {\r\n    uploadedFiles,\r\n    getFileKey,\r\n    handleRemoveFiles,\r\n    fieldsArray,\r\n    formState,\r\n    control,\r\n    cols,\r\n    handleShowModal,\r\n    commonInfo,\r\n    lossInfo,\r\n    claimInfo,\r\n    policyInfo,\r\n    handleSubmit,\r\n    handleSubmitUpload,\r\n    isPending,\r\n    isRejected,\r\n    isFulfilled,\r\n    getIcons,\r\n    dmsContext,\r\n    handleCancel,\r\n    documentTypes: documentTypesAfterFilter,\r\n    hasPaymentDocumentType,\r\n    rowIndex,\r\n    handleSelectedItem,\r\n    selectedItem,\r\n    documentDto,\r\n    register,\r\n    getValues,\r\n    duplicateIndex,\r\n    handleSelectDocClassification,\r\n    selectedItemClassification,\r\n    rowIndexClassification,\r\n    docClassificationTypes,\r\n    indexDocTypeUnfilled,\r\n    setValue,\r\n    currencies,\r\n    handleInputChange,\r\n    resetPostStatus,\r\n    handleSingleFileSubmission,\r\n    isActionDispatched,\r\n    handleResetFilter,\r\n    postSubmissionRowIndex,\r\n    refDocumentDto,\r\n    isDmsFromPi\r\n  };\r\n};\r\n\r\nexport default useDmsUpload;\r\n"]},"metadata":{},"sourceType":"module"}