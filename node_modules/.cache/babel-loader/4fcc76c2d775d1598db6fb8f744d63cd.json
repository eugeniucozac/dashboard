{"ast":null,"code":"import _slicedToArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _toConsumableArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\n\nvar _jsxFileName = \"E:\\\\MPHASIS\\\\claims-page\\\\Mphasis-Edge\\\\src\\\\pages\\\\PremiumProcessingCaseDetails\\\\PremiumProcessingCaseDetails.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useHistory, useParams } from 'react-router';\nimport { Helmet } from 'react-helmet';\nimport get from 'lodash/get'; // app\n\nimport { PremiumProcessingCaseDetailsView } from './PremiumProcessingCaseDetails.view';\nimport { getCaseTeamModule, getCheckSigningCaseHistory, getCaseHistoryDetails, getCaseTeamDetails, selectCaseDetails, selectCaseRfiDetails, hideModal, showModal, selectRefDataNewProcessType, selectRefDataNewFacilityType, selectRefDataNewBordereauType, selectRefDataNewBordereauPolicyType, getCaseTeamDetailsSuccess, selectCaseIsCheckSigning, selectUser, selectPremiumProcessingCasesSelected, getCaseRFIDetails, selectcaseRfiSubTabs, getCaseRfiSubTabData, selectUserRole } from 'stores';\nimport { useConfirmNavigation } from 'hooks';\nimport * as constants from 'consts';\nimport * as utils from 'utils';\nimport config from 'config';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nvar PremiumProcessingCaseDetails = function PremiumProcessingCaseDetails() {\n  _s();\n\n  var _user$userRole, _user$userRole2;\n\n  var history = useHistory();\n  var dispatch = useDispatch();\n\n  var _useParams = useParams(),\n      id = _useParams.id,\n      tab = _useParams.tab;\n\n  var _useConfirmNavigation = useConfirmNavigation(),\n      confirmNavigation = _useConfirmNavigation.confirmNavigation;\n\n  var user = useSelector(selectUser);\n  var caseDetails = useSelector(selectCaseDetails);\n  var caseRfiDetails = useSelector(selectCaseRfiDetails);\n  var uiBrand = useSelector(function (state) {\n    return get(state, 'ui.brand');\n  });\n  var processTypeRefData = useSelector(selectRefDataNewProcessType) || [];\n  var facilityTypeRefData = useSelector(selectRefDataNewFacilityType) || [];\n  var bordereauTypeRefData = useSelector(selectRefDataNewBordereauType) || [];\n  var bordereauPolicyTypeRefData = useSelector(selectRefDataNewBordereauPolicyType) || [];\n  var isCheckSigning = useSelector(selectCaseIsCheckSigning) || false;\n  var cases = useSelector(selectPremiumProcessingCasesSelected);\n  var rfiSubTabs = useSelector(selectcaseRfiSubTabs);\n  var currentUser = useSelector(selectUserRole);\n  var isHistoryCases = (caseDetails === null || caseDetails === void 0 ? void 0 : caseDetails.taskView) === constants.ALL_CASES;\n  var isFrontEndContact = utils.generic.isValidArray(currentUser, true) && currentUser.some(function (item) {\n    return [constants.FRONT_END_CONTACT.toLowerCase()].includes(item.name.toLowerCase());\n  });\n  var isSeniorManager = utils.generic.isValidArray(currentUser, true) && currentUser.some(function (item) {\n    return [constants.SENIOR_MANAGER.toLowerCase()].includes(item.name.toLowerCase());\n  });\n  var isFCE = user === null || user === void 0 ? void 0 : (_user$userRole = user.userRole) === null || _user$userRole === void 0 ? void 0 : _user$userRole.some(function (role) {\n    return (role === null || role === void 0 ? void 0 : role.name) === constants.ROLE_FRONT_END_CONTACT;\n  });\n  var isOperationsLead = user === null || user === void 0 ? void 0 : (_user$userRole2 = user.userRole) === null || _user$userRole2 === void 0 ? void 0 : _user$userRole2.some(function (role) {\n    return (role === null || role === void 0 ? void 0 : role.name) === constants.ROLE_OPERATIONS_LEAD;\n  });\n  var hasDocumentSearchPermission = isFCE || isOperationsLead;\n  var taskId = id || '';\n  var processId = caseDetails.processId,\n      caseId = caseDetails.caseId,\n      caseStageDetails = caseDetails.caseStageDetails;\n  var rfiCaseId = caseRfiDetails === null || caseRfiDetails === void 0 ? void 0 : caseRfiDetails.caseId;\n  var rfiType = (caseRfiDetails === null || caseRfiDetails === void 0 ? void 0 : caseRfiDetails.rfiType) ? true : false;\n  var rfiProcessId = caseRfiDetails === null || caseRfiDetails === void 0 ? void 0 : caseRfiDetails.processId;\n  var isIssueDocumentStage = caseStageDetails === null || caseStageDetails === void 0 ? void 0 : caseStageDetails.some(function (cs) {\n    return [constants.BPM_STAGE_ISSUE_DOCUMENTS].includes(cs.bpmStageCode) && cs.active;\n  });\n  var isCompletedStage = caseStageDetails === null || caseStageDetails === void 0 ? void 0 : caseStageDetails.some(function (cs) {\n    return [constants.BPM_STAGE_COMPLETED].includes(cs.bpmStageCode) && cs.active;\n  });\n  var isRejectedStage = caseStageDetails === null || caseStageDetails === void 0 ? void 0 : caseStageDetails.some(function (cs) {\n    return [constants.BPM_STAGE_REJECTED].includes(cs.bpmStageCode) && cs.active;\n  });\n  var isRfiCase = utils.generic.isValidArray(cases, true) && utils.premiumProcessing.isRfi(cases === null || cases === void 0 ? void 0 : cases[0]);\n  var breadcrumbs = [{\n    name: 'premiumProcessing',\n    label: utils.string.t('premiumProcessing.breadcrumbs.home'),\n    link: config.routes.premiumProcessing.root\n  }].concat(_toConsumableArray(caseId || rfiCaseId ? [{\n    name: 'caseId',\n    label: utils.string.t('premiumProcessing.breadcrumbs.case', {\n      id: caseId || rfiCaseId\n    }),\n    link: '#',\n    active: true\n  }] : []));\n  var tabs = [{\n    value: constants.PREMIUM_PROCESSING_TAB_CASE_DETAILS,\n    label: utils.string.t('premiumProcessing.tabs.caseDetails')\n  }, {\n    value: constants.PREMIUM_PROCESSING_TAB_DOCUMENTS,\n    label: utils.string.t('premiumProcessing.tabs.documents')\n  }, {\n    value: constants.PREMIUM_PROCESSING_TAB_RFI,\n    label: utils.string.t('premiumProcessing.tabs.rfi')\n  }].concat(_toConsumableArray(!isCheckSigning ? [{\n    value: constants.PREMIUM_PROCESSING_TAB_ISSUE_DOCUMENTS,\n    label: utils.string.t('premiumProcessing.tabs.issueDocuments'),\n    disabled: !isIssueDocumentStage && !isCompletedStage && !isRejectedStage\n  }] : []), [{\n    value: constants.PREMIUM_PROCESSING_TAB_NOTES,\n    label: utils.string.t('premiumProcessing.tabs.notes')\n  }], _toConsumableArray(isCheckSigning ? [{\n    value: constants.PREMIUM_PROCESSING_TAB_HISTORY,\n    label: utils.string.t('premiumProcessing.tabs.history')\n  }] : []));\n  var isValidTab = tabs.map(function (item) {\n    return item.value;\n  }).includes(tab);\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      isDataLoaded = _useState2[0],\n      setIsDataLoaded = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      isPageDirty = _useState4[0],\n      setIsPageDirty = _useState4[1];\n\n  var _useState5 = useState(isValidTab ? tab : constants.PREMIUM_PROCESSING_TAB_CASE_DETAILS),\n      _useState6 = _slicedToArray(_useState5, 2),\n      selectedTab = _useState6[0],\n      setSelectedTab = _useState6[1];\n\n  var openUpdatingPopup = function openUpdatingPopup() {\n    dispatch(showModal({\n      component: 'CONFIRM',\n      props: {\n        fullWidth: true,\n        title: utils.string.t('premiumProcessing.alert'),\n        maxWidth: 'xs',\n        componentProps: {\n          hideCancelButton: true,\n          confirmLabel: utils.string.t('processingInstructions.authorisations.form.confirm'),\n          confirmMessage: /*#__PURE__*/_jsxDEV(\"span\", {\n            dangerouslySetInnerHTML: {\n              __html: \"\".concat(utils.string.t('premiumProcessing.piHyperLinkErrorMessage'))\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 136,\n            columnNumber: 15\n          }, _this),\n          buttonColors: {\n            confirm: 'secondary'\n          },\n          submitHandler: function submitHandler() {},\n          handleClose: function handleClose() {}\n        }\n      }\n    }));\n  };\n\n  var switchTab = function switchTab(newTab) {\n    setSelectedTab(newTab);\n    setIsPageDirty(false);\n    history.replace(\"\".concat(config.routes.premiumProcessing.case).concat(taskId ? \"/\".concat(taskId) : '').concat(tab ? \"/\".concat(newTab) : ''));\n    dispatch(hideModal());\n  };\n\n  var stayOnTab = function stayOnTab() {\n    dispatch(hideModal());\n  };\n\n  useEffect(function () {\n    if (caseId || rfiCaseId) {\n      var caseIdData = caseId || rfiCaseId;\n      dispatch(getCaseRfiSubTabData(caseIdData));\n    }\n  }, [dispatch, caseId]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  var selectTab = function selectTab(tab) {\n    if (isPageDirty) {\n      confirmNavigation(function () {\n        return switchTab(tab);\n      }, stayOnTab);\n    } else {\n      setIsPageDirty(false);\n      setSelectedTab(tab); // history tab in PP rfi to land directly on the particular tab\n\n      if ((isHistoryCases || isFrontEndContact || isSeniorManager) && rfiSubTabs.length >= 1) {\n        var _selectedList$;\n\n        var selectedList = rfiSubTabs.filter(function (item) {\n          return item;\n        }, 'taskId');\n        history.replace(\"\".concat(config.routes.premiumProcessing.case).concat(taskId ? \"/\".concat(taskId) : '').concat(tab ? \"/\".concat(tab) : '').concat(tab === constants.PREMIUM_PROCESSING_TAB_RFI ? \"/\".concat((_selectedList$ = selectedList[0]) === null || _selectedList$ === void 0 ? void 0 : _selectedList$.taskId) : tab === constants.PREMIUM_PROCESSING_TAB_ISSUE_DOCUMENTS ? \"/\".concat(constants.PREMIUM_PROCESSING_TAB_NON_BUREAU) : ''));\n      } else {\n        history.replace(\"\".concat(config.routes.premiumProcessing.case).concat(taskId ? \"/\".concat(taskId) : '').concat(tab ? \"/\".concat(tab) : '').concat(tab === constants.PREMIUM_PROCESSING_TAB_RFI ? \"/\".concat(constants.PREMIUM_PROCESSING_TAB_NEW_RFI) : tab === constants.PREMIUM_PROCESSING_TAB_ISSUE_DOCUMENTS ? \"/\".concat(constants.PREMIUM_PROCESSING_TAB_NON_BUREAU) : ''));\n      }\n    }\n  };\n\n  useEffect(function () {\n    if (isRfiCase) {\n      var _cases$;\n\n      dispatch(getCaseRFIDetails({\n        taskId: (_cases$ = cases[0]) === null || _cases$ === void 0 ? void 0 : _cases$.taskId\n      }));\n    }\n\n    if (taskId && !isDataLoaded) {\n      dispatch(getCaseTeamDetails({\n        taskId: taskId,\n        taskView: caseDetails.taskView || constants.WORKLIST\n      })).then(function (response) {\n        if ((response === null || response === void 0 ? void 0 : response.message) === constants.API_RESPONSE_SUCCESS) {\n          var _response$status;\n\n          if ((response === null || response === void 0 ? void 0 : (_response$status = response.status) === null || _response$status === void 0 ? void 0 : _response$status.toUpperCase()) === constants.API_RESPONSE_OK) {\n            var _response$data, _response$data$caseDe, _response$data2, _response$data2$caseD, _response$data3, _response$data3$caseD, _response$data4, _response$data4$caseD, _response$data7, _response$data7$caseD;\n\n            response.data.caseDetails.processId = ((_response$data = response.data) === null || _response$data === void 0 ? void 0 : (_response$data$caseDe = _response$data.caseDetails) === null || _response$data$caseDe === void 0 ? void 0 : _response$data$caseDe.processId) && utils.referenceData.processTypes.getNameById(processTypeRefData, (_response$data2 = response.data) === null || _response$data2 === void 0 ? void 0 : (_response$data2$caseD = _response$data2.caseDetails) === null || _response$data2$caseD === void 0 ? void 0 : _response$data2$caseD.processId) || '';\n\n            if (((_response$data3 = response.data) === null || _response$data3 === void 0 ? void 0 : (_response$data3$caseD = _response$data3.caseDetails) === null || _response$data3$caseD === void 0 ? void 0 : _response$data3$caseD.processId) === constants.FDO && ((_response$data4 = response.data) === null || _response$data4 === void 0 ? void 0 : (_response$data4$caseD = _response$data4.caseDetails) === null || _response$data4$caseD === void 0 ? void 0 : _response$data4$caseD.facilityTypeId)) {\n              var _response$data5, _response$data5$caseD, _response$data6, _response$data6$caseD;\n\n              var facilityTypesName = utils.generic.isValidArray(facilityTypeRefData, true) && ((_response$data5 = response.data) === null || _response$data5 === void 0 ? void 0 : (_response$data5$caseD = _response$data5.caseDetails) === null || _response$data5$caseD === void 0 ? void 0 : _response$data5$caseD.facilityTypeId) && utils.referenceData.facilityTypes.getNameById(facilityTypeRefData, (_response$data6 = response.data) === null || _response$data6 === void 0 ? void 0 : (_response$data6$caseD = _response$data6.caseDetails) === null || _response$data6$caseD === void 0 ? void 0 : _response$data6$caseD.facilityTypeId) || '';\n              response.data.caseDetails.facilityTypeId = facilityTypesName;\n            }\n\n            if (((_response$data7 = response.data) === null || _response$data7 === void 0 ? void 0 : (_response$data7$caseD = _response$data7.caseDetails) === null || _response$data7$caseD === void 0 ? void 0 : _response$data7$caseD.processId) === constants.BORDEREAU) {\n              var _response$data8, _response$data8$caseD, _response$data11, _response$data11$case;\n\n              if ((_response$data8 = response.data) === null || _response$data8 === void 0 ? void 0 : (_response$data8$caseD = _response$data8.caseDetails) === null || _response$data8$caseD === void 0 ? void 0 : _response$data8$caseD.bordereauTypeId) {\n                var _response$data9, _response$data9$caseD, _response$data10, _response$data10$case;\n\n                var bordereauTypeName = utils.generic.isValidArray(bordereauTypeRefData, true) && ((_response$data9 = response.data) === null || _response$data9 === void 0 ? void 0 : (_response$data9$caseD = _response$data9.caseDetails) === null || _response$data9$caseD === void 0 ? void 0 : _response$data9$caseD.bordereauTypeId) && utils.referenceData.bordereauTypes.getNameById(bordereauTypeRefData, (_response$data10 = response.data) === null || _response$data10 === void 0 ? void 0 : (_response$data10$case = _response$data10.caseDetails) === null || _response$data10$case === void 0 ? void 0 : _response$data10$case.bordereauTypeId) || '';\n                response.data.caseDetails.bordereauTypeId = bordereauTypeName;\n              }\n\n              if ((_response$data11 = response.data) === null || _response$data11 === void 0 ? void 0 : (_response$data11$case = _response$data11.caseDetails) === null || _response$data11$case === void 0 ? void 0 : _response$data11$case.policyTypeId) {\n                var _response$data12, _response$data12$case, _response$data13, _response$data13$case;\n\n                var bordereauPolicyTypeName = utils.generic.isValidArray(bordereauPolicyTypeRefData, true) && ((_response$data12 = response.data) === null || _response$data12 === void 0 ? void 0 : (_response$data12$case = _response$data12.caseDetails) === null || _response$data12$case === void 0 ? void 0 : _response$data12$case.policyTypeId) && utils.referenceData.bordereauPolicyTypes.getNameById(bordereauPolicyTypeRefData, (_response$data13 = response.data) === null || _response$data13 === void 0 ? void 0 : (_response$data13$case = _response$data13.caseDetails) === null || _response$data13$case === void 0 ? void 0 : _response$data13$case.policyTypeId) || '';\n                response.data.caseDetails.policyTypeId = bordereauPolicyTypeName;\n              }\n            }\n\n            dispatch(getCaseTeamDetailsSuccess(response.data));\n          }\n        }\n      });\n    }\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(function () {\n    var processIdData = processId ? processId : rfiProcessId;\n\n    var getData = function getData() {\n      var promises = [dispatch(getCaseTeamModule({\n        taskId: taskId,\n        rfiCaseId: rfiCaseId,\n        rfiType: rfiType\n      })), dispatch(getCaseHistoryDetails({\n        taskId: taskId,\n        processId: processId\n      })), dispatch(getCheckSigningCaseHistory({\n        processIdData: processIdData\n      }))];\n      return Promise.allSettled(promises).then(function (results) {\n        return Promise.resolve(results);\n      });\n    };\n\n    if (processId || rfiCaseId) {\n      getData().then(function (data) {\n        if (utils.generic.isValidArray(data, true)) {\n          setIsDataLoaded(true);\n        }\n      });\n    }\n  }, [taskId, processId, rfiCaseId, rfiType]); // eslint-disable-line react-hooks/exhaustive-deps\n  // abort\n\n  if (!isDataLoaded) {\n    return null;\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Helmet, {\n      children: /*#__PURE__*/_jsxDEV(\"title\", {\n        children: \"\".concat(utils.string.t('premiumProcessing.title'), \" - \").concat(utils.app.getAppName(uiBrand))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 9\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 277,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(PremiumProcessingCaseDetailsView, {\n      hasDocumentSearchPermission: hasDocumentSearchPermission,\n      taskId: taskId,\n      caseId: caseId,\n      caseDetails: caseDetails,\n      breadcrumbs: breadcrumbs,\n      tabs: tabs,\n      selectedTab: selectedTab,\n      isPageDirty: isPageDirty,\n      handlers: {\n        confirmNavigation: confirmNavigation,\n        openUpdatingPopup: openUpdatingPopup,\n        selectTab: selectTab,\n        setIsPageDirty: setIsPageDirty\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 280,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true);\n};\n\n_s(PremiumProcessingCaseDetails, \"3guLIaaNhuGE3CvQwLnYTQShf6w=\", false, function () {\n  return [useHistory, useDispatch, useParams, useConfirmNavigation, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector];\n});\n\n_c = PremiumProcessingCaseDetails;\nexport default PremiumProcessingCaseDetails;\n\nvar _c;\n\n$RefreshReg$(_c, \"PremiumProcessingCaseDetails\");","map":{"version":3,"sources":["E:/MPHASIS/claims-page/Mphasis-Edge/src/pages/PremiumProcessingCaseDetails/PremiumProcessingCaseDetails.js"],"names":["React","useEffect","useState","useSelector","useDispatch","useHistory","useParams","Helmet","get","PremiumProcessingCaseDetailsView","getCaseTeamModule","getCheckSigningCaseHistory","getCaseHistoryDetails","getCaseTeamDetails","selectCaseDetails","selectCaseRfiDetails","hideModal","showModal","selectRefDataNewProcessType","selectRefDataNewFacilityType","selectRefDataNewBordereauType","selectRefDataNewBordereauPolicyType","getCaseTeamDetailsSuccess","selectCaseIsCheckSigning","selectUser","selectPremiumProcessingCasesSelected","getCaseRFIDetails","selectcaseRfiSubTabs","getCaseRfiSubTabData","selectUserRole","useConfirmNavigation","constants","utils","config","PremiumProcessingCaseDetails","history","dispatch","id","tab","confirmNavigation","user","caseDetails","caseRfiDetails","uiBrand","state","processTypeRefData","facilityTypeRefData","bordereauTypeRefData","bordereauPolicyTypeRefData","isCheckSigning","cases","rfiSubTabs","currentUser","isHistoryCases","taskView","ALL_CASES","isFrontEndContact","generic","isValidArray","some","item","FRONT_END_CONTACT","toLowerCase","includes","name","isSeniorManager","SENIOR_MANAGER","isFCE","userRole","role","ROLE_FRONT_END_CONTACT","isOperationsLead","ROLE_OPERATIONS_LEAD","hasDocumentSearchPermission","taskId","processId","caseId","caseStageDetails","rfiCaseId","rfiType","rfiProcessId","isIssueDocumentStage","cs","BPM_STAGE_ISSUE_DOCUMENTS","bpmStageCode","active","isCompletedStage","BPM_STAGE_COMPLETED","isRejectedStage","BPM_STAGE_REJECTED","isRfiCase","premiumProcessing","isRfi","breadcrumbs","label","string","t","link","routes","root","tabs","value","PREMIUM_PROCESSING_TAB_CASE_DETAILS","PREMIUM_PROCESSING_TAB_DOCUMENTS","PREMIUM_PROCESSING_TAB_RFI","PREMIUM_PROCESSING_TAB_ISSUE_DOCUMENTS","disabled","PREMIUM_PROCESSING_TAB_NOTES","PREMIUM_PROCESSING_TAB_HISTORY","isValidTab","map","isDataLoaded","setIsDataLoaded","isPageDirty","setIsPageDirty","selectedTab","setSelectedTab","openUpdatingPopup","component","props","fullWidth","title","maxWidth","componentProps","hideCancelButton","confirmLabel","confirmMessage","__html","buttonColors","confirm","submitHandler","handleClose","switchTab","newTab","replace","case","stayOnTab","caseIdData","selectTab","length","selectedList","filter","PREMIUM_PROCESSING_TAB_NON_BUREAU","PREMIUM_PROCESSING_TAB_NEW_RFI","WORKLIST","then","response","message","API_RESPONSE_SUCCESS","status","toUpperCase","API_RESPONSE_OK","data","referenceData","processTypes","getNameById","FDO","facilityTypeId","facilityTypesName","facilityTypes","BORDEREAU","bordereauTypeId","bordereauTypeName","bordereauTypes","policyTypeId","bordereauPolicyTypeName","bordereauPolicyTypes","processIdData","getData","promises","Promise","allSettled","results","resolve","app","getAppName"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { useHistory, useParams } from 'react-router';\r\nimport { Helmet } from 'react-helmet';\r\nimport get from 'lodash/get';\r\n\r\n// app\r\nimport { PremiumProcessingCaseDetailsView } from './PremiumProcessingCaseDetails.view';\r\nimport {\r\n  getCaseTeamModule,\r\n  getCheckSigningCaseHistory,\r\n  getCaseHistoryDetails,\r\n  getCaseTeamDetails,\r\n  selectCaseDetails,\r\n  selectCaseRfiDetails,\r\n  hideModal,\r\n  showModal,\r\n  selectRefDataNewProcessType,\r\n  selectRefDataNewFacilityType,\r\n  selectRefDataNewBordereauType,\r\n  selectRefDataNewBordereauPolicyType,\r\n  getCaseTeamDetailsSuccess,\r\n  selectCaseIsCheckSigning,\r\n  selectUser,\r\n  selectPremiumProcessingCasesSelected,\r\n  getCaseRFIDetails,\r\n  selectcaseRfiSubTabs,\r\n  getCaseRfiSubTabData,\r\n  selectUserRole,\r\n} from 'stores';\r\nimport { useConfirmNavigation } from 'hooks';\r\nimport * as constants from 'consts';\r\nimport * as utils from 'utils';\r\nimport config from 'config';\r\n\r\nconst PremiumProcessingCaseDetails = () => {\r\n  const history = useHistory();\r\n  const dispatch = useDispatch();\r\n  const { id, tab } = useParams();\r\n  const { confirmNavigation } = useConfirmNavigation();\r\n\r\n  const user = useSelector(selectUser);\r\n  const caseDetails = useSelector(selectCaseDetails);\r\n  const caseRfiDetails = useSelector(selectCaseRfiDetails);\r\n  const uiBrand = useSelector((state) => get(state, 'ui.brand'));\r\n  const processTypeRefData = useSelector(selectRefDataNewProcessType) || [];\r\n  const facilityTypeRefData = useSelector(selectRefDataNewFacilityType) || [];\r\n  const bordereauTypeRefData = useSelector(selectRefDataNewBordereauType) || [];\r\n  const bordereauPolicyTypeRefData = useSelector(selectRefDataNewBordereauPolicyType) || [];\r\n  const isCheckSigning = useSelector(selectCaseIsCheckSigning) || false;\r\n  const cases = useSelector(selectPremiumProcessingCasesSelected);\r\n  const rfiSubTabs = useSelector(selectcaseRfiSubTabs);\r\n  const currentUser = useSelector(selectUserRole);\r\n  const isHistoryCases = caseDetails?.taskView === constants.ALL_CASES;\r\n  const isFrontEndContact =\r\n    utils.generic.isValidArray(currentUser, true) &&\r\n    currentUser.some((item) => [constants.FRONT_END_CONTACT.toLowerCase()].includes(item.name.toLowerCase()));\r\n  const isSeniorManager =\r\n    utils.generic.isValidArray(currentUser, true) &&\r\n    currentUser.some((item) => [constants.SENIOR_MANAGER.toLowerCase()].includes(item.name.toLowerCase()));\r\n  const isFCE = user?.userRole?.some((role) => role?.name === constants.ROLE_FRONT_END_CONTACT);\r\n  const isOperationsLead = user?.userRole?.some((role) => role?.name === constants.ROLE_OPERATIONS_LEAD);\r\n  const hasDocumentSearchPermission = isFCE || isOperationsLead;\r\n\r\n  const taskId = id || '';\r\n  const { processId, caseId, caseStageDetails } = caseDetails;\r\n  const rfiCaseId = caseRfiDetails?.caseId;\r\n  const rfiType = caseRfiDetails?.rfiType ? true : false;\r\n  const rfiProcessId = caseRfiDetails?.processId;\r\n  const isIssueDocumentStage = caseStageDetails?.some((cs) => [constants.BPM_STAGE_ISSUE_DOCUMENTS].includes(cs.bpmStageCode) && cs.active);\r\n  const isCompletedStage = caseStageDetails?.some((cs) => [constants.BPM_STAGE_COMPLETED].includes(cs.bpmStageCode) && cs.active);\r\n  const isRejectedStage = caseStageDetails?.some((cs) => [constants.BPM_STAGE_REJECTED].includes(cs.bpmStageCode) && cs.active);\r\n  const isRfiCase = utils.generic.isValidArray(cases, true) && utils.premiumProcessing.isRfi(cases?.[0]);\r\n\r\n  const breadcrumbs = [\r\n    {\r\n      name: 'premiumProcessing',\r\n      label: utils.string.t('premiumProcessing.breadcrumbs.home'),\r\n      link: config.routes.premiumProcessing.root,\r\n    },\r\n    ...(caseId || rfiCaseId\r\n      ? [\r\n          {\r\n            name: 'caseId',\r\n            label: utils.string.t('premiumProcessing.breadcrumbs.case', { id: caseId || rfiCaseId }),\r\n            link: '#',\r\n            active: true,\r\n          },\r\n        ]\r\n      : []),\r\n  ];\r\n\r\n  const tabs = [\r\n    { value: constants.PREMIUM_PROCESSING_TAB_CASE_DETAILS, label: utils.string.t('premiumProcessing.tabs.caseDetails') },\r\n    {\r\n      value: constants.PREMIUM_PROCESSING_TAB_DOCUMENTS,\r\n      label: utils.string.t('premiumProcessing.tabs.documents'),\r\n    },\r\n    {\r\n      value: constants.PREMIUM_PROCESSING_TAB_RFI,\r\n      label: utils.string.t('premiumProcessing.tabs.rfi'),\r\n    },\r\n    ...(!isCheckSigning\r\n      ? [\r\n          {\r\n            value: constants.PREMIUM_PROCESSING_TAB_ISSUE_DOCUMENTS,\r\n            label: utils.string.t('premiumProcessing.tabs.issueDocuments'),\r\n            disabled: !isIssueDocumentStage && !isCompletedStage && !isRejectedStage,\r\n          },\r\n        ]\r\n      : []),\r\n    { value: constants.PREMIUM_PROCESSING_TAB_NOTES, label: utils.string.t('premiumProcessing.tabs.notes') },\r\n    ...(isCheckSigning\r\n      ? [{ value: constants.PREMIUM_PROCESSING_TAB_HISTORY, label: utils.string.t('premiumProcessing.tabs.history') }]\r\n      : []),\r\n  ];\r\n\r\n  const isValidTab = tabs.map((item) => item.value).includes(tab);\r\n\r\n  const [isDataLoaded, setIsDataLoaded] = useState(false);\r\n  const [isPageDirty, setIsPageDirty] = useState(false);\r\n  const [selectedTab, setSelectedTab] = useState(isValidTab ? tab : constants.PREMIUM_PROCESSING_TAB_CASE_DETAILS);\r\n\r\n  const openUpdatingPopup = () => {\r\n    dispatch(\r\n      showModal({\r\n        component: 'CONFIRM',\r\n        props: {\r\n          fullWidth: true,\r\n          title: utils.string.t('premiumProcessing.alert'),\r\n          maxWidth: 'xs',\r\n          componentProps: {\r\n            hideCancelButton: true,\r\n            confirmLabel: utils.string.t('processingInstructions.authorisations.form.confirm'),\r\n            confirmMessage: (\r\n              <span\r\n                dangerouslySetInnerHTML={{\r\n                  __html: `${utils.string.t('premiumProcessing.piHyperLinkErrorMessage')}`,\r\n                }}\r\n              />\r\n            ),\r\n            buttonColors: { confirm: 'secondary' },\r\n            submitHandler: () => {},\r\n            handleClose: () => {},\r\n          },\r\n        },\r\n      })\r\n    );\r\n  };\r\n\r\n  const switchTab = (newTab) => {\r\n    setSelectedTab(newTab);\r\n    setIsPageDirty(false);\r\n    history.replace(`${config.routes.premiumProcessing.case}${taskId ? `/${taskId}` : ''}${tab ? `/${newTab}` : ''}`);\r\n    dispatch(hideModal());\r\n  };\r\n\r\n  const stayOnTab = () => {\r\n    dispatch(hideModal());\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (caseId || rfiCaseId) {\r\n      const caseIdData = caseId || rfiCaseId;\r\n      dispatch(getCaseRfiSubTabData(caseIdData));\r\n    }\r\n  }, [dispatch, caseId]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  const selectTab = (tab) => {\r\n    if (isPageDirty) {\r\n      confirmNavigation(() => switchTab(tab), stayOnTab);\r\n    } else {\r\n      setIsPageDirty(false);\r\n      setSelectedTab(tab);\r\n\r\n      // history tab in PP rfi to land directly on the particular tab\r\n      if ((isHistoryCases || isFrontEndContact || isSeniorManager) && rfiSubTabs.length >= 1) {\r\n        const selectedList = rfiSubTabs.filter((item) => item, 'taskId');\r\n        history.replace(\r\n          `${config.routes.premiumProcessing.case}${taskId ? `/${taskId}` : ''}${tab ? `/${tab}` : ''}${\r\n            tab === constants.PREMIUM_PROCESSING_TAB_RFI\r\n              ? `/${selectedList[0]?.taskId}`\r\n              : tab === constants.PREMIUM_PROCESSING_TAB_ISSUE_DOCUMENTS\r\n              ? `/${constants.PREMIUM_PROCESSING_TAB_NON_BUREAU}`\r\n              : ''\r\n          }`\r\n        );\r\n      } else {\r\n        history.replace(\r\n          `${config.routes.premiumProcessing.case}${taskId ? `/${taskId}` : ''}${tab ? `/${tab}` : ''}${\r\n            tab === constants.PREMIUM_PROCESSING_TAB_RFI\r\n              ? `/${constants.PREMIUM_PROCESSING_TAB_NEW_RFI}`\r\n              : tab === constants.PREMIUM_PROCESSING_TAB_ISSUE_DOCUMENTS\r\n              ? `/${constants.PREMIUM_PROCESSING_TAB_NON_BUREAU}`\r\n              : ''\r\n          }`\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isRfiCase) {\r\n      dispatch(getCaseRFIDetails({ taskId: cases[0]?.taskId }));\r\n    }\r\n    if (taskId && !isDataLoaded) {\r\n      dispatch(getCaseTeamDetails({ taskId, taskView: caseDetails.taskView || constants.WORKLIST })).then((response) => {\r\n        if (response?.message === constants.API_RESPONSE_SUCCESS) {\r\n          if (response?.status?.toUpperCase() === constants.API_RESPONSE_OK) {\r\n            response.data.caseDetails.processId =\r\n              (response.data?.caseDetails?.processId &&\r\n                utils.referenceData.processTypes.getNameById(processTypeRefData, response.data?.caseDetails?.processId)) ||\r\n              '';\r\n            if (response.data?.caseDetails?.processId === constants.FDO && response.data?.caseDetails?.facilityTypeId) {\r\n              const facilityTypesName =\r\n                (utils.generic.isValidArray(facilityTypeRefData, true) &&\r\n                  response.data?.caseDetails?.facilityTypeId &&\r\n                  utils.referenceData.facilityTypes.getNameById(facilityTypeRefData, response.data?.caseDetails?.facilityTypeId)) ||\r\n                '';\r\n              response.data.caseDetails.facilityTypeId = facilityTypesName;\r\n            }\r\n            if (response.data?.caseDetails?.processId === constants.BORDEREAU) {\r\n              if (response.data?.caseDetails?.bordereauTypeId) {\r\n                const bordereauTypeName =\r\n                  (utils.generic.isValidArray(bordereauTypeRefData, true) &&\r\n                    response.data?.caseDetails?.bordereauTypeId &&\r\n                    utils.referenceData.bordereauTypes.getNameById(bordereauTypeRefData, response.data?.caseDetails?.bordereauTypeId)) ||\r\n                  '';\r\n                response.data.caseDetails.bordereauTypeId = bordereauTypeName;\r\n              }\r\n              if (response.data?.caseDetails?.policyTypeId) {\r\n                const bordereauPolicyTypeName =\r\n                  (utils.generic.isValidArray(bordereauPolicyTypeRefData, true) &&\r\n                    response.data?.caseDetails?.policyTypeId &&\r\n                    utils.referenceData.bordereauPolicyTypes.getNameById(\r\n                      bordereauPolicyTypeRefData,\r\n                      response.data?.caseDetails?.policyTypeId\r\n                    )) ||\r\n                  '';\r\n                response.data.caseDetails.policyTypeId = bordereauPolicyTypeName;\r\n              }\r\n            }\r\n            dispatch(getCaseTeamDetailsSuccess(response.data));\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    const processIdData = processId ? processId : rfiProcessId;\r\n    const getData = () => {\r\n      const promises = [\r\n        dispatch(getCaseTeamModule({ taskId, rfiCaseId, rfiType })),\r\n        dispatch(getCaseHistoryDetails({ taskId, processId })),\r\n        dispatch(getCheckSigningCaseHistory({ processIdData })),\r\n      ];\r\n      return Promise.allSettled(promises).then((results) => Promise.resolve(results));\r\n    };\r\n\r\n    if (processId || rfiCaseId) {\r\n      getData().then((data) => {\r\n        if (utils.generic.isValidArray(data, true)) {\r\n          setIsDataLoaded(true);\r\n        }\r\n      });\r\n    }\r\n  }, [taskId, processId, rfiCaseId, rfiType]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  // abort\r\n  if (!isDataLoaded) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Helmet>\r\n        <title>{`${utils.string.t('premiumProcessing.title')} - ${utils.app.getAppName(uiBrand)}`}</title>\r\n      </Helmet>\r\n      <PremiumProcessingCaseDetailsView\r\n        hasDocumentSearchPermission={hasDocumentSearchPermission}\r\n        taskId={taskId}\r\n        caseId={caseId}\r\n        caseDetails={caseDetails}\r\n        breadcrumbs={breadcrumbs}\r\n        tabs={tabs}\r\n        selectedTab={selectedTab}\r\n        isPageDirty={isPageDirty}\r\n        handlers={{ confirmNavigation, openUpdatingPopup, selectTab, setIsPageDirty }}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default PremiumProcessingCaseDetails;\r\n"]},"metadata":{},"sourceType":"module"}