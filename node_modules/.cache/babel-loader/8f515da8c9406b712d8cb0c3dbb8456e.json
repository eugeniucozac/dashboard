{"ast":null,"code":"import _slicedToArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"E:\\\\MPHASIS\\\\claims-page\\\\Mphasis-Edge\\\\src\\\\forms\\\\DownloadBordereaux\\\\DownloadBordereaux.js\",\n    _s = $RefreshSig$();\n\nimport * as React from 'react';\nimport PropTypes from 'prop-types';\nimport { useSelector, useDispatch } from 'react-redux';\nimport * as Yup from 'yup';\nimport get from 'lodash/get';\nimport moment from 'moment'; // app\n\nimport { DownloadBordereauxView } from './DownloadBordereaux.view';\nimport { downloadRiskBordereaux, getRiskProductsWithReports, getRiskFacilities, selectFacilitiesListItems, selectProductsWithReportsSorted, selectDownloadStatus } from 'stores';\nimport * as utils from 'utils';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nDownloadBordereaux.propTypes = {\n  handleClose: PropTypes.func.isRequired\n};\nexport default function DownloadBordereaux(_ref) {\n  _s();\n\n  var _products$;\n\n  var handleClose = _ref.handleClose;\n  var dispatch = useDispatch();\n  var productsWithReports = useSelector(selectProductsWithReportsSorted);\n  var riskProductsLoading = useSelector(function (state) {\n    return get(state, 'risk.productsWithReports.loading');\n  });\n  var riskFacilitiesItems = useSelector(selectFacilitiesListItems);\n  var download = useSelector(selectDownloadStatus);\n\n  var _React$useState = React.useState(),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      productSelected = _React$useState2[0],\n      setProductSelected = _React$useState2[1];\n\n  var _React$useState3 = React.useState(),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      setDownloadTypeSelected = _React$useState4[1];\n\n  var _React$useState5 = React.useState([]),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      reportsOptions = _React$useState6[0],\n      setReportsOptions = _React$useState6[1];\n\n  var products = productsWithReports.map(function (product) {\n    return {\n      value: product.value,\n      label: product.label\n    };\n  });\n  var facilities = riskFacilitiesItems.filter(function (facility) {\n    return facility.productCode === productSelected;\n  });\n  React.useEffect(function () {\n    if ((products === null || products === void 0 ? void 0 : products.length) === 1) {\n      setProductSelected(products[0].value);\n    }\n  }, [products]);\n  React.useEffect(function () {\n    !utils.generic.isValidArray(productsWithReports, true) && dispatch(getRiskProductsWithReports());\n    dispatch(getRiskFacilities({\n      size: 1000\n    }));\n  }, [] // eslint-disable-line react-hooks/exhaustive-deps\n  );\n  React.useEffect(function () {\n    if (productSelected) {\n      setReportsOptions(riskProductsLoading ? [] : get(productsWithReports.find(function (product) {\n        return product.value === productSelected;\n      }), 'reports'));\n    }\n  }, [productSelected, riskProductsLoading] // eslint-disable-line react-hooks/exhaustive-deps\n  );\n\n  var handleSubmit = function handleSubmit(data) {\n    return dispatch(downloadRiskBordereaux(data));\n  };\n\n  var handleCancel = function handleCancel() {\n    if (utils.generic.isFunction(handleClose)) {\n      handleClose();\n    }\n  };\n\n  var fields = [[{\n    gridSize: {\n      xs: 12\n    },\n    id: 'product',\n    name: 'product',\n    transform: 'option',\n    type: 'select',\n    value: (products === null || products === void 0 ? void 0 : products.length) === 1 && ((_products$ = products[0]) === null || _products$ === void 0 ? void 0 : _products$.value) ? products[0].value : '',\n    options: products,\n    label: utils.string.t('products.product'),\n    muiComponentProps: {\n      disabled: !utils.generic.isValidArray(products, true)\n    },\n    validation: Yup.string().required(utils.string.t('validation.required')),\n    handleUpdate: function handleUpdate(name, value) {\n      return setProductSelected(value);\n    }\n  }, {\n    gridSize: {\n      xs: 9\n    },\n    id: 'type',\n    name: 'type',\n    type: 'select',\n    value: '',\n    options: reportsOptions,\n    label: utils.string.t('products.report'),\n    handleUpdate: function handleUpdate(name, value) {\n      return setDownloadTypeSelected(value);\n    },\n    muiComponentProps: {\n      disabled: !productSelected || !utils.generic.isValidArray(reportsOptions, true)\n    },\n    validation: Yup.string().required(utils.string.t('validation.required'))\n  }, {\n    gridSize: {\n      xs: 3\n    },\n    id: 'onlyBound',\n    name: 'onlyBound',\n    title: utils.string.t('products.boundOnly'),\n    type: 'checkbox',\n    value: false,\n    conditional: {\n      conditional: true,\n      conditionalField: 'type',\n      conditionValue: 'DATA_DUMP'\n    }\n  }, {\n    gridSize: {\n      xs: 12\n    },\n    id: 'facility',\n    name: 'facility',\n    type: 'select',\n    value: '',\n    options: facilities,\n    optionKey: 'id',\n    optionLabel: 'name',\n    label: utils.string.t('products.facility'),\n    hint: utils.string.t('products.facilityHint'),\n    muiComponentProps: {\n      disabled: !productSelected || !utils.generic.isValidArray(facilities, true)\n    },\n    validation: Yup.string()\n  }, {\n    gridSize: {\n      xs: 12,\n      sm: 6\n    },\n    type: 'datepicker',\n    icon: 'TodayIcon',\n    name: 'from',\n    label: utils.string.t('form.dateFrom.label'),\n    value: null,\n    muiComponentProps: {\n      fullWidth: true\n    },\n    muiPickerProps: {\n      views: ['year', 'month'],\n      format: 'MMMM YYYY'\n    },\n    validation: Yup.string().nullable().required(utils.string.t('form.dateFrom.required')).test('from', utils.string.t('form.dateFrom.mustBeSameOrBeforeTo'), function (value) {\n      return value && this.options.parent.to ? moment(value).isSameOrBefore(this.options.parent.to) : true;\n    })\n  }, {\n    gridSize: {\n      xs: 12,\n      sm: 6\n    },\n    type: 'datepicker',\n    name: 'to',\n    label: utils.string.t('form.dateTo.label'),\n    value: null,\n    muiComponentProps: {\n      fullWidth: true\n    },\n    muiPickerProps: {\n      views: ['year', 'month'],\n      format: 'MMMM YYYY'\n    },\n    validation: Yup.string().nullable().required(utils.string.t('form.dateTo.required')).test('from', utils.string.t('form.dateTo.mustBeSameOrAfterFrom'), function (value) {\n      return value && this.options.parent.from ? moment(value).isSameOrAfter(this.options.parent.from) : true;\n    })\n  }]];\n  var actions = [{\n    name: 'submit',\n    label: utils.string.t('app.download'),\n    handler: handleSubmit\n  }, {\n    name: 'cancel',\n    label: utils.string.t('app.cancel'),\n    handler: handleCancel\n  }];\n  return /*#__PURE__*/_jsxDEV(DownloadBordereauxView, {\n    fields: fields,\n    actions: actions,\n    loading: riskProductsLoading,\n    download: download\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 200,\n    columnNumber: 10\n  }, this);\n}\n\n_s(DownloadBordereaux, \"Qj3/3ZUfcg0RFmqAfyDBZ2+Tm4U=\", false, function () {\n  return [useDispatch, useSelector, useSelector, useSelector, useSelector];\n});\n\n_c = DownloadBordereaux;\n\nvar _c;\n\n$RefreshReg$(_c, \"DownloadBordereaux\");","map":{"version":3,"sources":["E:/MPHASIS/claims-page/Mphasis-Edge/src/forms/DownloadBordereaux/DownloadBordereaux.js"],"names":["React","PropTypes","useSelector","useDispatch","Yup","get","moment","DownloadBordereauxView","downloadRiskBordereaux","getRiskProductsWithReports","getRiskFacilities","selectFacilitiesListItems","selectProductsWithReportsSorted","selectDownloadStatus","utils","DownloadBordereaux","propTypes","handleClose","func","isRequired","dispatch","productsWithReports","riskProductsLoading","state","riskFacilitiesItems","download","useState","productSelected","setProductSelected","setDownloadTypeSelected","reportsOptions","setReportsOptions","products","map","product","value","label","facilities","filter","facility","productCode","useEffect","length","generic","isValidArray","size","find","handleSubmit","data","handleCancel","isFunction","fields","gridSize","xs","id","name","transform","type","options","string","t","muiComponentProps","disabled","validation","required","handleUpdate","title","conditional","conditionalField","conditionValue","optionKey","optionLabel","hint","sm","icon","fullWidth","muiPickerProps","views","format","nullable","test","parent","to","isSameOrBefore","from","isSameOrAfter","actions","handler"],"mappings":"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","sourcesContent":["import * as React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport * as Yup from 'yup';\r\nimport get from 'lodash/get';\r\nimport moment from 'moment';\r\n\r\n// app\r\nimport { DownloadBordereauxView } from './DownloadBordereaux.view';\r\nimport {\r\n  downloadRiskBordereaux,\r\n  getRiskProductsWithReports,\r\n  getRiskFacilities,\r\n  selectFacilitiesListItems,\r\n  selectProductsWithReportsSorted,\r\n  selectDownloadStatus,\r\n} from 'stores';\r\nimport * as utils from 'utils';\r\n\r\nDownloadBordereaux.propTypes = {\r\n  handleClose: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default function DownloadBordereaux({ handleClose }) {\r\n  const dispatch = useDispatch();\r\n  const productsWithReports = useSelector(selectProductsWithReportsSorted);\r\n  const riskProductsLoading = useSelector((state) => get(state, 'risk.productsWithReports.loading'));\r\n  const riskFacilitiesItems = useSelector(selectFacilitiesListItems);\r\n  const download = useSelector(selectDownloadStatus);\r\n  const [productSelected, setProductSelected] = React.useState();\r\n  const [, setDownloadTypeSelected] = React.useState();\r\n  const [reportsOptions, setReportsOptions] = React.useState([]);\r\n\r\n  const products = productsWithReports.map((product) => ({\r\n    value: product.value,\r\n    label: product.label,\r\n  }));\r\n\r\n  const facilities = riskFacilitiesItems.filter((facility) => facility.productCode === productSelected);\r\n\r\n  React.useEffect(() => {\r\n    if (products?.length === 1) {\r\n      setProductSelected(products[0].value);\r\n    }\r\n  }, [products]);\r\n\r\n  React.useEffect(\r\n    () => {\r\n      !utils.generic.isValidArray(productsWithReports, true) && dispatch(getRiskProductsWithReports());\r\n      dispatch(getRiskFacilities({ size: 1000 }));\r\n    },\r\n    [] // eslint-disable-line react-hooks/exhaustive-deps\r\n  );\r\n\r\n  React.useEffect(\r\n    () => {\r\n      if (productSelected) {\r\n        setReportsOptions(\r\n          riskProductsLoading\r\n            ? []\r\n            : get(\r\n                productsWithReports.find((product) => product.value === productSelected),\r\n                'reports'\r\n              )\r\n        );\r\n      }\r\n    },\r\n    [productSelected, riskProductsLoading] // eslint-disable-line react-hooks/exhaustive-deps\r\n  );\r\n\r\n  const handleSubmit = (data) => {\r\n    return dispatch(downloadRiskBordereaux(data));\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    if (utils.generic.isFunction(handleClose)) {\r\n      handleClose();\r\n    }\r\n  };\r\n\r\n  const fields = [\r\n    [\r\n      {\r\n        gridSize: { xs: 12 },\r\n        id: 'product',\r\n        name: 'product',\r\n        transform: 'option',\r\n        type: 'select',\r\n        value: products?.length === 1 && products[0]?.value ? products[0].value : '',\r\n        options: products,\r\n        label: utils.string.t('products.product'),\r\n        muiComponentProps: {\r\n          disabled: !utils.generic.isValidArray(products, true),\r\n        },\r\n        validation: Yup.string().required(utils.string.t('validation.required')),\r\n        handleUpdate: (name, value) => setProductSelected(value),\r\n      },\r\n      {\r\n        gridSize: { xs: 9 },\r\n        id: 'type',\r\n        name: 'type',\r\n        type: 'select',\r\n        value: '',\r\n        options: reportsOptions,\r\n        label: utils.string.t('products.report'),\r\n        handleUpdate: (name, value) => setDownloadTypeSelected(value),\r\n        muiComponentProps: {\r\n          disabled: !productSelected || !utils.generic.isValidArray(reportsOptions, true),\r\n        },\r\n        validation: Yup.string().required(utils.string.t('validation.required')),\r\n      },\r\n      {\r\n        gridSize: { xs: 3 },\r\n        id: 'onlyBound',\r\n        name: 'onlyBound',\r\n        title: utils.string.t('products.boundOnly'),\r\n        type: 'checkbox',\r\n        value: false,\r\n\r\n        conditional: {\r\n          conditional: true,\r\n          conditionalField: 'type',\r\n          conditionValue: 'DATA_DUMP',\r\n        },\r\n      },\r\n\r\n      {\r\n        gridSize: { xs: 12 },\r\n        id: 'facility',\r\n        name: 'facility',\r\n        type: 'select',\r\n        value: '',\r\n        options: facilities,\r\n        optionKey: 'id',\r\n        optionLabel: 'name',\r\n        label: utils.string.t('products.facility'),\r\n        hint: utils.string.t('products.facilityHint'),\r\n        muiComponentProps: {\r\n          disabled: !productSelected || !utils.generic.isValidArray(facilities, true),\r\n        },\r\n        validation: Yup.string(),\r\n      },\r\n      {\r\n        gridSize: { xs: 12, sm: 6 },\r\n        type: 'datepicker',\r\n        icon: 'TodayIcon',\r\n        name: 'from',\r\n        label: utils.string.t('form.dateFrom.label'),\r\n        value: null,\r\n        muiComponentProps: {\r\n          fullWidth: true,\r\n        },\r\n        muiPickerProps: {\r\n          views: ['year', 'month'],\r\n          format: 'MMMM YYYY',\r\n        },\r\n        validation: Yup.string()\r\n          .nullable()\r\n          .required(utils.string.t('form.dateFrom.required'))\r\n          .test('from', utils.string.t('form.dateFrom.mustBeSameOrBeforeTo'), function (value) {\r\n            return value && this.options.parent.to ? moment(value).isSameOrBefore(this.options.parent.to) : true;\r\n          }),\r\n      },\r\n      {\r\n        gridSize: { xs: 12, sm: 6 },\r\n        type: 'datepicker',\r\n        name: 'to',\r\n        label: utils.string.t('form.dateTo.label'),\r\n        value: null,\r\n        muiComponentProps: {\r\n          fullWidth: true,\r\n        },\r\n        muiPickerProps: {\r\n          views: ['year', 'month'],\r\n          format: 'MMMM YYYY',\r\n        },\r\n        validation: Yup.string()\r\n          .nullable()\r\n          .required(utils.string.t('form.dateTo.required'))\r\n          .test('from', utils.string.t('form.dateTo.mustBeSameOrAfterFrom'), function (value) {\r\n            return value && this.options.parent.from ? moment(value).isSameOrAfter(this.options.parent.from) : true;\r\n          }),\r\n      },\r\n    ],\r\n  ];\r\n\r\n  const actions = [\r\n    {\r\n      name: 'submit',\r\n      label: utils.string.t('app.download'),\r\n      handler: handleSubmit,\r\n    },\r\n    {\r\n      name: 'cancel',\r\n      label: utils.string.t('app.cancel'),\r\n      handler: handleCancel,\r\n    },\r\n  ];\r\n\r\n  return <DownloadBordereauxView fields={fields} actions={actions} loading={riskProductsLoading} download={download} />;\r\n}\r\n"]},"metadata":{},"sourceType":"module"}