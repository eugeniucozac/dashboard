{"ast":null,"code":"import _objectSpread from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _toConsumableArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"E:\\\\MPHASIS\\\\claims-page\\\\Mphasis-Edge\\\\src\\\\forms\\\\DmsUploadFiles\\\\DmsUploadFiles.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport { useDispatch, useSelector } from 'react-redux'; // app\n\nimport { DmsUploadFilesView } from './DmsUploadFiles.view';\nimport { hideModal, getViewTableDocuments, getDmsMetaData, selectRefDataNewDocumentTypesByContextSource, selectRefDataNewDocumentTypeLookUpByContextSource, selectDmsMetaData, selectorDmsViewFiles, selectCaseDetails, selectSettlementCurrency, removeLoader, postDmsDocumentsV2 } from 'stores';\nimport * as constants from 'consts';\nimport * as utils from 'utils';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nDmsUploadFiles.propTypes = {\n  files: PropTypes.array.isRequired,\n  context: PropTypes.string.isRequired,\n  referenceId: PropTypes.string.isRequired,\n  sourceId: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  documentTypeKey: PropTypes.oneOf(Object.values(constants.DMS_DOCUMENT_TYPE_SECTION_KEYS.type)),\n  searchParamsAfterUpload: PropTypes.shape({\n    referenceId: PropTypes.oneOfType([PropTypes.number, PropTypes.string]).isRequired,\n    sectionType: PropTypes.string.isRequired\n  }),\n  postDmsDocumentsSuccess: PropTypes.func,\n  isStandaloneUpload: PropTypes.bool // When Upload modal is launched individually rather than from within DmsTable\n\n};\nDmsUploadFiles.defaultProps = {\n  documentTypeKey: constants.DMS_DOCUMENT_TYPE_SECTION_KEYS.type.policy,\n  postDmsDocumentsSuccess: function postDmsDocumentsSuccess() {},\n  isStandaloneUpload: false\n};\nexport default function DmsUploadFiles(_ref) {\n  _s();\n\n  var files = _ref.files,\n      context = _ref.context,\n      referenceId = _ref.referenceId,\n      sourceId = _ref.sourceId,\n      documentTypeKey = _ref.documentTypeKey,\n      searchParamsAfterUpload = _ref.searchParamsAfterUpload,\n      postDmsDocumentsSuccess = _ref.postDmsDocumentsSuccess,\n      isStandaloneUpload = _ref.isStandaloneUpload;\n  var dispatch = useDispatch();\n  var filesLiteVersion = utils.dms.trimFileProperties(files);\n  var isDmsFromPi = utils.dmsFormatter.isDmsFromPi(documentTypeKey);\n  var isDmsFromPiInstruction = utils.dmsFormatter.isDmsFromPiInstruction(documentTypeKey);\n  var showFolderFilter = !(isDmsFromPi || documentTypeKey === constants.DMS_DOCUMENT_TYPE_SECTION_KEYS.type.policy); // redux\n\n  var selectCurrencies = useSelector(selectSettlementCurrency);\n  var documentMetaData = useSelector(selectDmsMetaData);\n  var previousUploadedFiles = useSelector(selectorDmsViewFiles);\n  var ppCaseDetails = useSelector(selectCaseDetails); // TODO will be later coming as props\n\n  var xbInstanceId = sourceId ? sourceId : constants.DMS_CLAIM_SOURCE_ID;\n\n  var _utils$dmsFormatter$g = utils.dmsFormatter.getDocumentTypeFilterKeys(context, xbInstanceId, documentTypeKey),\n      dmsSectionKey = _utils$dmsFormatter$g.dmsSectionKey,\n      selectedSourceId = _utils$dmsFormatter$g.sourceId;\n\n  var documentTypesBeforeFilter = useSelector(dmsSectionKey === constants.DMS_DOCUMENT_TYPE_SECTION_KEYS.type.policy ? selectRefDataNewDocumentTypeLookUpByContextSource(dmsSectionKey, selectedSourceId) : selectRefDataNewDocumentTypesByContextSource(dmsSectionKey, selectedSourceId));\n\n  var _ref2 = isDmsFromPi && utils.dmsFormatter.getDocumentTypeInfo(documentTypeKey, selectedSourceId),\n      documentTypeDescription = _ref2.documentTypeDescription,\n      sectionKey = _ref2.sectionKey,\n      dmsSourceID = _ref2.dmsSourceID;\n\n  var documentTypesAfterFilter = (context === constants.DMS_CONTEXT_POLICY || context === constants.DMS_CONTEXT_PROCESSING_INSTRUCTION) && isDmsFromPi ? documentTypesBeforeFilter === null || documentTypesBeforeFilter === void 0 ? void 0 : documentTypesBeforeFilter.filter(function (type) {\n    return type.documentTypeDescription === documentTypeDescription && type.sectionKey === sectionKey && type.sourceID === dmsSourceID;\n  }) : documentTypesBeforeFilter; // state\n\n  var _useState = useState(filesLiteVersion),\n      _useState2 = _slicedToArray(_useState, 2),\n      activeFiles = _useState2[0],\n      setActiveFiles = _useState2[1];\n\n  var _useState3 = useState(documentTypesAfterFilter),\n      _useState4 = _slicedToArray(_useState3, 2),\n      refinedDocTypes = _useState4[0],\n      setRefinedDocTypes = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isMetaDataLoaded = _useState6[0],\n      setIsMetaDataLoaded = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      showDocTypeRequired = _useState8[0],\n      setShowDocTypeRequired = _useState8[1];\n\n  var _useState9 = useState(true),\n      _useState10 = _slicedToArray(_useState9, 2),\n      canSubmit = _useState10[0],\n      setCanSubmit = _useState10[1];\n\n  var _useState11 = useState(false),\n      _useState12 = _slicedToArray(_useState11, 2),\n      filesSubmitted = _useState12[0],\n      setFilesSubmitted = _useState12[1];\n\n  var _useState13 = useState(false),\n      _useState14 = _slicedToArray(_useState13, 2),\n      isUploading = _useState14[0],\n      setIsUploading = _useState14[1];\n\n  var _useState15 = useState((filesLiteVersion === null || filesLiteVersion === void 0 ? void 0 : filesLiteVersion.map(function () {\n    return false;\n  })) || []),\n      _useState16 = _slicedToArray(_useState15, 2),\n      uploadStatus = _useState16[0],\n      setUploadStatus = _useState16[1];\n\n  var _useState17 = useState([]),\n      _useState18 = _slicedToArray(_useState17, 2),\n      postUploadMetaData = _useState18[0],\n      setPostUploadMetaData = _useState18[1];\n\n  var tableFormArrayRef = useRef(utils.dms.getFilesForm(activeFiles || []));\n  var duplicateFileIndexes = utils.dms.getDuplicateFileIndexes(activeFiles, previousUploadedFiles);\n  var folderTypes = utils.dms.getFolderTypes(documentTypesAfterFilter);\n  var currencies = utils.currency.listWithCodeAndCurrency(selectCurrencies); // Premium Processing Case Details\n\n  var policyRef = ppCaseDetails === null || ppCaseDetails === void 0 ? void 0 : ppCaseDetails.policyRef;\n  var instructionId = ppCaseDetails === null || ppCaseDetails === void 0 ? void 0 : ppCaseDetails.instructionId;\n  var cols = [{\n    id: 'fileName',\n    label: utils.string.t('claims.lossInformation.dmsUploadDocument.cols.fileName')\n  }, {\n    id: 'documentType',\n    label: utils.string.t('claims.lossInformation.dmsUploadDocument.cols.documentType')\n  }, {\n    id: 'documentClassification',\n    label: utils.string.t('claims.lossInformation.dmsUploadDocument.cols.documentClassification')\n  }, {\n    id: 'tag',\n    label: utils.string.t('claims.lossInformation.dmsUploadDocument.cols.tag')\n  }, {\n    id: 'removeDoc',\n    empty: true\n  }]; // handlers\n\n  var handleFolderTypeSelection = function handleFolderTypeSelection(event, value) {\n    setRefinedDocTypes(utils.dms.refinedDocTypeByFolderName(value, documentTypesAfterFilter));\n  };\n\n  var handleRemoveFiles = function handleRemoveFiles(removalIndex) {\n    var newList = _toConsumableArray(activeFiles);\n\n    newList.splice(removalIndex, 1);\n\n    var newForm = _toConsumableArray(tableFormArrayRef === null || tableFormArrayRef === void 0 ? void 0 : tableFormArrayRef.current);\n\n    newForm.splice(removalIndex, 1);\n    tableFormArrayRef.current = _toConsumableArray(newForm);\n    setActiveFiles(newList);\n    checkIfInvalidFiles(tableFormArrayRef === null || tableFormArrayRef === void 0 ? void 0 : tableFormArrayRef.current);\n  };\n\n  var handleTableForm = function handleTableForm(index, rowFormState) {\n    var _rowFormState$formDoc;\n\n    var newForm = _toConsumableArray(tableFormArrayRef === null || tableFormArrayRef === void 0 ? void 0 : tableFormArrayRef.current);\n\n    newForm[index] = {\n      formFileName: (rowFormState === null || rowFormState === void 0 ? void 0 : rowFormState.formFileName) || '',\n      formDocType: rowFormState === null || rowFormState === void 0 ? void 0 : rowFormState.formDocType,\n      formDocClassificationType: {\n        id: (rowFormState === null || rowFormState === void 0 ? void 0 : (_rowFormState$formDoc = rowFormState.formDocClassificationType) === null || _rowFormState$formDoc === void 0 ? void 0 : _rowFormState$formDoc.id) || 0\n      },\n      paymentFields: rowFormState === null || rowFormState === void 0 ? void 0 : rowFormState.paymentFields,\n      isDuplicateFileName: (rowFormState === null || rowFormState === void 0 ? void 0 : rowFormState.isDuplicateFileName) || false,\n      isInvalidFileName: (rowFormState === null || rowFormState === void 0 ? void 0 : rowFormState.isInvalidFileName) || false\n    };\n    tableFormArrayRef.current = _toConsumableArray(newForm);\n    checkIfInvalidFiles(tableFormArrayRef === null || tableFormArrayRef === void 0 ? void 0 : tableFormArrayRef.current);\n  };\n\n  var checkIfInvalidFiles = function checkIfInvalidFiles(fileFormArray) {\n    var invalidCondition = utils.generic.isValidArray(fileFormArray, true) && fileFormArray.every(function (fileForm) {\n      return !(fileForm === null || fileForm === void 0 ? void 0 : fileForm.isInvalidFileName);\n    });\n    if (!canSubmit && invalidCondition) setCanSubmit(true);\n    if (canSubmit && !invalidCondition) setCanSubmit(false);\n  };\n\n  var checkIfSubmittable = function checkIfSubmittable(fileFormArray) {\n    var submitCondition = utils.generic.isValidArray(fileFormArray, true) && fileFormArray.every(function (fileForm) {\n      var _fileForm$formDocType;\n\n      return (fileForm === null || fileForm === void 0 ? void 0 : (_fileForm$formDocType = fileForm.formDocType) === null || _fileForm$formDocType === void 0 ? void 0 : _fileForm$formDocType.id) && !(fileForm === null || fileForm === void 0 ? void 0 : fileForm.isInvalidFileName);\n    });\n    setCanSubmit(submitCondition);\n    return submitCondition;\n  };\n\n  var handleFilesSubmission = function handleFilesSubmission(e) {\n    e.preventDefault();\n    var filesFormData = tableFormArrayRef === null || tableFormArrayRef === void 0 ? void 0 : tableFormArrayRef.current;\n\n    if (checkIfSubmittable(filesFormData)) {\n      setIsUploading(true);\n      makeUploadCall(filesFormData);\n    } else {\n      setShowDocTypeRequired(true);\n    }\n  };\n\n  var makeUploadCall = function makeUploadCall(filesFormData) {\n    var submitData = utils.dms.constructUploadDocsRequest(context, filesLiteVersion, filesFormData, documentMetaData);\n    var submitFiles = utils.dms.getFullFileProperties(files, filesLiteVersion);\n    dispatch(postDmsDocumentsV2({\n      context: context,\n      documentTypeKey: documentTypeKey,\n      submitData: submitData,\n      submitFiles: submitFiles\n    })).then(function (data) {\n      var _data$status;\n\n      setIsUploading(false);\n\n      if ((data === null || data === void 0 ? void 0 : (_data$status = data.status) === null || _data$status === void 0 ? void 0 : _data$status.toLowerCase()) === constants.API_RESPONSE_OK.toLowerCase()) {\n        var _data$data;\n\n        setFilesSubmitted(true);\n        markUploadFailedFiles(data === null || data === void 0 ? void 0 : data.data);\n        postDmsDocumentsSuccess(data);\n        setPostUploadMetaData(utils.dms.getDocMetaDataAfterUpload(data === null || data === void 0 ? void 0 : (_data$data = data.data) === null || _data$data === void 0 ? void 0 : _data$data.documentDto));\n      }\n    });\n  };\n\n  var markUploadFailedFiles = function markUploadFailedFiles(data) {\n    var _data$documentDto, _data$documentDto2, _ref3;\n\n    var uploadFiles = data === null || data === void 0 ? void 0 : (_data$documentDto = data.documentDto) === null || _data$documentDto === void 0 ? void 0 : _data$documentDto.map(function (eachFile) {\n      return eachFile === null || eachFile === void 0 ? void 0 : eachFile.documentName;\n    });\n    var uploadStatus = data === null || data === void 0 ? void 0 : (_data$documentDto2 = data.documentDto) === null || _data$documentDto2 === void 0 ? void 0 : _data$documentDto2.map(function (eachFile) {\n      return eachFile === null || eachFile === void 0 ? void 0 : eachFile.documentUploaded;\n    });\n    var checkIfAllUploaded = uploadStatus === null || uploadStatus === void 0 ? void 0 : uploadStatus.every(function (item) {\n      return item;\n    });\n    if (checkIfAllUploaded) setCanSubmit(false);\n    var newList = (_ref3 = _toConsumableArray(activeFiles)) === null || _ref3 === void 0 ? void 0 : _ref3.filter(function (item, index) {\n      return !uploadStatus[index];\n    });\n\n    var currentForm = _toConsumableArray(tableFormArrayRef === null || tableFormArrayRef === void 0 ? void 0 : tableFormArrayRef.current);\n\n    var removalIndex = [];\n    var newForm = currentForm === null || currentForm === void 0 ? void 0 : currentForm.filter(function (item) {\n      var matchIndex = uploadFiles === null || uploadFiles === void 0 ? void 0 : uploadFiles.indexOf(item === null || item === void 0 ? void 0 : item.formFileName);\n      removalIndex.push(matchIndex);\n      return matchIndex > -1 && !uploadStatus[matchIndex];\n    });\n\n    if (utils.generic.isValidArray(removalIndex, true)) {\n      removalIndex.forEach(function (ind) {\n        uploadStatus.splice(ind, 1);\n      });\n    }\n\n    tableFormArrayRef.current = _toConsumableArray(newForm);\n    setActiveFiles(newList);\n    setUploadStatus(uploadStatus);\n  };\n\n  var handleRetrySingleFile = function handleRetrySingleFile(retryIndex) {\n    var submitData = utils.dms.constructUploadDocsRequest(context, [filesLiteVersion[retryIndex]], [tableFormArrayRef === null || tableFormArrayRef === void 0 ? void 0 : tableFormArrayRef.current[retryIndex]], documentMetaData);\n    var submitFiles = utils.dms.getFullFileProperties([files[retryIndex]], [filesLiteVersion[retryIndex]]);\n    dispatch(postDmsDocumentsV2({\n      context: context,\n      documentTypeKey: documentTypeKey,\n      submitData: submitData,\n      submitFiles: submitFiles\n    })).then(function (data) {\n      var _data$status2;\n\n      setIsUploading(false);\n\n      if ((data === null || data === void 0 ? void 0 : (_data$status2 = data.status) === null || _data$status2 === void 0 ? void 0 : _data$status2.toLowerCase()) === constants.API_RESPONSE_OK.toLowerCase()) {\n        setFilesSubmitted(true);\n        markUploadFailedFiles(data === null || data === void 0 ? void 0 : data.data);\n      }\n    });\n  };\n\n  var handleCancel = function handleCancel() {\n    dispatch(hideModal('DMS_UPLOAD_FILES'));\n  };\n\n  useEffect(function () {\n    dispatch(getDmsMetaData(context, xbInstanceId, referenceId)).then(function (data) {\n      setIsMetaDataLoaded((data === null || data === void 0 ? void 0 : data.status) === constants.API_RESPONSE_OK);\n    });\n    dispatch(removeLoader('DmsUploadFiles'));\n    return function () {\n      if (!isDmsFromPiInstruction || !isStandaloneUpload) {\n        dispatch(getViewTableDocuments(_objectSpread({}, searchParamsAfterUpload ? searchParamsAfterUpload : _objectSpread({\n          referenceId: referenceId,\n          sectionType: context,\n          documentTypeKey: documentTypeKey\n        }, policyRef && instructionId && {\n          policyRef: policyRef,\n          instructionId: instructionId\n        }))));\n      }\n    };\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return /*#__PURE__*/_jsxDEV(DmsUploadFilesView, {\n    context: context,\n    files: activeFiles,\n    duplicateFileIndexes: duplicateFileIndexes,\n    cols: cols,\n    currencies: currencies,\n    folderTypes: folderTypes,\n    documentTypes: refinedDocTypes,\n    isMetaDataLoaded: isMetaDataLoaded,\n    showDocTypeRequired: showDocTypeRequired,\n    canSubmit: canSubmit,\n    filesSubmitted: filesSubmitted,\n    isUploading: isUploading,\n    uploadStatus: uploadStatus,\n    isDmsFromPi: isDmsFromPi,\n    showFolderFilter: showFolderFilter,\n    postUploadMetaData: postUploadMetaData,\n    handlers: {\n      handleFolderTypeSelection: handleFolderTypeSelection,\n      handleRemoveFiles: handleRemoveFiles,\n      handleTableForm: handleTableForm,\n      handleFilesSubmission: handleFilesSubmission,\n      handleRetrySingleFile: handleRetrySingleFile,\n      handleCancel: handleCancel\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 272,\n    columnNumber: 5\n  }, this);\n}\n\n_s(DmsUploadFiles, \"qwSQldNb19eCD+toKmKuQYCo8sM=\", false, function () {\n  return [useDispatch, useSelector, useSelector, useSelector, useSelector, useSelector];\n});\n\n_c = DmsUploadFiles;\n\nvar _c;\n\n$RefreshReg$(_c, \"DmsUploadFiles\");","map":{"version":3,"sources":["E:/MPHASIS/claims-page/Mphasis-Edge/src/forms/DmsUploadFiles/DmsUploadFiles.js"],"names":["React","useState","useEffect","useRef","PropTypes","useDispatch","useSelector","DmsUploadFilesView","hideModal","getViewTableDocuments","getDmsMetaData","selectRefDataNewDocumentTypesByContextSource","selectRefDataNewDocumentTypeLookUpByContextSource","selectDmsMetaData","selectorDmsViewFiles","selectCaseDetails","selectSettlementCurrency","removeLoader","postDmsDocumentsV2","constants","utils","DmsUploadFiles","propTypes","files","array","isRequired","context","string","referenceId","sourceId","oneOfType","number","documentTypeKey","oneOf","Object","values","DMS_DOCUMENT_TYPE_SECTION_KEYS","type","searchParamsAfterUpload","shape","sectionType","postDmsDocumentsSuccess","func","isStandaloneUpload","bool","defaultProps","policy","dispatch","filesLiteVersion","dms","trimFileProperties","isDmsFromPi","dmsFormatter","isDmsFromPiInstruction","showFolderFilter","selectCurrencies","documentMetaData","previousUploadedFiles","ppCaseDetails","xbInstanceId","DMS_CLAIM_SOURCE_ID","getDocumentTypeFilterKeys","dmsSectionKey","selectedSourceId","documentTypesBeforeFilter","getDocumentTypeInfo","documentTypeDescription","sectionKey","dmsSourceID","documentTypesAfterFilter","DMS_CONTEXT_POLICY","DMS_CONTEXT_PROCESSING_INSTRUCTION","filter","sourceID","activeFiles","setActiveFiles","refinedDocTypes","setRefinedDocTypes","isMetaDataLoaded","setIsMetaDataLoaded","showDocTypeRequired","setShowDocTypeRequired","canSubmit","setCanSubmit","filesSubmitted","setFilesSubmitted","isUploading","setIsUploading","map","uploadStatus","setUploadStatus","postUploadMetaData","setPostUploadMetaData","tableFormArrayRef","getFilesForm","duplicateFileIndexes","getDuplicateFileIndexes","folderTypes","getFolderTypes","currencies","currency","listWithCodeAndCurrency","policyRef","instructionId","cols","id","label","t","empty","handleFolderTypeSelection","event","value","refinedDocTypeByFolderName","handleRemoveFiles","removalIndex","newList","splice","newForm","current","checkIfInvalidFiles","handleTableForm","index","rowFormState","formFileName","formDocType","formDocClassificationType","paymentFields","isDuplicateFileName","isInvalidFileName","fileFormArray","invalidCondition","generic","isValidArray","every","fileForm","checkIfSubmittable","submitCondition","handleFilesSubmission","e","preventDefault","filesFormData","makeUploadCall","submitData","constructUploadDocsRequest","submitFiles","getFullFileProperties","then","data","status","toLowerCase","API_RESPONSE_OK","markUploadFailedFiles","getDocMetaDataAfterUpload","documentDto","uploadFiles","eachFile","documentName","documentUploaded","checkIfAllUploaded","item","currentForm","matchIndex","indexOf","push","forEach","ind","handleRetrySingleFile","retryIndex","handleCancel"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\n\r\n// app\r\nimport { DmsUploadFilesView } from './DmsUploadFiles.view';\r\nimport {\r\n  hideModal,\r\n  getViewTableDocuments,\r\n  getDmsMetaData,\r\n  selectRefDataNewDocumentTypesByContextSource,\r\n  selectRefDataNewDocumentTypeLookUpByContextSource,\r\n  selectDmsMetaData,\r\n  selectorDmsViewFiles,\r\n  selectCaseDetails,\r\n  selectSettlementCurrency,\r\n  removeLoader,\r\n  postDmsDocumentsV2,\r\n} from 'stores';\r\nimport * as constants from 'consts';\r\nimport * as utils from 'utils';\r\n\r\nDmsUploadFiles.propTypes = {\r\n  files: PropTypes.array.isRequired,\r\n  context: PropTypes.string.isRequired,\r\n  referenceId: PropTypes.string.isRequired,\r\n  sourceId: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\r\n  documentTypeKey: PropTypes.oneOf(Object.values(constants.DMS_DOCUMENT_TYPE_SECTION_KEYS.type)),\r\n  searchParamsAfterUpload: PropTypes.shape({\r\n    referenceId: PropTypes.oneOfType([PropTypes.number, PropTypes.string]).isRequired,\r\n    sectionType: PropTypes.string.isRequired,\r\n  }),\r\n  postDmsDocumentsSuccess: PropTypes.func,\r\n  isStandaloneUpload: PropTypes.bool, // When Upload modal is launched individually rather than from within DmsTable\r\n};\r\n\r\nDmsUploadFiles.defaultProps = {\r\n  documentTypeKey: constants.DMS_DOCUMENT_TYPE_SECTION_KEYS.type.policy,\r\n  postDmsDocumentsSuccess: () => { },\r\n  isStandaloneUpload: false,\r\n};\r\n\r\nexport default function DmsUploadFiles({ files, context, referenceId, sourceId, documentTypeKey, searchParamsAfterUpload, postDmsDocumentsSuccess, isStandaloneUpload }) {\r\n  const dispatch = useDispatch();\r\n\r\n  const filesLiteVersion = utils.dms.trimFileProperties(files);\r\n  const isDmsFromPi = utils.dmsFormatter.isDmsFromPi(documentTypeKey);\r\n  const isDmsFromPiInstruction = utils.dmsFormatter.isDmsFromPiInstruction(documentTypeKey);\r\n  const showFolderFilter = !(isDmsFromPi || documentTypeKey === constants.DMS_DOCUMENT_TYPE_SECTION_KEYS.type.policy);\r\n\r\n  // redux\r\n  const selectCurrencies = useSelector(selectSettlementCurrency);\r\n  const documentMetaData = useSelector(selectDmsMetaData);\r\n  const previousUploadedFiles = useSelector(selectorDmsViewFiles);\r\n  const ppCaseDetails = useSelector(selectCaseDetails); // TODO will be later coming as props\r\n\r\n  const xbInstanceId = sourceId ? sourceId : constants.DMS_CLAIM_SOURCE_ID;\r\n\r\n  const { dmsSectionKey, sourceId: selectedSourceId } = utils.dmsFormatter.getDocumentTypeFilterKeys(context, xbInstanceId, documentTypeKey);\r\n  const documentTypesBeforeFilter = useSelector(\r\n    dmsSectionKey === constants.DMS_DOCUMENT_TYPE_SECTION_KEYS.type.policy\r\n      ? selectRefDataNewDocumentTypeLookUpByContextSource(dmsSectionKey, selectedSourceId)\r\n      : selectRefDataNewDocumentTypesByContextSource(dmsSectionKey, selectedSourceId)\r\n  );\r\n\r\n  const { documentTypeDescription, sectionKey, dmsSourceID } =\r\n    isDmsFromPi && utils.dmsFormatter.getDocumentTypeInfo(documentTypeKey, selectedSourceId);\r\n\r\n  const documentTypesAfterFilter =\r\n    (context === constants.DMS_CONTEXT_POLICY\r\n      || context === constants.DMS_CONTEXT_PROCESSING_INSTRUCTION) && isDmsFromPi ?\r\n      documentTypesBeforeFilter?.filter(\r\n        (type) => (\r\n          type.documentTypeDescription === documentTypeDescription\r\n          && type.sectionKey === sectionKey\r\n          && type.sourceID === dmsSourceID\r\n        )\r\n      ) : documentTypesBeforeFilter;\r\n\r\n  // state\r\n  const [activeFiles, setActiveFiles] = useState(filesLiteVersion);\r\n  const [refinedDocTypes, setRefinedDocTypes] = useState(documentTypesAfterFilter);\r\n  const [isMetaDataLoaded, setIsMetaDataLoaded] = useState(false);\r\n  const [showDocTypeRequired, setShowDocTypeRequired] = useState(false);\r\n  const [canSubmit, setCanSubmit] = useState(true);\r\n  const [filesSubmitted, setFilesSubmitted] = useState(false);\r\n  const [isUploading, setIsUploading] = useState(false);\r\n  const [uploadStatus, setUploadStatus] = useState(filesLiteVersion?.map(() => false) || []);\r\n  const [postUploadMetaData, setPostUploadMetaData] = useState([]);\r\n\r\n  const tableFormArrayRef = useRef(utils.dms.getFilesForm(activeFiles || []));\r\n  const duplicateFileIndexes = utils.dms.getDuplicateFileIndexes(activeFiles, previousUploadedFiles);\r\n  const folderTypes = utils.dms.getFolderTypes(documentTypesAfterFilter);\r\n  const currencies = utils.currency.listWithCodeAndCurrency(selectCurrencies);\r\n  // Premium Processing Case Details\r\n  const policyRef = ppCaseDetails?.policyRef;\r\n  const instructionId = ppCaseDetails?.instructionId;\r\n\r\n  const cols = [\r\n    {\r\n      id: 'fileName',\r\n      label: utils.string.t('claims.lossInformation.dmsUploadDocument.cols.fileName'),\r\n    },\r\n    {\r\n      id: 'documentType',\r\n      label: utils.string.t('claims.lossInformation.dmsUploadDocument.cols.documentType'),\r\n    },\r\n    {\r\n      id: 'documentClassification',\r\n      label: utils.string.t('claims.lossInformation.dmsUploadDocument.cols.documentClassification'),\r\n    },\r\n    {\r\n      id: 'tag',\r\n      label: utils.string.t('claims.lossInformation.dmsUploadDocument.cols.tag'),\r\n    },\r\n    {\r\n      id: 'removeDoc',\r\n      empty: true,\r\n    },\r\n  ];\r\n\r\n  // handlers\r\n  const handleFolderTypeSelection = (event, value) => {\r\n    setRefinedDocTypes(utils.dms.refinedDocTypeByFolderName(value, documentTypesAfterFilter));\r\n  };\r\n\r\n  const handleRemoveFiles = (removalIndex) => {\r\n    const newList = [...activeFiles];\r\n    newList.splice(removalIndex, 1);\r\n\r\n    const newForm = [...tableFormArrayRef?.current];\r\n    newForm.splice(removalIndex, 1);\r\n    tableFormArrayRef.current = [...newForm];\r\n\r\n    setActiveFiles(newList);\r\n    checkIfInvalidFiles(tableFormArrayRef?.current);\r\n  };\r\n\r\n  const handleTableForm = (index, rowFormState) => {\r\n    const newForm = [...tableFormArrayRef?.current];\r\n    newForm[index] = {\r\n      formFileName: rowFormState?.formFileName || '',\r\n      formDocType: rowFormState?.formDocType,\r\n      formDocClassificationType: { id: rowFormState?.formDocClassificationType?.id || 0 },\r\n      paymentFields: rowFormState?.paymentFields,\r\n      isDuplicateFileName: rowFormState?.isDuplicateFileName || false,\r\n      isInvalidFileName: rowFormState?.isInvalidFileName || false,\r\n    };\r\n    tableFormArrayRef.current = [...newForm];\r\n\r\n    checkIfInvalidFiles(tableFormArrayRef?.current);\r\n  };\r\n\r\n  const checkIfInvalidFiles = (fileFormArray) => {\r\n    const invalidCondition = utils.generic.isValidArray(fileFormArray, true) &&\r\n      fileFormArray.every((fileForm) => !fileForm?.isInvalidFileName);\r\n    if (!canSubmit && invalidCondition) setCanSubmit(true);\r\n    if (canSubmit && !invalidCondition) setCanSubmit(false);\r\n  };\r\n\r\n  const checkIfSubmittable = (fileFormArray) => {\r\n    const submitCondition = utils.generic.isValidArray(fileFormArray, true) &&\r\n      fileFormArray.every((fileForm) => {\r\n        return fileForm?.formDocType?.id && !fileForm?.isInvalidFileName;\r\n      });\r\n    setCanSubmit(submitCondition);\r\n    return submitCondition;\r\n  };\r\n\r\n  const handleFilesSubmission = (e) => {\r\n    e.preventDefault();\r\n    const filesFormData = tableFormArrayRef?.current;\r\n\r\n    if (checkIfSubmittable(filesFormData)) {\r\n      setIsUploading(true);\r\n      makeUploadCall(filesFormData);\r\n    } else {\r\n      setShowDocTypeRequired(true);\r\n    }\r\n  };\r\n\r\n  const makeUploadCall = (filesFormData) => {\r\n\r\n    const submitData = utils.dms.constructUploadDocsRequest(context, filesLiteVersion, filesFormData, documentMetaData);\r\n    const submitFiles = utils.dms.getFullFileProperties(files, filesLiteVersion);\r\n\r\n    dispatch(postDmsDocumentsV2({ context, documentTypeKey, submitData, submitFiles }))\r\n      .then((data) => {\r\n        setIsUploading(false);\r\n        if (data?.status?.toLowerCase() === constants.API_RESPONSE_OK.toLowerCase()) {\r\n          setFilesSubmitted(true);\r\n          markUploadFailedFiles(data?.data);\r\n          postDmsDocumentsSuccess(data);\r\n          setPostUploadMetaData(utils.dms.getDocMetaDataAfterUpload(data?.data?.documentDto));\r\n        }\r\n      });\r\n\r\n  }\r\n\r\n  const markUploadFailedFiles = (data) => {\r\n    const uploadFiles = data?.documentDto?.map((eachFile) => eachFile?.documentName);\r\n    const uploadStatus = data?.documentDto?.map((eachFile) => eachFile?.documentUploaded);\r\n    const checkIfAllUploaded = uploadStatus?.every((item) => (item));\r\n    if (checkIfAllUploaded) setCanSubmit(false);\r\n\r\n    const newList = [...activeFiles]?.filter((item, index) => (!uploadStatus[index]));\r\n\r\n    const currentForm = [...tableFormArrayRef?.current];\r\n    let removalIndex = [];\r\n\r\n    const newForm = currentForm?.filter((item) => {\r\n      const matchIndex = uploadFiles?.indexOf(item?.formFileName);\r\n      removalIndex.push(matchIndex);\r\n      return matchIndex > -1 && !uploadStatus[matchIndex];\r\n    });\r\n\r\n    if (utils.generic.isValidArray(removalIndex, true)) {\r\n      removalIndex.forEach((ind) => {\r\n        uploadStatus.splice(ind, 1);\r\n      });\r\n    }\r\n\r\n    tableFormArrayRef.current = [...newForm];\r\n\r\n    setActiveFiles(newList);\r\n    setUploadStatus(uploadStatus);\r\n  };\r\n\r\n  const handleRetrySingleFile = (retryIndex) => {\r\n    const submitData = utils.dms.constructUploadDocsRequest(context, [filesLiteVersion[retryIndex]], [tableFormArrayRef?.current[retryIndex]], documentMetaData);\r\n    const submitFiles = utils.dms.getFullFileProperties([files[retryIndex]], [filesLiteVersion[retryIndex]]);\r\n\r\n    dispatch(postDmsDocumentsV2({ context, documentTypeKey, submitData, submitFiles }))\r\n      .then((data) => {\r\n        setIsUploading(false);\r\n        if (data?.status?.toLowerCase() === constants.API_RESPONSE_OK.toLowerCase()) {\r\n          setFilesSubmitted(true);\r\n          markUploadFailedFiles(data?.data);\r\n        }\r\n      });\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    dispatch(hideModal('DMS_UPLOAD_FILES'));\r\n  }\r\n\r\n  useEffect(() => {\r\n    dispatch(getDmsMetaData(context, xbInstanceId, referenceId)).then((data) => {\r\n      setIsMetaDataLoaded(data?.status === constants.API_RESPONSE_OK);\r\n    });\r\n    dispatch(removeLoader('DmsUploadFiles'));\r\n\r\n    return () => {\r\n      if (!isDmsFromPiInstruction || !isStandaloneUpload) {\r\n        dispatch(\r\n          getViewTableDocuments({\r\n            ...(searchParamsAfterUpload\r\n              ? searchParamsAfterUpload\r\n              : {\r\n                referenceId,\r\n                sectionType: context,\r\n                documentTypeKey,\r\n                ...(policyRef && instructionId && { policyRef, instructionId }),\r\n              }),\r\n          })\r\n        );\r\n      }\r\n    };\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  return (\r\n    <DmsUploadFilesView\r\n      context={context}\r\n      files={activeFiles}\r\n      duplicateFileIndexes={duplicateFileIndexes}\r\n      cols={cols}\r\n      currencies={currencies}\r\n      folderTypes={folderTypes}\r\n      documentTypes={refinedDocTypes}\r\n      isMetaDataLoaded={isMetaDataLoaded}\r\n      showDocTypeRequired={showDocTypeRequired}\r\n      canSubmit={canSubmit}\r\n      filesSubmitted={filesSubmitted}\r\n      isUploading={isUploading}\r\n      uploadStatus={uploadStatus}\r\n      isDmsFromPi={isDmsFromPi}\r\n      showFolderFilter={showFolderFilter}\r\n      postUploadMetaData={postUploadMetaData}\r\n      handlers={{\r\n        handleFolderTypeSelection,\r\n        handleRemoveFiles,\r\n        handleTableForm,\r\n        handleFilesSubmission,\r\n        handleRetrySingleFile,\r\n        handleCancel,\r\n      }}\r\n    />\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}