{"ast":null,"code":"import _regeneratorRuntime from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"E:\\\\MPHASIS\\\\claims-page\\\\Mphasis-Edge\\\\src\\\\modules\\\\TaskCheckList\\\\TaskCheckList.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useForm } from 'react-hook-form';\nimport * as Yup from 'yup';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport xorBy from 'lodash/xorBy';\nimport { useHistory } from 'react-router'; //app\n\nimport { TaskCheckListView } from './TaskCheckList.view';\nimport { showModal, hideModal, getTaskChecklist, getNextTaskList, selectTaskCheckList, selectTaskNextActionList, selectUserOrganisation, resetTaskProcessingChecklistChanges, postSaveTaskCheckListActions, postSaveNextTaskAction, postCloseClaim, getCurrencyPurchasedValue } from 'stores';\nimport { FormCheckbox } from 'components';\nimport * as utils from 'utils';\nimport { ORGANIZATIONS, TASK_CHECKLIST_WARNINGS, CLOSE_CLAIM, ADVICE_AND_SETTLEMENT, TASK_TAB_COMPLETED_STATUS } from 'consts';\nimport config from 'config'; //mui\n\nimport { Box } from '@material-ui/core';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nTaskCheckList.propTypes = {\n  task: PropTypes.object.isRequired,\n  currencyPurchasedValue: PropTypes.string.isRequired,\n  isCurrencyChanged: PropTypes.bool.isRequired\n};\nexport default function TaskCheckList(_ref) {\n  _s();\n\n  var task = _ref.task,\n      currencyPurchasedValue = _ref.currencyPurchasedValue,\n      isCurrencyChanged = _ref.isCurrencyChanged;\n  var dispatch = useDispatch();\n  var history = useHistory();\n  var taskCheckList = useSelector(selectTaskCheckList);\n  var taskNextActionList = useSelector(selectTaskNextActionList);\n  var userOrgDetail = useSelector(selectUserOrganisation);\n  var taskCode = task === null || task === void 0 ? void 0 : task.taskDefKey;\n  var taskId = task === null || task === void 0 ? void 0 : task.taskId;\n  var userOrgName = (userOrgDetail === null || userOrgDetail === void 0 ? void 0 : userOrgDetail.name.toLowerCase()) || ORGANIZATIONS.mphasis.name;\n  var isMphasisUser = userOrgName === ORGANIZATIONS.mphasis.name;\n  var saveType = {\n    checkList: 'checkList',\n    nextAction: 'nextAction',\n    completeTask: 'completeTask'\n  };\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      allSelectionFlag = _useState2[0],\n      setAllSelectionFlag = _useState2[1];\n\n  var _useState3 = useState(!isMphasisUser),\n      _useState4 = _slicedToArray(_useState3, 2),\n      nextActionFlag = _useState4[0],\n      setNextActionFlag = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      mandatoryList = _useState6[0],\n      setMandatoryList = _useState6[1];\n\n  var _useState7 = useState(''),\n      _useState8 = _slicedToArray(_useState7, 2),\n      nextActionVal = _useState8[0],\n      setNextActionVal = _useState8[1];\n\n  var _useState9 = useState([]),\n      _useState10 = _slicedToArray(_useState9, 2),\n      checkListChanges = _useState10[0],\n      setCheckListChanges = _useState10[1];\n\n  var fields = utils.generic.isValidArray(taskCheckList, true) ? taskCheckList.map(function (eachCheck) {\n    return {\n      name: eachCheck === null || eachCheck === void 0 ? void 0 : eachCheck.actionListID.toString(),\n      type: 'checkbox',\n      defaultValue: Boolean(eachCheck === null || eachCheck === void 0 ? void 0 : eachCheck.isActioned) || false,\n      validation: (eachCheck === null || eachCheck === void 0 ? void 0 : eachCheck.isMandatory) ? Yup.bool().required() : Yup.bool(),\n      muiComponentProps: {\n        onChange: function onChange(name, value) {\n          return handleCheckListChange(name, value);\n        }\n      }\n    };\n  }) : [];\n  var validationSchema = utils.form.getValidationSchema(fields);\n  var checkListForm = useForm(_objectSpread({}, validationSchema && {\n    resolver: yupResolver(validationSchema),\n    context: {\n      validation: true\n    }\n  }));\n  var headerFields = [{\n    name: 'selectAllValues',\n    type: 'checkbox',\n    defaultValue: false,\n    muiComponentProps: {\n      onChange: function onChange(name, value) {\n        return handleAllCheckListSelected(name, value);\n      }\n    }\n  }];\n  var columns = [{\n    id: 'select',\n    label: /*#__PURE__*/_jsxDEV(Box, {\n      mb: -1.25,\n      children: utils.generic.isValidArray(taskCheckList, true) && /*#__PURE__*/_jsxDEV(FormCheckbox, _objectSpread({}, utils.form.getFieldProps(headerFields, 'selectAllValues')), void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 9\n    }, this),\n    visible: true\n  }, {\n    id: 'ChecklistItems',\n    label: utils.string.t('claims.processing.taskDetailsCheckList.columns.ChecklistItems'),\n    sort: {\n      type: 'lexical',\n      direction: 'asc'\n    },\n    nowrap: true,\n    visible: true,\n    mandatory: true\n  }, {\n    id: 'lastUpdatedBy',\n    label: utils.string.t('claims.processing.taskDetailsCheckList.columns.lastUpdatedBy'),\n    sort: {\n      type: 'lexical',\n      direction: 'asc'\n    },\n    nowrap: true,\n    visible: true,\n    mandatory: true\n  }, {\n    id: 'lastUpdatedOn',\n    label: utils.string.t('claims.processing.taskDetailsCheckList.columns.lastUpdatedOn'),\n    sort: {\n      type: 'date',\n      direction: 'asc'\n    },\n    nowrap: true,\n    visible: true,\n    mandatory: true\n  }];\n  var popoverActions = [{\n    id: 'blank',\n    label: '',\n    callback: function callback() {\n      return handleNextActionSelected('');\n    }\n  }].concat(_toConsumableArray(taskNextActionList.map(function (action) {\n    return {\n      id: action === null || action === void 0 ? void 0 : action.taskCode,\n      label: action === null || action === void 0 ? void 0 : action.taskLabel,\n      data: action,\n      callback: function callback() {\n        return handleNextActionSelected(action === null || action === void 0 ? void 0 : action.taskCode);\n      }\n    };\n  })));\n\n  var fetchDataFromBackend = function fetchDataFromBackend() {\n    dispatch(getTaskChecklist({\n      taskCode: taskCode,\n      taskId: taskId,\n      userOrgName: userOrgName,\n      viewLoader: false\n    }));\n    dispatch(getNextTaskList({\n      taskCode: taskCode,\n      viewLoader: false\n    }));\n\n    if (taskCode === ADVICE_AND_SETTLEMENT) {\n      dispatch(getCurrencyPurchasedValue(task === null || task === void 0 ? void 0 : task.processId));\n    }\n  };\n\n  var constructMandatoryList = function constructMandatoryList() {\n    var result = taskCheckList.filter(function (item) {\n      return (item === null || item === void 0 ? void 0 : item.isMandatory) && !(item === null || item === void 0 ? void 0 : item.isActioned);\n    }).map(function (item) {\n      return item === null || item === void 0 ? void 0 : item.actionListID.toString();\n    });\n    setMandatoryList(result);\n  };\n\n  var updateMandatoryList = function updateMandatoryList(name) {\n    if (isMphasisUser) {\n      var wasMandatory = !!taskCheckList.find(function (item) {\n        return (item === null || item === void 0 ? void 0 : item.actionListID.toString()) === name && (item === null || item === void 0 ? void 0 : item.isMandatory);\n      });\n\n      if (wasMandatory) {\n        var newList = xorBy(mandatoryList, [name]) || [];\n        setMandatoryList(newList);\n      }\n    } else {\n      setMandatoryList([]);\n    }\n  };\n\n  var handleCheckListChange = function handleCheckListChange(name, value) {\n    updateMandatoryList(name);\n    var findCheckItem = taskCheckList.find(function (item) {\n      var keyCheck = item === null || item === void 0 ? void 0 : item.actionListID.toString();\n      return keyCheck === name;\n    });\n\n    if (findCheckItem) {\n      var constructChangeItem = [findCheckItem].map(function (item) {\n        return {\n          actionListDetailID: item === null || item === void 0 ? void 0 : item.actionListDetailID,\n          actionListID: item === null || item === void 0 ? void 0 : item.actionListID,\n          isActioned: !value ? 0 : 1\n        };\n      });\n      var newChangeList = xorBy(checkListChanges, constructChangeItem, 'actionListID');\n      setCheckListChanges(newChangeList);\n    }\n  };\n\n  var handleAllCheckListSelected = function handleAllCheckListSelected(name, isAllSelected) {\n    setAllSelectionFlag(isAllSelected);\n\n    if (isMphasisUser) {\n      if (isAllSelected) {\n        setMandatoryList([]);\n      } else {\n        constructMandatoryList();\n      }\n\n      setNextActionFlag(isAllSelected);\n    }\n\n    var constructChangeItem = taskCheckList.map(function (item) {\n      return {\n        actionListDetailID: item === null || item === void 0 ? void 0 : item.actionListDetailID,\n        actionListID: item === null || item === void 0 ? void 0 : item.actionListID,\n        isActioned: !isAllSelected ? 0 : 1\n      };\n    });\n    setCheckListChanges(constructChangeItem);\n  };\n\n  var handleNextActionSelected = function handleNextActionSelected(nextActionCode) {\n    setNextActionVal(nextActionCode);\n\n    if (nextActionCode === CLOSE_CLAIM) {\n      handleConfirmClaimClose(nextActionCode);\n    } else {\n      handleNextTaskWarning(saveType.nextAction, nextActionCode);\n    }\n  };\n\n  var checkListChangeSave = function checkListChangeSave() {\n    if (isMphasisUser && utils.generic.isValidArray(mandatoryList, true)) {\n      handleMandatoryWarning();\n    } else {\n      saveTaskOperations(saveType.checkList);\n    }\n  };\n\n  var checkListChangeReset = function checkListChangeReset() {\n    checkListForm.reset();\n    setCheckListChanges([]);\n\n    if (utils.generic.isValidArray(taskCheckList, true) && isMphasisUser) {\n      constructMandatoryList();\n    } else {\n      setMandatoryList([]);\n    }\n  };\n\n  var completeTask = function completeTask() {\n    handleTaskCompleteWarning();\n  };\n\n  var saveTaskOperations = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(type, nextActionCode) {\n      var saveRequest;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              // \"nextTaskCode\" is null for postSaveNextTaskAction to mark task as complete\n              // \"nextTaskCode\" is null for postSaveTaskCheckListActions & postSaveNextTaskAction (complete task scenario)\n              saveRequest = {\n                processID: task === null || task === void 0 ? void 0 : task.processId,\n                nextTaskCode: type !== saveType.nextAction ? null : nextActionCode || nextActionVal,\n                currencyPurchased: currencyPurchasedValue,\n                approvalStatus: task === null || task === void 0 ? void 0 : task.approvalStatus,\n                actionListDetails: checkListChanges\n              };\n\n              if (!(type === saveType.checkList)) {\n                _context.next = 7;\n                break;\n              }\n\n              _context.next = 4;\n              return dispatch(postSaveTaskCheckListActions(task === null || task === void 0 ? void 0 : task.taskId, saveRequest));\n\n            case 4:\n              fetchDataFromBackend();\n              _context.next = 10;\n              break;\n\n            case 7:\n              _context.next = 9;\n              return dispatch(postSaveNextTaskAction(task === null || task === void 0 ? void 0 : task.taskId, saveRequest));\n\n            case 9:\n              navigateToTaskGrid();\n\n            case 10:\n              checkListChangeReset();\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function saveTaskOperations(_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var closeClaimTask = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(nextActionCode) {\n      var payload;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              payload = {\n                nextTaskCode: nextActionCode,\n                processID: task === null || task === void 0 ? void 0 : task.rootProcessId\n              };\n              _context2.next = 3;\n              return dispatch(postCloseClaim(task === null || task === void 0 ? void 0 : task.taskId, payload));\n\n            case 3:\n              navigateToTaskGrid();\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function closeClaimTask(_x3) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var handleMandatoryWarning = function handleMandatoryWarning() {\n    dispatch(showModal({\n      component: 'CHECK_LIST_ALERTS',\n      props: {\n        title: utils.string.t('navigation.alert'),\n        hideCompOnBlur: false,\n        fullWidth: true,\n        maxWidth: 'sm',\n        disableAutoFocus: true,\n        componentProps: {\n          type: TASK_CHECKLIST_WARNINGS.type.mandatory,\n          handlers: {\n            submit: function submit() {\n              dispatch(hideModal());\n\n              if (nextActionVal) {\n                handleNextTaskWarning();\n              } else {\n                saveTaskOperations(saveType.checkList);\n              }\n            },\n            cancel: function cancel() {\n              dispatch(hideModal());\n            }\n          }\n        }\n      }\n    }));\n  };\n\n  var handleNextTaskWarning = function handleNextTaskWarning() {\n    var type = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : saveType.checkList;\n    var nextActionCode = arguments.length > 1 ? arguments[1] : undefined;\n    dispatch(showModal({\n      component: 'CHECK_LIST_ALERTS',\n      props: {\n        title: utils.string.t('navigation.alert'),\n        hideCompOnBlur: false,\n        fullWidth: true,\n        maxWidth: 'sm',\n        disableAutoFocus: true,\n        componentProps: {\n          type: TASK_CHECKLIST_WARNINGS.type.nextTask,\n          handlers: {\n            submit: function submit() {\n              dispatch(hideModal());\n              saveTaskOperations(type, nextActionCode);\n            },\n            cancel: function cancel() {\n              dispatch(hideModal());\n            }\n          }\n        }\n      }\n    }));\n  };\n\n  var handleTaskCompleteWarning = function handleTaskCompleteWarning() {\n    dispatch(showModal({\n      component: 'CHECK_LIST_ALERTS',\n      props: {\n        title: utils.string.t('navigation.alert'),\n        hideCompOnBlur: false,\n        fullWidth: true,\n        maxWidth: 'sm',\n        disableAutoFocus: true,\n        componentProps: {\n          type: TASK_CHECKLIST_WARNINGS.type.completeTask,\n          handlers: {\n            submit: function submit() {\n              dispatch(hideModal());\n              saveTaskOperations(saveType.completeTask);\n            },\n            cancel: function cancel() {\n              dispatch(hideModal());\n            }\n          }\n        }\n      }\n    }));\n  };\n\n  var handleConfirmClaimClose = function handleConfirmClaimClose(nextActionCode) {\n    dispatch(showModal({\n      component: 'CONFIRM',\n      props: {\n        title: utils.string.t('status.alert'),\n        hint: utils.string.t('claims.processing.taskDetailsCheckList.closeClaims'),\n        fullWidth: true,\n        maxWidth: 'xs',\n        componentProps: {\n          cancelLabel: utils.string.t('app.no'),\n          confirmLabel: utils.string.t('app.yes'),\n          submitHandler: function submitHandler() {\n            closeClaimTask(nextActionCode);\n          }\n        }\n      }\n    }));\n  };\n\n  var navigateToTaskGrid = function navigateToTaskGrid() {\n    history.push(\"\".concat(config.routes.claimsProcessing.claim, \"/\").concat(task === null || task === void 0 ? void 0 : task.processRef));\n  };\n\n  var isCompletedTask = (task === null || task === void 0 ? void 0 : task.status) === TASK_TAB_COMPLETED_STATUS;\n  var isCheckListChanged = utils.generic.isValidArray(checkListChanges, true);\n  var hasCheckList = utils.generic.isValidArray(taskCheckList, true);\n  var hasNextActions = utils.generic.isValidArray(popoverActions, true) && popoverActions.length > 1;\n  useEffect(function () {\n    fetchDataFromBackend();\n    return function () {\n      dispatch(resetTaskProcessingChecklistChanges());\n    };\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(function () {\n    if (utils.generic.isValidArray(taskCheckList, true) && isMphasisUser) {\n      constructMandatoryList();\n    }\n  }, [taskCheckList]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(function () {\n    if (isMphasisUser) {\n      if (utils.generic.isValidArray(taskCheckList, true) && !utils.generic.isValidArray(mandatoryList, true)) {\n        setNextActionFlag(true);\n      } else {\n        setNextActionFlag(false);\n      }\n    }\n  }, [mandatoryList]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return /*#__PURE__*/_jsxDEV(TaskCheckListView, {\n    isCompletedTask: isCompletedTask,\n    allSelectionFlag: allSelectionFlag,\n    nextActionFlag: nextActionFlag,\n    isMphasisUser: isMphasisUser,\n    isCheckListChanged: isCheckListChanged,\n    hasCheckList: hasCheckList,\n    hasNextActions: hasNextActions,\n    columns: columns,\n    rows: taskCheckList,\n    fields: fields,\n    formControls: checkListForm,\n    popoverActions: popoverActions,\n    isCurrencyChanged: isCurrencyChanged,\n    task: task,\n    handlers: {\n      checkListChangeSave: checkListChangeSave,\n      checkListChangeReset: checkListChangeReset,\n      completeTask: completeTask\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 406,\n    columnNumber: 5\n  }, this);\n}\n\n_s(TaskCheckList, \"Yrt10A41r6M7uVKzs7hTXqnsbto=\", false, function () {\n  return [useDispatch, useHistory, useSelector, useSelector, useSelector, useForm];\n});\n\n_c = TaskCheckList;\n\nvar _c;\n\n$RefreshReg$(_c, \"TaskCheckList\");","map":{"version":3,"sources":["E:/MPHASIS/claims-page/Mphasis-Edge/src/modules/TaskCheckList/TaskCheckList.js"],"names":["React","useEffect","useState","PropTypes","useSelector","useDispatch","useForm","Yup","yupResolver","xorBy","useHistory","TaskCheckListView","showModal","hideModal","getTaskChecklist","getNextTaskList","selectTaskCheckList","selectTaskNextActionList","selectUserOrganisation","resetTaskProcessingChecklistChanges","postSaveTaskCheckListActions","postSaveNextTaskAction","postCloseClaim","getCurrencyPurchasedValue","FormCheckbox","utils","ORGANIZATIONS","TASK_CHECKLIST_WARNINGS","CLOSE_CLAIM","ADVICE_AND_SETTLEMENT","TASK_TAB_COMPLETED_STATUS","config","Box","TaskCheckList","propTypes","task","object","isRequired","currencyPurchasedValue","string","isCurrencyChanged","bool","dispatch","history","taskCheckList","taskNextActionList","userOrgDetail","taskCode","taskDefKey","taskId","userOrgName","name","toLowerCase","mphasis","isMphasisUser","saveType","checkList","nextAction","completeTask","allSelectionFlag","setAllSelectionFlag","nextActionFlag","setNextActionFlag","mandatoryList","setMandatoryList","nextActionVal","setNextActionVal","checkListChanges","setCheckListChanges","fields","generic","isValidArray","map","eachCheck","actionListID","toString","type","defaultValue","Boolean","isActioned","validation","isMandatory","required","muiComponentProps","onChange","value","handleCheckListChange","validationSchema","form","getValidationSchema","checkListForm","resolver","context","headerFields","handleAllCheckListSelected","columns","id","label","getFieldProps","visible","t","sort","direction","nowrap","mandatory","popoverActions","callback","handleNextActionSelected","action","taskLabel","data","fetchDataFromBackend","viewLoader","processId","constructMandatoryList","result","filter","item","updateMandatoryList","wasMandatory","find","newList","findCheckItem","keyCheck","constructChangeItem","actionListDetailID","newChangeList","isAllSelected","nextActionCode","handleConfirmClaimClose","handleNextTaskWarning","checkListChangeSave","handleMandatoryWarning","saveTaskOperations","checkListChangeReset","reset","handleTaskCompleteWarning","saveRequest","processID","nextTaskCode","currencyPurchased","approvalStatus","actionListDetails","navigateToTaskGrid","closeClaimTask","payload","rootProcessId","component","props","title","hideCompOnBlur","fullWidth","maxWidth","disableAutoFocus","componentProps","handlers","submit","cancel","nextTask","hint","cancelLabel","confirmLabel","submitHandler","push","routes","claimsProcessing","claim","processRef","isCompletedTask","status","isCheckListChanged","hasCheckList","hasNextActions","length"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { useForm } from 'react-hook-form';\r\nimport * as Yup from 'yup';\r\nimport { yupResolver } from '@hookform/resolvers/yup';\r\nimport xorBy from 'lodash/xorBy';\r\nimport { useHistory } from 'react-router';\r\n\r\n//app\r\nimport { TaskCheckListView } from './TaskCheckList.view';\r\nimport {\r\n  showModal,\r\n  hideModal,\r\n  getTaskChecklist,\r\n  getNextTaskList,\r\n  selectTaskCheckList,\r\n  selectTaskNextActionList,\r\n  selectUserOrganisation,\r\n  resetTaskProcessingChecklistChanges,\r\n  postSaveTaskCheckListActions,\r\n  postSaveNextTaskAction,\r\n  postCloseClaim,\r\n  getCurrencyPurchasedValue,\r\n} from 'stores';\r\nimport { FormCheckbox } from 'components';\r\nimport * as utils from 'utils';\r\nimport { ORGANIZATIONS, TASK_CHECKLIST_WARNINGS, CLOSE_CLAIM, ADVICE_AND_SETTLEMENT, TASK_TAB_COMPLETED_STATUS } from 'consts';\r\nimport config from 'config';\r\n\r\n//mui\r\nimport { Box } from '@material-ui/core';\r\n\r\nTaskCheckList.propTypes = {\r\n  task: PropTypes.object.isRequired,\r\n  currencyPurchasedValue: PropTypes.string.isRequired,\r\n  isCurrencyChanged: PropTypes.bool.isRequired,\r\n};\r\nexport default function TaskCheckList({ task, currencyPurchasedValue, isCurrencyChanged }) {\r\n  const dispatch = useDispatch();\r\n  const history = useHistory();\r\n\r\n  const taskCheckList = useSelector(selectTaskCheckList);\r\n  const taskNextActionList = useSelector(selectTaskNextActionList);\r\n  const userOrgDetail = useSelector(selectUserOrganisation);\r\n\r\n  const taskCode = task?.taskDefKey;\r\n  const taskId = task?.taskId;\r\n  const userOrgName = userOrgDetail?.name.toLowerCase() || ORGANIZATIONS.mphasis.name;\r\n  const isMphasisUser = userOrgName === ORGANIZATIONS.mphasis.name;\r\n  const saveType = { checkList: 'checkList', nextAction: 'nextAction', completeTask: 'completeTask' };\r\n\r\n  const [allSelectionFlag, setAllSelectionFlag] = useState(false);\r\n  const [nextActionFlag, setNextActionFlag] = useState(!isMphasisUser);\r\n  const [mandatoryList, setMandatoryList] = useState([]);\r\n  const [nextActionVal, setNextActionVal] = useState('');\r\n  const [checkListChanges, setCheckListChanges] = useState([]);\r\n\r\n  let fields = utils.generic.isValidArray(taskCheckList, true)\r\n    ? taskCheckList.map((eachCheck) => ({\r\n      name: eachCheck?.actionListID.toString(),\r\n      type: 'checkbox',\r\n      defaultValue: Boolean(eachCheck?.isActioned) || false,\r\n      validation: eachCheck?.isMandatory ? Yup.bool().required() : Yup.bool(),\r\n      muiComponentProps: {\r\n        onChange: (name, value) => handleCheckListChange(name, value),\r\n      },\r\n    }))\r\n    : [];\r\n\r\n  const validationSchema = utils.form.getValidationSchema(fields);\r\n  const checkListForm = useForm({\r\n    ...(validationSchema && { resolver: yupResolver(validationSchema), context: { validation: true } }),\r\n  });\r\n\r\n  const headerFields = [\r\n    {\r\n      name: 'selectAllValues',\r\n      type: 'checkbox',\r\n      defaultValue: false,\r\n      muiComponentProps: {\r\n        onChange: (name, value) => handleAllCheckListSelected(name, value),\r\n      },\r\n    },\r\n  ];\r\n\r\n  const columns = [\r\n    {\r\n      id: 'select',\r\n      label: (\r\n        <Box mb={-1.25}>\r\n          {utils.generic.isValidArray(taskCheckList, true) && (\r\n            <FormCheckbox {...utils.form.getFieldProps(headerFields, 'selectAllValues')} />\r\n          )}\r\n        </Box>\r\n      ),\r\n      visible: true,\r\n    },\r\n    {\r\n      id: 'ChecklistItems',\r\n      label: utils.string.t('claims.processing.taskDetailsCheckList.columns.ChecklistItems'),\r\n      sort: { type: 'lexical', direction: 'asc' },\r\n      nowrap: true,\r\n      visible: true,\r\n      mandatory: true,\r\n    },\r\n    {\r\n      id: 'lastUpdatedBy',\r\n      label: utils.string.t('claims.processing.taskDetailsCheckList.columns.lastUpdatedBy'),\r\n      sort: { type: 'lexical', direction: 'asc' },\r\n      nowrap: true,\r\n      visible: true,\r\n      mandatory: true,\r\n    },\r\n    {\r\n      id: 'lastUpdatedOn',\r\n      label: utils.string.t('claims.processing.taskDetailsCheckList.columns.lastUpdatedOn'),\r\n      sort: { type: 'date', direction: 'asc' },\r\n      nowrap: true,\r\n      visible: true,\r\n      mandatory: true,\r\n    },\r\n  ];\r\n\r\n  const popoverActions = [\r\n    { id: 'blank', label: '', callback: () => handleNextActionSelected('') },\r\n    ...taskNextActionList.map((action) => ({\r\n      id: action?.taskCode,\r\n      label: action?.taskLabel,\r\n      data: action,\r\n      callback: () => handleNextActionSelected(action?.taskCode),\r\n    })),\r\n  ];\r\n\r\n  const fetchDataFromBackend = () => {\r\n    dispatch(getTaskChecklist({ taskCode, taskId, userOrgName, viewLoader: false }));\r\n    dispatch(getNextTaskList({ taskCode, viewLoader: false }));\r\n    if (taskCode === ADVICE_AND_SETTLEMENT) {\r\n      dispatch(getCurrencyPurchasedValue(task?.processId));\r\n    }\r\n  };\r\n\r\n  const constructMandatoryList = () => {\r\n    const result = taskCheckList\r\n      .filter((item) => item?.isMandatory && !item?.isActioned)\r\n      .map((item) => {\r\n        return item?.actionListID.toString();\r\n      });\r\n    setMandatoryList(result);\r\n  };\r\n\r\n  const updateMandatoryList = (name) => {\r\n    if (isMphasisUser) {\r\n      const wasMandatory = !!taskCheckList.find((item) => {\r\n        return item?.actionListID.toString() === name && item?.isMandatory;\r\n      });\r\n      if (wasMandatory) {\r\n        const newList = xorBy(mandatoryList, [name]) || [];\r\n        setMandatoryList(newList);\r\n      }\r\n    } else {\r\n      setMandatoryList([]);\r\n    }\r\n  };\r\n\r\n  const handleCheckListChange = (name, value) => {\r\n    updateMandatoryList(name);\r\n    const findCheckItem = taskCheckList.find((item) => {\r\n      const keyCheck = item?.actionListID.toString();\r\n      return keyCheck === name;\r\n    });\r\n    if (findCheckItem) {\r\n      const constructChangeItem = [findCheckItem].map((item) => {\r\n        return {\r\n          actionListDetailID: item?.actionListDetailID,\r\n          actionListID: item?.actionListID,\r\n          isActioned: !value ? 0 : 1,\r\n        };\r\n      });\r\n      const newChangeList = xorBy(checkListChanges, constructChangeItem, 'actionListID');\r\n      setCheckListChanges(newChangeList);\r\n    }\r\n  };\r\n\r\n  const handleAllCheckListSelected = (name, isAllSelected) => {\r\n    setAllSelectionFlag(isAllSelected);\r\n    if (isMphasisUser) {\r\n      if (isAllSelected) {\r\n        setMandatoryList([]);\r\n      } else {\r\n        constructMandatoryList();\r\n      }\r\n      setNextActionFlag(isAllSelected);\r\n    }\r\n    const constructChangeItem = taskCheckList.map((item) => {\r\n      return {\r\n        actionListDetailID: item?.actionListDetailID,\r\n        actionListID: item?.actionListID,\r\n        isActioned: !isAllSelected ? 0 : 1,\r\n      };\r\n    });\r\n    setCheckListChanges(constructChangeItem);\r\n  };\r\n\r\n  const handleNextActionSelected = (nextActionCode) => {\r\n    setNextActionVal(nextActionCode);\r\n    if (nextActionCode === CLOSE_CLAIM) {\r\n      handleConfirmClaimClose(nextActionCode);\r\n    } else {\r\n      handleNextTaskWarning(saveType.nextAction, nextActionCode);\r\n    }\r\n  };\r\n\r\n  const checkListChangeSave = () => {\r\n    if (isMphasisUser && utils.generic.isValidArray(mandatoryList, true)) {\r\n      handleMandatoryWarning();\r\n    } else {\r\n      saveTaskOperations(saveType.checkList);\r\n    }\r\n  };\r\n\r\n  const checkListChangeReset = () => {\r\n    checkListForm.reset();\r\n    setCheckListChanges([]);\r\n    if (utils.generic.isValidArray(taskCheckList, true) && isMphasisUser) {\r\n      constructMandatoryList();\r\n    } else {\r\n      setMandatoryList([]);\r\n    }\r\n  };\r\n\r\n  const completeTask = () => {\r\n    handleTaskCompleteWarning();\r\n  };\r\n\r\n  const saveTaskOperations = async (type, nextActionCode) => {\r\n    // \"nextTaskCode\" is null for postSaveNextTaskAction to mark task as complete\r\n    // \"nextTaskCode\" is null for postSaveTaskCheckListActions & postSaveNextTaskAction (complete task scenario)\r\n\r\n    const saveRequest = {\r\n      processID: task?.processId,\r\n      nextTaskCode: type !== saveType.nextAction ? null : nextActionCode || nextActionVal,\r\n      currencyPurchased: currencyPurchasedValue,\r\n      approvalStatus: task?.approvalStatus,\r\n      actionListDetails: checkListChanges,\r\n    };\r\n\r\n    if (type === saveType.checkList) {\r\n      await dispatch(postSaveTaskCheckListActions(task?.taskId, saveRequest));\r\n      fetchDataFromBackend();\r\n    } else {\r\n      await dispatch(postSaveNextTaskAction(task?.taskId, saveRequest));\r\n      navigateToTaskGrid();\r\n    }\r\n    checkListChangeReset();\r\n  };\r\n\r\n  const closeClaimTask = async (nextActionCode) => {\r\n    const payload = {\r\n      nextTaskCode: nextActionCode,\r\n      processID: task?.rootProcessId,\r\n    };\r\n    await dispatch(postCloseClaim(task?.taskId, payload));\r\n    navigateToTaskGrid();\r\n  };\r\n\r\n  const handleMandatoryWarning = () => {\r\n    dispatch(\r\n      showModal({\r\n        component: 'CHECK_LIST_ALERTS',\r\n        props: {\r\n          title: utils.string.t('navigation.alert'),\r\n          hideCompOnBlur: false,\r\n          fullWidth: true,\r\n          maxWidth: 'sm',\r\n          disableAutoFocus: true,\r\n          componentProps: {\r\n            type: TASK_CHECKLIST_WARNINGS.type.mandatory,\r\n            handlers: {\r\n              submit: () => {\r\n                dispatch(hideModal());\r\n                if (nextActionVal) {\r\n                  handleNextTaskWarning();\r\n                } else {\r\n                  saveTaskOperations(saveType.checkList);\r\n                }\r\n              },\r\n              cancel: () => {\r\n                dispatch(hideModal());\r\n              },\r\n            },\r\n          },\r\n        },\r\n      })\r\n    );\r\n  };\r\n\r\n  const handleNextTaskWarning = (type = saveType.checkList, nextActionCode) => {\r\n    dispatch(\r\n      showModal({\r\n        component: 'CHECK_LIST_ALERTS',\r\n        props: {\r\n          title: utils.string.t('navigation.alert'),\r\n          hideCompOnBlur: false,\r\n          fullWidth: true,\r\n          maxWidth: 'sm',\r\n          disableAutoFocus: true,\r\n          componentProps: {\r\n            type: TASK_CHECKLIST_WARNINGS.type.nextTask,\r\n            handlers: {\r\n              submit: () => {\r\n                dispatch(hideModal());\r\n                saveTaskOperations(type, nextActionCode);\r\n              },\r\n              cancel: () => {\r\n                dispatch(hideModal());\r\n              },\r\n            },\r\n          },\r\n        },\r\n      })\r\n    );\r\n  };\r\n\r\n  const handleTaskCompleteWarning = () => {\r\n    dispatch(\r\n      showModal({\r\n        component: 'CHECK_LIST_ALERTS',\r\n        props: {\r\n          title: utils.string.t('navigation.alert'),\r\n          hideCompOnBlur: false,\r\n          fullWidth: true,\r\n          maxWidth: 'sm',\r\n          disableAutoFocus: true,\r\n          componentProps: {\r\n            type: TASK_CHECKLIST_WARNINGS.type.completeTask,\r\n            handlers: {\r\n              submit: () => {\r\n                dispatch(hideModal());\r\n                saveTaskOperations(saveType.completeTask);\r\n              },\r\n              cancel: () => {\r\n                dispatch(hideModal());\r\n              },\r\n            },\r\n          },\r\n        },\r\n      })\r\n    );\r\n  };\r\n\r\n  const handleConfirmClaimClose = (nextActionCode) => {\r\n    dispatch(\r\n      showModal({\r\n        component: 'CONFIRM',\r\n        props: {\r\n          title: utils.string.t('status.alert'),\r\n          hint: utils.string.t('claims.processing.taskDetailsCheckList.closeClaims'),\r\n          fullWidth: true,\r\n          maxWidth: 'xs',\r\n          componentProps: {\r\n            cancelLabel: utils.string.t('app.no'),\r\n            confirmLabel: utils.string.t('app.yes'),\r\n            submitHandler: () => {\r\n              closeClaimTask(nextActionCode);\r\n            },\r\n          },\r\n        },\r\n      })\r\n    );\r\n  };\r\n\r\n  const navigateToTaskGrid = () => {\r\n    history.push(`${config.routes.claimsProcessing.claim}/${task?.processRef}`);\r\n  };\r\n\r\n  const isCompletedTask = task?.status === TASK_TAB_COMPLETED_STATUS;\r\n  const isCheckListChanged = utils.generic.isValidArray(checkListChanges, true);\r\n  const hasCheckList = utils.generic.isValidArray(taskCheckList, true);\r\n  const hasNextActions = utils.generic.isValidArray(popoverActions, true) && popoverActions.length > 1;\r\n\r\n  useEffect(() => {\r\n    fetchDataFromBackend();\r\n    return () => {\r\n      dispatch(resetTaskProcessingChecklistChanges());\r\n    };\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    if (utils.generic.isValidArray(taskCheckList, true) && isMphasisUser) {\r\n      constructMandatoryList();\r\n    }\r\n  }, [taskCheckList]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    if (isMphasisUser) {\r\n      if (utils.generic.isValidArray(taskCheckList, true) && !utils.generic.isValidArray(mandatoryList, true)) {\r\n        setNextActionFlag(true);\r\n      } else {\r\n        setNextActionFlag(false);\r\n      }\r\n    }\r\n  }, [mandatoryList]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  return (\r\n    <TaskCheckListView\r\n      isCompletedTask={isCompletedTask}\r\n      allSelectionFlag={allSelectionFlag}\r\n      nextActionFlag={nextActionFlag}\r\n      isMphasisUser={isMphasisUser}\r\n      isCheckListChanged={isCheckListChanged}\r\n      hasCheckList={hasCheckList}\r\n      hasNextActions={hasNextActions}\r\n      columns={columns}\r\n      rows={taskCheckList}\r\n      fields={fields}\r\n      formControls={checkListForm}\r\n      popoverActions={popoverActions}\r\n      isCurrencyChanged={isCurrencyChanged}\r\n      task={task}\r\n      handlers={{\r\n        checkListChangeSave,\r\n        checkListChangeReset,\r\n        completeTask,\r\n      }}\r\n    />\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}