{"ast":null,"code":"import _objectSpread from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _toConsumableArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"E:\\\\MPHASIS\\\\claims-page\\\\Mphasis-Edge\\\\src\\\\modules\\\\ProcessingInstructionsAuthorisation\\\\ProcessingInstructionsAuthorisation.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useHistory } from 'react-router';\nimport get from 'lodash/get';\nimport uniqBy from 'lodash/uniqBy'; //app\n\nimport ProcessingInstructionsAuthorisationView from './ProcessingInstructionsAuthorisation.view';\nimport { updateProcessingInstruction, getUsersForRole, selectUserDetails, selectUsersInRoles, selectUser, showModal, submitProcessingInstruction, enqueueNotification, approveOrRejectInstruction, hideModal, uploadGeneratedPiPdfToGxb, storeResetAllState, selectPiProducingBrokers, selectPiAccountExecutives, sendEmailNotification, initiateCase, selectRefDataNewDocumentTypesByContextSource, getMetaDataForPdf, updateReferenceDocumentCountLoading, getRiskReferenceDocumentsCount } from 'stores';\nimport * as constants from 'consts';\nimport * as utils from 'utils';\nimport { savePDF } from 'modules';\nimport styles from './ProcessingInstructionsAuthorisation.styles'; //mui\n\nimport { Box, makeStyles, Typography } from '@material-ui/core';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nProcessingInstructionsAuthorisation.propTypes = {\n  instruction: PropTypes.object.isRequired,\n  handlers: PropTypes.shape({\n    back: PropTypes.func.isRequired\n  }).isRequired,\n  checkListMandatoryDataStatus: PropTypes.bool.isRequired,\n  processingInstructionMandatoryDataStatus: PropTypes.bool.isRequired\n};\nexport default function ProcessingInstructionsAuthorisation(_ref) {\n  _s();\n\n  var _instruction$riskRefe,\n      _utils$processingInst,\n      _utils$processingInst2,\n      _this = this,\n      _instruction$details7;\n\n  var instruction = _ref.instruction,\n      handlers = _ref.handlers,\n      childRef = _ref.childRef,\n      checkListMandatoryDataStatus = _ref.checkListMandatoryDataStatus,\n      processingInstructionMandatoryDataStatus = _ref.processingInstructionMandatoryDataStatus;\n  var classes = makeStyles(styles)();\n  var dispatch = useDispatch();\n  var history = useHistory();\n  var user = useSelector(selectUser);\n  var users = useSelector(selectUsersInRoles);\n  var currentUser = useSelector(selectUserDetails);\n  var documents = useSelector(function (state) {\n    return get(state, 'processingInstructions.documents');\n  }) || {};\n  var producingBrokerValues = useSelector(selectPiProducingBrokers);\n  var accountExecutiveValues = useSelector(selectPiAccountExecutives);\n  var retainedBrokerageAmountForPdf = useSelector(function (state) {\n    return get(state, 'processingInstructions.retainedBrokerageAmountForPdf');\n  });\n  var totalAmountForPdf = useSelector(function (state) {\n    return get(state, 'processingInstructions.totalAmountForPdf');\n  });\n  var businessProcesses = useSelector(function (state) {\n    return get(state, 'referenceData.businessProcesses');\n  });\n  var isResetAllSelected = useSelector(function (state) {\n    return get(state, 'processingInstructions.isResetAllSelected');\n  });\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      defaultValues = _useState2[0],\n      setDefaultValues = _useState2[1];\n\n  var isSubmittedAuthorisedSignatory = utils.processingInstructions.status.isSubmittedAuthorisedSignatory(instruction === null || instruction === void 0 ? void 0 : instruction.statusId);\n  var isSubmittedProcessing = utils.processingInstructions.status.isSubmittedProcessing(instruction === null || instruction === void 0 ? void 0 : instruction.statusId);\n\n  var _useState3 = useState(isSubmittedAuthorisedSignatory),\n      _useState4 = _slicedToArray(_useState3, 2),\n      isReadyToSubmit = _useState4[0],\n      setIsReadyToSubmit = _useState4[1];\n\n  var isDraft = utils.processingInstructions.status.isDraft(instruction === null || instruction === void 0 ? void 0 : instruction.statusId);\n  var isRejectedDraft = utils.processingInstructions.status.isRejectedDraft(instruction === null || instruction === void 0 ? void 0 : instruction.statusId);\n  var isReopened = utils.processingInstructions.status.isReopened(instruction === null || instruction === void 0 ? void 0 : instruction.statusId);\n  var userHasWritePermission = utils.app.access.feature('processingInstructions.processingInstructions', ['create', 'update'], user);\n  var isEditAllowed = userHasWritePermission && (isDraft || isRejectedDraft || isReopened || isResetAllSelected);\n  var isReadOnly = !isEditAllowed;\n  var refDataCurrencies = useSelector(function (state) {\n    return get(state, 'referenceData.currencyCodes');\n  }) || [];\n  var isEndorsement = utils.processingInstructions.isEndorsement(instruction === null || instruction === void 0 ? void 0 : instruction.processTypeId);\n  var isFeeAndAmendment = utils.processingInstructions.isFeeAndAmendment(instruction === null || instruction === void 0 ? void 0 : instruction.processTypeId);\n  var isBordereau = utils.processingInstructions.isBordereau(instruction === null || instruction === void 0 ? void 0 : instruction.processTypeId);\n  var faBorderProcessType = isBordereau || isFeeAndAmendment;\n  var riskReferences = instruction === null || instruction === void 0 ? void 0 : instruction.riskReferences;\n  var leadRef = instruction === null || instruction === void 0 ? void 0 : (_instruction$riskRefe = instruction.riskReferences) === null || _instruction$riskRefe === void 0 ? void 0 : _instruction$riskRefe.find(function (r) {\n    return r.leadPolicy;\n  });\n\n  var handleResetAll = function handleResetAll() {\n    dispatch(storeResetAllState(true));\n  }; // check the documents are uploaded or not in the risk reference and details steps\n\n\n  var isAllowPremiumTaxValidation = ((_utils$processingInst = utils.processingInstructions.getFinancialField(instruction, 'premiumTaxCalculationSheetAttached')) === null || _utils$processingInst === void 0 ? void 0 : _utils$processingInst.numberValue) === 1 ? true : false;\n  var isAllowSignedLinesValidation = ((_utils$processingInst2 = utils.processingInstructions.getFinancialField(instruction, 'signedLinesCalculationSheetAttached')) === null || _utils$processingInst2 === void 0 ? void 0 : _utils$processingInst2.numberValue) === 1 ? true : false;\n  var isNoPremiumTaxDocumentExist = !(documents === null || documents === void 0 ? void 0 : documents.premiumTaxDocument) ? true : false;\n  var isNoSignedLinesDocumentExist = !(documents === null || documents === void 0 ? void 0 : documents.signedLinesDocument) ? true : false;\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isAnyRiskRefHavingNoDocument = _useState6[0],\n      setIsAnyRiskRefHavingNoDocument = _useState6[1];\n\n  useEffect(function () {\n    dispatch(getUsersForRole([constants.FRONT_END_CONTACT, constants.OPERATIONS_LEAD, constants.AUTHORISED_SIGNATORY]));\n  }, [dispatch]);\n  useEffect(function () {\n    if (!isSubmittedProcessing && !isSubmittedAuthorisedSignatory && utils.generic.isValidArray(documents === null || documents === void 0 ? void 0 : documents.riskReferences, true)) {\n      var _documents$riskRefere;\n\n      dispatch(updateReferenceDocumentCountLoading(true));\n      var referenceList = documents === null || documents === void 0 ? void 0 : (_documents$riskRefere = documents.riskReferences) === null || _documents$riskRefere === void 0 ? void 0 : _documents$riskRefere.map(function (refData) {\n        return {\n          endorsementId: refData.endorsementId,\n          endorsementNumber: refData.endorsementNumber,\n          riskRefId: refData.riskRefId,\n          xbInstanceId: refData.xbInstanceId,\n          xbPolicyId: refData.xbPolicyId\n        };\n      });\n      var documentTypeValue = isEndorsement ? constants.PI_ENDORSEMENT_TYPE_DOCUMENT.documentTypeDescription : faBorderProcessType ? constants.PI_FABORDER_TYPE_DOCUMENT.documentTypeDescription : constants.PI_CLOSING_FDO_TYPE_DOCUMENT.documentTypeDescription;\n      dispatch(getRiskReferenceDocumentsCount(referenceList, documentTypeValue)).then(function (response) {\n        if ((response === null || response === void 0 ? void 0 : response.status) === constants.API_RESPONSE_OK) {\n          var _response$data;\n\n          setIsAnyRiskRefHavingNoDocument(response === null || response === void 0 ? void 0 : (_response$data = response.data) === null || _response$data === void 0 ? void 0 : _response$data.some(function (a) {\n            return a.documentCount === 0;\n          }));\n        }\n      });\n    }\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  var filterUsersByRole = function filterUsersByRole(roleNames) {\n    return riskReferences === null || riskReferences === void 0 ? void 0 : riskReferences.reduce(function (acc, cur) {\n      var groupDepartXbInstanceIds = \"\".concat(cur.departmentId, \"-\").concat(cur.xbInstanceId);\n      return [].concat(_toConsumableArray(acc), _toConsumableArray(users.filter(function (u) {\n        return roleNames.includes(u.userRole);\n      }).filter(function (u) {\n        var _u$departmentId;\n\n        return (_u$departmentId = u.departmentId) === null || _u$departmentId === void 0 ? void 0 : _u$departmentId.split(',').map(function (x) {\n          return x.trim();\n        }).includes(groupDepartXbInstanceIds);\n      }).map(function (u) {\n        return {\n          id: u.userId,\n          name: u.fullName + ' - ' + u.emailId\n        };\n      })));\n    }, []);\n  };\n\n  var frontEndContacts = uniqBy(filterUsersByRole([constants.FRONT_END_CONTACT, constants.OPERATIONS_LEAD]), 'id');\n  var operationsLeads = uniqBy(filterUsersByRole([constants.AUTHORISED_SIGNATORY]), 'id');\n\n  var getFrontEndContactValue = function getFrontEndContactValue() {\n    var _instruction$details;\n\n    var frontEndContactId = instruction === null || instruction === void 0 ? void 0 : (_instruction$details = instruction.details) === null || _instruction$details === void 0 ? void 0 : _instruction$details.frontEndContactId;\n\n    if (!frontEndContactId && utils.generic.isValidArray(frontEndContacts, true)) {\n      var currentUserIsFec = frontEndContacts.find(function (fec) {\n        return fec.id === (currentUser === null || currentUser === void 0 ? void 0 : currentUser.id);\n      });\n      frontEndContactId = (currentUserIsFec === null || currentUserIsFec === void 0 ? void 0 : currentUserIsFec.id) ? currentUserIsFec.id : '';\n    }\n\n    return frontEndContactId || '';\n  };\n\n  var getFrontEndContactEmailId = function getFrontEndContactEmailId() {\n    var _instruction$details2, _frontEndContacts$fin;\n\n    var fecId = instruction === null || instruction === void 0 ? void 0 : (_instruction$details2 = instruction.details) === null || _instruction$details2 === void 0 ? void 0 : _instruction$details2.frontEndContactId;\n    var fecEmailId = frontEndContacts === null || frontEndContacts === void 0 ? void 0 : (_frontEndContacts$fin = frontEndContacts.find(function (fec) {\n      return fec.id === fecId;\n    })) === null || _frontEndContacts$fin === void 0 ? void 0 : _frontEndContacts$fin.name;\n    return fecEmailId.substring(fecEmailId.indexOf('-') + 2);\n  };\n\n  var getSavedFrontEndContactName = function getSavedFrontEndContactName() {\n    var _instruction$details3, _frontEndContacts$fin2;\n\n    var fecId = instruction === null || instruction === void 0 ? void 0 : (_instruction$details3 = instruction.details) === null || _instruction$details3 === void 0 ? void 0 : _instruction$details3.frontEndContactId;\n    var fecName = frontEndContacts === null || frontEndContacts === void 0 ? void 0 : (_frontEndContacts$fin2 = frontEndContacts.find(function (fec) {\n      return fec.id === fecId;\n    })) === null || _frontEndContacts$fin2 === void 0 ? void 0 : _frontEndContacts$fin2.name;\n    return fecName;\n  };\n\n  var getSelectedFrontEndContactName = function getSelectedFrontEndContactName(fecId) {\n    var _frontEndContacts$fin3;\n\n    var selectedFecName = frontEndContacts === null || frontEndContacts === void 0 ? void 0 : (_frontEndContacts$fin3 = frontEndContacts.find(function (fec) {\n      return fec.id === fecId;\n    })) === null || _frontEndContacts$fin3 === void 0 ? void 0 : _frontEndContacts$fin3.name;\n    return selectedFecName.substring(0, selectedFecName.indexOf('-') - 1);\n  };\n\n  var getAuthorizedSignatoryName = function getAuthorizedSignatoryName() {\n    var _instruction$details4, _operationsLeads$find;\n\n    var asId = instruction === null || instruction === void 0 ? void 0 : (_instruction$details4 = instruction.details) === null || _instruction$details4 === void 0 ? void 0 : _instruction$details4.authorisedSignatoryId;\n    var asName = operationsLeads === null || operationsLeads === void 0 ? void 0 : (_operationsLeads$find = operationsLeads.find(function (as) {\n      return as.id === asId;\n    })) === null || _operationsLeads$find === void 0 ? void 0 : _operationsLeads$find.name;\n    return asName;\n  };\n\n  var getAccountExecutiveName = function getAccountExecutiveName() {\n    var _instruction$details5, _accountExecutiveValu;\n\n    var accountExecutiveId = instruction === null || instruction === void 0 ? void 0 : (_instruction$details5 = instruction.details) === null || _instruction$details5 === void 0 ? void 0 : _instruction$details5.accountExecutiveId;\n    var accountExecutiveName = accountExecutiveValues === null || accountExecutiveValues === void 0 ? void 0 : (_accountExecutiveValu = accountExecutiveValues.find(function (a) {\n      return a.id === accountExecutiveId;\n    })) === null || _accountExecutiveValu === void 0 ? void 0 : _accountExecutiveValu.value;\n    return accountExecutiveName;\n  };\n\n  var getProducingBrokerName = function getProducingBrokerName() {\n    var _instruction$details6, _producingBrokerValue;\n\n    var producingBrokerId = instruction === null || instruction === void 0 ? void 0 : (_instruction$details6 = instruction.details) === null || _instruction$details6 === void 0 ? void 0 : _instruction$details6.producingBrokerId;\n    var producingBrokerName = producingBrokerValues === null || producingBrokerValues === void 0 ? void 0 : (_producingBrokerValue = producingBrokerValues.find(function (p) {\n      return p.id === producingBrokerId;\n    })) === null || _producingBrokerValue === void 0 ? void 0 : _producingBrokerValue.value;\n    return producingBrokerName;\n  };\n\n  var handleCancel = function handleCancel() {\n    var _childRef$current, _childRef$current$pro;\n\n    var reset = childRef === null || childRef === void 0 ? void 0 : (_childRef$current = childRef.current) === null || _childRef$current === void 0 ? void 0 : (_childRef$current$pro = _childRef$current.props) === null || _childRef$current$pro === void 0 ? void 0 : _childRef$current$pro.resetFunc;\n\n    if (utils.generic.isFunction(reset)) {\n      reset(defaultValues, {\n        keepDirty: false\n      });\n    }\n  };\n\n  var handleSave = function handleSave() {\n    var _childRef$current2, _childRef$current2$pr;\n\n    var formValues = childRef === null || childRef === void 0 ? void 0 : (_childRef$current2 = childRef.current) === null || _childRef$current2 === void 0 ? void 0 : (_childRef$current2$pr = _childRef$current2.props) === null || _childRef$current2$pr === void 0 ? void 0 : _childRef$current2$pr.values;\n\n    var updatedInstruction = _objectSpread(_objectSpread({}, instruction), {}, {\n      details: _objectSpread(_objectSpread({}, instruction.details), {}, {\n        frontEndContact: getSelectedFrontEndContactName(formValues.frontEndContact),\n        frontEndContactId: formValues.frontEndContact,\n        authorisedSignatoryId: formValues.authorisedSignatory\n      })\n    });\n\n    dispatch(updateProcessingInstruction(updatedInstruction));\n  };\n\n  var mandatoryDocumentsNotUploaded = function mandatoryDocumentsNotUploaded() {\n    dispatch(showModal({\n      component: 'CONFIRM',\n      props: {\n        fullWidth: true,\n        title: utils.string.t('processingInstructions.mandatoryDocuments.error'),\n        maxWidth: 'xs',\n        componentProps: {\n          hideCancelButton: true,\n          confirmLabel: utils.string.t('processingInstructions.authorisations.form.confirm'),\n          confirmMessage: /*#__PURE__*/_jsxDEV(Box, {\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              className: classes.documentsValidationTitle,\n              children: [\"$\", utils.string.t('processingInstructions.mandatoryDocuments.mandatoryDocumentUploaded')]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 239,\n              columnNumber: 17\n            }, _this), /*#__PURE__*/_jsxDEV(\"ul\", {\n              children: [isAnyRiskRefHavingNoDocument && /*#__PURE__*/_jsxDEV(\"li\", {\n                children: utils.string.t('processingInstructions.mandatoryDocuments.signedSlipDocumentsUploaded')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 244,\n                columnNumber: 21\n              }, _this), isAllowPremiumTaxValidation && isNoPremiumTaxDocumentExist && /*#__PURE__*/_jsxDEV(\"li\", {\n                children: utils.string.t('processingInstructions.mandatoryDocuments.premiumTaxDocumentsUploaded')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 247,\n                columnNumber: 21\n              }, _this), isAllowSignedLinesValidation && isNoSignedLinesDocumentExist && /*#__PURE__*/_jsxDEV(\"li\", {\n                children: utils.string.t('processingInstructions.mandatoryDocuments.marketSignedLinesDocumentUploaded')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 250,\n                columnNumber: 21\n              }, _this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 242,\n              columnNumber: 17\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 238,\n            columnNumber: 15\n          }, _this),\n          buttonColors: {\n            confirm: 'secondary'\n          },\n          submitHandler: function submitHandler() {},\n          handleClose: function handleClose() {}\n        }\n      }\n    }));\n  };\n\n  var handleSubmit = function handleSubmit() {\n    if (isAllowPremiumTaxValidation && isNoPremiumTaxDocumentExist || isAllowSignedLinesValidation && isNoSignedLinesDocumentExist || isAnyRiskRefHavingNoDocument) {\n      mandatoryDocumentsNotUploaded();\n    } else {\n      var _childRef$current3, _childRef$current3$pr, _businessProcesses$fi;\n\n      var formValues = (childRef === null || childRef === void 0 ? void 0 : (_childRef$current3 = childRef.current) === null || _childRef$current3 === void 0 ? void 0 : (_childRef$current3$pr = _childRef$current3.props) === null || _childRef$current3$pr === void 0 ? void 0 : _childRef$current3$pr.values) || {};\n      var businessProcess = businessProcesses === null || businessProcesses === void 0 ? void 0 : (_businessProcesses$fi = businessProcesses.find(function (bp) {\n        return bp.businessProcessID === instruction.businessProcessId;\n      })) === null || _businessProcesses$fi === void 0 ? void 0 : _businessProcesses$fi.businessProcessName;\n\n      var updatedInstruction = _objectSpread(_objectSpread({}, instruction), {}, {\n        businessProcess: businessProcess,\n        details: _objectSpread(_objectSpread({}, instruction.details), {}, {\n          frontEndContactId: formValues.frontEndContact,\n          authorisedSignatoryId: formValues.authorisedSignatory\n        })\n      });\n\n      dispatch(submitProcessingInstruction(updatedInstruction)).then(function (res) {\n        if ((res === null || res === void 0 ? void 0 : res.status) === constants.API_RESPONSE_OK) {\n          history.push('/processing-instructions');\n          dispatch(enqueueNotification('processingInstructions.details.submittedSuccessfully', 'success'));\n        }\n      });\n    }\n  };\n\n  var getUncheckedWarningMessage = function getUncheckedWarningMessage() {\n    var _instruction$checklis, _instruction$financia;\n\n    var isAuthorizedSignatoryCheckedAll = (instruction === null || instruction === void 0 ? void 0 : (_instruction$checklis = instruction.checklist) === null || _instruction$checklis === void 0 ? void 0 : _instruction$checklis.every(function (item) {\n      return item.authorisedSignatory;\n    })) && (instruction === null || instruction === void 0 ? void 0 : (_instruction$financia = instruction.financialChecklist) === null || _instruction$financia === void 0 ? void 0 : _instruction$financia.every(function (item) {\n      return item.approvedByAuthorisedSignatory;\n    }));\n    return !isAuthorizedSignatoryCheckedAll ? utils.string.t('processingInstructions.authorisations.warningText') : '';\n  };\n\n  var documentTypesBeforeFilter = useSelector(selectRefDataNewDocumentTypesByContextSource(constants.DMS_CONTEXT_INSTRUCTION, constants.PI_GENERATE_PDF_SUBMIT.sourceID));\n  var documentTypesAfterFilter = documentTypesBeforeFilter === null || documentTypesBeforeFilter === void 0 ? void 0 : documentTypesBeforeFilter.filter(function (type) {\n    return type.documentTypeDescription === constants.PI_GENERATE_PDF_SUBMIT.documentTypeDescription && type.sectionKey === constants.PI_GENERATE_PDF_SUBMIT.sectionKey && type.sourceID === constants.PI_GENERATE_PDF_SUBMIT.sourceID;\n  });\n\n  var handleUploadProcessingInstruction = function handleUploadProcessingInstruction() {\n    var pdf = savePDF({\n      processingInstruction: instruction,\n      departmentName: leadRef === null || leadRef === void 0 ? void 0 : leadRef.departmentName,\n      frontEndContactName: getSavedFrontEndContactName(),\n      authorizedSignatoryName: getAuthorizedSignatoryName(),\n      accountExecutiveName: getAccountExecutiveName(),\n      producingBrokerName: getProducingBrokerName(),\n      retainedBrokerageAmountForPdf: retainedBrokerageAmountForPdf,\n      totalAmountForPdf: totalAmountForPdf,\n      refDataCurrencies: refDataCurrencies\n    });\n    dispatch(getMetaDataForPdf({\n      leadRef: leadRef,\n      instruction: instruction\n    })).then(function (data) {\n      if ((data === null || data === void 0 ? void 0 : data.status) === constants.API_RESPONSE_OK) {\n        dispatch(uploadGeneratedPiPdfToGxb({\n          pdf: pdf,\n          riskRef: leadRef,\n          documentTypesAfterFilter: documentTypesAfterFilter,\n          instruction: instruction,\n          metaData: data === null || data === void 0 ? void 0 : data.data\n        })).then(function (res) {\n          var _res$data, _res$response, _res$response2;\n\n          if ((res === null || res === void 0 ? void 0 : (_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.length) === 0 || (res === null || res === void 0 ? void 0 : (_res$response = res.response) === null || _res$response === void 0 ? void 0 : _res$response.status) === constants.API_STATUS_INTERNAL_SERVER_ERROR || (res === null || res === void 0 ? void 0 : (_res$response2 = res.response) === null || _res$response2 === void 0 ? void 0 : _res$response2.status) === constants.API_STATUS_NOT_FOUND) {\n            dispatch(sendEmailNotification({\n              instruction: instruction,\n              frontEndContactEmail: getFrontEndContactEmailId(),\n              frontEndContactName: getSavedFrontEndContactName()\n            }));\n          }\n        });\n      }\n    });\n  };\n\n  var handleApprove = function handleApprove() {\n    var instructionType = utils.string.t(\"processingInstructions.type.\".concat(instruction === null || instruction === void 0 ? void 0 : instruction.processTypeId));\n    dispatch(showModal({\n      component: 'CONFIRM_WITH_COMMENT',\n      props: {\n        title: utils.string.t('processingInstructions.authorisations.approve.title'),\n        width: 'sm',\n        maxWidth: 'sm',\n        componentProps: {\n          confirmLabel: utils.string.t('app.approve'),\n          cancelLabel: utils.string.t('app.cancel'),\n          warningMessage: getUncheckedWarningMessage(),\n          confirmMessage: utils.string.t('processingInstructions.authorisations.approve.text', {\n            instructionType: instructionType\n          }),\n          buttonColors: {\n            confirm: 'secondary',\n            cancel: 'primary'\n          },\n          commentLabel: utils.string.t('processingInstructions.authorisations.approve.commentLabel'),\n          commentProps: {\n            multiline: true,\n            rows: 5,\n            rowsMax: 6,\n            inputProps: {\n              maxLength: 2000\n            }\n          },\n          confirmHandler: function confirmHandler(comment) {\n            dispatch(hideModal());\n            handleUploadProcessingInstruction();\n            dispatch(approveOrRejectInstruction(instruction.id, comment, 'APPROVE')).then(function (response) {\n              if ((response === null || response === void 0 ? void 0 : response.status) === constants.PI_STATUS_SUBMITTED_PROCESSING_LABEL) {\n                var _businessProcesses$fi2;\n\n                var businessProcess = businessProcesses === null || businessProcesses === void 0 ? void 0 : (_businessProcesses$fi2 = businessProcesses.find(function (bp) {\n                  return bp.businessProcessID === instruction.businessProcessId;\n                })) === null || _businessProcesses$fi2 === void 0 ? void 0 : _businessProcesses$fi2.businessProcessName;\n                dispatch(initiateCase(_objectSpread(_objectSpread({}, instruction), {}, {\n                  businessProcess: businessProcess\n                })));\n              }\n            });\n          },\n          cancelHandler: function cancelHandler() {\n            dispatch(hideModal());\n          },\n          closeHandler: function closeHandler() {\n            dispatch(hideModal());\n          }\n        }\n      }\n    }));\n  };\n\n  var handleReject = function handleReject() {\n    var instructionType = utils.string.t(\"processingInstructions.type.\".concat(instruction === null || instruction === void 0 ? void 0 : instruction.processTypeId));\n    dispatch(showModal({\n      component: 'CONFIRM_WITH_COMMENT',\n      props: {\n        title: utils.string.t('processingInstructions.authorisations.reject.title'),\n        width: 'sm',\n        maxWidth: 'sm',\n        componentProps: {\n          confirmLabel: utils.string.t('app.reject'),\n          cancelLabel: utils.string.t('app.cancel'),\n          warningMessage: getUncheckedWarningMessage(),\n          confirmMessage: utils.string.t('processingInstructions.authorisations.reject.text', {\n            instructionType: instructionType\n          }),\n          buttonColors: {\n            confirm: 'secondary',\n            cancel: 'primary'\n          },\n          commentLabel: utils.string.t('processingInstructions.authorisations.reject.commentLabel'),\n          commentProps: {\n            multiline: true,\n            rows: 5,\n            rowsMax: 6,\n            inputProps: {\n              maxLength: 2000\n            }\n          },\n          confirmHandler: function confirmHandler(comment) {\n            dispatch(hideModal());\n            dispatch(approveOrRejectInstruction(instruction.id, comment, 'REJECT'));\n          },\n          cancelHandler: function cancelHandler() {\n            dispatch(hideModal());\n          },\n          closeHandler: function closeHandler() {\n            dispatch(hideModal());\n          }\n        }\n      }\n    }));\n  };\n\n  useEffect(function () {\n    var _childRef$current4, _childRef$current4$pr;\n\n    var reset = childRef === null || childRef === void 0 ? void 0 : (_childRef$current4 = childRef.current) === null || _childRef$current4 === void 0 ? void 0 : (_childRef$current4$pr = _childRef$current4.props) === null || _childRef$current4$pr === void 0 ? void 0 : _childRef$current4$pr.resetFunc;\n\n    var updatedDefaultValues = _objectSpread({}, utils.form.getInitialValues(fields));\n\n    setDefaultValues(updatedDefaultValues);\n\n    if (utils.generic.isFunction(reset)) {\n      reset(updatedDefaultValues, {\n        keepDirty: false\n      });\n    }\n  }, [instruction] // eslint-disable-line react-hooks/exhaustive-deps\n  );\n  var fields = [{\n    name: 'frontEndContact',\n    type: 'select',\n    options: frontEndContacts,\n    optionKey: 'id',\n    optionLabel: 'name',\n    label: utils.string.t('processingInstructions.authorisations.fields.frontEndContact'),\n    value: getFrontEndContactValue(),\n    muiComponentProps: {\n      disabled: isReadOnly || checkListMandatoryDataStatus || processingInstructionMandatoryDataStatus\n    }\n  }, {\n    name: 'authorisedSignatory',\n    type: 'select',\n    options: operationsLeads,\n    optionKey: 'id',\n    optionLabel: 'name',\n    label: utils.string.t('processingInstructions.authorisations.fields.authorisedSignatory'),\n    value: (instruction === null || instruction === void 0 ? void 0 : (_instruction$details7 = instruction.details) === null || _instruction$details7 === void 0 ? void 0 : _instruction$details7.authorisedSignatoryId) || '',\n    muiComponentProps: {\n      disabled: isReadOnly || checkListMandatoryDataStatus || processingInstructionMandatoryDataStatus\n    }\n  }, {\n    name: 'readyToSubmit',\n    type: 'checkbox',\n    value: isReadyToSubmit,\n    label: utils.string.t('processingInstructions.authorisations.fields.readyToSubmit'),\n    muiComponentProps: {\n      disabled: isReadOnly || checkListMandatoryDataStatus || processingInstructionMandatoryDataStatus,\n      onChange: function onChange(name, value) {\n        setIsReadyToSubmit(value);\n      }\n    }\n  }]; // abort\n\n  if (!defaultValues || !instruction || utils.generic.isInvalidOrEmptyArray(users)) return null;\n  return /*#__PURE__*/_jsxDEV(ProcessingInstructionsAuthorisationView, {\n    instruction: instruction,\n    fields: fields,\n    defaultValues: defaultValues,\n    isReadyToSubmit: isReadyToSubmit,\n    isSubmittedAuthorisedSignatory: isSubmittedAuthorisedSignatory,\n    isReadOnly: isReadOnly,\n    checkListMandatoryDataStatus: checkListMandatoryDataStatus,\n    processingInstructionMandatoryDataStatus: processingInstructionMandatoryDataStatus,\n    handlers: _objectSpread(_objectSpread({}, handlers), {}, {\n      save: handleSave,\n      cancel: handleCancel,\n      submit: handleSubmit,\n      approve: handleApprove,\n      reject: handleReject,\n      resetAll: handleResetAll\n    }),\n    ref: childRef\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 497,\n    columnNumber: 5\n  }, this);\n}\n\n_s(ProcessingInstructionsAuthorisation, \"+zrifz9UqQESnkDW9BUhGHmr+Vs=\", false, function () {\n  return [useDispatch, useHistory, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector];\n});\n\n_c = ProcessingInstructionsAuthorisation;\n\nvar _c;\n\n$RefreshReg$(_c, \"ProcessingInstructionsAuthorisation\");","map":{"version":3,"sources":["E:/MPHASIS/claims-page/Mphasis-Edge/src/modules/ProcessingInstructionsAuthorisation/ProcessingInstructionsAuthorisation.js"],"names":["React","useEffect","useState","PropTypes","useDispatch","useSelector","useHistory","get","uniqBy","ProcessingInstructionsAuthorisationView","updateProcessingInstruction","getUsersForRole","selectUserDetails","selectUsersInRoles","selectUser","showModal","submitProcessingInstruction","enqueueNotification","approveOrRejectInstruction","hideModal","uploadGeneratedPiPdfToGxb","storeResetAllState","selectPiProducingBrokers","selectPiAccountExecutives","sendEmailNotification","initiateCase","selectRefDataNewDocumentTypesByContextSource","getMetaDataForPdf","updateReferenceDocumentCountLoading","getRiskReferenceDocumentsCount","constants","utils","savePDF","styles","Box","makeStyles","Typography","ProcessingInstructionsAuthorisation","propTypes","instruction","object","isRequired","handlers","shape","back","func","checkListMandatoryDataStatus","bool","processingInstructionMandatoryDataStatus","childRef","classes","dispatch","history","user","users","currentUser","documents","state","producingBrokerValues","accountExecutiveValues","retainedBrokerageAmountForPdf","totalAmountForPdf","businessProcesses","isResetAllSelected","defaultValues","setDefaultValues","isSubmittedAuthorisedSignatory","processingInstructions","status","statusId","isSubmittedProcessing","isReadyToSubmit","setIsReadyToSubmit","isDraft","isRejectedDraft","isReopened","userHasWritePermission","app","access","feature","isEditAllowed","isReadOnly","refDataCurrencies","isEndorsement","processTypeId","isFeeAndAmendment","isBordereau","faBorderProcessType","riskReferences","leadRef","find","r","leadPolicy","handleResetAll","isAllowPremiumTaxValidation","getFinancialField","numberValue","isAllowSignedLinesValidation","isNoPremiumTaxDocumentExist","premiumTaxDocument","isNoSignedLinesDocumentExist","signedLinesDocument","isAnyRiskRefHavingNoDocument","setIsAnyRiskRefHavingNoDocument","FRONT_END_CONTACT","OPERATIONS_LEAD","AUTHORISED_SIGNATORY","generic","isValidArray","referenceList","map","refData","endorsementId","endorsementNumber","riskRefId","xbInstanceId","xbPolicyId","documentTypeValue","PI_ENDORSEMENT_TYPE_DOCUMENT","documentTypeDescription","PI_FABORDER_TYPE_DOCUMENT","PI_CLOSING_FDO_TYPE_DOCUMENT","then","response","API_RESPONSE_OK","data","some","a","documentCount","filterUsersByRole","roleNames","reduce","acc","cur","groupDepartXbInstanceIds","departmentId","filter","u","includes","userRole","split","x","trim","id","userId","name","fullName","emailId","frontEndContacts","operationsLeads","getFrontEndContactValue","frontEndContactId","details","currentUserIsFec","fec","getFrontEndContactEmailId","fecId","fecEmailId","substring","indexOf","getSavedFrontEndContactName","fecName","getSelectedFrontEndContactName","selectedFecName","getAuthorizedSignatoryName","asId","authorisedSignatoryId","asName","as","getAccountExecutiveName","accountExecutiveId","accountExecutiveName","value","getProducingBrokerName","producingBrokerId","producingBrokerName","p","handleCancel","reset","current","props","resetFunc","isFunction","keepDirty","handleSave","formValues","values","updatedInstruction","frontEndContact","authorisedSignatory","mandatoryDocumentsNotUploaded","component","fullWidth","title","string","t","maxWidth","componentProps","hideCancelButton","confirmLabel","confirmMessage","documentsValidationTitle","buttonColors","confirm","submitHandler","handleClose","handleSubmit","businessProcess","bp","businessProcessID","businessProcessId","businessProcessName","res","push","getUncheckedWarningMessage","isAuthorizedSignatoryCheckedAll","checklist","every","item","financialChecklist","approvedByAuthorisedSignatory","documentTypesBeforeFilter","DMS_CONTEXT_INSTRUCTION","PI_GENERATE_PDF_SUBMIT","sourceID","documentTypesAfterFilter","type","sectionKey","handleUploadProcessingInstruction","pdf","processingInstruction","departmentName","frontEndContactName","authorizedSignatoryName","riskRef","metaData","length","API_STATUS_INTERNAL_SERVER_ERROR","API_STATUS_NOT_FOUND","frontEndContactEmail","handleApprove","instructionType","width","cancelLabel","warningMessage","cancel","commentLabel","commentProps","multiline","rows","rowsMax","inputProps","maxLength","confirmHandler","comment","PI_STATUS_SUBMITTED_PROCESSING_LABEL","cancelHandler","closeHandler","handleReject","updatedDefaultValues","form","getInitialValues","fields","options","optionKey","optionLabel","label","muiComponentProps","disabled","onChange","isInvalidOrEmptyArray","save","submit","approve","reject","resetAll"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { useHistory } from 'react-router';\r\nimport get from 'lodash/get';\r\nimport uniqBy from 'lodash/uniqBy';\r\n\r\n//app\r\nimport ProcessingInstructionsAuthorisationView from './ProcessingInstructionsAuthorisation.view';\r\nimport {\r\n  updateProcessingInstruction,\r\n  getUsersForRole,\r\n  selectUserDetails,\r\n  selectUsersInRoles,\r\n  selectUser,\r\n  showModal,\r\n  submitProcessingInstruction,\r\n  enqueueNotification,\r\n  approveOrRejectInstruction,\r\n  hideModal,\r\n  uploadGeneratedPiPdfToGxb,\r\n  storeResetAllState,\r\n  selectPiProducingBrokers,\r\n  selectPiAccountExecutives,\r\n  sendEmailNotification,\r\n  initiateCase,\r\n  selectRefDataNewDocumentTypesByContextSource,\r\n  getMetaDataForPdf,\r\n  updateReferenceDocumentCountLoading,\r\n  getRiskReferenceDocumentsCount,\r\n} from 'stores';\r\nimport * as constants from 'consts';\r\nimport * as utils from 'utils';\r\nimport { savePDF } from 'modules';\r\nimport styles from './ProcessingInstructionsAuthorisation.styles';\r\n\r\n//mui\r\nimport { Box, makeStyles, Typography } from '@material-ui/core';\r\n\r\nProcessingInstructionsAuthorisation.propTypes = {\r\n  instruction: PropTypes.object.isRequired,\r\n  handlers: PropTypes.shape({\r\n    back: PropTypes.func.isRequired,\r\n  }).isRequired,\r\n  checkListMandatoryDataStatus: PropTypes.bool.isRequired,\r\n  processingInstructionMandatoryDataStatus: PropTypes.bool.isRequired,\r\n};\r\n\r\nexport default function ProcessingInstructionsAuthorisation({\r\n  instruction,\r\n  handlers,\r\n  childRef,\r\n  checkListMandatoryDataStatus,\r\n  processingInstructionMandatoryDataStatus,\r\n}) {\r\n  const classes = makeStyles(styles)();\r\n  const dispatch = useDispatch();\r\n  const history = useHistory();\r\n\r\n  const user = useSelector(selectUser);\r\n  const users = useSelector(selectUsersInRoles);\r\n  const currentUser = useSelector(selectUserDetails);\r\n  const documents = useSelector((state) => get(state, 'processingInstructions.documents')) || {};\r\n  const producingBrokerValues = useSelector(selectPiProducingBrokers);\r\n  const accountExecutiveValues = useSelector(selectPiAccountExecutives);\r\n  const retainedBrokerageAmountForPdf = useSelector((state) => get(state, 'processingInstructions.retainedBrokerageAmountForPdf'));\r\n  const totalAmountForPdf = useSelector((state) => get(state, 'processingInstructions.totalAmountForPdf'));\r\n  const businessProcesses = useSelector((state) => get(state, 'referenceData.businessProcesses'));\r\n  const isResetAllSelected = useSelector((state) => get(state, 'processingInstructions.isResetAllSelected'));\r\n  const [defaultValues, setDefaultValues] = useState();\r\n  const isSubmittedAuthorisedSignatory = utils.processingInstructions.status.isSubmittedAuthorisedSignatory(instruction?.statusId);\r\n  const isSubmittedProcessing = utils.processingInstructions.status.isSubmittedProcessing(instruction?.statusId);\r\n\r\n  const [isReadyToSubmit, setIsReadyToSubmit] = useState(isSubmittedAuthorisedSignatory);\r\n  const isDraft = utils.processingInstructions.status.isDraft(instruction?.statusId);\r\n  const isRejectedDraft = utils.processingInstructions.status.isRejectedDraft(instruction?.statusId);\r\n  const isReopened = utils.processingInstructions.status.isReopened(instruction?.statusId);\r\n  const userHasWritePermission = utils.app.access.feature('processingInstructions.processingInstructions', ['create', 'update'], user);\r\n  const isEditAllowed = userHasWritePermission && (isDraft || isRejectedDraft || isReopened || isResetAllSelected);\r\n  const isReadOnly = !isEditAllowed;\r\n  const refDataCurrencies = useSelector((state) => get(state, 'referenceData.currencyCodes')) || [];\r\n\r\n  const isEndorsement = utils.processingInstructions.isEndorsement(instruction?.processTypeId);\r\n  const isFeeAndAmendment = utils.processingInstructions.isFeeAndAmendment(instruction?.processTypeId);\r\n  const isBordereau = utils.processingInstructions.isBordereau(instruction?.processTypeId);\r\n  const faBorderProcessType = isBordereau || isFeeAndAmendment;\r\n\r\n  const riskReferences = instruction?.riskReferences;\r\n  const leadRef = instruction?.riskReferences?.find((r) => r.leadPolicy);\r\n\r\n  const handleResetAll = () => {\r\n    dispatch(storeResetAllState(true));\r\n  };\r\n  // check the documents are uploaded or not in the risk reference and details steps\r\n  const isAllowPremiumTaxValidation =\r\n    utils.processingInstructions.getFinancialField(instruction, 'premiumTaxCalculationSheetAttached')?.numberValue === 1 ? true : false;\r\n  const isAllowSignedLinesValidation =\r\n    utils.processingInstructions.getFinancialField(instruction, 'signedLinesCalculationSheetAttached')?.numberValue === 1 ? true : false;\r\n  const isNoPremiumTaxDocumentExist = !documents?.premiumTaxDocument ? true : false;\r\n  const isNoSignedLinesDocumentExist = !documents?.signedLinesDocument ? true : false;\r\n\r\n  const [isAnyRiskRefHavingNoDocument, setIsAnyRiskRefHavingNoDocument] = useState(false);\r\n\r\n  useEffect(() => {\r\n    dispatch(getUsersForRole([constants.FRONT_END_CONTACT, constants.OPERATIONS_LEAD, constants.AUTHORISED_SIGNATORY]));\r\n  }, [dispatch]);\r\n\r\n  useEffect(() => {\r\n    if (!isSubmittedProcessing && !isSubmittedAuthorisedSignatory && utils.generic.isValidArray(documents?.riskReferences, true)) {\r\n      dispatch(updateReferenceDocumentCountLoading(true));\r\n      const referenceList = documents?.riskReferences?.map((refData) => {\r\n        return {\r\n          endorsementId: refData.endorsementId,\r\n          endorsementNumber: refData.endorsementNumber,\r\n          riskRefId: refData.riskRefId,\r\n          xbInstanceId: refData.xbInstanceId,\r\n          xbPolicyId: refData.xbPolicyId,\r\n        };\r\n      });\r\n      const documentTypeValue = isEndorsement\r\n        ? constants.PI_ENDORSEMENT_TYPE_DOCUMENT.documentTypeDescription\r\n        : faBorderProcessType\r\n        ? constants.PI_FABORDER_TYPE_DOCUMENT.documentTypeDescription\r\n        : constants.PI_CLOSING_FDO_TYPE_DOCUMENT.documentTypeDescription;\r\n      dispatch(getRiskReferenceDocumentsCount(referenceList, documentTypeValue)).then((response) => {\r\n        if (response?.status === constants.API_RESPONSE_OK) {\r\n          setIsAnyRiskRefHavingNoDocument(response?.data?.some((a) => a.documentCount === 0));\r\n        }\r\n      });\r\n    }\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  const filterUsersByRole = (roleNames) => {\r\n    return riskReferences?.reduce((acc, cur) => {\r\n      const groupDepartXbInstanceIds = `${cur.departmentId}-${cur.xbInstanceId}`;\r\n      return [\r\n        ...acc,\r\n        ...users\r\n          .filter((u) => roleNames.includes(u.userRole))\r\n          .filter((u) =>\r\n            u.departmentId\r\n              ?.split(',')\r\n              .map((x) => x.trim())\r\n              .includes(groupDepartXbInstanceIds)\r\n          )\r\n          .map((u) => {\r\n            return { id: u.userId, name: u.fullName + ' - ' + u.emailId };\r\n          }),\r\n      ];\r\n    }, []);\r\n  };\r\n\r\n  const frontEndContacts = uniqBy(filterUsersByRole([constants.FRONT_END_CONTACT, constants.OPERATIONS_LEAD]), 'id');\r\n  const operationsLeads = uniqBy(filterUsersByRole([constants.AUTHORISED_SIGNATORY]), 'id');\r\n\r\n  const getFrontEndContactValue = () => {\r\n    let frontEndContactId = instruction?.details?.frontEndContactId;\r\n\r\n    if (!frontEndContactId && utils.generic.isValidArray(frontEndContacts, true)) {\r\n      const currentUserIsFec = frontEndContacts.find((fec) => fec.id === currentUser?.id);\r\n      frontEndContactId = currentUserIsFec?.id ? currentUserIsFec.id : '';\r\n    }\r\n\r\n    return frontEndContactId || '';\r\n  };\r\n\r\n  const getFrontEndContactEmailId = () => {\r\n    const fecId = instruction?.details?.frontEndContactId;\r\n    const fecEmailId = frontEndContacts?.find((fec) => fec.id === fecId)?.name;\r\n    return fecEmailId.substring(fecEmailId.indexOf('-') + 2);\r\n  };\r\n\r\n  const getSavedFrontEndContactName = () => {\r\n    const fecId = instruction?.details?.frontEndContactId;\r\n    const fecName = frontEndContacts?.find((fec) => fec.id === fecId)?.name;\r\n    return fecName;\r\n  };\r\n\r\n  const getSelectedFrontEndContactName = (fecId) => {\r\n    const selectedFecName = frontEndContacts?.find((fec) => fec.id === fecId)?.name;\r\n    return selectedFecName.substring(0, selectedFecName.indexOf('-') - 1);\r\n  };\r\n\r\n  const getAuthorizedSignatoryName = () => {\r\n    const asId = instruction?.details?.authorisedSignatoryId;\r\n    const asName = operationsLeads?.find((as) => as.id === asId)?.name;\r\n    return asName;\r\n  };\r\n\r\n  const getAccountExecutiveName = () => {\r\n    const accountExecutiveId = instruction?.details?.accountExecutiveId;\r\n    const accountExecutiveName = accountExecutiveValues?.find((a) => a.id === accountExecutiveId)?.value;\r\n    return accountExecutiveName;\r\n  };\r\n\r\n  const getProducingBrokerName = () => {\r\n    const producingBrokerId = instruction?.details?.producingBrokerId;\r\n    const producingBrokerName = producingBrokerValues?.find((p) => p.id === producingBrokerId)?.value;\r\n    return producingBrokerName;\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    const reset = childRef?.current?.props?.resetFunc;\r\n\r\n    if (utils.generic.isFunction(reset)) {\r\n      reset(defaultValues, { keepDirty: false });\r\n    }\r\n  };\r\n\r\n  const handleSave = () => {\r\n    const formValues = childRef?.current?.props?.values;\r\n\r\n    const updatedInstruction = {\r\n      ...instruction,\r\n      details: {\r\n        ...instruction.details,\r\n        frontEndContact: getSelectedFrontEndContactName(formValues.frontEndContact),\r\n        frontEndContactId: formValues.frontEndContact,\r\n        authorisedSignatoryId: formValues.authorisedSignatory,\r\n      },\r\n    };\r\n\r\n    dispatch(updateProcessingInstruction(updatedInstruction));\r\n  };\r\n\r\n  const mandatoryDocumentsNotUploaded = () => {\r\n    dispatch(\r\n      showModal({\r\n        component: 'CONFIRM',\r\n        props: {\r\n          fullWidth: true,\r\n          title: utils.string.t('processingInstructions.mandatoryDocuments.error'),\r\n          maxWidth: 'xs',\r\n          componentProps: {\r\n            hideCancelButton: true,\r\n            confirmLabel: utils.string.t('processingInstructions.authorisations.form.confirm'),\r\n            confirmMessage: (\r\n              <Box>\r\n                <Typography className={classes.documentsValidationTitle}>\r\n                  ${utils.string.t('processingInstructions.mandatoryDocuments.mandatoryDocumentUploaded')}\r\n                </Typography>\r\n                <ul>\r\n                  {isAnyRiskRefHavingNoDocument && (\r\n                    <li>{utils.string.t('processingInstructions.mandatoryDocuments.signedSlipDocumentsUploaded')}</li>\r\n                  )}\r\n                  {isAllowPremiumTaxValidation && isNoPremiumTaxDocumentExist && (\r\n                    <li>{utils.string.t('processingInstructions.mandatoryDocuments.premiumTaxDocumentsUploaded')}</li>\r\n                  )}\r\n                  {isAllowSignedLinesValidation && isNoSignedLinesDocumentExist && (\r\n                    <li>{utils.string.t('processingInstructions.mandatoryDocuments.marketSignedLinesDocumentUploaded')}</li>\r\n                  )}\r\n                </ul>\r\n              </Box>\r\n            ),\r\n            buttonColors: { confirm: 'secondary' },\r\n            submitHandler: () => {},\r\n            handleClose: () => {},\r\n          },\r\n        },\r\n      })\r\n    );\r\n  };\r\n\r\n  const handleSubmit = () => {\r\n    if (\r\n      (isAllowPremiumTaxValidation && isNoPremiumTaxDocumentExist) ||\r\n      (isAllowSignedLinesValidation && isNoSignedLinesDocumentExist) ||\r\n      isAnyRiskRefHavingNoDocument\r\n    ) {\r\n      mandatoryDocumentsNotUploaded();\r\n    } else {\r\n      const formValues = childRef?.current?.props?.values || {};\r\n      const businessProcess = businessProcesses?.find((bp) => bp.businessProcessID === instruction.businessProcessId)?.businessProcessName;\r\n\r\n      const updatedInstruction = {\r\n        ...instruction,\r\n        businessProcess,\r\n        details: {\r\n          ...instruction.details,\r\n          frontEndContactId: formValues.frontEndContact,\r\n          authorisedSignatoryId: formValues.authorisedSignatory,\r\n        },\r\n      };\r\n\r\n      dispatch(submitProcessingInstruction(updatedInstruction)).then((res) => {\r\n        if (res?.status === constants.API_RESPONSE_OK) {\r\n          history.push('/processing-instructions');\r\n          dispatch(enqueueNotification('processingInstructions.details.submittedSuccessfully', 'success'));\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  const getUncheckedWarningMessage = () => {\r\n    const isAuthorizedSignatoryCheckedAll =\r\n      instruction?.checklist?.every((item) => item.authorisedSignatory) &&\r\n      instruction?.financialChecklist?.every((item) => item.approvedByAuthorisedSignatory);\r\n    return !isAuthorizedSignatoryCheckedAll ? utils.string.t('processingInstructions.authorisations.warningText') : '';\r\n  };\r\n\r\n  const documentTypesBeforeFilter = useSelector(\r\n    selectRefDataNewDocumentTypesByContextSource(constants.DMS_CONTEXT_INSTRUCTION, constants.PI_GENERATE_PDF_SUBMIT.sourceID)\r\n  );\r\n\r\n  const documentTypesAfterFilter = documentTypesBeforeFilter?.filter(\r\n    (type) =>\r\n      type.documentTypeDescription === constants.PI_GENERATE_PDF_SUBMIT.documentTypeDescription &&\r\n      type.sectionKey === constants.PI_GENERATE_PDF_SUBMIT.sectionKey &&\r\n      type.sourceID === constants.PI_GENERATE_PDF_SUBMIT.sourceID\r\n  );\r\n\r\n  const handleUploadProcessingInstruction = () => {\r\n    const pdf = savePDF({\r\n      processingInstruction: instruction,\r\n      departmentName: leadRef?.departmentName,\r\n      frontEndContactName: getSavedFrontEndContactName(),\r\n      authorizedSignatoryName: getAuthorizedSignatoryName(),\r\n      accountExecutiveName: getAccountExecutiveName(),\r\n      producingBrokerName: getProducingBrokerName(),\r\n      retainedBrokerageAmountForPdf: retainedBrokerageAmountForPdf,\r\n      totalAmountForPdf: totalAmountForPdf,\r\n      refDataCurrencies: refDataCurrencies,\r\n    });\r\n\r\n    dispatch(getMetaDataForPdf({ leadRef, instruction })).then((data) => {\r\n      if (data?.status === constants.API_RESPONSE_OK) {\r\n        dispatch(uploadGeneratedPiPdfToGxb({ pdf, riskRef: leadRef, documentTypesAfterFilter, instruction, metaData: data?.data })).then(\r\n          (res) => {\r\n            if (\r\n              res?.data?.length === 0 ||\r\n              res?.response?.status === constants.API_STATUS_INTERNAL_SERVER_ERROR ||\r\n              res?.response?.status === constants.API_STATUS_NOT_FOUND\r\n            ) {\r\n              dispatch(\r\n                sendEmailNotification({\r\n                  instruction,\r\n                  frontEndContactEmail: getFrontEndContactEmailId(),\r\n                  frontEndContactName: getSavedFrontEndContactName(),\r\n                })\r\n              );\r\n            }\r\n          }\r\n        );\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleApprove = () => {\r\n    const instructionType = utils.string.t(`processingInstructions.type.${instruction?.processTypeId}`);\r\n    dispatch(\r\n      showModal({\r\n        component: 'CONFIRM_WITH_COMMENT',\r\n        props: {\r\n          title: utils.string.t('processingInstructions.authorisations.approve.title'),\r\n          width: 'sm',\r\n          maxWidth: 'sm',\r\n          componentProps: {\r\n            confirmLabel: utils.string.t('app.approve'),\r\n            cancelLabel: utils.string.t('app.cancel'),\r\n            warningMessage: getUncheckedWarningMessage(),\r\n            confirmMessage: utils.string.t('processingInstructions.authorisations.approve.text', { instructionType: instructionType }),\r\n            buttonColors: { confirm: 'secondary', cancel: 'primary' },\r\n            commentLabel: utils.string.t('processingInstructions.authorisations.approve.commentLabel'),\r\n            commentProps: {\r\n              multiline: true,\r\n              rows: 5,\r\n              rowsMax: 6,\r\n              inputProps: {\r\n                maxLength: 2000,\r\n              },\r\n            },\r\n            confirmHandler: (comment) => {\r\n              dispatch(hideModal());\r\n              handleUploadProcessingInstruction();\r\n              dispatch(approveOrRejectInstruction(instruction.id, comment, 'APPROVE')).then((response) => {\r\n                if (response?.status === constants.PI_STATUS_SUBMITTED_PROCESSING_LABEL) {\r\n                  const businessProcess = businessProcesses?.find(\r\n                    (bp) => bp.businessProcessID === instruction.businessProcessId\r\n                  )?.businessProcessName;\r\n                  dispatch(initiateCase({ ...instruction, businessProcess }));\r\n                }\r\n              });\r\n            },\r\n            cancelHandler: () => {\r\n              dispatch(hideModal());\r\n            },\r\n            closeHandler: () => {\r\n              dispatch(hideModal());\r\n            },\r\n          },\r\n        },\r\n      })\r\n    );\r\n  };\r\n\r\n  const handleReject = () => {\r\n    const instructionType = utils.string.t(`processingInstructions.type.${instruction?.processTypeId}`);\r\n    dispatch(\r\n      showModal({\r\n        component: 'CONFIRM_WITH_COMMENT',\r\n        props: {\r\n          title: utils.string.t('processingInstructions.authorisations.reject.title'),\r\n          width: 'sm',\r\n          maxWidth: 'sm',\r\n          componentProps: {\r\n            confirmLabel: utils.string.t('app.reject'),\r\n            cancelLabel: utils.string.t('app.cancel'),\r\n            warningMessage: getUncheckedWarningMessage(),\r\n            confirmMessage: utils.string.t('processingInstructions.authorisations.reject.text', { instructionType: instructionType }),\r\n            buttonColors: { confirm: 'secondary', cancel: 'primary' },\r\n            commentLabel: utils.string.t('processingInstructions.authorisations.reject.commentLabel'),\r\n            commentProps: {\r\n              multiline: true,\r\n              rows: 5,\r\n              rowsMax: 6,\r\n              inputProps: {\r\n                maxLength: 2000,\r\n              },\r\n            },\r\n            confirmHandler: (comment) => {\r\n              dispatch(hideModal());\r\n              dispatch(approveOrRejectInstruction(instruction.id, comment, 'REJECT'));\r\n            },\r\n            cancelHandler: () => {\r\n              dispatch(hideModal());\r\n            },\r\n            closeHandler: () => {\r\n              dispatch(hideModal());\r\n            },\r\n          },\r\n        },\r\n      })\r\n    );\r\n  };\r\n\r\n  useEffect(\r\n    () => {\r\n      const reset = childRef?.current?.props?.resetFunc;\r\n      const updatedDefaultValues = {\r\n        ...utils.form.getInitialValues(fields),\r\n      };\r\n\r\n      setDefaultValues(updatedDefaultValues);\r\n\r\n      if (utils.generic.isFunction(reset)) {\r\n        reset(updatedDefaultValues, {\r\n          keepDirty: false,\r\n        });\r\n      }\r\n    },\r\n    [instruction] // eslint-disable-line react-hooks/exhaustive-deps\r\n  );\r\n\r\n  const fields = [\r\n    {\r\n      name: 'frontEndContact',\r\n      type: 'select',\r\n      options: frontEndContacts,\r\n      optionKey: 'id',\r\n      optionLabel: 'name',\r\n      label: utils.string.t('processingInstructions.authorisations.fields.frontEndContact'),\r\n      value: getFrontEndContactValue(),\r\n      muiComponentProps: {\r\n        disabled: isReadOnly || checkListMandatoryDataStatus || processingInstructionMandatoryDataStatus,\r\n      },\r\n    },\r\n    {\r\n      name: 'authorisedSignatory',\r\n      type: 'select',\r\n      options: operationsLeads,\r\n      optionKey: 'id',\r\n      optionLabel: 'name',\r\n      label: utils.string.t('processingInstructions.authorisations.fields.authorisedSignatory'),\r\n      value: instruction?.details?.authorisedSignatoryId || '',\r\n      muiComponentProps: {\r\n        disabled: isReadOnly || checkListMandatoryDataStatus || processingInstructionMandatoryDataStatus,\r\n      },\r\n    },\r\n    {\r\n      name: 'readyToSubmit',\r\n      type: 'checkbox',\r\n      value: isReadyToSubmit,\r\n      label: utils.string.t('processingInstructions.authorisations.fields.readyToSubmit'),\r\n      muiComponentProps: {\r\n        disabled: isReadOnly || checkListMandatoryDataStatus || processingInstructionMandatoryDataStatus,\r\n        onChange: (name, value) => {\r\n          setIsReadyToSubmit(value);\r\n        },\r\n      },\r\n    },\r\n  ];\r\n\r\n  // abort\r\n  if (!defaultValues || !instruction || utils.generic.isInvalidOrEmptyArray(users)) return null;\r\n\r\n  return (\r\n    <ProcessingInstructionsAuthorisationView\r\n      instruction={instruction}\r\n      fields={fields}\r\n      defaultValues={defaultValues}\r\n      isReadyToSubmit={isReadyToSubmit}\r\n      isSubmittedAuthorisedSignatory={isSubmittedAuthorisedSignatory}\r\n      isReadOnly={isReadOnly}\r\n      checkListMandatoryDataStatus={checkListMandatoryDataStatus}\r\n      processingInstructionMandatoryDataStatus={processingInstructionMandatoryDataStatus}\r\n      handlers={{\r\n        ...handlers,\r\n        save: handleSave,\r\n        cancel: handleCancel,\r\n        submit: handleSubmit,\r\n        approve: handleApprove,\r\n        reject: handleReject,\r\n        resetAll: handleResetAll,\r\n      }}\r\n      ref={childRef}\r\n    />\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}