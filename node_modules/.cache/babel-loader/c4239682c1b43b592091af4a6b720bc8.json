{"ast":null,"code":"import \"core-js/modules/es.string.search\";\nimport { authLogout, addLoader, removeLoader } from 'stores';\nimport * as utils from 'utils';\nimport get from 'lodash/get';\nimport moment from 'moment';\nimport { CLAIM_POLICY_SEARCH_REQ_TYPES } from 'consts';\nexport var getPolicies = function getPolicies(params) {\n  return function (dispatch, getState) {\n    var _params$viewLoader;\n\n    // prettier-ignore\n    var _getState = getState(),\n        auth = _getState.user.auth,\n        endpoint = _getState.config.vars.endpoint,\n        claims = _getState.claims;\n\n    var newRequestType = (params === null || params === void 0 ? void 0 : params.requestType) || CLAIM_POLICY_SEARCH_REQ_TYPES.search;\n    var prevDirection = get(claims, 'policies.sort.direction') || '';\n    var newDirection = params.hasOwnProperty('direction') ? params.direction : prevDirection;\n    var prevQuery = get(claims, 'policies.query') || '';\n    var newQuery = params.hasOwnProperty('term') ? params.term : prevQuery;\n    var prevSortBy = get(claims, 'policies.sort.by') || '';\n    var newSortBy = params.hasOwnProperty('sortBy') ? params.sortBy : prevSortBy;\n    var prevSearchBy = get(claims, 'policies.searchBy') || '';\n    var newSearchBy = params.hasOwnProperty('searchBy') ? params.searchBy : prevSearchBy;\n    var newFilterQuery = params.hasOwnProperty('filterTerm') && params.filterTerm !== '' ? params.filterTerm : [];\n    var datesExceptionFields = ['inceptionDate', 'expiryDate'];\n    var constructFilter = Object.entries(newFilterQuery);\n    var updatedFilter = utils.generic.isValidArray(constructFilter, true) ? constructFilter.map(function (filter) {\n      var column = filter[0];\n      var filterValue = datesExceptionFields.indexOf(column) > -1 && filter[1] ? [{\n        id: 1,\n        name: moment(new Date(filter[1])).format('YYYY-MM-DD')\n      }] : filter[1];\n      return utils.generic.isValidArray(filterValue, true) && {\n        column: column,\n        filterValue: filterValue\n      };\n    }).filter(function (item) {\n      return item;\n    }) : [];\n    var appliedParams = {\n      newRequestType: newRequestType,\n      newDirection: newDirection,\n      newQuery: newQuery,\n      newSortBy: newSortBy,\n      newSearchBy: newSearchBy,\n      updatedFilter: updatedFilter\n    };\n    var isNonFilterTypeCall = newRequestType !== CLAIM_POLICY_SEARCH_REQ_TYPES.filter;\n    var viewLoader = (_params$viewLoader = params === null || params === void 0 ? void 0 : params.viewLoader) !== null && _params$viewLoader !== void 0 ? _params$viewLoader : false;\n    var data = {\n      requestType: newRequestType,\n      filterLossClaimsCriteria: null,\n      page: params && params.page || 0,\n      pageSize: params && params.size || claims.policies.pageSize,\n      search: newQuery,\n      sortBy: newSortBy,\n      searchBy: newSearchBy,\n      direction: newDirection,\n      filterSearch: updatedFilter\n    };\n    dispatch(getPoliciesRequest({\n      params: params,\n      appliedParams: appliedParams\n    }));\n    if (isNonFilterTypeCall && viewLoader) dispatch(addLoader('getPolicies'));\n    return utils.api.post({\n      token: auth.accessToken,\n      endpoint: endpoint.claimService,\n      path: 'api/data/policy/claims/search',\n      data: data\n    }).then(function (response) {\n      return utils.api.handleResponse(response);\n    }).then(function (json) {\n      return utils.api.handleNewData(json);\n    }).then(function (data) {\n      dispatch(getPoliciesSuccess(data, newRequestType));\n      return data;\n    })[\"catch\"](function (err) {\n      dispatch(getPoliciesFailure(err, isNonFilterTypeCall));\n      utils.api.handleUnauthorized(err, dispatch, authLogout);\n      return err;\n    })[\"finally\"](function () {\n      if (isNonFilterTypeCall && viewLoader) dispatch(removeLoader('getPolicies'));\n    });\n  };\n};\nexport var getPoliciesRequest = function getPoliciesRequest(params) {\n  return {\n    type: 'CLAIMS_POLICIES_GET_REQUEST',\n    payload: params\n  };\n};\nexport var getPoliciesSuccess = function getPoliciesSuccess(data, newRequestType) {\n  return {\n    type: 'CLAIMS_POLICIES_GET_SUCCESS',\n    payload: {\n      items: data.data,\n      pagination: data.pagination,\n      requestType: newRequestType\n    }\n  };\n};\nexport var getPoliciesFailure = function getPoliciesFailure(error, isNonFilterTypeCall) {\n  return {\n    type: 'CLAIMS_POLICIES_GET_FAILURE',\n    payload: {\n      error: error,\n      isNonFilterTypeCall: isNonFilterTypeCall\n    }\n  };\n};","map":{"version":3,"sources":["E:/MPHASIS/claims-page/Mphasis-Edge/src/stores/claims/claims.actions.getPolicies.js"],"names":["authLogout","addLoader","removeLoader","utils","get","moment","CLAIM_POLICY_SEARCH_REQ_TYPES","getPolicies","params","dispatch","getState","auth","user","endpoint","config","vars","claims","newRequestType","requestType","search","prevDirection","newDirection","hasOwnProperty","direction","prevQuery","newQuery","term","prevSortBy","newSortBy","sortBy","prevSearchBy","newSearchBy","searchBy","newFilterQuery","filterTerm","datesExceptionFields","constructFilter","Object","entries","updatedFilter","generic","isValidArray","map","filter","column","filterValue","indexOf","id","name","Date","format","item","appliedParams","isNonFilterTypeCall","viewLoader","data","filterLossClaimsCriteria","page","pageSize","size","policies","filterSearch","getPoliciesRequest","api","post","token","accessToken","claimService","path","then","response","handleResponse","json","handleNewData","getPoliciesSuccess","err","getPoliciesFailure","handleUnauthorized","type","payload","items","pagination","error"],"mappings":"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","sourcesContent":["import { authLogout, addLoader, removeLoader } from 'stores';\r\nimport * as utils from 'utils';\r\nimport get from 'lodash/get';\r\nimport moment from 'moment';\r\nimport { CLAIM_POLICY_SEARCH_REQ_TYPES } from 'consts';\r\n\r\nexport const getPolicies = (params) => (dispatch, getState) => {\r\n  // prettier-ignore\r\n  const { user: { auth }, config: { vars: { endpoint } }, claims } = getState();\r\n\r\n  const newRequestType = params?.requestType || CLAIM_POLICY_SEARCH_REQ_TYPES.search;\r\n\r\n  const prevDirection = get(claims, 'policies.sort.direction') || '';\r\n  const newDirection = params.hasOwnProperty('direction') ? params.direction : prevDirection;\r\n\r\n  const prevQuery = get(claims, 'policies.query') || '';\r\n  const newQuery = params.hasOwnProperty('term') ? params.term : prevQuery;\r\n\r\n  const prevSortBy = get(claims, 'policies.sort.by') || '';\r\n  const newSortBy = params.hasOwnProperty('sortBy') ? params.sortBy : prevSortBy;\r\n\r\n  const prevSearchBy = get(claims, 'policies.searchBy') || '';\r\n  const newSearchBy = params.hasOwnProperty('searchBy') ? params.searchBy : prevSearchBy;\r\n\r\n  const newFilterQuery = params.hasOwnProperty('filterTerm') && params.filterTerm !== '' ? params.filterTerm : [];\r\n  const datesExceptionFields = ['inceptionDate', 'expiryDate'];\r\n  const constructFilter = Object.entries(newFilterQuery);\r\n  const updatedFilter = utils.generic.isValidArray(constructFilter, true)\r\n    ? constructFilter\r\n        .map((filter) => {\r\n          const column = filter[0];\r\n          const filterValue =\r\n            datesExceptionFields.indexOf(column) > -1 && filter[1]\r\n              ? [{ id: 1, name: moment(new Date(filter[1])).format('YYYY-MM-DD') }]\r\n              : filter[1];\r\n          return utils.generic.isValidArray(filterValue, true) && { column, filterValue };\r\n        })\r\n        .filter((item) => item)\r\n    : [];\r\n\r\n  const appliedParams = { newRequestType, newDirection, newQuery, newSortBy, newSearchBy, updatedFilter };\r\n  const isNonFilterTypeCall = newRequestType !== CLAIM_POLICY_SEARCH_REQ_TYPES.filter;\r\n  const viewLoader = params?.viewLoader ?? false;\r\n  const data = {\r\n    requestType: newRequestType,\r\n    filterLossClaimsCriteria: null,\r\n    page: (params && params.page) || 0,\r\n    pageSize: (params && params.size) || claims.policies.pageSize,\r\n    search: newQuery,\r\n    sortBy: newSortBy,\r\n    searchBy: newSearchBy,\r\n    direction: newDirection,\r\n    filterSearch: updatedFilter,\r\n  };\r\n\r\n  dispatch(getPoliciesRequest({ params, appliedParams }));\r\n  if (isNonFilterTypeCall && viewLoader) dispatch(addLoader('getPolicies'));\r\n\r\n  return utils.api\r\n    .post({\r\n      token: auth.accessToken,\r\n      endpoint: endpoint.claimService,\r\n      path: 'api/data/policy/claims/search',\r\n      data,\r\n    })\r\n    .then((response) => utils.api.handleResponse(response))\r\n    .then((json) => utils.api.handleNewData(json))\r\n    .then((data) => {\r\n      dispatch(getPoliciesSuccess(data, newRequestType));\r\n      return data;\r\n    })\r\n    .catch((err) => {\r\n      dispatch(getPoliciesFailure(err, isNonFilterTypeCall));\r\n      utils.api.handleUnauthorized(err, dispatch, authLogout);\r\n      return err;\r\n    })\r\n    .finally(() => {\r\n      if (isNonFilterTypeCall && viewLoader) dispatch(removeLoader('getPolicies'));\r\n    });\r\n};\r\n\r\nexport const getPoliciesRequest = (params) => {\r\n  return {\r\n    type: 'CLAIMS_POLICIES_GET_REQUEST',\r\n    payload: params,\r\n  };\r\n};\r\n\r\nexport const getPoliciesSuccess = (data, newRequestType) => {\r\n  return {\r\n    type: 'CLAIMS_POLICIES_GET_SUCCESS',\r\n    payload: {\r\n      items: data.data,\r\n      pagination: data.pagination,\r\n      requestType: newRequestType,\r\n    },\r\n  };\r\n};\r\n\r\nexport const getPoliciesFailure = (error, isNonFilterTypeCall) => {\r\n  return {\r\n    type: 'CLAIMS_POLICIES_GET_FAILURE',\r\n    payload: { error, isNonFilterTypeCall },\r\n  };\r\n};\r\n"]},"metadata":{},"sourceType":"module"}