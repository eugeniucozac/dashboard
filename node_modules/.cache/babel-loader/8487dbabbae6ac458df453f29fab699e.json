{"ast":null,"code":"import _objectSpread from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _toConsumableArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"E:\\\\MPHASIS\\\\claims-page\\\\Mphasis-Edge\\\\src\\\\modules\\\\ProcessingInstructionsAuthorisation\\\\ProcessingInstructionsAuthorisation.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useHistory } from 'react-router';\nimport get from 'lodash/get';\nimport uniqBy from 'lodash/uniqBy'; //app\n\nimport ProcessingInstructionsAuthorisationView from './ProcessingInstructionsAuthorisation.view';\nimport { updateProcessingInstruction, getUsersForRole, selectUserDetails, selectUsersInRoles, selectUser, showModal, submitProcessingInstruction, enqueueNotification, approveOrRejectInstruction, hideModal, uploadGeneratedPiPdfToGxb, storeResetAllState, selectPiProducingBrokers, selectPiAccountExecutives, sendEmailNotification, initiateCase, selectRefDataNewDocumentTypesByContextSource, getMetaDataForPdf } from 'stores';\nimport * as constants from 'consts';\nimport * as utils from 'utils';\nimport { savePDF } from 'modules';\nimport styles from './ProcessingInstructionsAuthorisation.styles'; //mui\n\nimport { Box, makeStyles } from '@material-ui/core';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nProcessingInstructionsAuthorisation.propTypes = {\n  instruction: PropTypes.object.isRequired,\n  handlers: PropTypes.shape({\n    back: PropTypes.func.isRequired\n  }).isRequired\n};\nexport default function ProcessingInstructionsAuthorisation(_ref) {\n  _s();\n\n  var _instruction$riskRefe,\n      _utils$processingInst,\n      _utils$processingInst2,\n      _this = this,\n      _instruction$details7;\n\n  var instruction = _ref.instruction,\n      handlers = _ref.handlers,\n      childRef = _ref.childRef;\n  var classes = makeStyles(styles)();\n  var dispatch = useDispatch();\n  var history = useHistory();\n  var user = useSelector(selectUser);\n  var users = useSelector(selectUsersInRoles);\n  var currentUser = useSelector(selectUserDetails);\n  var documents = useSelector(function (state) {\n    return get(state, 'processingInstructions.documents');\n  }) || {};\n  var producingBrokerValues = useSelector(selectPiProducingBrokers);\n  var accountExecutiveValues = useSelector(selectPiAccountExecutives);\n  var retainedBrokerageAmountForPdf = useSelector(function (state) {\n    return get(state, 'processingInstructions.retainedBrokerageAmountForPdf');\n  });\n  var totalAmountForPdf = useSelector(function (state) {\n    return get(state, 'processingInstructions.totalAmountForPdf');\n  });\n  var businessProcesses = useSelector(function (state) {\n    return get(state, 'referenceData.businessProcesses');\n  });\n  var isResetAllSelected = useSelector(function (state) {\n    return get(state, 'processingInstructions.isResetAllSelected');\n  });\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      defaultValues = _useState2[0],\n      setDefaultValues = _useState2[1];\n\n  var isSubmittedAuthorisedSignatory = utils.processingInstructions.status.isSubmittedAuthorisedSignatory(instruction === null || instruction === void 0 ? void 0 : instruction.statusId);\n\n  var _useState3 = useState(isSubmittedAuthorisedSignatory),\n      _useState4 = _slicedToArray(_useState3, 2),\n      isReadyToSubmit = _useState4[0],\n      setIsReadyToSubmit = _useState4[1];\n\n  var isDraft = utils.processingInstructions.status.isDraft(instruction === null || instruction === void 0 ? void 0 : instruction.statusId);\n  var isRejectedDraft = utils.processingInstructions.status.isRejectedDraft(instruction === null || instruction === void 0 ? void 0 : instruction.statusId);\n  var isReopened = utils.processingInstructions.status.isReopened(instruction === null || instruction === void 0 ? void 0 : instruction.statusId);\n  var userHasWritePermission = utils.app.access.feature('processingInstructions.processingInstructions', ['create', 'update'], user);\n  var isEditAllowed = userHasWritePermission && (isDraft || isRejectedDraft || isReopened || isResetAllSelected);\n  var isReadOnly = !isEditAllowed;\n  var refDataCurrencies = useSelector(function (state) {\n    return get(state, 'referenceData.currencyCodes');\n  }) || [];\n  var riskReferences = instruction === null || instruction === void 0 ? void 0 : instruction.riskReferences;\n  var leadRef = instruction === null || instruction === void 0 ? void 0 : (_instruction$riskRefe = instruction.riskReferences) === null || _instruction$riskRefe === void 0 ? void 0 : _instruction$riskRefe.find(function (r) {\n    return r.leadPolicy;\n  });\n\n  var handleResetAll = function handleResetAll() {\n    dispatch(storeResetAllState(true));\n  }; // check the documents are uploaded or not in the risk reference and details steps\n\n\n  var isAllowPremiumTaxValidation = ((_utils$processingInst = utils.processingInstructions.getFinancialField(instruction, 'premiumTaxCalculationSheetAttached')) === null || _utils$processingInst === void 0 ? void 0 : _utils$processingInst.numberValue) === 1 ? true : false;\n  var isAllowSignedLinesValidation = ((_utils$processingInst2 = utils.processingInstructions.getFinancialField(instruction, 'signedLinesCalculationSheetAttached')) === null || _utils$processingInst2 === void 0 ? void 0 : _utils$processingInst2.numberValue) === 1 ? true : false;\n  var isNoPremiumTaxDocumentExist = !(documents === null || documents === void 0 ? void 0 : documents.premiumTaxDocument) ? true : false;\n  var isNoSignedLinesDocumentExist = !(documents === null || documents === void 0 ? void 0 : documents.signedLinesDocument) ? true : false;\n  useEffect(function () {\n    dispatch(getUsersForRole([constants.FRONT_END_CONTACT, constants.OPERATIONS_LEAD, constants.AUTHORISED_SIGNATORY]));\n  }, [dispatch]);\n\n  var filterUsersByRole = function filterUsersByRole(roleNames) {\n    return riskReferences === null || riskReferences === void 0 ? void 0 : riskReferences.reduce(function (acc, cur) {\n      var groupDepartXbInstanceIds = \"\".concat(cur.departmentId, \"-\").concat(cur.xbInstanceId);\n      return [].concat(_toConsumableArray(acc), _toConsumableArray(users.filter(function (u) {\n        return roleNames.includes(u.userRole);\n      }).filter(function (u) {\n        var _u$departmentId;\n\n        return (_u$departmentId = u.departmentId) === null || _u$departmentId === void 0 ? void 0 : _u$departmentId.split(',').map(function (x) {\n          return x.trim();\n        }).includes(groupDepartXbInstanceIds);\n      }).map(function (u) {\n        return {\n          id: u.userId,\n          name: u.fullName + ' - ' + u.emailId\n        };\n      })));\n    }, []);\n  };\n\n  var frontEndContacts = uniqBy(filterUsersByRole([constants.FRONT_END_CONTACT, constants.OPERATIONS_LEAD]), 'id');\n  var operationsLeads = uniqBy(filterUsersByRole([constants.AUTHORISED_SIGNATORY]), 'id');\n\n  var getFrontEndContactValue = function getFrontEndContactValue() {\n    var _instruction$details;\n\n    var frontEndContactId = instruction === null || instruction === void 0 ? void 0 : (_instruction$details = instruction.details) === null || _instruction$details === void 0 ? void 0 : _instruction$details.frontEndContactId;\n\n    if (!frontEndContactId && utils.generic.isValidArray(frontEndContacts, true)) {\n      var currentUserIsFec = frontEndContacts.find(function (fec) {\n        return fec.id === (currentUser === null || currentUser === void 0 ? void 0 : currentUser.id);\n      });\n      frontEndContactId = (currentUserIsFec === null || currentUserIsFec === void 0 ? void 0 : currentUserIsFec.id) ? currentUserIsFec.id : '';\n    }\n\n    return frontEndContactId || '';\n  };\n\n  var getFrontEndContactEmailId = function getFrontEndContactEmailId() {\n    var _instruction$details2, _frontEndContacts$fin;\n\n    var fecId = instruction === null || instruction === void 0 ? void 0 : (_instruction$details2 = instruction.details) === null || _instruction$details2 === void 0 ? void 0 : _instruction$details2.frontEndContactId;\n    var fecEmailId = frontEndContacts === null || frontEndContacts === void 0 ? void 0 : (_frontEndContacts$fin = frontEndContacts.find(function (fec) {\n      return fec.id === fecId;\n    })) === null || _frontEndContacts$fin === void 0 ? void 0 : _frontEndContacts$fin.name;\n    return fecEmailId.substring(fecEmailId.indexOf('-') + 2);\n  };\n\n  var getSavedFrontEndContactName = function getSavedFrontEndContactName() {\n    var _instruction$details3, _frontEndContacts$fin2;\n\n    var fecId = instruction === null || instruction === void 0 ? void 0 : (_instruction$details3 = instruction.details) === null || _instruction$details3 === void 0 ? void 0 : _instruction$details3.frontEndContactId;\n    var fecName = frontEndContacts === null || frontEndContacts === void 0 ? void 0 : (_frontEndContacts$fin2 = frontEndContacts.find(function (fec) {\n      return fec.id === fecId;\n    })) === null || _frontEndContacts$fin2 === void 0 ? void 0 : _frontEndContacts$fin2.name;\n    return fecName;\n  };\n\n  var getSelectedFrontEndContactName = function getSelectedFrontEndContactName(fecId) {\n    var _frontEndContacts$fin3;\n\n    var selectedFecName = frontEndContacts === null || frontEndContacts === void 0 ? void 0 : (_frontEndContacts$fin3 = frontEndContacts.find(function (fec) {\n      return fec.id === fecId;\n    })) === null || _frontEndContacts$fin3 === void 0 ? void 0 : _frontEndContacts$fin3.name;\n    return selectedFecName.substring(0, selectedFecName.indexOf('-') - 1);\n  };\n\n  var getAuthorizedSignatoryName = function getAuthorizedSignatoryName() {\n    var _instruction$details4, _operationsLeads$find;\n\n    var asId = instruction === null || instruction === void 0 ? void 0 : (_instruction$details4 = instruction.details) === null || _instruction$details4 === void 0 ? void 0 : _instruction$details4.authorisedSignatoryId;\n    var asName = operationsLeads === null || operationsLeads === void 0 ? void 0 : (_operationsLeads$find = operationsLeads.find(function (as) {\n      return as.id === asId;\n    })) === null || _operationsLeads$find === void 0 ? void 0 : _operationsLeads$find.name;\n    return asName;\n  };\n\n  var getAccountExecutiveName = function getAccountExecutiveName() {\n    var _instruction$details5, _accountExecutiveValu;\n\n    var accountExecutiveId = instruction === null || instruction === void 0 ? void 0 : (_instruction$details5 = instruction.details) === null || _instruction$details5 === void 0 ? void 0 : _instruction$details5.accountExecutiveId;\n    var accountExecutiveName = accountExecutiveValues === null || accountExecutiveValues === void 0 ? void 0 : (_accountExecutiveValu = accountExecutiveValues.find(function (a) {\n      return a.id === accountExecutiveId;\n    })) === null || _accountExecutiveValu === void 0 ? void 0 : _accountExecutiveValu.value;\n    return accountExecutiveName;\n  };\n\n  var getProducingBrokerName = function getProducingBrokerName() {\n    var _instruction$details6, _producingBrokerValue;\n\n    var producingBrokerId = instruction === null || instruction === void 0 ? void 0 : (_instruction$details6 = instruction.details) === null || _instruction$details6 === void 0 ? void 0 : _instruction$details6.producingBrokerId;\n    var producingBrokerName = producingBrokerValues === null || producingBrokerValues === void 0 ? void 0 : (_producingBrokerValue = producingBrokerValues.find(function (p) {\n      return p.id === producingBrokerId;\n    })) === null || _producingBrokerValue === void 0 ? void 0 : _producingBrokerValue.value;\n    return producingBrokerName;\n  };\n\n  var handleCancel = function handleCancel() {\n    var _childRef$current, _childRef$current$pro;\n\n    var reset = childRef === null || childRef === void 0 ? void 0 : (_childRef$current = childRef.current) === null || _childRef$current === void 0 ? void 0 : (_childRef$current$pro = _childRef$current.props) === null || _childRef$current$pro === void 0 ? void 0 : _childRef$current$pro.resetFunc;\n\n    if (utils.generic.isFunction(reset)) {\n      reset(defaultValues, {\n        keepDirty: false\n      });\n    }\n  };\n\n  var handleSave = function handleSave() {\n    var _childRef$current2, _childRef$current2$pr;\n\n    var formValues = childRef === null || childRef === void 0 ? void 0 : (_childRef$current2 = childRef.current) === null || _childRef$current2 === void 0 ? void 0 : (_childRef$current2$pr = _childRef$current2.props) === null || _childRef$current2$pr === void 0 ? void 0 : _childRef$current2$pr.values;\n\n    var updatedInstruction = _objectSpread(_objectSpread({}, instruction), {}, {\n      details: _objectSpread(_objectSpread({}, instruction.details), {}, {\n        frontEndContact: getSelectedFrontEndContactName(formValues.frontEndContact),\n        frontEndContactId: formValues.frontEndContact,\n        authorisedSignatoryId: formValues.authorisedSignatory\n      })\n    });\n\n    dispatch(updateProcessingInstruction(updatedInstruction));\n  };\n\n  var mandatoryDocumentsNotUploaded = function mandatoryDocumentsNotUploaded() {\n    dispatch(showModal({\n      component: 'CONFIRM',\n      props: {\n        fullWidth: true,\n        title: utils.string.t('processingInstructions.mandatoryDocuments.error'),\n        maxWidth: 'xs',\n        componentProps: {\n          hideCancelButton: true,\n          confirmLabel: utils.string.t('processingInstructions.authorisations.form.confirm'),\n          confirmMessage: /*#__PURE__*/_jsxDEV(Box, {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: classes.documentsValidationTitle,\n              dangerouslySetInnerHTML: {\n                __html: \"\".concat(utils.string.t('processingInstructions.mandatoryDocuments.mandatoryDocumentUploaded'))\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 195,\n              columnNumber: 17\n            }, _this), /*#__PURE__*/_jsxDEV(\"ul\", {\n              children: [isAllowPremiumTaxValidation && isNoPremiumTaxDocumentExist && /*#__PURE__*/_jsxDEV(\"li\", {\n                dangerouslySetInnerHTML: {\n                  __html: \"\".concat(utils.string.t('processingInstructions.mandatoryDocuments.premiumTaxDocumentsUploaded'))\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 203,\n                columnNumber: 21\n              }, _this), isAllowSignedLinesValidation && isNoSignedLinesDocumentExist && /*#__PURE__*/_jsxDEV(\"li\", {\n                dangerouslySetInnerHTML: {\n                  __html: \"\".concat(utils.string.t('processingInstructions.mandatoryDocuments.marketSignedLinesDocumentUploaded'))\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 210,\n                columnNumber: 21\n              }, _this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 201,\n              columnNumber: 17\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 194,\n            columnNumber: 15\n          }, _this),\n          buttonColors: {\n            confirm: 'secondary'\n          },\n          submitHandler: function submitHandler() {},\n          handleClose: function handleClose() {}\n        }\n      }\n    }));\n  };\n\n  var handleSubmit = function handleSubmit() {\n    if (isAllowPremiumTaxValidation && isNoPremiumTaxDocumentExist || isAllowSignedLinesValidation && isNoSignedLinesDocumentExist) {\n      mandatoryDocumentsNotUploaded();\n    } else {\n      var _childRef$current3, _childRef$current3$pr, _businessProcesses$fi;\n\n      var formValues = (childRef === null || childRef === void 0 ? void 0 : (_childRef$current3 = childRef.current) === null || _childRef$current3 === void 0 ? void 0 : (_childRef$current3$pr = _childRef$current3.props) === null || _childRef$current3$pr === void 0 ? void 0 : _childRef$current3$pr.values) || {};\n      var businessProcess = businessProcesses === null || businessProcesses === void 0 ? void 0 : (_businessProcesses$fi = businessProcesses.find(function (bp) {\n        return bp.businessProcessID === instruction.businessProcessId;\n      })) === null || _businessProcesses$fi === void 0 ? void 0 : _businessProcesses$fi.businessProcessName;\n\n      var updatedInstruction = _objectSpread(_objectSpread({}, instruction), {}, {\n        businessProcess: businessProcess,\n        details: _objectSpread(_objectSpread({}, instruction.details), {}, {\n          frontEndContactId: formValues.frontEndContact,\n          authorisedSignatoryId: formValues.authorisedSignatory\n        })\n      });\n\n      dispatch(submitProcessingInstruction(updatedInstruction)).then(function (res) {\n        history.push('/processing-instructions');\n        dispatch(enqueueNotification('processingInstructions.details.submittedSuccessfully', 'success'));\n      });\n    }\n  };\n\n  var getUncheckedWarningMessage = function getUncheckedWarningMessage() {\n    var _instruction$checklis, _instruction$financia;\n\n    var isAuthorizedSignatoryCheckedAll = (instruction === null || instruction === void 0 ? void 0 : (_instruction$checklis = instruction.checklist) === null || _instruction$checklis === void 0 ? void 0 : _instruction$checklis.every(function (item) {\n      return item.authorisedSignatory;\n    })) && (instruction === null || instruction === void 0 ? void 0 : (_instruction$financia = instruction.financialChecklist) === null || _instruction$financia === void 0 ? void 0 : _instruction$financia.every(function (item) {\n      return item.approvedByAuthorisedSignatory;\n    }));\n    return !isAuthorizedSignatoryCheckedAll ? utils.string.t('processingInstructions.authorisations.warningText') : '';\n  };\n\n  var documentTypesBeforeFilter = useSelector(selectRefDataNewDocumentTypesByContextSource(constants.DMS_CONTEXT_INSTRUCTION, leadRef === null || leadRef === void 0 ? void 0 : leadRef.xbInstanceId));\n  var documentTypesAfterFilter = documentTypesBeforeFilter === null || documentTypesBeforeFilter === void 0 ? void 0 : documentTypesBeforeFilter.filter(function (type) {\n    return type.documentTypeDescription === constants.PI_GENERATE_PDF_SUBMIT.documentTypeDescription && type.sectionKey === constants.PI_GENERATE_PDF_SUBMIT.sectionKey && type.sourceID === constants.PI_GENERATE_PDF_SUBMIT.sourceID;\n  });\n\n  var handleUploadProcessingInstruction = function handleUploadProcessingInstruction() {\n    var pdf = savePDF({\n      processingInstruction: instruction,\n      departmentName: leadRef === null || leadRef === void 0 ? void 0 : leadRef.departmentName,\n      frontEndContactName: getSavedFrontEndContactName(),\n      authorizedSignatoryName: getAuthorizedSignatoryName(),\n      accountExecutiveName: getAccountExecutiveName(),\n      producingBrokerName: getProducingBrokerName(),\n      retainedBrokerageAmountForPdf: retainedBrokerageAmountForPdf,\n      totalAmountForPdf: totalAmountForPdf,\n      refDataCurrencies: refDataCurrencies\n    });\n    dispatch(getMetaDataForPdf({\n      leadRef: leadRef,\n      instruction: instruction\n    })).then(function (data) {\n      if ((data === null || data === void 0 ? void 0 : data.status) === constants.API_RESPONSE_OK) {\n        dispatch(uploadGeneratedPiPdfToGxb({\n          pdf: pdf,\n          riskRef: leadRef,\n          documentTypesAfterFilter: documentTypesAfterFilter,\n          instruction: instruction,\n          metaData: data === null || data === void 0 ? void 0 : data.data\n        })).then(function (res) {\n          var _res$data, _res$response, _res$response2;\n\n          if ((res === null || res === void 0 ? void 0 : (_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.length) === 0 || (res === null || res === void 0 ? void 0 : (_res$response = res.response) === null || _res$response === void 0 ? void 0 : _res$response.status) === constants.API_STATUS_INTERNAL_SERVER_ERROR || (res === null || res === void 0 ? void 0 : (_res$response2 = res.response) === null || _res$response2 === void 0 ? void 0 : _res$response2.status) === constants.API_STATUS_NOT_FOUND) {\n            dispatch(sendEmailNotification({\n              instruction: instruction,\n              frontEndContactEmail: getFrontEndContactEmailId(),\n              frontEndContactName: getSavedFrontEndContactName()\n            }));\n          }\n        });\n      }\n    });\n  };\n\n  var handleApprove = function handleApprove() {\n    var instructionType = utils.string.t(\"processingInstructions.type.\".concat(instruction === null || instruction === void 0 ? void 0 : instruction.processTypeId));\n    dispatch(showModal({\n      component: 'CONFIRM_WITH_COMMENT',\n      props: {\n        title: utils.string.t('processingInstructions.authorisations.approve.title'),\n        width: 'sm',\n        maxWidth: 'sm',\n        componentProps: {\n          confirmLabel: utils.string.t('app.approve'),\n          cancelLabel: utils.string.t('app.cancel'),\n          warningMessage: getUncheckedWarningMessage(),\n          confirmMessage: utils.string.t('processingInstructions.authorisations.approve.text', {\n            instructionType: instructionType\n          }),\n          buttonColors: {\n            confirm: 'secondary',\n            cancel: 'primary'\n          },\n          commentLabel: utils.string.t('processingInstructions.authorisations.approve.commentLabel'),\n          commentProps: {\n            multiline: true,\n            rows: 5,\n            rowsMax: 6,\n            inputProps: {\n              maxLength: 2000\n            }\n          },\n          confirmHandler: function confirmHandler(comment) {\n            dispatch(hideModal());\n            handleUploadProcessingInstruction();\n            dispatch(approveOrRejectInstruction(instruction.id, comment, 'APPROVE')).then(function (response) {\n              if ((response === null || response === void 0 ? void 0 : response.status) === constants.PI_STATUS_SUBMITTED_PROCESSING_LABEL) {\n                var _businessProcesses$fi2;\n\n                var businessProcess = businessProcesses === null || businessProcesses === void 0 ? void 0 : (_businessProcesses$fi2 = businessProcesses.find(function (bp) {\n                  return bp.businessProcessID === instruction.businessProcessId;\n                })) === null || _businessProcesses$fi2 === void 0 ? void 0 : _businessProcesses$fi2.businessProcessName;\n                dispatch(initiateCase(_objectSpread(_objectSpread({}, instruction), {}, {\n                  businessProcess: businessProcess\n                })));\n              }\n            });\n          },\n          cancelHandler: function cancelHandler() {\n            dispatch(hideModal());\n          },\n          closeHandler: function closeHandler() {\n            dispatch(hideModal());\n          }\n        }\n      }\n    }));\n  };\n\n  var handleReject = function handleReject() {\n    var instructionType = utils.string.t(\"processingInstructions.type.\".concat(instruction === null || instruction === void 0 ? void 0 : instruction.processTypeId));\n    dispatch(showModal({\n      component: 'CONFIRM_WITH_COMMENT',\n      props: {\n        title: utils.string.t('processingInstructions.authorisations.reject.title'),\n        width: 'sm',\n        maxWidth: 'sm',\n        componentProps: {\n          confirmLabel: utils.string.t('app.reject'),\n          cancelLabel: utils.string.t('app.cancel'),\n          warningMessage: getUncheckedWarningMessage(),\n          confirmMessage: utils.string.t('processingInstructions.authorisations.reject.text', {\n            instructionType: instructionType\n          }),\n          buttonColors: {\n            confirm: 'secondary',\n            cancel: 'primary'\n          },\n          commentLabel: utils.string.t('processingInstructions.authorisations.reject.commentLabel'),\n          commentProps: {\n            multiline: true,\n            rows: 5,\n            rowsMax: 6,\n            inputProps: {\n              maxLength: 2000\n            }\n          },\n          confirmHandler: function confirmHandler(comment) {\n            dispatch(hideModal());\n            dispatch(approveOrRejectInstruction(instruction.id, comment, 'REJECT'));\n          },\n          cancelHandler: function cancelHandler() {\n            dispatch(hideModal());\n          },\n          closeHandler: function closeHandler() {\n            dispatch(hideModal());\n          }\n        }\n      }\n    }));\n  };\n\n  useEffect(function () {\n    var _childRef$current4, _childRef$current4$pr;\n\n    var reset = childRef === null || childRef === void 0 ? void 0 : (_childRef$current4 = childRef.current) === null || _childRef$current4 === void 0 ? void 0 : (_childRef$current4$pr = _childRef$current4.props) === null || _childRef$current4$pr === void 0 ? void 0 : _childRef$current4$pr.resetFunc;\n\n    var updatedDefaultValues = _objectSpread({}, utils.form.getInitialValues(fields));\n\n    setDefaultValues(updatedDefaultValues);\n\n    if (utils.generic.isFunction(reset)) {\n      reset(updatedDefaultValues, {\n        keepDirty: false\n      });\n    }\n  }, [instruction] // eslint-disable-line react-hooks/exhaustive-deps\n  );\n  var fields = [{\n    name: 'frontEndContact',\n    type: 'select',\n    options: frontEndContacts,\n    optionKey: 'id',\n    optionLabel: 'name',\n    label: utils.string.t('processingInstructions.authorisations.fields.frontEndContact'),\n    value: getFrontEndContactValue(),\n    muiComponentProps: {\n      disabled: isReadOnly\n    }\n  }, {\n    name: 'authorisedSignatory',\n    type: 'select',\n    options: operationsLeads,\n    optionKey: 'id',\n    optionLabel: 'name',\n    label: utils.string.t('processingInstructions.authorisations.fields.authorisedSignatory'),\n    value: (instruction === null || instruction === void 0 ? void 0 : (_instruction$details7 = instruction.details) === null || _instruction$details7 === void 0 ? void 0 : _instruction$details7.authorisedSignatoryId) || '',\n    muiComponentProps: {\n      disabled: isReadOnly\n    }\n  }, {\n    name: 'readyToSubmit',\n    type: 'checkbox',\n    value: isReadyToSubmit,\n    label: utils.string.t('processingInstructions.authorisations.fields.readyToSubmit'),\n    muiComponentProps: {\n      disabled: isReadOnly,\n      onChange: function onChange(name, value) {\n        setIsReadyToSubmit(value);\n      }\n    }\n  }]; // abort\n\n  if (!defaultValues || !instruction || utils.generic.isInvalidOrEmptyArray(users)) return null;\n  return /*#__PURE__*/_jsxDEV(ProcessingInstructionsAuthorisationView, {\n    instruction: instruction,\n    fields: fields,\n    defaultValues: defaultValues,\n    isReadyToSubmit: isReadyToSubmit,\n    isSubmittedAuthorisedSignatory: isSubmittedAuthorisedSignatory,\n    isReadOnly: isReadOnly,\n    handlers: _objectSpread(_objectSpread({}, handlers), {}, {\n      save: handleSave,\n      cancel: handleCancel,\n      submit: handleSubmit,\n      approve: handleApprove,\n      reject: handleReject,\n      resetAll: handleResetAll\n    }),\n    ref: childRef\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 454,\n    columnNumber: 5\n  }, this);\n}\n\n_s(ProcessingInstructionsAuthorisation, \"1GQv1SJSZEYHGhQxlcN9ygeC2Wk=\", false, function () {\n  return [useDispatch, useHistory, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector];\n});\n\n_c = ProcessingInstructionsAuthorisation;\n\nvar _c;\n\n$RefreshReg$(_c, \"ProcessingInstructionsAuthorisation\");","map":{"version":3,"sources":["E:/MPHASIS/claims-page/Mphasis-Edge/src/modules/ProcessingInstructionsAuthorisation/ProcessingInstructionsAuthorisation.js"],"names":["React","useEffect","useState","PropTypes","useDispatch","useSelector","useHistory","get","uniqBy","ProcessingInstructionsAuthorisationView","updateProcessingInstruction","getUsersForRole","selectUserDetails","selectUsersInRoles","selectUser","showModal","submitProcessingInstruction","enqueueNotification","approveOrRejectInstruction","hideModal","uploadGeneratedPiPdfToGxb","storeResetAllState","selectPiProducingBrokers","selectPiAccountExecutives","sendEmailNotification","initiateCase","selectRefDataNewDocumentTypesByContextSource","getMetaDataForPdf","constants","utils","savePDF","styles","Box","makeStyles","ProcessingInstructionsAuthorisation","propTypes","instruction","object","isRequired","handlers","shape","back","func","childRef","classes","dispatch","history","user","users","currentUser","documents","state","producingBrokerValues","accountExecutiveValues","retainedBrokerageAmountForPdf","totalAmountForPdf","businessProcesses","isResetAllSelected","defaultValues","setDefaultValues","isSubmittedAuthorisedSignatory","processingInstructions","status","statusId","isReadyToSubmit","setIsReadyToSubmit","isDraft","isRejectedDraft","isReopened","userHasWritePermission","app","access","feature","isEditAllowed","isReadOnly","refDataCurrencies","riskReferences","leadRef","find","r","leadPolicy","handleResetAll","isAllowPremiumTaxValidation","getFinancialField","numberValue","isAllowSignedLinesValidation","isNoPremiumTaxDocumentExist","premiumTaxDocument","isNoSignedLinesDocumentExist","signedLinesDocument","FRONT_END_CONTACT","OPERATIONS_LEAD","AUTHORISED_SIGNATORY","filterUsersByRole","roleNames","reduce","acc","cur","groupDepartXbInstanceIds","departmentId","xbInstanceId","filter","u","includes","userRole","split","map","x","trim","id","userId","name","fullName","emailId","frontEndContacts","operationsLeads","getFrontEndContactValue","frontEndContactId","details","generic","isValidArray","currentUserIsFec","fec","getFrontEndContactEmailId","fecId","fecEmailId","substring","indexOf","getSavedFrontEndContactName","fecName","getSelectedFrontEndContactName","selectedFecName","getAuthorizedSignatoryName","asId","authorisedSignatoryId","asName","as","getAccountExecutiveName","accountExecutiveId","accountExecutiveName","a","value","getProducingBrokerName","producingBrokerId","producingBrokerName","p","handleCancel","reset","current","props","resetFunc","isFunction","keepDirty","handleSave","formValues","values","updatedInstruction","frontEndContact","authorisedSignatory","mandatoryDocumentsNotUploaded","component","fullWidth","title","string","t","maxWidth","componentProps","hideCancelButton","confirmLabel","confirmMessage","documentsValidationTitle","__html","buttonColors","confirm","submitHandler","handleClose","handleSubmit","businessProcess","bp","businessProcessID","businessProcessId","businessProcessName","then","res","push","getUncheckedWarningMessage","isAuthorizedSignatoryCheckedAll","checklist","every","item","financialChecklist","approvedByAuthorisedSignatory","documentTypesBeforeFilter","DMS_CONTEXT_INSTRUCTION","documentTypesAfterFilter","type","documentTypeDescription","PI_GENERATE_PDF_SUBMIT","sectionKey","sourceID","handleUploadProcessingInstruction","pdf","processingInstruction","departmentName","frontEndContactName","authorizedSignatoryName","data","API_RESPONSE_OK","riskRef","metaData","length","response","API_STATUS_INTERNAL_SERVER_ERROR","API_STATUS_NOT_FOUND","frontEndContactEmail","handleApprove","instructionType","processTypeId","width","cancelLabel","warningMessage","cancel","commentLabel","commentProps","multiline","rows","rowsMax","inputProps","maxLength","confirmHandler","comment","PI_STATUS_SUBMITTED_PROCESSING_LABEL","cancelHandler","closeHandler","handleReject","updatedDefaultValues","form","getInitialValues","fields","options","optionKey","optionLabel","label","muiComponentProps","disabled","onChange","isInvalidOrEmptyArray","save","submit","approve","reject","resetAll"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { useHistory } from 'react-router';\r\nimport get from 'lodash/get';\r\nimport uniqBy from 'lodash/uniqBy';\r\n\r\n//app\r\nimport ProcessingInstructionsAuthorisationView from './ProcessingInstructionsAuthorisation.view';\r\nimport {\r\n  updateProcessingInstruction,\r\n  getUsersForRole,\r\n  selectUserDetails,\r\n  selectUsersInRoles,\r\n  selectUser,\r\n  showModal,\r\n  submitProcessingInstruction,\r\n  enqueueNotification,\r\n  approveOrRejectInstruction,\r\n  hideModal,\r\n  uploadGeneratedPiPdfToGxb,\r\n  storeResetAllState,\r\n  selectPiProducingBrokers,\r\n  selectPiAccountExecutives,\r\n  sendEmailNotification,\r\n  initiateCase,\r\n  selectRefDataNewDocumentTypesByContextSource,\r\n  getMetaDataForPdf,\r\n} from 'stores';\r\nimport * as constants from 'consts';\r\nimport * as utils from 'utils';\r\nimport { savePDF } from 'modules';\r\nimport styles from './ProcessingInstructionsAuthorisation.styles';\r\n\r\n//mui\r\nimport { Box, makeStyles } from '@material-ui/core';\r\n\r\nProcessingInstructionsAuthorisation.propTypes = {\r\n  instruction: PropTypes.object.isRequired,\r\n  handlers: PropTypes.shape({\r\n    back: PropTypes.func.isRequired,\r\n  }).isRequired,\r\n};\r\n\r\nexport default function ProcessingInstructionsAuthorisation({ instruction, handlers, childRef }) {\r\n  const classes = makeStyles(styles)();\r\n  const dispatch = useDispatch();\r\n  const history = useHistory();\r\n\r\n  const user = useSelector(selectUser);\r\n  const users = useSelector(selectUsersInRoles);\r\n  const currentUser = useSelector(selectUserDetails);\r\n  const documents = useSelector((state) => get(state, 'processingInstructions.documents')) || {};\r\n  const producingBrokerValues = useSelector(selectPiProducingBrokers);\r\n  const accountExecutiveValues = useSelector(selectPiAccountExecutives);\r\n  const retainedBrokerageAmountForPdf = useSelector((state) => get(state, 'processingInstructions.retainedBrokerageAmountForPdf'));\r\n  const totalAmountForPdf = useSelector((state) => get(state, 'processingInstructions.totalAmountForPdf'));\r\n  const businessProcesses = useSelector((state) => get(state, 'referenceData.businessProcesses'));\r\n  const isResetAllSelected = useSelector((state) => get(state, 'processingInstructions.isResetAllSelected'));\r\n  const [defaultValues, setDefaultValues] = useState();\r\n  const isSubmittedAuthorisedSignatory = utils.processingInstructions.status.isSubmittedAuthorisedSignatory(instruction?.statusId);\r\n  const [isReadyToSubmit, setIsReadyToSubmit] = useState(isSubmittedAuthorisedSignatory);\r\n  const isDraft = utils.processingInstructions.status.isDraft(instruction?.statusId);\r\n  const isRejectedDraft = utils.processingInstructions.status.isRejectedDraft(instruction?.statusId);\r\n  const isReopened = utils.processingInstructions.status.isReopened(instruction?.statusId);\r\n  const userHasWritePermission = utils.app.access.feature('processingInstructions.processingInstructions', ['create', 'update'], user);\r\n  const isEditAllowed = userHasWritePermission && (isDraft || isRejectedDraft || isReopened || isResetAllSelected);\r\n  const isReadOnly = !isEditAllowed;\r\n  const refDataCurrencies = useSelector((state) => get(state, 'referenceData.currencyCodes')) || [];\r\n\r\n  const riskReferences = instruction?.riskReferences;\r\n  const leadRef = instruction?.riskReferences?.find((r) => r.leadPolicy);\r\n\r\n  const handleResetAll = () => {\r\n    dispatch(storeResetAllState(true));\r\n  };\r\n  // check the documents are uploaded or not in the risk reference and details steps\r\n  const isAllowPremiumTaxValidation =\r\n    utils.processingInstructions.getFinancialField(instruction, 'premiumTaxCalculationSheetAttached')?.numberValue === 1 ? true : false;\r\n  const isAllowSignedLinesValidation =\r\n    utils.processingInstructions.getFinancialField(instruction, 'signedLinesCalculationSheetAttached')?.numberValue === 1 ? true : false;\r\n  const isNoPremiumTaxDocumentExist = !documents?.premiumTaxDocument ? true : false;\r\n  const isNoSignedLinesDocumentExist = !documents?.signedLinesDocument ? true : false;\r\n\r\n  useEffect(() => {\r\n    dispatch(getUsersForRole([constants.FRONT_END_CONTACT, constants.OPERATIONS_LEAD, constants.AUTHORISED_SIGNATORY]));\r\n  }, [dispatch]);\r\n\r\n  const filterUsersByRole = (roleNames) => {\r\n    return riskReferences?.reduce((acc, cur) => {\r\n      const groupDepartXbInstanceIds = `${cur.departmentId}-${cur.xbInstanceId}`;\r\n      return [\r\n        ...acc,\r\n        ...users\r\n          .filter((u) => roleNames.includes(u.userRole))\r\n          .filter((u) =>\r\n            u.departmentId\r\n              ?.split(',')\r\n              .map((x) => x.trim())\r\n              .includes(groupDepartXbInstanceIds)\r\n          )\r\n          .map((u) => {\r\n            return { id: u.userId, name: u.fullName + ' - ' + u.emailId };\r\n          }),\r\n      ];\r\n    }, []);\r\n  };\r\n\r\n  const frontEndContacts = uniqBy(filterUsersByRole([constants.FRONT_END_CONTACT, constants.OPERATIONS_LEAD]), 'id');\r\n  const operationsLeads = uniqBy(filterUsersByRole([constants.AUTHORISED_SIGNATORY]), 'id');\r\n\r\n  const getFrontEndContactValue = () => {\r\n    let frontEndContactId = instruction?.details?.frontEndContactId;\r\n\r\n    if (!frontEndContactId && utils.generic.isValidArray(frontEndContacts, true)) {\r\n      const currentUserIsFec = frontEndContacts.find((fec) => fec.id === currentUser?.id);\r\n      frontEndContactId = currentUserIsFec?.id ? currentUserIsFec.id : '';\r\n    }\r\n\r\n    return frontEndContactId || '';\r\n  };\r\n\r\n  const getFrontEndContactEmailId = () => {\r\n    const fecId = instruction?.details?.frontEndContactId;\r\n    const fecEmailId = frontEndContacts?.find((fec) => fec.id === fecId)?.name;\r\n    return fecEmailId.substring(fecEmailId.indexOf('-') + 2);\r\n  };\r\n\r\n  const getSavedFrontEndContactName = () => {\r\n    const fecId = instruction?.details?.frontEndContactId;\r\n    const fecName = frontEndContacts?.find((fec) => fec.id === fecId)?.name;\r\n    return fecName;\r\n  };\r\n\r\n  const getSelectedFrontEndContactName = (fecId) => {\r\n    const selectedFecName = frontEndContacts?.find((fec) => fec.id === fecId)?.name;\r\n    return selectedFecName.substring(0, selectedFecName.indexOf('-') - 1);\r\n  };\r\n\r\n  const getAuthorizedSignatoryName = () => {\r\n    const asId = instruction?.details?.authorisedSignatoryId;\r\n    const asName = operationsLeads?.find((as) => as.id === asId)?.name;\r\n    return asName;\r\n  };\r\n\r\n  const getAccountExecutiveName = () => {\r\n    const accountExecutiveId = instruction?.details?.accountExecutiveId;\r\n    const accountExecutiveName = accountExecutiveValues?.find((a) => a.id === accountExecutiveId)?.value;\r\n    return accountExecutiveName;\r\n  };\r\n\r\n  const getProducingBrokerName = () => {\r\n    const producingBrokerId = instruction?.details?.producingBrokerId;\r\n    const producingBrokerName = producingBrokerValues?.find((p) => p.id === producingBrokerId)?.value;\r\n    return producingBrokerName;\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    const reset = childRef?.current?.props?.resetFunc;\r\n\r\n    if (utils.generic.isFunction(reset)) {\r\n      reset(defaultValues, { keepDirty: false });\r\n    }\r\n  };\r\n\r\n  const handleSave = () => {\r\n    const formValues = childRef?.current?.props?.values;\r\n\r\n    const updatedInstruction = {\r\n      ...instruction,\r\n      details: {\r\n        ...instruction.details,\r\n        frontEndContact: getSelectedFrontEndContactName(formValues.frontEndContact),\r\n        frontEndContactId: formValues.frontEndContact,\r\n        authorisedSignatoryId: formValues.authorisedSignatory,\r\n      },\r\n    };\r\n\r\n    dispatch(updateProcessingInstruction(updatedInstruction));\r\n  };\r\n\r\n  const mandatoryDocumentsNotUploaded = () => {\r\n    dispatch(\r\n      showModal({\r\n        component: 'CONFIRM',\r\n        props: {\r\n          fullWidth: true,\r\n          title: utils.string.t('processingInstructions.mandatoryDocuments.error'),\r\n          maxWidth: 'xs',\r\n          componentProps: {\r\n            hideCancelButton: true,\r\n            confirmLabel: utils.string.t('processingInstructions.authorisations.form.confirm'),\r\n            confirmMessage: (\r\n              <Box>\r\n                <div\r\n                  className={classes.documentsValidationTitle}\r\n                  dangerouslySetInnerHTML={{\r\n                    __html: `${utils.string.t('processingInstructions.mandatoryDocuments.mandatoryDocumentUploaded')}`,\r\n                  }}\r\n                />\r\n                <ul>\r\n                  {isAllowPremiumTaxValidation && isNoPremiumTaxDocumentExist && (\r\n                    <li\r\n                      dangerouslySetInnerHTML={{\r\n                        __html: `${utils.string.t('processingInstructions.mandatoryDocuments.premiumTaxDocumentsUploaded')}`,\r\n                      }}\r\n                    />\r\n                  )}\r\n                  {isAllowSignedLinesValidation && isNoSignedLinesDocumentExist && (\r\n                    <li\r\n                      dangerouslySetInnerHTML={{\r\n                        __html: `${utils.string.t('processingInstructions.mandatoryDocuments.marketSignedLinesDocumentUploaded')}`,\r\n                      }}\r\n                    />\r\n                  )}\r\n                </ul>\r\n              </Box>\r\n            ),\r\n            buttonColors: { confirm: 'secondary' },\r\n            submitHandler: () => {},\r\n            handleClose: () => {},\r\n          },\r\n        },\r\n      })\r\n    );\r\n  };\r\n\r\n  const handleSubmit = () => {\r\n    if ((isAllowPremiumTaxValidation && isNoPremiumTaxDocumentExist) || (isAllowSignedLinesValidation && isNoSignedLinesDocumentExist)) {\r\n      mandatoryDocumentsNotUploaded();\r\n    } else {\r\n      const formValues = childRef?.current?.props?.values || {};\r\n      const businessProcess = businessProcesses?.find((bp) => bp.businessProcessID === instruction.businessProcessId)?.businessProcessName;\r\n\r\n      const updatedInstruction = {\r\n        ...instruction,\r\n        businessProcess,\r\n        details: {\r\n          ...instruction.details,\r\n          frontEndContactId: formValues.frontEndContact,\r\n          authorisedSignatoryId: formValues.authorisedSignatory,\r\n        },\r\n      };\r\n\r\n      dispatch(submitProcessingInstruction(updatedInstruction)).then((res) => {\r\n        history.push('/processing-instructions');\r\n        dispatch(enqueueNotification('processingInstructions.details.submittedSuccessfully', 'success'));\r\n      });\r\n    }\r\n  };\r\n\r\n  const getUncheckedWarningMessage = () => {\r\n    const isAuthorizedSignatoryCheckedAll =\r\n      instruction?.checklist?.every((item) => item.authorisedSignatory) &&\r\n      instruction?.financialChecklist?.every((item) => item.approvedByAuthorisedSignatory);\r\n    return !isAuthorizedSignatoryCheckedAll ? utils.string.t('processingInstructions.authorisations.warningText') : '';\r\n  };\r\n\r\n  const documentTypesBeforeFilter = useSelector(\r\n    selectRefDataNewDocumentTypesByContextSource(constants.DMS_CONTEXT_INSTRUCTION, leadRef?.xbInstanceId)\r\n  );\r\n\r\n  const documentTypesAfterFilter = documentTypesBeforeFilter?.filter(\r\n    (type) =>\r\n      type.documentTypeDescription === constants.PI_GENERATE_PDF_SUBMIT.documentTypeDescription &&\r\n      type.sectionKey === constants.PI_GENERATE_PDF_SUBMIT.sectionKey &&\r\n      type.sourceID === constants.PI_GENERATE_PDF_SUBMIT.sourceID\r\n  );\r\n\r\n  const handleUploadProcessingInstruction = () => {\r\n    const pdf = savePDF({\r\n      processingInstruction: instruction,\r\n      departmentName: leadRef?.departmentName,\r\n      frontEndContactName: getSavedFrontEndContactName(),\r\n      authorizedSignatoryName: getAuthorizedSignatoryName(),\r\n      accountExecutiveName: getAccountExecutiveName(),\r\n      producingBrokerName: getProducingBrokerName(),\r\n      retainedBrokerageAmountForPdf: retainedBrokerageAmountForPdf,\r\n      totalAmountForPdf: totalAmountForPdf,\r\n      refDataCurrencies: refDataCurrencies,\r\n    });\r\n    dispatch(getMetaDataForPdf({ leadRef, instruction })).then((data) => {\r\n      if (data?.status === constants.API_RESPONSE_OK) {\r\n        dispatch(uploadGeneratedPiPdfToGxb({ pdf, riskRef: leadRef, documentTypesAfterFilter, instruction, metaData: data?.data })).then(\r\n          (res) => {\r\n            if (\r\n              res?.data?.length === 0 ||\r\n              res?.response?.status === constants.API_STATUS_INTERNAL_SERVER_ERROR ||\r\n              res?.response?.status === constants.API_STATUS_NOT_FOUND\r\n            ) {\r\n              dispatch(\r\n                sendEmailNotification({\r\n                  instruction,\r\n                  frontEndContactEmail: getFrontEndContactEmailId(),\r\n                  frontEndContactName: getSavedFrontEndContactName(),\r\n                })\r\n              );\r\n            }\r\n          }\r\n        );\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleApprove = () => {\r\n    const instructionType = utils.string.t(`processingInstructions.type.${instruction?.processTypeId}`);\r\n    dispatch(\r\n      showModal({\r\n        component: 'CONFIRM_WITH_COMMENT',\r\n        props: {\r\n          title: utils.string.t('processingInstructions.authorisations.approve.title'),\r\n          width: 'sm',\r\n          maxWidth: 'sm',\r\n          componentProps: {\r\n            confirmLabel: utils.string.t('app.approve'),\r\n            cancelLabel: utils.string.t('app.cancel'),\r\n            warningMessage: getUncheckedWarningMessage(),\r\n            confirmMessage: utils.string.t('processingInstructions.authorisations.approve.text', { instructionType: instructionType }),\r\n            buttonColors: { confirm: 'secondary', cancel: 'primary' },\r\n            commentLabel: utils.string.t('processingInstructions.authorisations.approve.commentLabel'),\r\n            commentProps: {\r\n              multiline: true,\r\n              rows: 5,\r\n              rowsMax: 6,\r\n              inputProps: {\r\n                maxLength: 2000,\r\n              },\r\n            },\r\n            confirmHandler: (comment) => {\r\n              dispatch(hideModal());\r\n              handleUploadProcessingInstruction();\r\n              dispatch(approveOrRejectInstruction(instruction.id, comment, 'APPROVE')).then((response) => {\r\n                if (response?.status === constants.PI_STATUS_SUBMITTED_PROCESSING_LABEL) {\r\n                  const businessProcess = businessProcesses?.find(\r\n                    (bp) => bp.businessProcessID === instruction.businessProcessId\r\n                  )?.businessProcessName;\r\n                  dispatch(initiateCase({ ...instruction, businessProcess }));\r\n                }\r\n              });\r\n            },\r\n            cancelHandler: () => {\r\n              dispatch(hideModal());\r\n            },\r\n            closeHandler: () => {\r\n              dispatch(hideModal());\r\n            },\r\n          },\r\n        },\r\n      })\r\n    );\r\n  };\r\n\r\n  const handleReject = () => {\r\n    const instructionType = utils.string.t(`processingInstructions.type.${instruction?.processTypeId}`);\r\n    dispatch(\r\n      showModal({\r\n        component: 'CONFIRM_WITH_COMMENT',\r\n        props: {\r\n          title: utils.string.t('processingInstructions.authorisations.reject.title'),\r\n          width: 'sm',\r\n          maxWidth: 'sm',\r\n          componentProps: {\r\n            confirmLabel: utils.string.t('app.reject'),\r\n            cancelLabel: utils.string.t('app.cancel'),\r\n            warningMessage: getUncheckedWarningMessage(),\r\n            confirmMessage: utils.string.t('processingInstructions.authorisations.reject.text', { instructionType: instructionType }),\r\n            buttonColors: { confirm: 'secondary', cancel: 'primary' },\r\n            commentLabel: utils.string.t('processingInstructions.authorisations.reject.commentLabel'),\r\n            commentProps: {\r\n              multiline: true,\r\n              rows: 5,\r\n              rowsMax: 6,\r\n              inputProps: {\r\n                maxLength: 2000,\r\n              },\r\n            },\r\n            confirmHandler: (comment) => {\r\n              dispatch(hideModal());\r\n              dispatch(approveOrRejectInstruction(instruction.id, comment, 'REJECT'));\r\n            },\r\n            cancelHandler: () => {\r\n              dispatch(hideModal());\r\n            },\r\n            closeHandler: () => {\r\n              dispatch(hideModal());\r\n            },\r\n          },\r\n        },\r\n      })\r\n    );\r\n  };\r\n\r\n  useEffect(\r\n    () => {\r\n      const reset = childRef?.current?.props?.resetFunc;\r\n      const updatedDefaultValues = {\r\n        ...utils.form.getInitialValues(fields),\r\n      };\r\n\r\n      setDefaultValues(updatedDefaultValues);\r\n\r\n      if (utils.generic.isFunction(reset)) {\r\n        reset(updatedDefaultValues, {\r\n          keepDirty: false,\r\n        });\r\n      }\r\n    },\r\n    [instruction] // eslint-disable-line react-hooks/exhaustive-deps\r\n  );\r\n\r\n  const fields = [\r\n    {\r\n      name: 'frontEndContact',\r\n      type: 'select',\r\n      options: frontEndContacts,\r\n      optionKey: 'id',\r\n      optionLabel: 'name',\r\n      label: utils.string.t('processingInstructions.authorisations.fields.frontEndContact'),\r\n      value: getFrontEndContactValue(),\r\n      muiComponentProps: {\r\n        disabled: isReadOnly,\r\n      },\r\n    },\r\n    {\r\n      name: 'authorisedSignatory',\r\n      type: 'select',\r\n      options: operationsLeads,\r\n      optionKey: 'id',\r\n      optionLabel: 'name',\r\n      label: utils.string.t('processingInstructions.authorisations.fields.authorisedSignatory'),\r\n      value: instruction?.details?.authorisedSignatoryId || '',\r\n      muiComponentProps: {\r\n        disabled: isReadOnly,\r\n      },\r\n    },\r\n    {\r\n      name: 'readyToSubmit',\r\n      type: 'checkbox',\r\n      value: isReadyToSubmit,\r\n      label: utils.string.t('processingInstructions.authorisations.fields.readyToSubmit'),\r\n      muiComponentProps: {\r\n        disabled: isReadOnly,\r\n        onChange: (name, value) => {\r\n          setIsReadyToSubmit(value);\r\n        },\r\n      },\r\n    },\r\n  ];\r\n\r\n  // abort\r\n  if (!defaultValues || !instruction || utils.generic.isInvalidOrEmptyArray(users)) return null;\r\n\r\n  return (\r\n    <ProcessingInstructionsAuthorisationView\r\n      instruction={instruction}\r\n      fields={fields}\r\n      defaultValues={defaultValues}\r\n      isReadyToSubmit={isReadyToSubmit}\r\n      isSubmittedAuthorisedSignatory={isSubmittedAuthorisedSignatory}\r\n      isReadOnly={isReadOnly}\r\n      handlers={{\r\n        ...handlers,\r\n        save: handleSave,\r\n        cancel: handleCancel,\r\n        submit: handleSubmit,\r\n        approve: handleApprove,\r\n        reject: handleReject,\r\n        resetAll: handleResetAll,\r\n      }}\r\n      ref={childRef}\r\n    />\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}