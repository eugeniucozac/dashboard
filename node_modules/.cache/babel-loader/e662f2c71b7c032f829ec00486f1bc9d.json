{"ast":null,"code":"import _objectSpread from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"E:\\\\MPHASIS\\\\claims-page\\\\Mphasis-Edge\\\\src\\\\modules\\\\RfiQueryForm\\\\RfiQueryForm.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport * as Yup from 'yup';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport { useHistory } from 'react-router';\nimport { useForm } from 'react-hook-form';\nimport { useDispatch, useSelector } from 'react-redux'; //app\n\nimport * as utils from 'utils';\nimport { RfiQueryFormView } from './RfiQueryForm.view';\nimport { Loader } from 'components';\nimport config from 'config';\nimport { CREATE_RFI_FORM, TASK_TAB_COMPLETED_STATUS } from 'consts';\nimport { getUsersByOrg, selectClaimsAssignedToUsers, postSendRFI, postCloseRFI, showModal, selectUserEmail, resetClaimsAssignedToUsers, setDmsTaskContextType } from 'stores'; // mui\n\nimport { Box } from '@material-ui/core';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function RfiQueryForm(props) {\n  _s();\n\n  var _useSelector, _props$task, _props$task$requested;\n\n  var dispatch = useDispatch();\n  var history = useHistory();\n  var assignedToUsers = ((_useSelector = useSelector(selectClaimsAssignedToUsers)) === null || _useSelector === void 0 ? void 0 : _useSelector.items) || null;\n  var userEmail = useSelector(selectUserEmail);\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      resetKey = _useState2[0],\n      setResetKey = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      isDataReady = _useState4[0],\n      setIsDataReady = _useState4[1];\n\n  var task = props.task;\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isResponseSubmitted = _useState6[0],\n      setIsResponseSubmitted = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      uploadDocumentsControl = _useState8[0],\n      setUploadDocumentsControl = _useState8[1];\n\n  var defaultAssignedUser = function defaultAssignedUser() {\n    var _task$requestedBy;\n\n    return (userEmail === null || userEmail === void 0 ? void 0 : userEmail.toLowerCase()) === (task === null || task === void 0 ? void 0 : (_task$requestedBy = task.requestedBy) === null || _task$requestedBy === void 0 ? void 0 : _task$requestedBy.toLowerCase()) ? assignedToUsers === null || assignedToUsers === void 0 ? void 0 : assignedToUsers.find(function (_ref) {\n      var _task$rfiSentTo;\n\n      var email = _ref.email;\n      return (email === null || email === void 0 ? void 0 : email.toLowerCase()) === (task === null || task === void 0 ? void 0 : (_task$rfiSentTo = task.rfiSentTo) === null || _task$rfiSentTo === void 0 ? void 0 : _task$rfiSentTo.toLowerCase());\n    }) : utils.generic.isValidArray(assignedToUsers, true) ? assignedToUsers === null || assignedToUsers === void 0 ? void 0 : assignedToUsers.find(function (_ref2) {\n      var _task$requestedBy2;\n\n      var email = _ref2.email;\n      return (email === null || email === void 0 ? void 0 : email.toLowerCase()) === (task === null || task === void 0 ? void 0 : (_task$requestedBy2 = task.requestedBy) === null || _task$requestedBy2 === void 0 ? void 0 : _task$requestedBy2.toLowerCase());\n    }) : null;\n  };\n\n  var fields = [{\n    name: 'sendTo',\n    type: 'autocompletemui',\n    value: defaultAssignedUser(),\n    options: utils.generic.isValidArray(assignedToUsers, true) ? assignedToUsers : [],\n    optionKey: 'email',\n    optionLabel: 'fullName',\n    muiComponentProps: {\n      disabled: (task === null || task === void 0 ? void 0 : task.status) === TASK_TAB_COMPLETED_STATUS\n    },\n    validation: Yup.object().required(utils.string.t('validation.required'))\n  }, {\n    name: 'description',\n    type: 'textarea',\n    hint: utils.string.t('claims.processing.validation.rfiHistoryMaxDesc', {\n      \"char\": 1000\n    }),\n    muiComponentProps: {\n      inputProps: {\n        maxLength: 1000\n      },\n      multiline: true,\n      rows: 3,\n      rowsMax: 3,\n      'data-testid': 'details'\n    },\n    validation: Yup.string().required(utils.string.t('validation.required')).max(1000, utils.string.t('claims.processing.validation.rfiHistoryMaxDesc', {\n      \"char\": 1000\n    }))\n  }];\n  var actions = [{\n    name: 'secondary',\n    label: utils.string.t('app.close'),\n    disabled: userEmail.toLowerCase() !== ((_props$task = props.task) === null || _props$task === void 0 ? void 0 : (_props$task$requested = _props$task.requestedBy) === null || _props$task$requested === void 0 ? void 0 : _props$task$requested.toLowerCase()),\n    handler: function handler() {\n      handleCloseRFI();\n    }\n  }, {\n    name: 'submit',\n    label: utils.string.t('app.reply'),\n    handler: function handler(values) {\n      handleRFISend(values);\n    }\n  }];\n  var dmsActions = {\n    skipUpload: {\n      label: utils.string.t('app.no'),\n      handler: function handler() {\n        setUploadDocumentsControl(false);\n        history.replace(config.routes.claimsProcessing.root);\n      }\n    },\n    upload: {\n      label: utils.string.t('app.yes'),\n      handler: function handler() {\n        setUploadDocumentsControl(true);\n      }\n    },\n    submitReply: {\n      label: utils.string.t('claims.processing.rfi.submitReply'),\n      handler: function handler() {\n        history.replace(config.routes.claimsProcessing.root);\n      }\n    }\n  };\n\n  var handleRFISend = function handleRFISend(values) {\n    if (values) {\n      var _props$task2, _props$task3, _props$selectedQueryC;\n\n      var sendToObj = assignedToUsers.find(function (user) {\n        var _values$sendTo;\n\n        return user.email === (values === null || values === void 0 ? void 0 : (_values$sendTo = values.sendTo) === null || _values$sendTo === void 0 ? void 0 : _values$sendTo.email);\n      });\n      var rfiSendData = {\n        assignedTo: sendToObj === null || sendToObj === void 0 ? void 0 : sendToObj.email,\n        bpmTaskID: (_props$task2 = props.task) === null || _props$task2 === void 0 ? void 0 : _props$task2.taskId,\n        caseIncidentID: (_props$task3 = props.task) === null || _props$task3 === void 0 ? void 0 : _props$task3.caseIncidentID,\n        notes: values === null || values === void 0 ? void 0 : values.description,\n        team: sendToObj === null || sendToObj === void 0 ? void 0 : sendToObj.organisationName,\n        queryCodeDescription: props === null || props === void 0 ? void 0 : (_props$selectedQueryC = props.selectedQueryCode) === null || _props$selectedQueryC === void 0 ? void 0 : _props$selectedQueryC.queryCodeDescription\n      };\n      dispatch(postSendRFI(rfiSendData)).then(function (data) {\n        if (data.status === 'OK') {\n          setIsResponseSubmitted(true);\n          var _data$data = data.data,\n              caseIncidentID = _data$data.caseIncidentID,\n              caseIncidentNotesID = _data$data.caseIncidentNotesID;\n\n          if (caseIncidentID && caseIncidentNotesID) {\n            dispatch(setDmsTaskContextType({\n              caseIncidentID: caseIncidentID,\n              caseIncidentNotesID: caseIncidentNotesID\n            }));\n          }\n        }\n      });\n    }\n  };\n\n  var handleCloseRFI = function handleCloseRFI() {\n    dispatch(showModal({\n      component: 'CONFIRM',\n      props: {\n        fullWidth: true,\n        title: utils.string.t('status.alert'),\n        maxWidth: 'xs',\n        componentProps: {\n          confirmLabel: utils.string.t('app.yes'),\n          cancelLabel: utils.string.t('app.no'),\n          confirmMessage: utils.string.t('claims.processing.modal.rfiCloseConfirm'),\n          buttonColors: {\n            confirm: 'secondary',\n            cancel: 'default'\n          },\n          submitHandler: function submitHandler() {\n            var _props$task4;\n\n            dispatch(postCloseRFI((_props$task4 = props.task) === null || _props$task4 === void 0 ? void 0 : _props$task4.taskId, history)).then(function (data) {\n              if (data.status === 'OK') {\n                setTimeout(function () {\n                  return history.replace(config.routes.claimsProcessing.root);\n                }, 1000);\n              }\n            });\n          }\n        }\n      }\n    }));\n  };\n\n  useEffect(function () {\n    dispatch(getUsersByOrg('', [props === null || props === void 0 ? void 0 : props.task], CREATE_RFI_FORM, true));\n    dispatch(resetClaimsAssignedToUsers());\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(function () {\n    if ((assignedToUsers === null || assignedToUsers === void 0 ? void 0 : assignedToUsers.length) > 0) {\n      setResetKey(new Date().getTime());\n      setIsDataReady(true);\n    }\n  }, [assignedToUsers]);\n  var defaultValues = utils.form.getInitialValues(fields);\n  var validationSchema = utils.form.getValidationSchema(fields);\n\n  var _useForm = useForm(_objectSpread({\n    defaultValues: defaultValues\n  }, validationSchema && {\n    resolver: yupResolver(validationSchema)\n  })),\n      control = _useForm.control,\n      reset = _useForm.reset,\n      errors = _useForm.errors,\n      handleSubmit = _useForm.handleSubmit,\n      formState = _useForm.formState,\n      setValue = _useForm.setValue;\n\n  if (!isDataReady) {\n    return /*#__PURE__*/_jsxDEV(Box, {\n      height: \"300px\",\n      children: /*#__PURE__*/_jsxDEV(Loader, {\n        visible: true,\n        absolute: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 7\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(RfiQueryFormView, _objectSpread(_objectSpread({}, props), {}, {\n    fields: fields,\n    actions: actions,\n    formProps: {\n      control: control,\n      handleSubmit: handleSubmit,\n      setValue: setValue,\n      errors: errors,\n      formState: formState,\n      reset: reset\n    },\n    resetKey: resetKey,\n    dmsActions: dmsActions,\n    isResponseSubmitted: isResponseSubmitted,\n    uploadDocumentsControl: uploadDocumentsControl\n  }), void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 195,\n    columnNumber: 5\n  }, this);\n}\n\n_s(RfiQueryForm, \"Upf7Fih6mG4fLc1IFSOP17t6F3U=\", false, function () {\n  return [useDispatch, useHistory, useSelector, useSelector, useForm];\n});\n\n_c = RfiQueryForm;\nRfiQueryForm.displayName = \"RfiQueryForm\";\nRfiQueryForm.__docgenInfo = {\n  \"description\": \"\",\n  \"methods\": [],\n  \"displayName\": \"RfiQueryForm\"\n};\n\nif (typeof STORYBOOK_REACT_CLASSES !== \"undefined\") {\n  STORYBOOK_REACT_CLASSES[\"src\\\\modules\\\\RfiQueryForm\\\\RfiQueryForm.js\"] = {\n    name: \"RfiQueryForm\",\n    docgenInfo: RfiQueryForm.__docgenInfo,\n    path: \"src\\\\modules\\\\RfiQueryForm\\\\RfiQueryForm.js\"\n  };\n}\n\nvar _c;\n\n$RefreshReg$(_c, \"RfiQueryForm\");","map":{"version":3,"sources":["E:/MPHASIS/claims-page/Mphasis-Edge/src/modules/RfiQueryForm/RfiQueryForm.js"],"names":["React","useEffect","useState","Yup","yupResolver","useHistory","useForm","useDispatch","useSelector","utils","RfiQueryFormView","Loader","config","CREATE_RFI_FORM","TASK_TAB_COMPLETED_STATUS","getUsersByOrg","selectClaimsAssignedToUsers","postSendRFI","postCloseRFI","showModal","selectUserEmail","resetClaimsAssignedToUsers","setDmsTaskContextType","Box","RfiQueryForm","props","dispatch","history","assignedToUsers","items","userEmail","resetKey","setResetKey","isDataReady","setIsDataReady","task","isResponseSubmitted","setIsResponseSubmitted","uploadDocumentsControl","setUploadDocumentsControl","defaultAssignedUser","toLowerCase","requestedBy","find","email","rfiSentTo","generic","isValidArray","fields","name","type","value","options","optionKey","optionLabel","muiComponentProps","disabled","status","validation","object","required","string","t","hint","inputProps","maxLength","multiline","rows","rowsMax","max","actions","label","handler","handleCloseRFI","values","handleRFISend","dmsActions","skipUpload","replace","routes","claimsProcessing","root","upload","submitReply","sendToObj","user","sendTo","rfiSendData","assignedTo","bpmTaskID","taskId","caseIncidentID","notes","description","team","organisationName","queryCodeDescription","selectedQueryCode","then","data","caseIncidentNotesID","component","fullWidth","title","maxWidth","componentProps","confirmLabel","cancelLabel","confirmMessage","buttonColors","confirm","cancel","submitHandler","setTimeout","length","Date","getTime","defaultValues","form","getInitialValues","validationSchema","getValidationSchema","resolver","control","reset","errors","handleSubmit","formState","setValue"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport * as Yup from 'yup';\r\nimport { yupResolver } from '@hookform/resolvers/yup';\r\nimport { useHistory } from 'react-router';\r\nimport { useForm } from 'react-hook-form';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\n\r\n//app\r\nimport * as utils from 'utils';\r\nimport { RfiQueryFormView } from './RfiQueryForm.view';\r\nimport { Loader } from 'components';\r\nimport config from 'config';\r\nimport { CREATE_RFI_FORM, TASK_TAB_COMPLETED_STATUS } from 'consts';\r\nimport {\r\n  getUsersByOrg,\r\n  selectClaimsAssignedToUsers,\r\n  postSendRFI,\r\n  postCloseRFI,\r\n  showModal,\r\n  selectUserEmail,\r\n  resetClaimsAssignedToUsers,\r\n  setDmsTaskContextType,\r\n} from 'stores';\r\n\r\n// mui\r\nimport { Box } from '@material-ui/core';\r\n\r\nexport default function RfiQueryForm(props) {\r\n  const dispatch = useDispatch();\r\n  const history = useHistory();\r\n\r\n  const assignedToUsers = useSelector(selectClaimsAssignedToUsers)?.items || null;\r\n  const userEmail = useSelector(selectUserEmail);\r\n  const [resetKey, setResetKey] = useState();\r\n  const [isDataReady, setIsDataReady] = useState(false);\r\n  const { task } = props;\r\n  const [isResponseSubmitted, setIsResponseSubmitted] = useState(false);\r\n  const [uploadDocumentsControl, setUploadDocumentsControl] = useState(false);\r\n\r\n  const defaultAssignedUser = () =>\r\n    userEmail?.toLowerCase() === task?.requestedBy?.toLowerCase()\r\n      ? assignedToUsers?.find(({ email }) => email?.toLowerCase() === task?.rfiSentTo?.toLowerCase())\r\n      : utils.generic.isValidArray(assignedToUsers, true)\r\n      ? assignedToUsers?.find(({ email }) => email?.toLowerCase() === task?.requestedBy?.toLowerCase())\r\n      : null;\r\n\r\n  const fields = [\r\n    {\r\n      name: 'sendTo',\r\n      type: 'autocompletemui',\r\n      value: defaultAssignedUser(),\r\n      options: utils.generic.isValidArray(assignedToUsers, true) ? assignedToUsers : [],\r\n      optionKey: 'email',\r\n      optionLabel: 'fullName',\r\n      muiComponentProps: {\r\n        disabled: task?.status === TASK_TAB_COMPLETED_STATUS\r\n      },\r\n      validation: Yup.object().required(utils.string.t('validation.required')),\r\n    },\r\n    {\r\n      name: 'description',\r\n      type: 'textarea',\r\n      hint: utils.string.t('claims.processing.validation.rfiHistoryMaxDesc', { char: 1000 }),\r\n      muiComponentProps: {\r\n        inputProps: { maxLength: 1000 },\r\n        multiline: true,\r\n        rows: 3,\r\n        rowsMax: 3,\r\n        'data-testid': 'details',\r\n      },\r\n      validation: Yup.string()\r\n        .required(utils.string.t('validation.required'))\r\n        .max(1000, utils.string.t('claims.processing.validation.rfiHistoryMaxDesc', { char: 1000 })),\r\n    },\r\n  ];\r\n\r\n  const actions = [\r\n    {\r\n      name: 'secondary',\r\n      label: utils.string.t('app.close'),\r\n      disabled: userEmail.toLowerCase() !== props.task?.requestedBy?.toLowerCase(),\r\n      handler: () => {\r\n        handleCloseRFI();\r\n      },\r\n    },\r\n    {\r\n      name: 'submit',\r\n      label: utils.string.t('app.reply'),\r\n      handler: (values) => {\r\n        handleRFISend(values);\r\n      },\r\n    },\r\n  ];\r\n\r\n  const dmsActions = {\r\n    skipUpload: {\r\n      label: utils.string.t('app.no'),\r\n      handler: () => {\r\n        setUploadDocumentsControl(false);\r\n        history.replace(config.routes.claimsProcessing.root);\r\n      },\r\n    },\r\n    upload: {\r\n      label: utils.string.t('app.yes'),\r\n      handler: () => {\r\n        setUploadDocumentsControl(true);\r\n      },\r\n    },\r\n    submitReply: {\r\n      label: utils.string.t('claims.processing.rfi.submitReply'),\r\n      handler: () => {\r\n        history.replace(config.routes.claimsProcessing.root);\r\n      },\r\n    },\r\n  };\r\n\r\n  const handleRFISend = (values) => {\r\n    if (values) {\r\n      const sendToObj = assignedToUsers.find((user) => user.email === values?.sendTo?.email);\r\n      const rfiSendData = {\r\n        assignedTo: sendToObj?.email,\r\n        bpmTaskID: props.task?.taskId,\r\n        caseIncidentID: props.task?.caseIncidentID,\r\n        notes: values?.description,\r\n        team: sendToObj?.organisationName,\r\n        queryCodeDescription: props?.selectedQueryCode?.queryCodeDescription,\r\n      };\r\n      dispatch(postSendRFI(rfiSendData)).then((data) => {\r\n        if (data.status === 'OK') {\r\n          setIsResponseSubmitted(true);\r\n          const { caseIncidentID, caseIncidentNotesID } = data.data;\r\n          if (caseIncidentID && caseIncidentNotesID) {\r\n            dispatch(setDmsTaskContextType({ caseIncidentID, caseIncidentNotesID }));\r\n          }\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleCloseRFI = () => {\r\n    dispatch(\r\n      showModal({\r\n        component: 'CONFIRM',\r\n        props: {\r\n          fullWidth: true,\r\n          title: utils.string.t('status.alert'),\r\n          maxWidth: 'xs',\r\n          componentProps: {\r\n            confirmLabel: utils.string.t('app.yes'),\r\n            cancelLabel: utils.string.t('app.no'),\r\n            confirmMessage: utils.string.t('claims.processing.modal.rfiCloseConfirm'),\r\n            buttonColors: { confirm: 'secondary', cancel: 'default' },\r\n            submitHandler: () => {\r\n              dispatch(postCloseRFI(props.task?.taskId, history)).then((data) => {\r\n                if (data.status === 'OK') {\r\n                  setTimeout(() => history.replace(config.routes.claimsProcessing.root), 1000);\r\n                }\r\n              });\r\n            },\r\n          },\r\n        },\r\n      })\r\n    );\r\n  };\r\n\r\n  useEffect(() => {\r\n    dispatch(getUsersByOrg('', [props?.task], CREATE_RFI_FORM, true));\r\n    dispatch(resetClaimsAssignedToUsers());\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    if (assignedToUsers?.length > 0) {\r\n      setResetKey(new Date().getTime());\r\n      setIsDataReady(true);\r\n    }\r\n  }, [assignedToUsers]);\r\n\r\n  const defaultValues = utils.form.getInitialValues(fields);\r\n  const validationSchema = utils.form.getValidationSchema(fields);\r\n\r\n  const { control, reset, errors, handleSubmit, formState, setValue } = useForm({\r\n    defaultValues,\r\n    ...(validationSchema && { resolver: yupResolver(validationSchema) }),\r\n  });\r\n\r\n  if (!isDataReady) {\r\n    return (\r\n      <Box height=\"300px\">\r\n        <Loader visible absolute />\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <RfiQueryFormView\r\n      {...props}\r\n      fields={fields}\r\n      actions={actions}\r\n      formProps={{ control, handleSubmit, setValue, errors, formState, reset }}\r\n      resetKey={resetKey}\r\n      dmsActions={dmsActions}\r\n      isResponseSubmitted={isResponseSubmitted}\r\n      uploadDocumentsControl={uploadDocumentsControl}\r\n    />\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}