{"ast":null,"code":"import _regeneratorRuntime from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport moment from 'moment'; // app\n\nimport { authLogout, hideModal, enqueueNotification } from 'stores';\nimport * as utils from 'utils';\nexport var downloadRiskBordereaux = function downloadRiskBordereaux(_ref) {\n  var product = _ref.product,\n      from = _ref.from,\n      to = _ref.to,\n      facility = _ref.facility,\n      type = _ref.type,\n      onlyBound = _ref.onlyBound;\n  return function (dispatch, getState) {\n    // prettier-ignore\n    var _getState = getState(),\n        auth = _getState.user.auth,\n        endpoint = _getState.config.vars.endpoint;\n\n    var defaultError = {\n      file: 'stores/risk.actions.downloadBordereaux'\n    };\n    dispatch(downloadRiskBordereauxRequest({\n      product: product,\n      from: from,\n      to: to,\n      facility: facility,\n      type: type,\n      onlyBound: onlyBound\n    }));\n\n    if (!product || !from || !to) {\n      return _objectSpread(_objectSpread({}, defaultError), {}, {\n        message: 'Data missing'\n      });\n    }\n\n    var dateFrom = moment(from).format('YYYY-MM');\n    var dateTo = moment(to).format('YYYY-MM');\n    var facilityParam = facility ? \"_\".concat(facility) : '';\n    var facilityIdParam = facility ? \"&facilityId=\".concat(facility) : '';\n    var typeParam = type ? \"&type=\".concat(type) : '';\n    var onlyBoundParam = type === 'DATA_DUMP' ? \"&onlyBound=\".concat(onlyBound) : '';\n    var defaultFilename = type === 'DATA_DUMP' ? \"data_\".concat(product, \"_\").concat(dateFrom, \"_\").concat(dateTo).concat(facilityParam) : \"bordereaux_\".concat(product, \"_\").concat(dateFrom, \"_\").concat(dateTo).concat(facilityParam);\n    var responseFilename = '';\n    utils.api.get({\n      token: auth.accessToken,\n      endpoint: endpoint.auth,\n      path: \"api/v1/products/\".concat(product, \"/bordereaux?from=\").concat(dateFrom, \"&to=\").concat(dateTo).concat(facilityIdParam).concat(typeParam).concat(onlyBoundParam)\n    }).then( /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(response) {\n        var blob;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!response.ok) {\n                  _context.next = 8;\n                  break;\n                }\n\n                _context.next = 3;\n                return response.blob();\n\n              case 3:\n                blob = _context.sent;\n                responseFilename = utils.file.getFilenameFromHeadersBlob(response.headers, blob, defaultFilename);\n                return _context.abrupt(\"return\", blob);\n\n              case 8:\n                return _context.abrupt(\"return\", Promise.reject({}));\n\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }()).then(function (blob) {\n      utils.file.download(blob, responseFilename);\n      dispatch(downloadRiskBordereauxSuccess());\n      dispatch(hideModal());\n      return responseFilename;\n    })[\"catch\"](function (err) {\n      var errorParams = _objectSpread(_objectSpread({}, defaultError), {}, {\n        message: 'API fetch error (blob)'\n      });\n\n      utils.api.handleError(err, errorParams);\n      utils.api.handleUnauthorized(err, dispatch, authLogout);\n      dispatch(downloadRiskBordereauxFailure(err));\n      dispatch(enqueueNotification(utils.api.getErrorMessage(err), 'error'));\n    });\n  };\n};\nexport var downloadRiskBordereauxRequest = function downloadRiskBordereauxRequest(formData) {\n  return {\n    type: 'DOWNLOAD_RISK_BORDEREAUX_REQUEST',\n    payload: formData\n  };\n};\nexport var downloadRiskBordereauxSuccess = function downloadRiskBordereauxSuccess() {\n  return {\n    type: 'DOWNLOAD_RISK_BORDEREAUX_SUCCESS'\n  };\n};\nexport var downloadRiskBordereauxFailure = function downloadRiskBordereauxFailure(error) {\n  return {\n    type: 'DOWNLOAD_RISK_BORDEREAUX_FAILURE',\n    payload: error\n  };\n};","map":{"version":3,"sources":["E:/MPHASIS/claims-page/Mphasis-Edge/src/stores/risk/risk.actions.downloadBordereaux.js"],"names":["moment","authLogout","hideModal","enqueueNotification","utils","downloadRiskBordereaux","product","from","to","facility","type","onlyBound","dispatch","getState","auth","user","endpoint","config","vars","defaultError","file","downloadRiskBordereauxRequest","message","dateFrom","format","dateTo","facilityParam","facilityIdParam","typeParam","onlyBoundParam","defaultFilename","responseFilename","api","get","token","accessToken","path","then","response","ok","blob","getFilenameFromHeadersBlob","headers","Promise","reject","download","downloadRiskBordereauxSuccess","err","errorParams","handleError","handleUnauthorized","downloadRiskBordereauxFailure","getErrorMessage","formData","payload","error"],"mappings":"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","sourcesContent":["import moment from 'moment';\r\n\r\n// app\r\nimport { authLogout, hideModal, enqueueNotification } from 'stores';\r\nimport * as utils from 'utils';\r\n\r\nexport const downloadRiskBordereaux =\r\n  ({ product, from, to, facility, type, onlyBound }) =>\r\n  (dispatch, getState) => {\r\n    // prettier-ignore\r\n    const { user: { auth }, config: { vars: { endpoint }}} = getState();\r\n\r\n    const defaultError = {\r\n      file: 'stores/risk.actions.downloadBordereaux',\r\n    };\r\n\r\n    dispatch(downloadRiskBordereauxRequest({ product, from, to, facility, type, onlyBound }));\r\n\r\n    if (!product || !from || !to) {\r\n      return { ...defaultError, message: 'Data missing' };\r\n    }\r\n\r\n    const dateFrom = moment(from).format('YYYY-MM');\r\n    const dateTo = moment(to).format('YYYY-MM');\r\n\r\n    const facilityParam = facility ? `_${facility}` : '';\r\n    const facilityIdParam = facility ? `&facilityId=${facility}` : '';\r\n    const typeParam = type ? `&type=${type}` : '';\r\n    const onlyBoundParam = type === 'DATA_DUMP' ? `&onlyBound=${onlyBound}` : '';\r\n\r\n    const defaultFilename =\r\n      type === 'DATA_DUMP'\r\n        ? `data_${product}_${dateFrom}_${dateTo}${facilityParam}`\r\n        : `bordereaux_${product}_${dateFrom}_${dateTo}${facilityParam}`;\r\n    let responseFilename = '';\r\n\r\n    utils.api\r\n      .get({\r\n        token: auth.accessToken,\r\n        endpoint: endpoint.auth,\r\n        path: `api/v1/products/${product}/bordereaux?from=${dateFrom}&to=${dateTo}${facilityIdParam}${typeParam}${onlyBoundParam}`,\r\n      })\r\n      .then(async (response) => {\r\n        if (response.ok) {\r\n          const blob = await response.blob();\r\n          responseFilename = utils.file.getFilenameFromHeadersBlob(response.headers, blob, defaultFilename);\r\n          return blob;\r\n        } else {\r\n          return Promise.reject({});\r\n        }\r\n      })\r\n      .then((blob) => {\r\n        utils.file.download(blob, responseFilename);\r\n        dispatch(downloadRiskBordereauxSuccess());\r\n        dispatch(hideModal());\r\n        return responseFilename;\r\n      })\r\n      .catch((err) => {\r\n        const errorParams = {\r\n          ...defaultError,\r\n          message: 'API fetch error (blob)',\r\n        };\r\n        utils.api.handleError(err, errorParams);\r\n        utils.api.handleUnauthorized(err, dispatch, authLogout);\r\n        dispatch(downloadRiskBordereauxFailure(err));\r\n        dispatch(enqueueNotification(utils.api.getErrorMessage(err), 'error'));\r\n      });\r\n  };\r\n\r\nexport const downloadRiskBordereauxRequest = (formData) => {\r\n  return {\r\n    type: 'DOWNLOAD_RISK_BORDEREAUX_REQUEST',\r\n    payload: formData,\r\n  };\r\n};\r\n\r\nexport const downloadRiskBordereauxSuccess = () => {\r\n  return {\r\n    type: 'DOWNLOAD_RISK_BORDEREAUX_SUCCESS',\r\n  };\r\n};\r\n\r\nexport const downloadRiskBordereauxFailure = (error) => {\r\n  return {\r\n    type: 'DOWNLOAD_RISK_BORDEREAUX_FAILURE',\r\n    payload: error,\r\n  };\r\n};\r\n"]},"metadata":{},"sourceType":"module"}