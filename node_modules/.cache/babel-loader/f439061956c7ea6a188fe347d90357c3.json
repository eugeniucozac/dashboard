{"ast":null,"code":"import _objectSpread from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\n\nvar _jsxFileName = \"E:\\\\MPHASIS\\\\claims-page\\\\Mphasis-Edge\\\\src\\\\components\\\\Comments\\\\Comments.view.js\",\n    _s = $RefreshSig$();\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useForm } from 'react-hook-form';\nimport { yupResolver } from '@hookform/resolvers/yup'; // app\n\nimport styles from './Comments.styles';\nimport { selectUser, deleteComment } from 'stores';\nimport { Avatar, Button, FormContainer, FormText, Info, Translate } from 'components';\nimport * as utils from 'utils'; // mui\n\nimport { Box, Collapse, Typography, makeStyles, useTheme } from '@material-ui/core';\nimport PersonIcon from '@material-ui/icons/Person';\nimport HighlightOffIcon from '@material-ui/icons/HighlightOff';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nCommentsView.propTypes = {\n  title: PropTypes.string,\n  comments: PropTypes.array,\n  truncate: PropTypes.number,\n  expanded: PropTypes.array,\n  divider: PropTypes.bool,\n  field: PropTypes.object,\n  user: PropTypes.object,\n  handleClickExpand: PropTypes.func,\n  handlePostComment: PropTypes.func\n};\nexport function CommentsView(_ref) {\n  _s();\n\n  var _this = this;\n\n  var id = _ref.id,\n      title = _ref.title,\n      comments = _ref.comments,\n      truncate = _ref.truncate,\n      expanded = _ref.expanded,\n      divider = _ref.divider,\n      field = _ref.field,\n      user = _ref.user,\n      handleClickExpand = _ref.handleClickExpand,\n      handlePostComment = _ref.handlePostComment;\n  var dispatch = useDispatch();\n  var classes = makeStyles(styles, {\n    name: 'Comments'\n  })({\n    divider: divider\n  });\n  var theme = useTheme();\n  var currentUser = useSelector(selectUser);\n  var defaultValues = utils.form.getInitialValues([field]);\n  var validationSchema = utils.form.getValidationSchema([field]);\n\n  var _useForm = useForm(_objectSpread({\n    mode: 'onChange',\n    defaultValues: defaultValues\n  }, validationSchema && {\n    resolver: yupResolver(validationSchema)\n  })),\n      control = _useForm.control,\n      reset = _useForm.reset,\n      handleSubmit = _useForm.handleSubmit,\n      formState = _useForm.formState;\n\n  var handleDeleteComment = function handleDeleteComment(commentId) {\n    dispatch(deleteComment(id, commentId));\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: classes.root,\n    children: [title && /*#__PURE__*/_jsxDEV(Typography, {\n      variant: \"h5\",\n      className: classes.title,\n      children: title\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 51,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Collapse, {\n      in: !!comments.length,\n      timeout: 'auto',\n      children: comments.map(function (item) {\n        var firstName = utils.user.firstname(item.user);\n        var fullName = utils.user.fullname(item.user);\n        var title = firstName || fullName || utils.string.t('app.na');\n        var subtitle = item.date ? utils.string.t('format.dateFromNow', {\n          value: {\n            date: item.date\n          }\n        }) : null;\n        var initials = utils.user.initials(item.user);\n        var icon = !initials ? PersonIcon : null;\n        var canDeleteComment = (currentUser === null || currentUser === void 0 ? void 0 : currentUser.id) === item.user.id;\n\n        var toggle = /*#__PURE__*/_jsxDEV(Button, {\n          size: \"xsmall\",\n          variant: \"text\",\n          text: /*#__PURE__*/_jsxDEV(Translate, {\n            label: \"app.seeMore\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 70,\n            columnNumber: 21\n          }, _this),\n          onClick: handleClickExpand(item.id),\n          nestedClasses: {\n            btn: classes.toggle,\n            label: classes.label\n          },\n          \"data-testid\": \"comment-expand-\".concat(item.id)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 67,\n          columnNumber: 13\n        }, _this); // handle string truncation\n        // we remove 20 characters more than the truncate limit, otherwise we could have cases\n        // where 1 characters is truncated, but the \"... see more\" takes more space than the actual string\n\n\n        var isTruncated = item.message && truncate && item.message.length > truncate;\n        var isCollapsed = !expanded.includes(item.id);\n\n        var messageTruncated = /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [item.message.slice(0, truncate - 20).trim(), \"...\", toggle]\n        }, void 0, true);\n\n        var message = isTruncated && isCollapsed ? messageTruncated : item.message;\n        return /*#__PURE__*/_jsxDEV(Box, {\n          display: \"flex\",\n          className: classes.info,\n          children: [/*#__PURE__*/_jsxDEV(Box, {\n            flex: \"1\",\n            children: /*#__PURE__*/_jsxDEV(Info, {\n              title: title,\n              subtitle: subtitle,\n              description: message,\n              avatarText: initials,\n              avatarIcon: icon,\n              avatarBg: !!icon ? theme.palette.grey[300] : null,\n              avatarBorder: !!icon,\n              \"data-testid\": \"comment-\".concat(item.id)\n            }, item.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 95,\n              columnNumber: 17\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 15\n          }, _this), /*#__PURE__*/_jsxDEV(Box, {\n            className: classes.info,\n            children: canDeleteComment ? /*#__PURE__*/_jsxDEV(Button, {\n              size: \"small\",\n              variant: \"text\",\n              color: \"primary\",\n              icon: HighlightOffIcon,\n              onClick: function onClick() {\n                return handleDeleteComment(item.id);\n              },\n              \"data-testid\": \"comment-delete-\".concat(item.id)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 109,\n              columnNumber: 19\n            }, _this) : null\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 107,\n            columnNumber: 15\n          }, _this)]\n        }, item.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 13\n        }, _this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      mt: 3,\n      mb: 0.5,\n      children: /*#__PURE__*/_jsxDEV(FormContainer, {\n        onSubmit: handleSubmit(handlePostComment(reset)),\n        className: classes.form,\n        \"data-testid\": \"form-comment\",\n        children: [/*#__PURE__*/_jsxDEV(Avatar, {\n          text: utils.user.initials(user),\n          size: 32,\n          avatarClasses: classes.avatar\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(FormText, _objectSpread(_objectSpread({}, field), {}, {\n          control: control,\n          muiComponentProps: _objectSpread(_objectSpread({}, field.muiComponentProps), {}, {\n            disabled: formState.isSubmitting\n          })\n        }), void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          type: \"submit\",\n          text: /*#__PURE__*/_jsxDEV(Translate, {\n            label: \"app.send\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 137,\n            columnNumber: 19\n          }, this),\n          color: \"primary\",\n          variant: \"contained\",\n          disabled: formState.isSubmitting || !formState.isValid,\n          nestedClasses: {\n            btn: classes.submit\n          },\n          \"data-testid\": \"send-button\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 49,\n    columnNumber: 5\n  }, this);\n}\n\n_s(CommentsView, \"9Rjn3dvIptQf6408YvKkZ/cNmHw=\", false, function () {\n  return [useDispatch, useTheme, useSelector, useForm];\n});\n\n_c = CommentsView;\n\nvar _c;\n\n$RefreshReg$(_c, \"CommentsView\");","map":{"version":3,"sources":["E:/MPHASIS/claims-page/Mphasis-Edge/src/components/Comments/Comments.view.js"],"names":["React","PropTypes","useDispatch","useSelector","useForm","yupResolver","styles","selectUser","deleteComment","Avatar","Button","FormContainer","FormText","Info","Translate","utils","Box","Collapse","Typography","makeStyles","useTheme","PersonIcon","HighlightOffIcon","CommentsView","propTypes","title","string","comments","array","truncate","number","expanded","divider","bool","field","object","user","handleClickExpand","func","handlePostComment","id","dispatch","classes","name","theme","currentUser","defaultValues","form","getInitialValues","validationSchema","getValidationSchema","mode","resolver","control","reset","handleSubmit","formState","handleDeleteComment","commentId","root","length","map","item","firstName","firstname","fullName","fullname","t","subtitle","date","value","initials","icon","canDeleteComment","toggle","btn","label","isTruncated","message","isCollapsed","includes","messageTruncated","slice","trim","info","palette","grey","avatar","muiComponentProps","disabled","isSubmitting","isValid","submit"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { useForm } from 'react-hook-form';\r\nimport { yupResolver } from '@hookform/resolvers/yup';\r\n\r\n// app\r\nimport styles from './Comments.styles';\r\nimport { selectUser, deleteComment } from 'stores';\r\nimport { Avatar, Button, FormContainer, FormText, Info, Translate } from 'components';\r\nimport * as utils from 'utils';\r\n\r\n// mui\r\nimport { Box, Collapse, Typography, makeStyles, useTheme } from '@material-ui/core';\r\nimport PersonIcon from '@material-ui/icons/Person';\r\nimport HighlightOffIcon from '@material-ui/icons/HighlightOff';\r\n\r\nCommentsView.propTypes = {\r\n  title: PropTypes.string,\r\n  comments: PropTypes.array,\r\n  truncate: PropTypes.number,\r\n  expanded: PropTypes.array,\r\n  divider: PropTypes.bool,\r\n  field: PropTypes.object,\r\n  user: PropTypes.object,\r\n  handleClickExpand: PropTypes.func,\r\n  handlePostComment: PropTypes.func,\r\n};\r\n\r\nexport function CommentsView({ id, title, comments, truncate, expanded, divider, field, user, handleClickExpand, handlePostComment }) {\r\n  const dispatch = useDispatch();\r\n  const classes = makeStyles(styles, { name: 'Comments' })({ divider });\r\n  const theme = useTheme();\r\n  const currentUser = useSelector(selectUser);\r\n  const defaultValues = utils.form.getInitialValues([field]);\r\n  const validationSchema = utils.form.getValidationSchema([field]);\r\n\r\n  const { control, reset, handleSubmit, formState } = useForm({\r\n    mode: 'onChange',\r\n    defaultValues,\r\n    ...(validationSchema && { resolver: yupResolver(validationSchema) }),\r\n  });\r\n\r\n  const handleDeleteComment = (commentId) => {\r\n    dispatch(deleteComment(id, commentId));\r\n  };\r\n\r\n  return (\r\n    <div className={classes.root}>\r\n      {title && (\r\n        <Typography variant=\"h5\" className={classes.title}>\r\n          {title}\r\n        </Typography>\r\n      )}\r\n\r\n      <Collapse in={!!comments.length} timeout={'auto'}>\r\n        {comments.map((item) => {\r\n          const firstName = utils.user.firstname(item.user);\r\n          const fullName = utils.user.fullname(item.user);\r\n          const title = firstName || fullName || utils.string.t('app.na');\r\n          const subtitle = item.date ? utils.string.t('format.dateFromNow', { value: { date: item.date } }) : null;\r\n          const initials = utils.user.initials(item.user);\r\n          const icon = !initials ? PersonIcon : null;\r\n          const canDeleteComment = currentUser?.id === item.user.id;\r\n\r\n          const toggle = (\r\n            <Button\r\n              size=\"xsmall\"\r\n              variant=\"text\"\r\n              text={<Translate label=\"app.seeMore\" />}\r\n              onClick={handleClickExpand(item.id)}\r\n              nestedClasses={{ btn: classes.toggle, label: classes.label }}\r\n              data-testid={`comment-expand-${item.id}`}\r\n            />\r\n          );\r\n\r\n          // handle string truncation\r\n          // we remove 20 characters more than the truncate limit, otherwise we could have cases\r\n          // where 1 characters is truncated, but the \"... see more\" takes more space than the actual string\r\n          const isTruncated = item.message && truncate && item.message.length > truncate;\r\n          const isCollapsed = !expanded.includes(item.id);\r\n          const messageTruncated = (\r\n            <>\r\n              {item.message.slice(0, truncate - 20).trim()}\r\n              ...\r\n              {toggle}\r\n            </>\r\n          );\r\n\r\n          const message = isTruncated && isCollapsed ? messageTruncated : item.message;\r\n\r\n          return (\r\n            <Box key={item.id} display=\"flex\" className={classes.info}>\r\n              <Box flex=\"1\">\r\n                <Info\r\n                  key={item.id}\r\n                  title={title}\r\n                  subtitle={subtitle}\r\n                  description={message}\r\n                  avatarText={initials}\r\n                  avatarIcon={icon}\r\n                  avatarBg={!!icon ? theme.palette.grey[300] : null}\r\n                  avatarBorder={!!icon}\r\n                  data-testid={`comment-${item.id}`}\r\n                />\r\n              </Box>\r\n              <Box className={classes.info}>\r\n                {canDeleteComment ? (\r\n                  <Button\r\n                    size=\"small\"\r\n                    variant=\"text\"\r\n                    color=\"primary\"\r\n                    icon={HighlightOffIcon}\r\n                    onClick={() => handleDeleteComment(item.id)}\r\n                    data-testid={`comment-delete-${item.id}`}\r\n                  />\r\n                ) : null}\r\n              </Box>\r\n            </Box>\r\n          );\r\n        })}\r\n      </Collapse>\r\n\r\n      <Box mt={3} mb={0.5}>\r\n        <FormContainer onSubmit={handleSubmit(handlePostComment(reset))} className={classes.form} data-testid=\"form-comment\">\r\n          <Avatar text={utils.user.initials(user)} size={32} avatarClasses={classes.avatar} />\r\n          <FormText\r\n            {...field}\r\n            control={control}\r\n            muiComponentProps={{\r\n              ...field.muiComponentProps,\r\n              disabled: formState.isSubmitting,\r\n            }}\r\n          />\r\n          <Button\r\n            type=\"submit\"\r\n            text={<Translate label=\"app.send\" />}\r\n            color=\"primary\"\r\n            variant=\"contained\"\r\n            disabled={formState.isSubmitting || !formState.isValid}\r\n            nestedClasses={{ btn: classes.submit }}\r\n            data-testid=\"send-button\"\r\n          />\r\n        </FormContainer>\r\n      </Box>\r\n    </div>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}