{"ast":null,"code":"import _objectSpread from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _createForOfIteratorHelper from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport _regeneratorRuntime from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"E:\\\\MPHASIS\\\\claims-page\\\\Mphasis-Edge\\\\src\\\\components\\\\FormAutocompleteMuiAsync\\\\FormAutocompleteMuiAsync.js\",\n    _s = $RefreshSig$();\n\n/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { useSelector } from 'react-redux';\nimport { useFormContext } from 'react-hook-form';\nimport isEqual from 'lodash/isEqual';\nimport get from 'lodash/get'; // app\n\nimport { selectUser } from 'stores';\nimport * as utils from 'utils'; // app\n\nimport FormAutocompleteMuiAsyncView from './FormAutocompleteMuiAsync.view';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nFormAutocompleteMuiAsync.propTypes = {\n  control: PropTypes.object,\n  name: PropTypes.string.isRequired,\n  options: PropTypes.arrayOf(PropTypes.object).isRequired,\n  optionKey: PropTypes.string.isRequired,\n  optionLabel: PropTypes.string.isRequired,\n  optionsCreatable: PropTypes.bool,\n  optionsFetch: PropTypes.object,\n  value: PropTypes.oneOfType([PropTypes.array, PropTypes.object]),\n  defaultValue: PropTypes.oneOfType([PropTypes.array, PropTypes.object]),\n  label: PropTypes.string,\n  placeholder: PropTypes.string,\n  hint: PropTypes.string,\n  error: PropTypes.shape({\n    message: PropTypes.string,\n    type: PropTypes.string\n  }),\n  muiComponentProps: PropTypes.object,\n  callback: PropTypes.func\n};\nFormAutocompleteMuiAsync.defaultProps = {\n  muiComponentProps: {},\n  options: [],\n  optionKey: 'value',\n  optionLabel: 'label',\n  value: null,\n  defaultValue: null\n};\nexport default function FormAutocompleteMuiAsync(props) {\n  _s();\n\n  var _props$muiComponentPr;\n\n  var _useFormContext = useFormContext(),\n      setValue = _useFormContext.setValue,\n      watch = _useFormContext.watch;\n\n  var _useState = useState(props === null || props === void 0 ? void 0 : props.dependentFieldsValues),\n      _useState2 = _slicedToArray(_useState, 2),\n      dependentFieldsState = _useState2[0],\n      setDependentFieldsState = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      componentOptions = _useState4[0],\n      setComponentOptions = _useState4[1];\n\n  var dataIndex = props.dataIndex,\n      dataSource = props.dataSource,\n      dataIncludeCustom = props.dataIncludeCustom,\n      dependants = props.dependants,\n      dependentFieldsValues = props.dependentFieldsValues,\n      name = props.name;\n  var product = useSelector(function (state) {\n    return get(state, 'risk.products.selected');\n  });\n  var user = useSelector(selectUser);\n  var endpoint = useSelector(function (state) {\n    return get(state, 'config.vars.endpoint');\n  });\n  var auth = user.auth;\n  var isMultiple = props === null || props === void 0 ? void 0 : (_props$muiComponentPr = props.muiComponentProps) === null || _props$muiComponentPr === void 0 ? void 0 : _props$muiComponentPr.multiple;\n  useEffect(function () {\n    if (isEqual(dependentFieldsValues, dependentFieldsState)) return;\n    setDependentFieldsState(dependentFieldsValues);\n  }, [dependentFieldsValues]);\n  useEffect(function () {\n    var isSubscribed = true;\n\n    var fetchData = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var response, data, errorParams;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return utils.api.get({\n                  token: auth.accessToken,\n                  endpoint: endpoint.auth,\n                  path: \"api/v1/products/\".concat(product, \"/data/\").concat(dataIndex),\n                  params: {\n                    dataSource: dataSource\n                  }\n                });\n\n              case 3:\n                response = _context.sent;\n                _context.next = 6;\n                return utils.api.handleResponse(response);\n\n              case 6:\n                data = _context.sent;\n                isSubscribed && setComponentOptions(data);\n                _context.next = 14;\n                break;\n\n              case 10:\n                _context.prev = 10;\n                _context.t0 = _context[\"catch\"](0);\n                errorParams = {\n                  file: 'FormAutocompleteMuiAsync.js',\n                  message: 'API fetch error, initial fetchData'\n                };\n                utils.api.handleError(_context.t0, errorParams);\n\n              case 14:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 10]]);\n      }));\n\n      return function fetchData() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    dependants.length === 0 && fetchData();\n    return function () {\n      return isSubscribed = false;\n    };\n  }, []);\n  useEffect(function () {\n    var isSubscribed = true;\n\n    var fetchData = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var restrictBy, _iterator, _step, _dependentFieldsState, dependant, _dependant$split, _dependant$split2, dependantIndex, depandantName, response, data, selectedValue, foundInOptions, errorParams;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                restrictBy = \"\";\n                _iterator = _createForOfIteratorHelper(dependants);\n\n                try {\n                  for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                    dependant = _step.value;\n                    _dependant$split = dependant.split(':'), _dependant$split2 = _slicedToArray(_dependant$split, 2), dependantIndex = _dependant$split2[0], depandantName = _dependant$split2[1];\n                    restrictBy = \"\".concat(restrictBy).concat(dependantIndex, \":\").concat((_dependentFieldsState = dependentFieldsState[depandantName]) === null || _dependentFieldsState === void 0 ? void 0 : _dependentFieldsState.value, \";\");\n                  }\n                } catch (err) {\n                  _iterator.e(err);\n                } finally {\n                  _iterator.f();\n                }\n\n                _context2.next = 6;\n                return utils.api.get({\n                  token: auth.accessToken,\n                  endpoint: endpoint.auth,\n                  path: \"api/v1/products/\".concat(product, \"/data/\").concat(dataIndex),\n                  params: _objectSpread({\n                    dataSource: dataSource,\n                    restrictBy: encodeURIComponent(restrictBy)\n                  }, dataIncludeCustom ? {\n                    includeCustom: dataIncludeCustom\n                  } : {})\n                });\n\n              case 6:\n                response = _context2.sent;\n                _context2.next = 9;\n                return utils.api.handleResponse(response);\n\n              case 9:\n                data = _context2.sent;\n                selectedValue = watch(name);\n                isSubscribed && setComponentOptions(data);\n\n                if (utils.generic.isValidArray(data, true) && selectedValue) {\n                  foundInOptions = isMultiple ? selectedValue.every(function (item) {\n                    return data.find(function (dataItem) {\n                      return (dataItem === null || dataItem === void 0 ? void 0 : dataItem.value) === (item === null || item === void 0 ? void 0 : item.value) || (dataItem === null || dataItem === void 0 ? void 0 : dataItem.value) === item;\n                    });\n                  }) : data.find(function (item) {\n                    return (selectedValue === null || selectedValue === void 0 ? void 0 : selectedValue.value) === (item === null || item === void 0 ? void 0 : item.value) || selectedValue === (item === null || item === void 0 ? void 0 : item.value);\n                  }) || false;\n                  if (!Boolean(foundInOptions) && isSubscribed) setValue(name, isMultiple ? [] : null);\n                }\n\n                _context2.next = 19;\n                break;\n\n              case 15:\n                _context2.prev = 15;\n                _context2.t0 = _context2[\"catch\"](0);\n                errorParams = {\n                  file: 'FormAutocompleteMuiAsync.js',\n                  message: 'API fetch error'\n                };\n                utils.api.handleError(_context2.t0, errorParams);\n\n              case 19:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[0, 15]]);\n      }));\n\n      return function fetchData() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    var isAllDefined = Object.keys(dependentFieldsState).every(function (key) {\n      return utils.generic.isValidObject(dependentFieldsState[key]);\n    });\n\n    if (isAllDefined && dependants.length > 0) {\n      isSubscribed && setComponentOptions([]);\n      fetchData();\n    }\n\n    return function () {\n      return isSubscribed = false;\n    };\n  }, [dependentFieldsState]);\n  return /*#__PURE__*/_jsxDEV(FormAutocompleteMuiAsyncView, _objectSpread({\n    componentOptions: componentOptions\n  }, props), void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 140,\n    columnNumber: 10\n  }, this);\n}\n\n_s(FormAutocompleteMuiAsync, \"EJtNvjPzUMhxprt0OxAHYVSWjG4=\", false, function () {\n  return [useFormContext, useSelector, useSelector, useSelector];\n});\n\n_c = FormAutocompleteMuiAsync;\n\nvar _c;\n\n$RefreshReg$(_c, \"FormAutocompleteMuiAsync\");","map":{"version":3,"sources":["E:/MPHASIS/claims-page/Mphasis-Edge/src/components/FormAutocompleteMuiAsync/FormAutocompleteMuiAsync.js"],"names":["React","useState","useEffect","PropTypes","useSelector","useFormContext","isEqual","get","selectUser","utils","FormAutocompleteMuiAsyncView","FormAutocompleteMuiAsync","propTypes","control","object","name","string","isRequired","options","arrayOf","optionKey","optionLabel","optionsCreatable","bool","optionsFetch","value","oneOfType","array","defaultValue","label","placeholder","hint","error","shape","message","type","muiComponentProps","callback","func","defaultProps","props","setValue","watch","dependentFieldsValues","dependentFieldsState","setDependentFieldsState","componentOptions","setComponentOptions","dataIndex","dataSource","dataIncludeCustom","dependants","product","state","user","endpoint","auth","isMultiple","multiple","isSubscribed","fetchData","api","token","accessToken","path","params","response","handleResponse","data","errorParams","file","handleError","length","restrictBy","dependant","split","dependantIndex","depandantName","encodeURIComponent","includeCustom","selectedValue","generic","isValidArray","foundInOptions","every","item","find","dataItem","Boolean","isAllDefined","Object","keys","key","isValidObject"],"mappings":"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","sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\r\nimport React, { useState, useEffect } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useSelector } from 'react-redux';\r\nimport { useFormContext } from 'react-hook-form';\r\nimport isEqual from 'lodash/isEqual';\r\nimport get from 'lodash/get';\r\n\r\n// app\r\nimport { selectUser } from 'stores';\r\nimport * as utils from 'utils';\r\n\r\n// app\r\nimport FormAutocompleteMuiAsyncView from './FormAutocompleteMuiAsync.view';\r\n\r\nFormAutocompleteMuiAsync.propTypes = {\r\n  control: PropTypes.object,\r\n  name: PropTypes.string.isRequired,\r\n  options: PropTypes.arrayOf(PropTypes.object).isRequired,\r\n  optionKey: PropTypes.string.isRequired,\r\n  optionLabel: PropTypes.string.isRequired,\r\n  optionsCreatable: PropTypes.bool,\r\n  optionsFetch: PropTypes.object,\r\n  value: PropTypes.oneOfType([PropTypes.array, PropTypes.object]),\r\n  defaultValue: PropTypes.oneOfType([PropTypes.array, PropTypes.object]),\r\n  label: PropTypes.string,\r\n  placeholder: PropTypes.string,\r\n  hint: PropTypes.string,\r\n  error: PropTypes.shape({\r\n    message: PropTypes.string,\r\n    type: PropTypes.string,\r\n  }),\r\n  muiComponentProps: PropTypes.object,\r\n  callback: PropTypes.func,\r\n};\r\n\r\nFormAutocompleteMuiAsync.defaultProps = {\r\n  muiComponentProps: {},\r\n  options: [],\r\n  optionKey: 'value',\r\n  optionLabel: 'label',\r\n  value: null,\r\n  defaultValue: null,\r\n};\r\n\r\nexport default function FormAutocompleteMuiAsync(props) {\r\n  const { setValue, watch } = useFormContext();\r\n  const [dependentFieldsState, setDependentFieldsState] = useState(props?.dependentFieldsValues);\r\n  const [componentOptions, setComponentOptions] = useState([]);\r\n  const { dataIndex, dataSource, dataIncludeCustom, dependants, dependentFieldsValues, name } = props;\r\n  const product = useSelector((state) => get(state, 'risk.products.selected'));\r\n  const user = useSelector(selectUser);\r\n  const endpoint = useSelector((state) => get(state, 'config.vars.endpoint'));\r\n  const { auth } = user;\r\n  const isMultiple = props?.muiComponentProps?.multiple;\r\n\r\n  useEffect(() => {\r\n    if (isEqual(dependentFieldsValues, dependentFieldsState)) return;\r\n\r\n    setDependentFieldsState(dependentFieldsValues);\r\n  }, [dependentFieldsValues]);\r\n\r\n  useEffect(() => {\r\n    let isSubscribed = true;\r\n\r\n    const fetchData = async () => {\r\n      try {\r\n        const response = await utils.api.get({\r\n          token: auth.accessToken,\r\n          endpoint: endpoint.auth,\r\n          path: `api/v1/products/${product}/data/${dataIndex}`,\r\n          params: { dataSource: dataSource },\r\n        });\r\n        const data = await utils.api.handleResponse(response);\r\n        isSubscribed && setComponentOptions(data);\r\n      } catch (err) {\r\n        const errorParams = {\r\n          file: 'FormAutocompleteMuiAsync.js',\r\n          message: 'API fetch error, initial fetchData',\r\n        };\r\n\r\n        utils.api.handleError(err, errorParams);\r\n      }\r\n    };\r\n    dependants.length === 0 && fetchData();\r\n\r\n    return () => (isSubscribed = false);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    let isSubscribed = true;\r\n\r\n    const fetchData = async () => {\r\n      try {\r\n        let restrictBy = ``;\r\n        for (const dependant of dependants) {\r\n          const [dependantIndex, depandantName] = dependant.split(':');\r\n          restrictBy = `${restrictBy}${dependantIndex}:${dependentFieldsState[depandantName]?.value};`;\r\n        }\r\n        const response = await utils.api.get({\r\n          token: auth.accessToken,\r\n          endpoint: endpoint.auth,\r\n          path: `api/v1/products/${product}/data/${dataIndex}`,\r\n          params: {\r\n            dataSource,\r\n            restrictBy: encodeURIComponent(restrictBy),\r\n            ...(dataIncludeCustom ? { includeCustom: dataIncludeCustom } : {}),\r\n          },\r\n        });\r\n        const data = await utils.api.handleResponse(response);\r\n\r\n        const selectedValue = watch(name);\r\n        isSubscribed && setComponentOptions(data);\r\n\r\n        if (utils.generic.isValidArray(data, true) && selectedValue) {\r\n          const foundInOptions = isMultiple\r\n            ? selectedValue.every((item) => data.find((dataItem) => dataItem?.value === item?.value || dataItem?.value === item))\r\n            : data.find((item) => selectedValue?.value === item?.value || selectedValue === item?.value) || false;\r\n\r\n          if (!Boolean(foundInOptions) && isSubscribed) setValue(name, isMultiple ? [] : null);\r\n        }\r\n      } catch (err) {\r\n        const errorParams = {\r\n          file: 'FormAutocompleteMuiAsync.js',\r\n          message: 'API fetch error',\r\n        };\r\n\r\n        utils.api.handleError(err, errorParams);\r\n      }\r\n    };\r\n    const isAllDefined = Object.keys(dependentFieldsState).every((key) => utils.generic.isValidObject(dependentFieldsState[key]));\r\n    if (isAllDefined && dependants.length > 0) {\r\n      isSubscribed && setComponentOptions([]);\r\n      fetchData();\r\n    }\r\n\r\n    return () => (isSubscribed = false);\r\n  }, [dependentFieldsState]);\r\n\r\n  return <FormAutocompleteMuiAsyncView componentOptions={componentOptions} {...props} />;\r\n}\r\n"]},"metadata":{},"sourceType":"module"}