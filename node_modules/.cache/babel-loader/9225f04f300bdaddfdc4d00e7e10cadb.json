{"ast":null,"code":"import _slicedToArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _toConsumableArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\n\nvar _jsxFileName = \"E:\\\\MPHASIS\\\\claims-page\\\\Mphasis-Edge\\\\src\\\\pages\\\\PremiumProcessingCaseDetails\\\\PremiumProcessingCaseDetails.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useHistory, useParams } from 'react-router';\nimport { Helmet } from 'react-helmet';\nimport get from 'lodash/get'; // app\n\nimport { PremiumProcessingCaseDetailsView } from './PremiumProcessingCaseDetails.view';\nimport { getCaseTeamModule, getCheckSigningCaseHistory, getCaseHistoryDetails, getCaseTeamDetails, selectCaseDetails, selectCaseRfiDetails, hideModal, showModal, selectRefDataNewProcessType, selectRefDataNewFacilityType, selectRefDataNewBordereauType, selectRefDataNewBordereauPolicyType, getCaseTeamDetailsSuccess, selectCaseIsCheckSigning, selectUser, selectPremiumProcessingCasesSelected, getCaseRFIDetails, selectcaseRfiSubTabs, getCaseRfiSubTabData } from 'stores';\nimport { useConfirmNavigation } from 'hooks';\nimport * as constants from 'consts';\nimport * as utils from 'utils';\nimport config from 'config';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nvar PremiumProcessingCaseDetails = function PremiumProcessingCaseDetails() {\n  _s();\n\n  var _user$userRole, _user$userRole2;\n\n  var history = useHistory();\n  var dispatch = useDispatch();\n\n  var _useParams = useParams(),\n      id = _useParams.id,\n      tab = _useParams.tab;\n\n  var _useConfirmNavigation = useConfirmNavigation(),\n      confirmNavigation = _useConfirmNavigation.confirmNavigation;\n\n  var user = useSelector(selectUser);\n  var caseDetails = useSelector(selectCaseDetails);\n  var caseRfiDetails = useSelector(selectCaseRfiDetails);\n  var uiBrand = useSelector(function (state) {\n    return get(state, 'ui.brand');\n  });\n  var processTypeRefData = useSelector(selectRefDataNewProcessType) || [];\n  var facilityTypeRefData = useSelector(selectRefDataNewFacilityType) || [];\n  var bordereauTypeRefData = useSelector(selectRefDataNewBordereauType) || [];\n  var bordereauPolicyTypeRefData = useSelector(selectRefDataNewBordereauPolicyType) || [];\n  var isCheckSigning = useSelector(selectCaseIsCheckSigning) || false;\n  var cases = useSelector(selectPremiumProcessingCasesSelected);\n  var rfiSubTabs = useSelector(selectcaseRfiSubTabs);\n  var isHistoryCases = (caseDetails === null || caseDetails === void 0 ? void 0 : caseDetails.taskView) === constants.ALL_CASES;\n  console.log(isHistoryCases, 'isHistoryCases');\n  var isFCE = user === null || user === void 0 ? void 0 : (_user$userRole = user.userRole) === null || _user$userRole === void 0 ? void 0 : _user$userRole.some(function (role) {\n    return (role === null || role === void 0 ? void 0 : role.name) === constants.ROLE_FRONT_END_CONTACT;\n  });\n  var isOperationsLead = user === null || user === void 0 ? void 0 : (_user$userRole2 = user.userRole) === null || _user$userRole2 === void 0 ? void 0 : _user$userRole2.some(function (role) {\n    return (role === null || role === void 0 ? void 0 : role.name) === constants.ROLE_OPERATIONS_LEAD;\n  });\n  var hasDocumentSearchPermission = isFCE || isOperationsLead;\n  var taskId = id || '';\n  var processId = caseDetails.processId,\n      caseId = caseDetails.caseId,\n      caseStageDetails = caseDetails.caseStageDetails;\n  var rfiCaseId = caseRfiDetails === null || caseRfiDetails === void 0 ? void 0 : caseRfiDetails.caseId;\n  var rfiType = (caseRfiDetails === null || caseRfiDetails === void 0 ? void 0 : caseRfiDetails.rfiType) ? true : false;\n  var rfiProcessId = caseRfiDetails === null || caseRfiDetails === void 0 ? void 0 : caseRfiDetails.processId;\n  var isIssueDocumentStage = caseStageDetails === null || caseStageDetails === void 0 ? void 0 : caseStageDetails.some(function (cs) {\n    return [constants.BPM_STAGE_ISSUE_DOCUMENTS].includes(cs.bpmStageCode) && cs.active;\n  });\n  var isCompletedStage = caseStageDetails === null || caseStageDetails === void 0 ? void 0 : caseStageDetails.some(function (cs) {\n    return [constants.BPM_STAGE_COMPLETED].includes(cs.bpmStageCode) && cs.active;\n  });\n  var isRejectedStage = caseStageDetails === null || caseStageDetails === void 0 ? void 0 : caseStageDetails.some(function (cs) {\n    return [constants.BPM_STAGE_REJECTED].includes(cs.bpmStageCode) && cs.active;\n  });\n  var isRfiCase = utils.generic.isValidArray(cases, true) && utils.premiumProcessing.isRfi(cases === null || cases === void 0 ? void 0 : cases[0]);\n  var breadcrumbs = [{\n    name: 'premiumProcessing',\n    label: utils.string.t('premiumProcessing.breadcrumbs.home'),\n    link: config.routes.premiumProcessing.root\n  }].concat(_toConsumableArray(caseId ? [{\n    name: 'caseId',\n    label: utils.string.t('premiumProcessing.breadcrumbs.case', {\n      id: caseId\n    }),\n    link: '#',\n    active: true\n  }] : []));\n  var tabs = [{\n    value: constants.PREMIUM_PROCESSING_TAB_CASE_DETAILS,\n    label: utils.string.t('premiumProcessing.tabs.caseDetails')\n  }, {\n    value: constants.PREMIUM_PROCESSING_TAB_DOCUMENTS,\n    label: utils.string.t('premiumProcessing.tabs.documents')\n  }, {\n    value: constants.PREMIUM_PROCESSING_TAB_RFI,\n    label: utils.string.t('premiumProcessing.tabs.rfi')\n  }].concat(_toConsumableArray(!isCheckSigning ? [{\n    value: constants.PREMIUM_PROCESSING_TAB_ISSUE_DOCUMENTS,\n    label: utils.string.t('premiumProcessing.tabs.issueDocuments'),\n    disabled: !isIssueDocumentStage && !isCompletedStage && !isRejectedStage\n  }] : []), [{\n    value: constants.PREMIUM_PROCESSING_TAB_NOTES,\n    label: utils.string.t('premiumProcessing.tabs.notes')\n  }], _toConsumableArray(isCheckSigning ? [{\n    value: constants.PREMIUM_PROCESSING_TAB_HISTORY,\n    label: utils.string.t('premiumProcessing.tabs.history')\n  }] : []));\n  var isValidTab = tabs.map(function (item) {\n    return item.value;\n  }).includes(tab);\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      isDataLoaded = _useState2[0],\n      setIsDataLoaded = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      isPageDirty = _useState4[0],\n      setIsPageDirty = _useState4[1];\n\n  var _useState5 = useState(isValidTab ? tab : constants.PREMIUM_PROCESSING_TAB_CASE_DETAILS),\n      _useState6 = _slicedToArray(_useState5, 2),\n      selectedTab = _useState6[0],\n      setSelectedTab = _useState6[1];\n\n  var openUpdatingPopup = function openUpdatingPopup() {\n    dispatch(showModal({\n      component: 'CONFIRM',\n      props: {\n        fullWidth: true,\n        title: utils.string.t('premiumProcessing.alert'),\n        maxWidth: 'xs',\n        componentProps: {\n          hideCancelButton: true,\n          confirmLabel: utils.string.t('processingInstructions.authorisations.form.confirm'),\n          confirmMessage: /*#__PURE__*/_jsxDEV(\"span\", {\n            dangerouslySetInnerHTML: {\n              __html: \"\".concat(utils.string.t('premiumProcessing.piHyperLinkErrorMessage'))\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 124,\n            columnNumber: 15\n          }, _this),\n          buttonColors: {\n            confirm: 'secondary'\n          },\n          submitHandler: function submitHandler() {},\n          handleClose: function handleClose() {}\n        }\n      }\n    }));\n  };\n\n  var switchTab = function switchTab(newTab) {\n    setSelectedTab(newTab);\n    setIsPageDirty(false);\n    history.replace(\"\".concat(config.routes.premiumProcessing.case).concat(taskId ? \"/\".concat(taskId) : '').concat(tab ? \"/\".concat(newTab) : ''));\n    dispatch(hideModal());\n  };\n\n  var stayOnTab = function stayOnTab() {\n    dispatch(hideModal());\n  };\n\n  useEffect(function () {\n    dispatch(getCaseRfiSubTabData(caseId));\n  }, [dispatch, caseId]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  var selectTab = function selectTab(tab) {\n    if (isPageDirty) {\n      confirmNavigation(function () {\n        return switchTab(tab);\n      }, stayOnTab);\n    } else {\n      setIsPageDirty(false);\n      setSelectedTab(tab); // history tab in PP rfi to land directly on the particular tab \n\n      if (isHistoryCases && rfiSubTabs.length >= 1) {\n        var _selectedList$;\n\n        var selectedList = rfiSubTabs.filter(function (item) {\n          return item;\n        }, 'taskId');\n        history.replace(\"\".concat(config.routes.premiumProcessing.case).concat(taskId ? \"/\".concat(taskId) : '').concat(tab ? \"/\".concat(tab) : '').concat(tab === constants.PREMIUM_PROCESSING_TAB_RFI ? \"/\".concat((_selectedList$ = selectedList[0]) === null || _selectedList$ === void 0 ? void 0 : _selectedList$.taskId) : tab === constants.PREMIUM_PROCESSING_TAB_ISSUE_DOCUMENTS ? \"/\".concat(constants.PREMIUM_PROCESSING_TAB_NON_BUREAU) : ''));\n      } else {\n        history.replace(\"\".concat(config.routes.premiumProcessing.case).concat(taskId ? \"/\".concat(taskId) : '').concat(tab ? \"/\".concat(tab) : '').concat(tab === constants.PREMIUM_PROCESSING_TAB_RFI ? \"/\".concat(constants.PREMIUM_PROCESSING_TAB_NEW_RFI) : tab === constants.PREMIUM_PROCESSING_TAB_ISSUE_DOCUMENTS ? \"/\".concat(constants.PREMIUM_PROCESSING_TAB_NON_BUREAU) : ''));\n      }\n    }\n  };\n\n  useEffect(function () {\n    if (isRfiCase) {\n      var _cases$;\n\n      dispatch(getCaseRFIDetails({\n        taskId: (_cases$ = cases[0]) === null || _cases$ === void 0 ? void 0 : _cases$.taskId\n      }));\n    }\n\n    if (taskId && !isDataLoaded && !isRfiCase) {\n      dispatch(getCaseTeamDetails({\n        taskId: taskId,\n        taskView: caseDetails.taskView || constants.WORKLIST\n      })).then(function (response) {\n        if ((response === null || response === void 0 ? void 0 : response.message) === constants.API_RESPONSE_SUCCESS) {\n          var _response$status;\n\n          if ((response === null || response === void 0 ? void 0 : (_response$status = response.status) === null || _response$status === void 0 ? void 0 : _response$status.toUpperCase()) === constants.API_RESPONSE_OK) {\n            var _response$data, _response$data$caseDe, _response$data2, _response$data2$caseD, _response$data3, _response$data3$caseD, _response$data4, _response$data4$caseD, _response$data7, _response$data7$caseD;\n\n            response.data.caseDetails.processId = ((_response$data = response.data) === null || _response$data === void 0 ? void 0 : (_response$data$caseDe = _response$data.caseDetails) === null || _response$data$caseDe === void 0 ? void 0 : _response$data$caseDe.processId) && utils.referenceData.processTypes.getNameById(processTypeRefData, (_response$data2 = response.data) === null || _response$data2 === void 0 ? void 0 : (_response$data2$caseD = _response$data2.caseDetails) === null || _response$data2$caseD === void 0 ? void 0 : _response$data2$caseD.processId) || '';\n\n            if (((_response$data3 = response.data) === null || _response$data3 === void 0 ? void 0 : (_response$data3$caseD = _response$data3.caseDetails) === null || _response$data3$caseD === void 0 ? void 0 : _response$data3$caseD.processId) === constants.FDO && ((_response$data4 = response.data) === null || _response$data4 === void 0 ? void 0 : (_response$data4$caseD = _response$data4.caseDetails) === null || _response$data4$caseD === void 0 ? void 0 : _response$data4$caseD.facilityTypeId)) {\n              var _response$data5, _response$data5$caseD, _response$data6, _response$data6$caseD;\n\n              var facilityTypesName = utils.generic.isValidArray(facilityTypeRefData, true) && ((_response$data5 = response.data) === null || _response$data5 === void 0 ? void 0 : (_response$data5$caseD = _response$data5.caseDetails) === null || _response$data5$caseD === void 0 ? void 0 : _response$data5$caseD.facilityTypeId) && utils.referenceData.facilityTypes.getNameById(facilityTypeRefData, (_response$data6 = response.data) === null || _response$data6 === void 0 ? void 0 : (_response$data6$caseD = _response$data6.caseDetails) === null || _response$data6$caseD === void 0 ? void 0 : _response$data6$caseD.facilityTypeId) || '';\n              response.data.caseDetails.facilityTypeId = facilityTypesName;\n            }\n\n            if (((_response$data7 = response.data) === null || _response$data7 === void 0 ? void 0 : (_response$data7$caseD = _response$data7.caseDetails) === null || _response$data7$caseD === void 0 ? void 0 : _response$data7$caseD.processId) === constants.BORDEREAU) {\n              var _response$data8, _response$data8$caseD, _response$data11, _response$data11$case;\n\n              if ((_response$data8 = response.data) === null || _response$data8 === void 0 ? void 0 : (_response$data8$caseD = _response$data8.caseDetails) === null || _response$data8$caseD === void 0 ? void 0 : _response$data8$caseD.bordereauTypeId) {\n                var _response$data9, _response$data9$caseD, _response$data10, _response$data10$case;\n\n                var bordereauTypeName = utils.generic.isValidArray(bordereauTypeRefData, true) && ((_response$data9 = response.data) === null || _response$data9 === void 0 ? void 0 : (_response$data9$caseD = _response$data9.caseDetails) === null || _response$data9$caseD === void 0 ? void 0 : _response$data9$caseD.bordereauTypeId) && utils.referenceData.bordereauTypes.getNameById(bordereauTypeRefData, (_response$data10 = response.data) === null || _response$data10 === void 0 ? void 0 : (_response$data10$case = _response$data10.caseDetails) === null || _response$data10$case === void 0 ? void 0 : _response$data10$case.bordereauTypeId) || '';\n                response.data.caseDetails.bordereauTypeId = bordereauTypeName;\n              }\n\n              if ((_response$data11 = response.data) === null || _response$data11 === void 0 ? void 0 : (_response$data11$case = _response$data11.caseDetails) === null || _response$data11$case === void 0 ? void 0 : _response$data11$case.policyTypeId) {\n                var _response$data12, _response$data12$case, _response$data13, _response$data13$case;\n\n                var bordereauPolicyTypeName = utils.generic.isValidArray(bordereauPolicyTypeRefData, true) && ((_response$data12 = response.data) === null || _response$data12 === void 0 ? void 0 : (_response$data12$case = _response$data12.caseDetails) === null || _response$data12$case === void 0 ? void 0 : _response$data12$case.policyTypeId) && utils.referenceData.bordereauPolicyTypes.getNameById(bordereauPolicyTypeRefData, (_response$data13 = response.data) === null || _response$data13 === void 0 ? void 0 : (_response$data13$case = _response$data13.caseDetails) === null || _response$data13$case === void 0 ? void 0 : _response$data13$case.policyTypeId) || '';\n                response.data.caseDetails.policyTypeId = bordereauPolicyTypeName;\n              }\n            }\n\n            dispatch(getCaseTeamDetailsSuccess(response.data));\n          }\n        }\n      });\n    }\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(function () {\n    var processIdData = processId ? processId : rfiProcessId;\n\n    var getData = function getData() {\n      var promises = [dispatch(getCaseTeamModule({\n        taskId: taskId,\n        rfiCaseId: rfiCaseId,\n        rfiType: rfiType\n      })), dispatch(getCaseHistoryDetails({\n        taskId: taskId,\n        processId: processId\n      })), dispatch(getCheckSigningCaseHistory({\n        processIdData: processIdData\n      }))];\n      return Promise.allSettled(promises).then(function (results) {\n        return Promise.resolve(results);\n      });\n    };\n\n    if (processId || rfiCaseId) {\n      getData().then(function (data) {\n        if (utils.generic.isValidArray(data, true)) {\n          setIsDataLoaded(true);\n        }\n      });\n    }\n  }, [taskId, processId, rfiCaseId, rfiType]); // eslint-disable-line react-hooks/exhaustive-deps\n  // abort\n\n  if (!isDataLoaded) {\n    return null;\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Helmet, {\n      children: /*#__PURE__*/_jsxDEV(\"title\", {\n        children: \"\".concat(utils.string.t('premiumProcessing.title'), \" - \").concat(utils.app.getAppName(uiBrand))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 9\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(PremiumProcessingCaseDetailsView, {\n      hasDocumentSearchPermission: hasDocumentSearchPermission,\n      taskId: taskId,\n      caseId: caseId,\n      caseDetails: caseDetails,\n      breadcrumbs: breadcrumbs,\n      tabs: tabs,\n      selectedTab: selectedTab,\n      isPageDirty: isPageDirty,\n      handlers: {\n        confirmNavigation: confirmNavigation,\n        openUpdatingPopup: openUpdatingPopup,\n        selectTab: selectTab,\n        setIsPageDirty: setIsPageDirty\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true);\n};\n\n_s(PremiumProcessingCaseDetails, \"T/+MeELrvyHpLjKU5l56RiOcLMA=\", false, function () {\n  return [useHistory, useDispatch, useParams, useConfirmNavigation, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector];\n});\n\n_c = PremiumProcessingCaseDetails;\nexport default PremiumProcessingCaseDetails;\n\nvar _c;\n\n$RefreshReg$(_c, \"PremiumProcessingCaseDetails\");","map":{"version":3,"sources":["E:/MPHASIS/claims-page/Mphasis-Edge/src/pages/PremiumProcessingCaseDetails/PremiumProcessingCaseDetails.js"],"names":["React","useEffect","useState","useSelector","useDispatch","useHistory","useParams","Helmet","get","PremiumProcessingCaseDetailsView","getCaseTeamModule","getCheckSigningCaseHistory","getCaseHistoryDetails","getCaseTeamDetails","selectCaseDetails","selectCaseRfiDetails","hideModal","showModal","selectRefDataNewProcessType","selectRefDataNewFacilityType","selectRefDataNewBordereauType","selectRefDataNewBordereauPolicyType","getCaseTeamDetailsSuccess","selectCaseIsCheckSigning","selectUser","selectPremiumProcessingCasesSelected","getCaseRFIDetails","selectcaseRfiSubTabs","getCaseRfiSubTabData","useConfirmNavigation","constants","utils","config","PremiumProcessingCaseDetails","history","dispatch","id","tab","confirmNavigation","user","caseDetails","caseRfiDetails","uiBrand","state","processTypeRefData","facilityTypeRefData","bordereauTypeRefData","bordereauPolicyTypeRefData","isCheckSigning","cases","rfiSubTabs","isHistoryCases","taskView","ALL_CASES","console","log","isFCE","userRole","some","role","name","ROLE_FRONT_END_CONTACT","isOperationsLead","ROLE_OPERATIONS_LEAD","hasDocumentSearchPermission","taskId","processId","caseId","caseStageDetails","rfiCaseId","rfiType","rfiProcessId","isIssueDocumentStage","cs","BPM_STAGE_ISSUE_DOCUMENTS","includes","bpmStageCode","active","isCompletedStage","BPM_STAGE_COMPLETED","isRejectedStage","BPM_STAGE_REJECTED","isRfiCase","generic","isValidArray","premiumProcessing","isRfi","breadcrumbs","label","string","t","link","routes","root","tabs","value","PREMIUM_PROCESSING_TAB_CASE_DETAILS","PREMIUM_PROCESSING_TAB_DOCUMENTS","PREMIUM_PROCESSING_TAB_RFI","PREMIUM_PROCESSING_TAB_ISSUE_DOCUMENTS","disabled","PREMIUM_PROCESSING_TAB_NOTES","PREMIUM_PROCESSING_TAB_HISTORY","isValidTab","map","item","isDataLoaded","setIsDataLoaded","isPageDirty","setIsPageDirty","selectedTab","setSelectedTab","openUpdatingPopup","component","props","fullWidth","title","maxWidth","componentProps","hideCancelButton","confirmLabel","confirmMessage","__html","buttonColors","confirm","submitHandler","handleClose","switchTab","newTab","replace","case","stayOnTab","selectTab","length","selectedList","filter","PREMIUM_PROCESSING_TAB_NON_BUREAU","PREMIUM_PROCESSING_TAB_NEW_RFI","WORKLIST","then","response","message","API_RESPONSE_SUCCESS","status","toUpperCase","API_RESPONSE_OK","data","referenceData","processTypes","getNameById","FDO","facilityTypeId","facilityTypesName","facilityTypes","BORDEREAU","bordereauTypeId","bordereauTypeName","bordereauTypes","policyTypeId","bordereauPolicyTypeName","bordereauPolicyTypes","processIdData","getData","promises","Promise","allSettled","results","resolve","app","getAppName"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { useHistory, useParams } from 'react-router';\r\nimport { Helmet } from 'react-helmet';\r\nimport get from 'lodash/get';\r\n\r\n// app\r\nimport { PremiumProcessingCaseDetailsView } from './PremiumProcessingCaseDetails.view';\r\nimport {\r\n  getCaseTeamModule,\r\n  getCheckSigningCaseHistory,\r\n  getCaseHistoryDetails,\r\n  getCaseTeamDetails,\r\n  selectCaseDetails,\r\n  selectCaseRfiDetails,\r\n  hideModal,\r\n  showModal,\r\n  selectRefDataNewProcessType,\r\n  selectRefDataNewFacilityType,\r\n  selectRefDataNewBordereauType,\r\n  selectRefDataNewBordereauPolicyType,\r\n  getCaseTeamDetailsSuccess,\r\n  selectCaseIsCheckSigning,\r\n  selectUser,\r\n  selectPremiumProcessingCasesSelected,\r\n  getCaseRFIDetails,\r\n  selectcaseRfiSubTabs,\r\n  getCaseRfiSubTabData\r\n} from 'stores';\r\nimport { useConfirmNavigation } from 'hooks';\r\nimport * as constants from 'consts';\r\nimport * as utils from 'utils';\r\nimport config from 'config';\r\n\r\nconst PremiumProcessingCaseDetails = () => {\r\n  const history = useHistory();\r\n  const dispatch = useDispatch();\r\n  const { id, tab } = useParams();\r\n  const { confirmNavigation } = useConfirmNavigation();\r\n\r\n  const user = useSelector(selectUser);\r\n  const caseDetails = useSelector(selectCaseDetails);\r\n  const caseRfiDetails = useSelector(selectCaseRfiDetails);\r\n  const uiBrand = useSelector((state) => get(state, 'ui.brand'));\r\n  const processTypeRefData = useSelector(selectRefDataNewProcessType) || [];\r\n  const facilityTypeRefData = useSelector(selectRefDataNewFacilityType) || [];\r\n  const bordereauTypeRefData = useSelector(selectRefDataNewBordereauType) || [];\r\n  const bordereauPolicyTypeRefData = useSelector(selectRefDataNewBordereauPolicyType) || [];\r\n  const isCheckSigning = useSelector(selectCaseIsCheckSigning) || false;\r\n  const cases = useSelector(selectPremiumProcessingCasesSelected);\r\n  const rfiSubTabs = useSelector(selectcaseRfiSubTabs);\r\n  const isHistoryCases = caseDetails?.taskView === constants.ALL_CASES;\r\n  console.log(isHistoryCases, 'isHistoryCases');\r\n\r\n  const isFCE = user?.userRole?.some((role) => role?.name === constants.ROLE_FRONT_END_CONTACT);\r\n  const isOperationsLead = user?.userRole?.some((role) => role?.name === constants.ROLE_OPERATIONS_LEAD);\r\n  const hasDocumentSearchPermission = isFCE || isOperationsLead;\r\n\r\n  const taskId = id || '';\r\n  const { processId, caseId, caseStageDetails } = caseDetails;\r\n  const rfiCaseId = caseRfiDetails?.caseId;\r\n  const rfiType = caseRfiDetails?.rfiType ? true : false;\r\n  const rfiProcessId = caseRfiDetails?.processId;\r\n  const isIssueDocumentStage = caseStageDetails?.some((cs) => [constants.BPM_STAGE_ISSUE_DOCUMENTS].includes(cs.bpmStageCode) && cs.active);\r\n  const isCompletedStage = caseStageDetails?.some((cs) => [constants.BPM_STAGE_COMPLETED].includes(cs.bpmStageCode) && cs.active);\r\n  const isRejectedStage = caseStageDetails?.some((cs) => [constants.BPM_STAGE_REJECTED].includes(cs.bpmStageCode) && cs.active);\r\n  const isRfiCase = utils.generic.isValidArray(cases, true) && utils.premiumProcessing.isRfi(cases?.[0]);\r\n\r\n  const breadcrumbs = [\r\n    {\r\n      name: 'premiumProcessing',\r\n      label: utils.string.t('premiumProcessing.breadcrumbs.home'),\r\n      link: config.routes.premiumProcessing.root,\r\n    },\r\n    ...(caseId\r\n      ? [\r\n        {\r\n          name: 'caseId',\r\n          label: utils.string.t('premiumProcessing.breadcrumbs.case', { id: caseId }),\r\n          link: '#',\r\n          active: true,\r\n        },\r\n      ]\r\n      : []),\r\n  ];\r\n\r\n  const tabs = [\r\n    { value: constants.PREMIUM_PROCESSING_TAB_CASE_DETAILS, label: utils.string.t('premiumProcessing.tabs.caseDetails') },\r\n    { value: constants.PREMIUM_PROCESSING_TAB_DOCUMENTS, label: utils.string.t('premiumProcessing.tabs.documents') },\r\n    { value: constants.PREMIUM_PROCESSING_TAB_RFI, label: utils.string.t('premiumProcessing.tabs.rfi') },\r\n    ...(!isCheckSigning\r\n      ? [\r\n        {\r\n          value: constants.PREMIUM_PROCESSING_TAB_ISSUE_DOCUMENTS,\r\n          label: utils.string.t('premiumProcessing.tabs.issueDocuments'),\r\n          disabled: !isIssueDocumentStage && !isCompletedStage && !isRejectedStage,\r\n        },\r\n      ]\r\n      : []),\r\n    { value: constants.PREMIUM_PROCESSING_TAB_NOTES, label: utils.string.t('premiumProcessing.tabs.notes') },\r\n    ...(isCheckSigning\r\n      ? [{ value: constants.PREMIUM_PROCESSING_TAB_HISTORY, label: utils.string.t('premiumProcessing.tabs.history') }]\r\n      : []),\r\n  ];\r\n\r\n  const isValidTab = tabs.map((item) => item.value).includes(tab);\r\n\r\n  const [isDataLoaded, setIsDataLoaded] = useState(false);\r\n  const [isPageDirty, setIsPageDirty] = useState(false);\r\n  const [selectedTab, setSelectedTab] = useState(isValidTab ? tab : constants.PREMIUM_PROCESSING_TAB_CASE_DETAILS);\r\n\r\n  const openUpdatingPopup = () => {\r\n    dispatch(\r\n      showModal({\r\n        component: 'CONFIRM',\r\n        props: {\r\n          fullWidth: true,\r\n          title: utils.string.t('premiumProcessing.alert'),\r\n          maxWidth: 'xs',\r\n          componentProps: {\r\n            hideCancelButton: true,\r\n            confirmLabel: utils.string.t('processingInstructions.authorisations.form.confirm'),\r\n            confirmMessage: (\r\n              <span\r\n                dangerouslySetInnerHTML={{\r\n                  __html: `${utils.string.t('premiumProcessing.piHyperLinkErrorMessage')}`,\r\n                }}\r\n              />\r\n            ),\r\n            buttonColors: { confirm: 'secondary' },\r\n            submitHandler: () => { },\r\n            handleClose: () => { },\r\n          },\r\n        },\r\n      })\r\n    );\r\n  };\r\n\r\n  const switchTab = (newTab) => {\r\n    setSelectedTab(newTab);\r\n    setIsPageDirty(false);\r\n    history.replace(`${config.routes.premiumProcessing.case}${taskId ? `/${taskId}` : ''}${tab ? `/${newTab}` : ''}`);\r\n    dispatch(hideModal());\r\n  };\r\n\r\n  const stayOnTab = () => {\r\n    dispatch(hideModal());\r\n  };\r\n\r\n  useEffect(() => {\r\n    dispatch(getCaseRfiSubTabData(caseId));\r\n  }, [dispatch, caseId]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  const selectTab = (tab) => {\r\n    if (isPageDirty) {\r\n      confirmNavigation(() => switchTab(tab), stayOnTab);\r\n    } else {\r\n      setIsPageDirty(false);\r\n      setSelectedTab(tab);\r\n\r\n      // history tab in PP rfi to land directly on the particular tab \r\n      if (isHistoryCases && rfiSubTabs.length >= 1) {\r\n        const selectedList = rfiSubTabs.filter((item) => item, 'taskId');\r\n        history.replace(\r\n          `${config.routes.premiumProcessing.case}${taskId ? `/${taskId}` : ''}${tab ? `/${tab}` : ''}${tab === constants.PREMIUM_PROCESSING_TAB_RFI\r\n            ? `/${selectedList[0]?.taskId}`\r\n            : tab === constants.PREMIUM_PROCESSING_TAB_ISSUE_DOCUMENTS\r\n              ? `/${constants.PREMIUM_PROCESSING_TAB_NON_BUREAU}`\r\n              : ''\r\n          }`\r\n        );\r\n      }\r\n      else {\r\n        history.replace(\r\n          `${config.routes.premiumProcessing.case}${taskId ? `/${taskId}` : ''}${tab ? `/${tab}` : ''}${tab === constants.PREMIUM_PROCESSING_TAB_RFI\r\n            ? `/${constants.PREMIUM_PROCESSING_TAB_NEW_RFI}`\r\n            : tab === constants.PREMIUM_PROCESSING_TAB_ISSUE_DOCUMENTS\r\n              ? `/${constants.PREMIUM_PROCESSING_TAB_NON_BUREAU}`\r\n              : ''\r\n          }`\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isRfiCase) {\r\n      dispatch(getCaseRFIDetails({ taskId: cases[0]?.taskId }));\r\n    }\r\n    if (taskId && !isDataLoaded && !isRfiCase) {\r\n      dispatch(getCaseTeamDetails({ taskId, taskView: caseDetails.taskView || constants.WORKLIST })).then((response) => {\r\n        if (response?.message === constants.API_RESPONSE_SUCCESS) {\r\n          if (response?.status?.toUpperCase() === constants.API_RESPONSE_OK) {\r\n            response.data.caseDetails.processId =\r\n              (response.data?.caseDetails?.processId &&\r\n                utils.referenceData.processTypes.getNameById(processTypeRefData, response.data?.caseDetails?.processId)) ||\r\n              '';\r\n            if (response.data?.caseDetails?.processId === constants.FDO && response.data?.caseDetails?.facilityTypeId) {\r\n              const facilityTypesName =\r\n                (utils.generic.isValidArray(facilityTypeRefData, true) &&\r\n                  response.data?.caseDetails?.facilityTypeId &&\r\n                  utils.referenceData.facilityTypes.getNameById(facilityTypeRefData, response.data?.caseDetails?.facilityTypeId)) ||\r\n                '';\r\n              response.data.caseDetails.facilityTypeId = facilityTypesName;\r\n            }\r\n            if (response.data?.caseDetails?.processId === constants.BORDEREAU) {\r\n              if (response.data?.caseDetails?.bordereauTypeId) {\r\n                const bordereauTypeName =\r\n                  (utils.generic.isValidArray(bordereauTypeRefData, true) &&\r\n                    response.data?.caseDetails?.bordereauTypeId &&\r\n                    utils.referenceData.bordereauTypes.getNameById(bordereauTypeRefData, response.data?.caseDetails?.bordereauTypeId)) ||\r\n                  '';\r\n                response.data.caseDetails.bordereauTypeId = bordereauTypeName;\r\n              }\r\n              if (response.data?.caseDetails?.policyTypeId) {\r\n                const bordereauPolicyTypeName =\r\n                  (utils.generic.isValidArray(bordereauPolicyTypeRefData, true) &&\r\n                    response.data?.caseDetails?.policyTypeId &&\r\n                    utils.referenceData.bordereauPolicyTypes.getNameById(\r\n                      bordereauPolicyTypeRefData,\r\n                      response.data?.caseDetails?.policyTypeId\r\n                    )) ||\r\n                  '';\r\n                response.data.caseDetails.policyTypeId = bordereauPolicyTypeName;\r\n              }\r\n            }\r\n            dispatch(getCaseTeamDetailsSuccess(response.data));\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    const processIdData = processId ? processId : rfiProcessId\r\n    const getData = () => {\r\n      const promises = [\r\n        dispatch(getCaseTeamModule({ taskId, rfiCaseId, rfiType })),\r\n        dispatch(getCaseHistoryDetails({ taskId, processId })),\r\n        dispatch(getCheckSigningCaseHistory({ processIdData })),\r\n      ];\r\n      return Promise.allSettled(promises).then((results) => Promise.resolve(results));\r\n    };\r\n\r\n    if (processId || rfiCaseId) {\r\n      getData().then((data) => {\r\n        if (utils.generic.isValidArray(data, true)) {\r\n          setIsDataLoaded(true);\r\n        }\r\n      });\r\n    }\r\n  }, [taskId, processId, rfiCaseId, rfiType]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  // abort\r\n  if (!isDataLoaded) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Helmet>\r\n        <title>{`${utils.string.t('premiumProcessing.title')} - ${utils.app.getAppName(uiBrand)}`}</title>\r\n      </Helmet>\r\n      <PremiumProcessingCaseDetailsView\r\n        hasDocumentSearchPermission={hasDocumentSearchPermission}\r\n        taskId={taskId}\r\n        caseId={caseId}\r\n        caseDetails={caseDetails}\r\n        breadcrumbs={breadcrumbs}\r\n        tabs={tabs}\r\n        selectedTab={selectedTab}\r\n        isPageDirty={isPageDirty}\r\n        handlers={{ confirmNavigation, openUpdatingPopup, selectTab, setIsPageDirty }}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default PremiumProcessingCaseDetails;\r\n"]},"metadata":{},"sourceType":"module"}