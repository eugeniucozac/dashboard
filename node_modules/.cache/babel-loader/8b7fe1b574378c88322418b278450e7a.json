{"ast":null,"code":"import _toConsumableArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"E:\\\\MPHASIS\\\\claims-page\\\\Mphasis-Edge\\\\src\\\\forms\\\\ChangeComplexityPriorityAssignment\\\\ChangeComplexityPriorityAssignment.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport * as Yup from 'yup';\nimport { useForm } from 'react-hook-form';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport uniq from 'lodash/uniq'; // app\n\nimport { ChangeComplexityPriorityAssignmentView } from './ChangeComplexityPriorityAssignment.view';\nimport { Loader } from 'components';\nimport { getClaimsBasicInformation, getComplexityTypes, getComplexityValues, getPriorityLevels, getUsersByOrg, resetComplexityBasisValues, selectClaimsAssignedToUsers, selectComplexityTypes, selectComplexityTypesLoaded, selectComplexityValues, selectComplexityValuesLoaded, selectPriorities, selectPrioritiesLoaded, selectUserOrganisation, selectClaimsInformation, hideModal, showModal, enqueueNotification, updateClaim } from 'stores';\nimport { useFormActions } from 'hooks';\nimport * as constants from 'consts';\nimport * as utils from 'utils'; // mui\n\nimport { Box } from '@material-ui/core';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nChangeComplexityPriorityAssignment.propTypes = {\n  claims: PropTypes.array.isRequired,\n  setIsDirty: PropTypes.func,\n  handleClose: PropTypes.func.isRequired\n};\nexport default function ChangeComplexityPriorityAssignment(_ref) {\n  _s();\n\n  var _getComplexity, _getPriority, _getPriority2, _getTeam, _getTeam2;\n\n  var claims = _ref.claims,\n      setIsDirty = _ref.setIsDirty,\n      handleClose = _ref.handleClose;\n  var dispatch = useDispatch();\n  var userOrganisation = useSelector(selectUserOrganisation);\n  var complexitiesBasisValues = useSelector(selectComplexityValues) || [];\n  var complexitiesBasisValuesLoaded = useSelector(selectComplexityValuesLoaded);\n  var complexityTypes = useSelector(selectComplexityTypes) || [];\n  var complexityTypesLoaded = useSelector(selectComplexityTypesLoaded);\n  var assignToUsersObj = useSelector(selectClaimsAssignedToUsers);\n  var priorities = useSelector(selectPriorities);\n  var prioritiesLoaded = useSelector(selectPrioritiesLoaded);\n  var singleClaimDetails = useSelector(selectClaimsInformation);\n  var teams = Object.values(constants.ORGANIZATIONS) || [];\n  var assignToUsersItems = (assignToUsersObj === null || assignToUsersObj === void 0 ? void 0 : assignToUsersObj.items) || [];\n  var assignToUsersLoaded = assignToUsersObj === null || assignToUsersObj === void 0 ? void 0 : assignToUsersObj.loaded;\n  var isAllClaimsComplexityUnsure = claims.every(function (claim) {\n    return claim.complexity === constants.CLAIM_COMPLEXITY_UNSURE;\n  });\n  var isSingleClaim = (claims === null || claims === void 0 ? void 0 : claims.length) === 1;\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      isCrossTeamAssignTo = _useState2[0],\n      setCrossTeamAssignTo = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      isComplexityBasisAvailable = _useState4[0],\n      setIsComplexityBasisAvailable = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isLoading = _useState6[0],\n      setIsLoading = _useState6[1];\n\n  var _useState7 = useState(!isSingleClaim),\n      _useState8 = _slicedToArray(_useState7, 2),\n      isBasicDetailLoaded = _useState8[0],\n      setIsBasicDetailLoaded = _useState8[1];\n\n  var singleClaim = _objectSpread(_objectSpread({}, claims === null || claims === void 0 ? void 0 : claims[0]), {}, {\n    complexityValueID: singleClaimDetails === null || singleClaimDetails === void 0 ? void 0 : singleClaimDetails.complexityValueID,\n    complexityBasis: singleClaimDetails === null || singleClaimDetails === void 0 ? void 0 : singleClaimDetails.complexityBasis\n  });\n\n  var getAssignedUser = function getAssignedUser() {\n    return assignToUsersItems.find(function (user) {\n      return claims.every(function (claim) {\n        return user.fullName === (claim === null || claim === void 0 ? void 0 : claim.assignedTo);\n      });\n    }) || null;\n  };\n\n  var getComplexity = function getComplexity() {\n    return complexityTypes.find(function (type) {\n      return claims.every(function (claim) {\n        return type.complextityType === (claim === null || claim === void 0 ? void 0 : claim.complexity);\n      });\n    }) || null;\n  };\n\n  var getComplexityBasis = function getComplexityBasis() {\n    if (isSingleClaim) {\n      return (complexitiesBasisValues === null || complexitiesBasisValues === void 0 ? void 0 : complexitiesBasisValues.find(function (_ref2) {\n        var complexityRulesID = _ref2.complexityRulesID;\n        return complexityRulesID === singleClaim.complexityValueID;\n      })) || null;\n    } else {\n      return null;\n    }\n  };\n\n  var getPriority = function getPriority() {\n    return (priorities === null || priorities === void 0 ? void 0 : priorities.find(function (priority) {\n      return claims.every(function (claim) {\n        return (priority === null || priority === void 0 ? void 0 : priority.description) === (claim === null || claim === void 0 ? void 0 : claim.priority);\n      });\n    })) || null;\n  };\n\n  var getTeam = function getTeam() {\n    return teams.find(function (team) {\n      return claims.every(function (claim) {\n        return team.label === (claim === null || claim === void 0 ? void 0 : claim.team);\n      });\n    }) || null;\n  };\n\n  var getTeamBy = function getTeamBy(prop, label) {\n    return (teams === null || teams === void 0 ? void 0 : teams.find(function (team) {\n      return team[prop] === label;\n    })) || null;\n  };\n\n  var isRequired = !isCrossTeamAssignTo;\n  var fields = [{\n    name: 'complexity',\n    type: 'select',\n    label: \"\".concat(utils.string.t('claims.processing.bulkAssign.fields.complexityType.label'), \" *\"),\n    value: ((_getComplexity = getComplexity()) === null || _getComplexity === void 0 ? void 0 : _getComplexity.complextityType) || '',\n    options: isAllClaimsComplexityUnsure ? complexityTypes : complexityTypes.filter(function (item) {\n      return item.complextityType !== constants.CLAIM_COMPLEXITY_UNSURE;\n    }),\n    optionKey: 'complextityType',\n    optionLabel: 'complextityType',\n    validation: Yup.string().required(utils.string.t('validation.required')),\n    handleUpdate: function handleUpdate(name, value) {\n      var _getTeamBy;\n\n      var complexityObj = complexityTypes.find(function (c) {\n        return c.complextityType === value;\n      });\n      setValue('team', ((_getTeamBy = getTeamBy('label', complexityObj === null || complexityObj === void 0 ? void 0 : complexityObj.organizationName)) === null || _getTeamBy === void 0 ? void 0 : _getTeamBy.label) || '');\n      setValue('assignTo', null);\n      setIsComplexityBasisAvailable((complexityObj === null || complexityObj === void 0 ? void 0 : complexityObj.complextityType) === constants.ORGANIZATIONS.ardonagh.complexity);\n      setCrossTeamAssignTo((complexityObj === null || complexityObj === void 0 ? void 0 : complexityObj.organizationName) !== (userOrganisation === null || userOrganisation === void 0 ? void 0 : userOrganisation.name));\n    }\n  }, {\n    name: 'complexityBasis',\n    type: 'autocompletemui',\n    label: \"\".concat(utils.string.t('claims.processing.bulkAssign.fields.complexity.label'), \" *\"),\n    value: getComplexityBasis(),\n    options: complexitiesBasisValues,\n    optionKey: 'complexityRulesID',\n    optionLabel: 'complexityRulesValue',\n    validation: isComplexityBasisAvailable && Yup.object().nullable().required(utils.string.t('validation.required'))\n  }, {\n    name: 'priority',\n    type: 'select',\n    label: \"\".concat(utils.string.t('claims.processing.bulkAssign.fields.priority.label'), \" *\"),\n    value: ((_getPriority = getPriority()) === null || _getPriority === void 0 ? void 0 : _getPriority.description) || '',\n    options: priorities,\n    optionKey: 'description',\n    optionLabel: 'description',\n    validation: Yup.string().required(utils.string.t('validation.required'))\n  }, {\n    name: 'priorityId',\n    type: 'hidden',\n    value: ((_getPriority2 = getPriority()) === null || _getPriority2 === void 0 ? void 0 : _getPriority2.id) || ''\n  }, {\n    name: 'team',\n    type: 'select',\n    label: \"\".concat(utils.string.t('claims.processing.bulkAssign.fields.team.label'), \" *\"),\n    value: ((_getTeam = getTeam()) === null || _getTeam === void 0 ? void 0 : _getTeam.label) || '',\n    options: [_objectSpread({}, constants.ORGANIZATIONS.mphasis), _objectSpread({}, constants.ORGANIZATIONS.ardonagh)],\n    optionKey: 'label',\n    optionLabel: 'label',\n    validation: Yup.string().required(utils.string.t('validation.required')),\n    handleUpdate: function handleUpdate(name, value) {\n      var teamObj = getTeamBy('label', value);\n      setCrossTeamAssignTo((teamObj === null || teamObj === void 0 ? void 0 : teamObj.label) !== (userOrganisation === null || userOrganisation === void 0 ? void 0 : userOrganisation.name));\n    }\n  }, {\n    name: 'teamId',\n    type: 'hidden',\n    value: ((_getTeam2 = getTeam()) === null || _getTeam2 === void 0 ? void 0 : _getTeam2.id) || ''\n  }, {\n    name: 'assignTo',\n    type: 'autocompletemui',\n    label: \"\".concat(utils.string.t('claims.processing.bulkAssign.fields.assignTo.label')).concat(isRequired ? ' *' : ''),\n    value: getAssignedUser(),\n    options: assignToUsersItems,\n    optionKey: 'id',\n    optionLabel: 'fullName',\n    validation: !isCrossTeamAssignTo && Yup.object().nullable().required(utils.string.t('claims.processing.bulkAssign.validation.chooseAssignee'))\n  }, {\n    name: 'notes',\n    type: 'textarea',\n    label: \"\".concat(utils.string.t('claims.processing.bulkAssign.fields.notes.label')).concat(isRequired ? ' *' : ''),\n    value: '',\n    muiComponentProps: {\n      multiline: true,\n      minRows: 3,\n      maxRows: 6\n    },\n    validation: !isCrossTeamAssignTo && Yup.string().min(1, utils.string.t('validation.required')).max(1000, utils.string.t('validation.string.max')).required(utils.string.t('validation.required'))\n  }];\n  var defaultValues = utils.form.getInitialValues(fields);\n  var validationSchema = utils.form.getValidationSchema(fields);\n\n  var _useForm = useForm(_objectSpread({\n    defaultValues: defaultValues\n  }, validationSchema && {\n    resolver: yupResolver(validationSchema)\n  })),\n      control = _useForm.control,\n      watch = _useForm.watch,\n      errors = _useForm.errors,\n      setValue = _useForm.setValue,\n      handleSubmit = _useForm.handleSubmit,\n      formState = _useForm.formState;\n\n  var formValues = watch();\n  var formIsDirty = formState.isDirty;\n  var actions = [{\n    name: 'cancel',\n    label: utils.string.t('app.cancel'),\n    handler: function handler() {\n      if (formIsDirty) {\n        dispatch(showModal({\n          component: 'CONFIRM',\n          props: {\n            title: utils.string.t('navigation.form.subtitle'),\n            hint: utils.string.t('navigation.form.title'),\n            fullWidth: true,\n            maxWidth: 'xs',\n            componentProps: {\n              cancelLabel: utils.string.t('app.no'),\n              confirmLabel: utils.string.t('app.yes'),\n              submitHandler: function submitHandler() {\n                handleClose();\n              }\n            }\n          }\n        }));\n      } else {\n        handleClose();\n      }\n    }\n  }, {\n    name: 'submit',\n    label: utils.string.t('app.assign'),\n    handler: function handler(values) {\n      onSubmit(values);\n    }\n  }];\n\n  var _useFormActions = useFormActions(actions),\n      cancel = _useFormActions.cancel,\n      submit = _useFormActions.submit;\n\n  var isDataReady = function isDataReady() {\n    return isBasicDetailLoaded && prioritiesLoaded && utils.generic.isValidArray(priorities, true) && assignToUsersLoaded && utils.generic.isValidArray(assignToUsersItems, true) && complexityTypesLoaded && utils.generic.isValidArray(complexityTypes, true) && complexitiesBasisValuesLoaded && utils.generic.isValidArray(complexitiesBasisValues, true);\n  };\n\n  var isDataMissing = function isDataMissing() {\n    var allDataLoaded = prioritiesLoaded && assignToUsersLoaded && complexityTypesLoaded && complexitiesBasisValuesLoaded;\n    var missingPriorities = prioritiesLoaded && utils.generic.isInvalidOrEmptyArray(priorities);\n    var missingUsers = assignToUsersLoaded && utils.generic.isInvalidOrEmptyArray(assignToUsersItems);\n    var missingComplexities = complexityTypesLoaded && utils.generic.isInvalidOrEmptyArray(complexityTypes);\n    var missingComplexitiesBasis = complexitiesBasisValuesLoaded && utils.generic.isInvalidOrEmptyArray(complexitiesBasisValues);\n    return allDataLoaded && (missingPriorities || missingUsers || missingComplexities || missingComplexitiesBasis);\n  };\n\n  var dataReady = isDataReady();\n  var dataMissing = isDataMissing();\n\n  var setComplexityBasisAvailability = function setComplexityBasisAvailability() {\n    var _getComplexity2;\n\n    setIsComplexityBasisAvailable(((_getComplexity2 = getComplexity()) === null || _getComplexity2 === void 0 ? void 0 : _getComplexity2.complextityType) === constants.ORGANIZATIONS.ardonagh.complexity);\n  };\n\n  var onSubmit = function onSubmit(values) {\n    dispatch(updateClaim(claims, values));\n  };\n\n  useEffect(function () {\n    dispatch(getPriorityLevels());\n    dispatch(getComplexityTypes());\n    dispatch(resetComplexityBasisValues());\n\n    if (isSingleClaim) {\n      dispatch(getClaimsBasicInformation(singleClaim.claimId, singleClaim.claimReference, singleClaim.sourceId, singleClaim.divisionId)).then(function () {\n        setIsBasicDetailLoaded(true);\n      });\n      dispatch(getComplexityValues(singleClaim.divisionId, singleClaim.sourceId, false));\n    } else {\n      dispatch(getComplexityValues(null, null, false, uniq(claims.reduce(function (acc, _ref3) {\n        var sourceId = _ref3.sourceId,\n            divisionId = _ref3.divisionId;\n        return sourceId && divisionId ? [].concat(_toConsumableArray(acc), [\"\".concat(sourceId, \"-\").concat(divisionId)]) : acc;\n      }, []))));\n    }\n\n    setComplexityBasisAvailability();\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n  // fetch list of users when team is changed\n\n  useEffect(function () {\n    var teamName = formValues === null || formValues === void 0 ? void 0 : formValues.team;\n\n    if (teamName) {\n      setIsLoading(true);\n      setValue('assignTo', null); // fetch users\n\n      dispatch(getUsersByOrg(teamName, claims, 'bulkAssignClaims', false)).then(function () {\n        setIsLoading(false);\n      });\n    }\n  }, [formValues === null || formValues === void 0 ? void 0 : formValues.team]); // eslint-disable-line react-hooks/exhaustive-deps\n  // make the form dirty if any values are changed\n\n  useEffect(function () {\n    setIsDirty(formIsDirty);\n  }, [formValues]); // eslint-disable-line react-hooks/exhaustive-deps\n  // populate form values when all data is ready\n\n  useEffect(function () {\n    var complexity = getComplexity();\n\n    if (dataReady) {\n      var _getPriority3;\n\n      setComplexityBasisAvailability();\n      setValue('assignTo', getAssignedUser());\n      setValue('complexity', (complexity === null || complexity === void 0 ? void 0 : complexity.complextityType) || '');\n      setValue('complexityBasis', getComplexityBasis());\n      setValue('priority', ((_getPriority3 = getPriority()) === null || _getPriority3 === void 0 ? void 0 : _getPriority3.description) || '');\n      setCrossTeamAssignTo((complexity === null || complexity === void 0 ? void 0 : complexity.organizationName) !== (userOrganisation === null || userOrganisation === void 0 ? void 0 : userOrganisation.name));\n    }\n  }, [dataReady]); // eslint-disable-line react-hooks/exhaustive-deps\n  // hide modal and show warning if necessary data is missing\n\n  useEffect(function () {\n    if (dataMissing) {\n      dispatch(hideModal());\n      dispatch(enqueueNotification(utils.string.t('claims.processing.bulkAssign.notifications.data.failure'), 'warning'));\n    }\n  }, [dataMissing]); // eslint-disable-line react-hooks/exhaustive-deps\n  // data is still loading...\n\n  if (!dataReady) {\n    return /*#__PURE__*/_jsxDEV(Box, {\n      height: \"300px\",\n      children: /*#__PURE__*/_jsxDEV(Loader, {\n        visible: true,\n        absolute: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 382,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 381,\n      columnNumber: 7\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(ChangeComplexityPriorityAssignmentView, {\n    fields: fields,\n    buttons: {\n      cancel: cancel,\n      submit: submit\n    },\n    formProps: {\n      control: control,\n      errors: errors,\n      handleSubmit: handleSubmit,\n      formState: formState\n    },\n    isComplexityBasisAvailable: isComplexityBasisAvailable,\n    isLoading: isLoading\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 388,\n    columnNumber: 5\n  }, this);\n}\n\n_s(ChangeComplexityPriorityAssignment, \"wiAWRctS/TyTFAgGY5JcDWo+noY=\", false, function () {\n  return [useDispatch, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useForm, useFormActions];\n});\n\n_c = ChangeComplexityPriorityAssignment;\n\nvar _c;\n\n$RefreshReg$(_c, \"ChangeComplexityPriorityAssignment\");","map":{"version":3,"sources":["E:/MPHASIS/claims-page/Mphasis-Edge/src/forms/ChangeComplexityPriorityAssignment/ChangeComplexityPriorityAssignment.js"],"names":["React","useEffect","useState","useDispatch","useSelector","PropTypes","Yup","useForm","yupResolver","uniq","ChangeComplexityPriorityAssignmentView","Loader","getClaimsBasicInformation","getComplexityTypes","getComplexityValues","getPriorityLevels","getUsersByOrg","resetComplexityBasisValues","selectClaimsAssignedToUsers","selectComplexityTypes","selectComplexityTypesLoaded","selectComplexityValues","selectComplexityValuesLoaded","selectPriorities","selectPrioritiesLoaded","selectUserOrganisation","selectClaimsInformation","hideModal","showModal","enqueueNotification","updateClaim","useFormActions","constants","utils","Box","ChangeComplexityPriorityAssignment","propTypes","claims","array","isRequired","setIsDirty","func","handleClose","dispatch","userOrganisation","complexitiesBasisValues","complexitiesBasisValuesLoaded","complexityTypes","complexityTypesLoaded","assignToUsersObj","priorities","prioritiesLoaded","singleClaimDetails","teams","Object","values","ORGANIZATIONS","assignToUsersItems","items","assignToUsersLoaded","loaded","isAllClaimsComplexityUnsure","every","claim","complexity","CLAIM_COMPLEXITY_UNSURE","isSingleClaim","length","isCrossTeamAssignTo","setCrossTeamAssignTo","isComplexityBasisAvailable","setIsComplexityBasisAvailable","isLoading","setIsLoading","isBasicDetailLoaded","setIsBasicDetailLoaded","singleClaim","complexityValueID","complexityBasis","getAssignedUser","find","user","fullName","assignedTo","getComplexity","type","complextityType","getComplexityBasis","complexityRulesID","getPriority","priority","description","getTeam","team","label","getTeamBy","prop","fields","name","string","t","value","options","filter","item","optionKey","optionLabel","validation","required","handleUpdate","complexityObj","c","setValue","organizationName","ardonagh","object","nullable","id","mphasis","teamObj","muiComponentProps","multiline","minRows","maxRows","min","max","defaultValues","form","getInitialValues","validationSchema","getValidationSchema","resolver","control","watch","errors","handleSubmit","formState","formValues","formIsDirty","isDirty","actions","handler","component","props","title","hint","fullWidth","maxWidth","componentProps","cancelLabel","confirmLabel","submitHandler","onSubmit","cancel","submit","isDataReady","generic","isValidArray","isDataMissing","allDataLoaded","missingPriorities","isInvalidOrEmptyArray","missingUsers","missingComplexities","missingComplexitiesBasis","dataReady","dataMissing","setComplexityBasisAvailability","claimId","claimReference","sourceId","divisionId","then","reduce","acc","teamName"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport PropTypes from 'prop-types';\r\nimport * as Yup from 'yup';\r\nimport { useForm } from 'react-hook-form';\r\nimport { yupResolver } from '@hookform/resolvers/yup';\r\nimport uniq from 'lodash/uniq';\r\n\r\n// app\r\nimport { ChangeComplexityPriorityAssignmentView } from './ChangeComplexityPriorityAssignment.view';\r\nimport { Loader } from 'components';\r\nimport {\r\n  getClaimsBasicInformation,\r\n  getComplexityTypes,\r\n  getComplexityValues,\r\n  getPriorityLevels,\r\n  getUsersByOrg,\r\n  resetComplexityBasisValues,\r\n  selectClaimsAssignedToUsers,\r\n  selectComplexityTypes,\r\n  selectComplexityTypesLoaded,\r\n  selectComplexityValues,\r\n  selectComplexityValuesLoaded,\r\n  selectPriorities,\r\n  selectPrioritiesLoaded,\r\n  selectUserOrganisation,\r\n  selectClaimsInformation,\r\n  hideModal,\r\n  showModal,\r\n  enqueueNotification,\r\n  updateClaim,\r\n} from 'stores';\r\nimport { useFormActions } from 'hooks';\r\nimport * as constants from 'consts';\r\nimport * as utils from 'utils';\r\n\r\n// mui\r\nimport { Box } from '@material-ui/core';\r\n\r\nChangeComplexityPriorityAssignment.propTypes = {\r\n  claims: PropTypes.array.isRequired,\r\n  setIsDirty: PropTypes.func,\r\n  handleClose: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default function ChangeComplexityPriorityAssignment({ claims, setIsDirty, handleClose }) {\r\n  const dispatch = useDispatch();\r\n\r\n  const userOrganisation = useSelector(selectUserOrganisation);\r\n  const complexitiesBasisValues = useSelector(selectComplexityValues) || [];\r\n  const complexitiesBasisValuesLoaded = useSelector(selectComplexityValuesLoaded);\r\n  const complexityTypes = useSelector(selectComplexityTypes) || [];\r\n  const complexityTypesLoaded = useSelector(selectComplexityTypesLoaded);\r\n  const assignToUsersObj = useSelector(selectClaimsAssignedToUsers);\r\n  const priorities = useSelector(selectPriorities);\r\n  const prioritiesLoaded = useSelector(selectPrioritiesLoaded);\r\n  const singleClaimDetails = useSelector(selectClaimsInformation);\r\n\r\n  const teams = Object.values(constants.ORGANIZATIONS) || [];\r\n  const assignToUsersItems = assignToUsersObj?.items || [];\r\n  const assignToUsersLoaded = assignToUsersObj?.loaded;\r\n  const isAllClaimsComplexityUnsure = claims.every((claim) => claim.complexity === constants.CLAIM_COMPLEXITY_UNSURE);\r\n  const isSingleClaim = claims?.length === 1;\r\n\r\n  const [isCrossTeamAssignTo, setCrossTeamAssignTo] = useState(false);\r\n  const [isComplexityBasisAvailable, setIsComplexityBasisAvailable] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [isBasicDetailLoaded, setIsBasicDetailLoaded] = useState(!isSingleClaim);\r\n\r\n  const singleClaim = {\r\n    ...claims?.[0],\r\n    complexityValueID: singleClaimDetails?.complexityValueID,\r\n    complexityBasis: singleClaimDetails?.complexityBasis,\r\n  };\r\n\r\n  const getAssignedUser = () => {\r\n    return (\r\n      assignToUsersItems.find((user) => {\r\n        return claims.every((claim) => user.fullName === claim?.assignedTo);\r\n      }) || null\r\n    );\r\n  };\r\n\r\n  const getComplexity = () => {\r\n    return (\r\n      complexityTypes.find((type) => {\r\n        return claims.every((claim) => type.complextityType === claim?.complexity);\r\n      }) || null\r\n    );\r\n  };\r\n\r\n  const getComplexityBasis = () => {\r\n    if (isSingleClaim) {\r\n      return (\r\n        complexitiesBasisValues?.find(({ complexityRulesID }) => {\r\n          return complexityRulesID === singleClaim.complexityValueID;\r\n        }) || null\r\n      );\r\n    } else {\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const getPriority = () => {\r\n    return (\r\n      priorities?.find((priority) => {\r\n        return claims.every((claim) => priority?.description === claim?.priority);\r\n      }) || null\r\n    );\r\n  };\r\n\r\n  const getTeam = () => {\r\n    return (\r\n      teams.find((team) => {\r\n        return claims.every((claim) => team.label === claim?.team);\r\n      }) || null\r\n    );\r\n  };\r\n\r\n  const getTeamBy = (prop, label) => {\r\n    return teams?.find((team) => team[prop] === label) || null;\r\n  };\r\n\r\n  const isRequired = !isCrossTeamAssignTo;\r\n\r\n  const fields = [\r\n    {\r\n      name: 'complexity',\r\n      type: 'select',\r\n      label: `${utils.string.t('claims.processing.bulkAssign.fields.complexityType.label')} *`,\r\n      value: getComplexity()?.complextityType || '',\r\n      options: isAllClaimsComplexityUnsure\r\n        ? complexityTypes\r\n        : complexityTypes.filter((item) => item.complextityType !== constants.CLAIM_COMPLEXITY_UNSURE),\r\n      optionKey: 'complextityType',\r\n      optionLabel: 'complextityType',\r\n      validation: Yup.string().required(utils.string.t('validation.required')),\r\n      handleUpdate: (name, value) => {\r\n        const complexityObj = complexityTypes.find((c) => c.complextityType === value);\r\n        setValue('team', getTeamBy('label', complexityObj?.organizationName)?.label || '');\r\n        setValue('assignTo', null);\r\n        setIsComplexityBasisAvailable(complexityObj?.complextityType === constants.ORGANIZATIONS.ardonagh.complexity);\r\n        setCrossTeamAssignTo(complexityObj?.organizationName !== userOrganisation?.name);\r\n      },\r\n    },\r\n    {\r\n      name: 'complexityBasis',\r\n      type: 'autocompletemui',\r\n      label: `${utils.string.t('claims.processing.bulkAssign.fields.complexity.label')} *`,\r\n      value: getComplexityBasis(),\r\n      options: complexitiesBasisValues,\r\n      optionKey: 'complexityRulesID',\r\n      optionLabel: 'complexityRulesValue',\r\n      validation: isComplexityBasisAvailable && Yup.object().nullable().required(utils.string.t('validation.required')),\r\n    },\r\n    {\r\n      name: 'priority',\r\n      type: 'select',\r\n      label: `${utils.string.t('claims.processing.bulkAssign.fields.priority.label')} *`,\r\n      value: getPriority()?.description || '',\r\n      options: priorities,\r\n      optionKey: 'description',\r\n      optionLabel: 'description',\r\n      validation: Yup.string().required(utils.string.t('validation.required')),\r\n    },\r\n    {\r\n      name: 'priorityId',\r\n      type: 'hidden',\r\n      value: getPriority()?.id || '',\r\n    },\r\n    {\r\n      name: 'team',\r\n      type: 'select',\r\n      label: `${utils.string.t('claims.processing.bulkAssign.fields.team.label')} *`,\r\n      value: getTeam()?.label || '',\r\n      options: [{ ...constants.ORGANIZATIONS.mphasis }, { ...constants.ORGANIZATIONS.ardonagh }],\r\n      optionKey: 'label',\r\n      optionLabel: 'label',\r\n      validation: Yup.string().required(utils.string.t('validation.required')),\r\n      handleUpdate: (name, value) => {\r\n        const teamObj = getTeamBy('label', value);\r\n        setCrossTeamAssignTo(teamObj?.label !== userOrganisation?.name);\r\n      },\r\n    },\r\n    {\r\n      name: 'teamId',\r\n      type: 'hidden',\r\n      value: getTeam()?.id || '',\r\n    },\r\n    {\r\n      name: 'assignTo',\r\n      type: 'autocompletemui',\r\n      label: `${utils.string.t('claims.processing.bulkAssign.fields.assignTo.label')}${isRequired ? ' *' : ''}`,\r\n      value: getAssignedUser(),\r\n      options: assignToUsersItems,\r\n      optionKey: 'id',\r\n      optionLabel: 'fullName',\r\n      validation:\r\n        !isCrossTeamAssignTo && Yup.object().nullable().required(utils.string.t('claims.processing.bulkAssign.validation.chooseAssignee')),\r\n    },\r\n    {\r\n      name: 'notes',\r\n      type: 'textarea',\r\n      label: `${utils.string.t('claims.processing.bulkAssign.fields.notes.label')}${isRequired ? ' *' : ''}`,\r\n      value: '',\r\n      muiComponentProps: {\r\n        multiline: true,\r\n        minRows: 3,\r\n        maxRows: 6,\r\n      },\r\n      validation:\r\n        !isCrossTeamAssignTo &&\r\n        Yup.string()\r\n          .min(1, utils.string.t('validation.required'))\r\n          .max(1000, utils.string.t('validation.string.max'))\r\n          .required(utils.string.t('validation.required')),\r\n    },\r\n  ];\r\n\r\n  const defaultValues = utils.form.getInitialValues(fields);\r\n  const validationSchema = utils.form.getValidationSchema(fields);\r\n\r\n  const { control, watch, errors, setValue, handleSubmit, formState } = useForm({\r\n    defaultValues,\r\n    ...(validationSchema && { resolver: yupResolver(validationSchema) }),\r\n  });\r\n\r\n  const formValues = watch();\r\n  const formIsDirty = formState.isDirty;\r\n\r\n  const actions = [\r\n    {\r\n      name: 'cancel',\r\n      label: utils.string.t('app.cancel'),\r\n      handler: () => {\r\n        if (formIsDirty) {\r\n          dispatch(\r\n            showModal({\r\n              component: 'CONFIRM',\r\n              props: {\r\n                title: utils.string.t('navigation.form.subtitle'),\r\n                hint: utils.string.t('navigation.form.title'),\r\n                fullWidth: true,\r\n                maxWidth: 'xs',\r\n                componentProps: {\r\n                  cancelLabel: utils.string.t('app.no'),\r\n                  confirmLabel: utils.string.t('app.yes'),\r\n                  submitHandler: () => {\r\n                    handleClose();\r\n                  },\r\n                },\r\n              },\r\n            })\r\n          );\r\n        } else {\r\n          handleClose();\r\n        }\r\n      },\r\n    },\r\n    {\r\n      name: 'submit',\r\n      label: utils.string.t('app.assign'),\r\n      handler: (values) => {\r\n        onSubmit(values);\r\n      },\r\n    },\r\n  ];\r\n\r\n  const { cancel, submit } = useFormActions(actions);\r\n\r\n  const isDataReady = () => {\r\n    return (\r\n      isBasicDetailLoaded &&\r\n      prioritiesLoaded &&\r\n      utils.generic.isValidArray(priorities, true) &&\r\n      assignToUsersLoaded &&\r\n      utils.generic.isValidArray(assignToUsersItems, true) &&\r\n      complexityTypesLoaded &&\r\n      utils.generic.isValidArray(complexityTypes, true) &&\r\n      complexitiesBasisValuesLoaded &&\r\n      utils.generic.isValidArray(complexitiesBasisValues, true)\r\n    );\r\n  };\r\n\r\n  const isDataMissing = () => {\r\n    const allDataLoaded = prioritiesLoaded && assignToUsersLoaded && complexityTypesLoaded && complexitiesBasisValuesLoaded;\r\n    const missingPriorities = prioritiesLoaded && utils.generic.isInvalidOrEmptyArray(priorities);\r\n    const missingUsers = assignToUsersLoaded && utils.generic.isInvalidOrEmptyArray(assignToUsersItems);\r\n    const missingComplexities = complexityTypesLoaded && utils.generic.isInvalidOrEmptyArray(complexityTypes);\r\n    const missingComplexitiesBasis = complexitiesBasisValuesLoaded && utils.generic.isInvalidOrEmptyArray(complexitiesBasisValues);\r\n\r\n    return allDataLoaded && (missingPriorities || missingUsers || missingComplexities || missingComplexitiesBasis);\r\n  };\r\n\r\n  const dataReady = isDataReady();\r\n  const dataMissing = isDataMissing();\r\n\r\n  const setComplexityBasisAvailability = () => {\r\n    setIsComplexityBasisAvailable(getComplexity()?.complextityType === constants.ORGANIZATIONS.ardonagh.complexity);\r\n  };\r\n\r\n  const onSubmit = (values) => {\r\n    dispatch(updateClaim(claims, values));\r\n  };\r\n\r\n  useEffect(() => {\r\n    dispatch(getPriorityLevels());\r\n    dispatch(getComplexityTypes());\r\n    dispatch(resetComplexityBasisValues());\r\n\r\n    if (isSingleClaim) {\r\n      dispatch(\r\n        getClaimsBasicInformation(singleClaim.claimId, singleClaim.claimReference, singleClaim.sourceId, singleClaim.divisionId)\r\n      ).then(() => {\r\n        setIsBasicDetailLoaded(true);\r\n      });\r\n      dispatch(getComplexityValues(singleClaim.divisionId, singleClaim.sourceId, false));\r\n    } else {\r\n      dispatch(\r\n        getComplexityValues(\r\n          null,\r\n          null,\r\n          false,\r\n          uniq(\r\n            claims.reduce((acc, { sourceId, divisionId }) => {\r\n              return sourceId && divisionId ? [...acc, `${sourceId}-${divisionId}`] : acc;\r\n            }, [])\r\n          )\r\n        )\r\n      );\r\n    }\r\n\r\n    setComplexityBasisAvailability();\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  // fetch list of users when team is changed\r\n  useEffect(() => {\r\n    const teamName = formValues?.team;\r\n\r\n    if (teamName) {\r\n      setIsLoading(true);\r\n      setValue('assignTo', null);\r\n\r\n      // fetch users\r\n      dispatch(getUsersByOrg(teamName, claims, 'bulkAssignClaims', false)).then(() => {\r\n        setIsLoading(false);\r\n      });\r\n    }\r\n  }, [formValues?.team]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  // make the form dirty if any values are changed\r\n  useEffect(() => {\r\n    setIsDirty(formIsDirty);\r\n  }, [formValues]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  // populate form values when all data is ready\r\n  useEffect(() => {\r\n    const complexity = getComplexity();\r\n\r\n    if (dataReady) {\r\n      setComplexityBasisAvailability();\r\n      setValue('assignTo', getAssignedUser());\r\n      setValue('complexity', complexity?.complextityType || '');\r\n      setValue('complexityBasis', getComplexityBasis());\r\n      setValue('priority', getPriority()?.description || '');\r\n      setCrossTeamAssignTo(complexity?.organizationName !== userOrganisation?.name);\r\n    }\r\n  }, [dataReady]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  // hide modal and show warning if necessary data is missing\r\n  useEffect(() => {\r\n    if (dataMissing) {\r\n      dispatch(hideModal());\r\n      dispatch(enqueueNotification(utils.string.t('claims.processing.bulkAssign.notifications.data.failure'), 'warning'));\r\n    }\r\n  }, [dataMissing]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  // data is still loading...\r\n  if (!dataReady) {\r\n    return (\r\n      <Box height=\"300px\">\r\n        <Loader visible absolute />\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <ChangeComplexityPriorityAssignmentView\r\n      fields={fields}\r\n      buttons={{ cancel, submit }}\r\n      formProps={{ control, errors, handleSubmit, formState }}\r\n      isComplexityBasisAvailable={isComplexityBasisAvailable}\r\n      isLoading={isLoading}\r\n    />\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}