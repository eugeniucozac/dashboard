{"ast":null,"code":"import _slicedToArray from \"E:/MPHASIS/claims-page/Mphasis-Edge/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"E:\\\\MPHASIS\\\\claims-page\\\\Mphasis-Edge\\\\src\\\\pages\\\\ProcessingInstructionsSteps\\\\ProcessingInstructionsSteps.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useParams, useHistory } from 'react-router';\nimport { Helmet } from 'react-helmet'; //app\n\nimport { ProcessingInstructionsStepsView } from './ProcessingInstructionsSteps.view';\nimport { AccessControl } from 'components';\nimport { enqueueNotification, getUsersInRoles, getFacilityTypes, getDepartments, selectProcessingInstructionById, getProcessingInstruction, storeResetAllState, selectUser, selectPiProducingBrokers, selectPiAccountExecutives, selectPiFacilityTypes, selectPiDepartmentList, resetProcessingInstruction } from 'stores';\nimport * as constants from 'consts';\nimport * as utils from 'utils';\nimport config from 'config';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nvar ProcessingInstructionsSteps = function ProcessingInstructionsSteps() {\n  _s();\n\n  var dispatch = useDispatch();\n  var history = useHistory();\n\n  var _useParams = useParams(),\n      id = _useParams.id,\n      step = _useParams.step,\n      tab = _useParams.tab;\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      steps = _useState2[0],\n      setSteps = _useState2[1];\n\n  var _useState3 = useState(0),\n      _useState4 = _slicedToArray(_useState3, 2),\n      activeStep = _useState4[0],\n      setActiveStep = _useState4[1];\n\n  var _useState5 = useState({}),\n      _useState6 = _slicedToArray(_useState5, 2),\n      fetchInstruction = _useState6[0],\n      setFetchInstruction = _useState6[1];\n\n  var _useState7 = useState({}),\n      _useState8 = _slicedToArray(_useState7, 2),\n      fetchDepartments = _useState8[0],\n      setFetchDepartments = _useState8[1];\n\n  var _useState9 = useState({}),\n      _useState10 = _slicedToArray(_useState9, 2),\n      fetchUsersInRoles = _useState10[0],\n      setFetchUsersInRoles = _useState10[1];\n\n  var _useState11 = useState({}),\n      _useState12 = _slicedToArray(_useState11, 2),\n      fetchFacilityTypes = _useState12[0],\n      setFetchFacilityTypes = _useState12[1];\n\n  var user = useSelector(selectUser);\n  var producingBrokers = useSelector(selectPiProducingBrokers);\n  var accountExecutives = useSelector(selectPiAccountExecutives);\n  var facilityTypes = useSelector(selectPiFacilityTypes);\n  var departmentList = useSelector(selectPiDepartmentList);\n  var instruction = useSelector(selectProcessingInstructionById(id));\n  var brand = useSelector(function (state) {\n    return state.ui.brand;\n  });\n  var isClosing = utils.processingInstructions.isClosing(instruction === null || instruction === void 0 ? void 0 : instruction.processTypeId);\n  var isFdo = utils.processingInstructions.isFdo(instruction === null || instruction === void 0 ? void 0 : instruction.processTypeId);\n  var isFeeAndAmendment = utils.processingInstructions.isFeeAndAmendment(instruction === null || instruction === void 0 ? void 0 : instruction.processTypeId);\n  var isBordereau = utils.processingInstructions.isBordereau(instruction === null || instruction === void 0 ? void 0 : instruction.processTypeId);\n  var isEndorsement = utils.processingInstructions.isEndorsement(instruction === null || instruction === void 0 ? void 0 : instruction.processTypeId);\n  var isDraft = utils.processingInstructions.status.isDraft(instruction === null || instruction === void 0 ? void 0 : instruction.statusId);\n  var isRejectedDraft = utils.processingInstructions.status.isRejectedDraft(instruction === null || instruction === void 0 ? void 0 : instruction.statusId);\n  var isReopened = utils.processingInstructions.status.isReopened(instruction === null || instruction === void 0 ? void 0 : instruction.statusId);\n  var isSubmittedAuthorisedSignatory = utils.processingInstructions.status.isSubmittedAuthorisedSignatory(instruction === null || instruction === void 0 ? void 0 : instruction.statusId);\n  var isSubmittedProcessing = utils.processingInstructions.status.isSubmittedProcessing(instruction === null || instruction === void 0 ? void 0 : instruction.statusId);\n  var processTypeName = utils.processingInstructions.getProcessTypeName(instruction === null || instruction === void 0 ? void 0 : instruction.processTypeId);\n  var userHasWritePermission = utils.app.access.feature('processingInstructions.processingInstructions', ['create', 'update'], user);\n  var userHasApproverAccess = utils.app.access.feature('processingInstructions.approverChecklist', ['create', 'update'], user);\n  var isEditAllowed = userHasWritePermission && (isDraft || isRejectedDraft || isReopened);\n  var isReadOnly = !isEditAllowed;\n  var isPageReady = fetchInstruction.done && fetchDepartments.done && fetchUsersInRoles.done && fetchFacilityTypes.done;\n  var stepsMap = {\n    closing: {\n      'add-risk-reference': 0,\n      checklist: 1,\n      'processing-instruction': 2,\n      authorisations: 3\n    },\n    endorsement: {\n      'add-risk-reference': 0,\n      'processing-instruction': 1\n    },\n    fdo: {\n      'add-risk-reference': 0,\n      checklist: 1,\n      'processing-instruction': 2,\n      authorisations: 3\n    },\n    bordereau: {\n      'add-risk-reference': 0,\n      'processing-instruction': 1\n    },\n    feeAmendment: {\n      'add-risk-reference': 0,\n      'processing-instruction': 1\n    }\n  };\n  useEffect(function () {\n    // fetch departments\n    if (utils.generic.isInvalidOrEmptyArray(departmentList) && !fetchDepartments.loading) {\n      setFetchDepartments({\n        done: false,\n        loading: true\n      });\n      dispatch(getDepartments()).then(function (res) {\n        if (utils.generic.isValidArray(res)) {\n          setFetchDepartments({\n            done: true,\n            loading: false\n          });\n        }\n      });\n    } else {\n      setFetchDepartments({\n        done: true,\n        loading: false\n      });\n    } // fetch users in roles\n\n\n    if ((utils.generic.isInvalidOrEmptyArray(producingBrokers) || utils.generic.isInvalidOrEmptyArray(accountExecutives)) && !fetchUsersInRoles.loading) {\n      setFetchUsersInRoles({\n        done: false,\n        loading: true\n      });\n      dispatch(getUsersInRoles([constants.PRODUCING_BROKER, constants.ACCOUNT_EXECUTIVE])).then(function (res) {\n        if (utils.generic.isValidArray(res)) {\n          setFetchUsersInRoles({\n            done: true,\n            loading: false\n          });\n        }\n      });\n    } else {\n      setFetchUsersInRoles({\n        done: true,\n        loading: false\n      });\n    } // cleanup\n\n\n    return function () {\n      dispatch(resetProcessingInstruction());\n    };\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(function () {\n    // fetch processing instruction by ID if not loaded\n    if (!(instruction === null || instruction === void 0 ? void 0 : instruction.id) && !fetchInstruction.loading) {\n      setFetchInstruction({\n        done: false,\n        loading: true\n      });\n      dispatch(getProcessingInstruction(id)).then(function (res) {\n        setFetchInstruction({\n          done: true,\n          loading: false\n        });\n        var notificationParams = {\n          data: {\n            id: id\n          },\n          keepAfterUrlChange: true\n        };\n\n        if (!(res === null || res === void 0 ? void 0 : res.id)) {\n          var _res$json, _res$json2, _res$json3;\n\n          // if user is Assigned Signatory and status is not submitted authorised/processing\n          if ((res === null || res === void 0 ? void 0 : (_res$json = res.json) === null || _res$json === void 0 ? void 0 : _res$json.message) === 'pi.status.not.allowed') {\n            dispatch(enqueueNotification('processingInstructions.notifications.statusNotAllowed', 'warning', notificationParams)); // if user doesn't have access to the instances and/or departments\n          } else if ((res === null || res === void 0 ? void 0 : (_res$json2 = res.json) === null || _res$json2 === void 0 ? void 0 : _res$json2.message) === 'pi.instance.dept.unauthorised') {\n            dispatch(enqueueNotification('processingInstructions.notifications.instanceDeptUnauthorised', 'warning', notificationParams)); // status was meanwhile changed to rejected draft\n          } else if ((res === null || res === void 0 ? void 0 : (_res$json3 = res.json) === null || _res$json3 === void 0 ? void 0 : _res$json3.message) === 'pi.status.rejected.draft') {\n            dispatch(enqueueNotification('processingInstructions.notifications.statusChangedToRejected', 'warning', notificationParams)); // if PI not found\n          } else {\n            dispatch(enqueueNotification('processingInstructions.notifications.notFound', 'warning', notificationParams));\n          }\n\n          history.replace(config.routes.processingInstructions.root);\n        }\n      });\n    } // fetch facility types\n\n\n    if (isFdo && utils.generic.isInvalidOrEmptyArray(facilityTypes) && !fetchFacilityTypes.loading) {\n      setFetchFacilityTypes({\n        done: false,\n        loading: true\n      });\n      dispatch(getFacilityTypes()).then(function (res) {\n        if (utils.generic.isValidArray(res)) {\n          setFetchFacilityTypes({\n            done: true,\n            loading: false\n          });\n        }\n      });\n    } else {\n      setFetchFacilityTypes({\n        done: true,\n        loading: false\n      });\n    }\n  }, [instruction === null || instruction === void 0 ? void 0 : instruction.id]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(function () {\n    dispatch(storeResetAllState(isEditAllowed));\n  }, [isReadOnly, isSubmittedAuthorisedSignatory]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(function () {\n    if (isPageReady) {\n      // set the available steps for different process types\n      var currentSteps = [];\n\n      if (isClosing || isFdo) {\n        currentSteps = [{\n          slug: 'add-risk-reference',\n          label: utils.string.t('processingInstructions.steps.addRiskRefs')\n        }, {\n          slug: 'checklist',\n          label: utils.string.t('processingInstructions.steps.checklist')\n        }, {\n          slug: 'processing-instruction',\n          label: utils.string.t('processingInstructions.steps.details')\n        }, {\n          slug: 'authorisations',\n          label: utils.string.t('processingInstructions.steps.authorisations')\n        }];\n      } else {\n        currentSteps = [{\n          slug: 'add-risk-reference',\n          label: utils.string.t('processingInstructions.steps.addRiskRefs')\n        }, {\n          slug: 'processing-instruction',\n          label: utils.string.t('processingInstructions.steps.details')\n        }];\n      }\n\n      setSteps(currentSteps); // redirection logic\n      // if step is defined in URL route params\n\n      if (step) {\n        // if URL step param is not a valid step slug\n        if (!currentSteps.map(function (item) {\n          return item.slug;\n        }).includes(step)) {\n          history.replace(\"\".concat(config.routes.processingInstructions.steps, \"/\").concat(id, \"/\").concat(currentSteps[0].slug));\n        }\n      } else {\n        // if user is Assigned Signatory\n        // AND type is closing OR fdo\n        // AND status is submittedToAuthorisedSignatory OR submittedForProcessing\n        if (userHasApproverAccess && (isClosing || isFdo) && (isSubmittedAuthorisedSignatory || isSubmittedProcessing)) {\n          history.replace(\"\".concat(config.routes.processingInstructions.steps, \"/\").concat(id, \"/checklist\")); // if type is closing OR fdo\n          // AND status is reopened\n        } else if (isReopened && (isClosing || isFdo)) {\n          history.replace(\"\".concat(config.routes.processingInstructions.steps, \"/\").concat(id, \"/checklist\"));\n        } else if (isReopened && (isFeeAndAmendment || isBordereau || isEndorsement)) {\n          history.replace(\"\".concat(config.routes.processingInstructions.steps, \"/\").concat(id, \"/processing-instruction\"));\n        } else {\n          history.replace(\"\".concat(config.routes.processingInstructions.steps, \"/\").concat(id, \"/\").concat(currentSteps[0].slug));\n        }\n      } // set the active step based on URL params or fallback to override custom logic if any applies\n\n\n      if (processTypeName) {\n        var _stepsMap$processType;\n\n        setActiveStep(step ? (_stepsMap$processType = stepsMap[processTypeName]) === null || _stepsMap$processType === void 0 ? void 0 : _stepsMap$processType[step] : 0);\n      }\n    }\n  }, [isPageReady, processTypeName, step]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  var handleNext = function handleNext(step) {\n    history.push(\"\".concat(config.routes.processingInstructions.steps, \"/\").concat(id).concat(step ? \"/\".concat(step) : ''));\n  };\n\n  var handleBack = function handleBack(step) {\n    history.push(\"\".concat(config.routes.processingInstructions.steps, \"/\").concat(id).concat(step ? \"/\".concat(step) : ''));\n  }; // abort\n\n\n  if (!isPageReady || !instruction || !id || !processTypeName) return null;\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Helmet, {\n      children: /*#__PURE__*/_jsxDEV(\"title\", {\n        children: \"\".concat(utils.string.t('processingInstructions.edit.title'), \" (\").concat(id, \") - \").concat(utils.app.getAppName(brand))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 9\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(AccessControl, {\n      feature: \"processingInstructions.processingInstructions\",\n      permissions: \"read\",\n      children: /*#__PURE__*/_jsxDEV(ProcessingInstructionsStepsView, {\n        instruction: instruction,\n        urlParams: {\n          id: parseInt(id),\n          step: step,\n          tab: tab\n        },\n        type: processTypeName,\n        steps: steps,\n        stepsMap: stepsMap,\n        activeStep: activeStep,\n        departmentList: departmentList,\n        handlers: {\n          back: handleBack,\n          next: handleNext\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 249,\n        columnNumber: 9\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true);\n};\n\n_s(ProcessingInstructionsSteps, \"SB1Rpem3quImRM2nF+135TL23BY=\", false, function () {\n  return [useDispatch, useHistory, useParams, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector];\n});\n\n_c = ProcessingInstructionsSteps;\nProcessingInstructionsSteps.__docgenInfo = {\n  \"description\": \"\",\n  \"methods\": [],\n  \"displayName\": \"ProcessingInstructionsSteps\"\n};\nexport default ProcessingInstructionsSteps;\n\nif (typeof STORYBOOK_REACT_CLASSES !== \"undefined\") {\n  STORYBOOK_REACT_CLASSES[\"src\\\\pages\\\\ProcessingInstructionsSteps\\\\ProcessingInstructionsSteps.js\"] = {\n    name: \"ProcessingInstructionsSteps\",\n    docgenInfo: ProcessingInstructionsSteps.__docgenInfo,\n    path: \"src\\\\pages\\\\ProcessingInstructionsSteps\\\\ProcessingInstructionsSteps.js\"\n  };\n}\n\nvar _c;\n\n$RefreshReg$(_c, \"ProcessingInstructionsSteps\");","map":{"version":3,"sources":["E:/MPHASIS/claims-page/Mphasis-Edge/src/pages/ProcessingInstructionsSteps/ProcessingInstructionsSteps.js"],"names":["React","useEffect","useState","useSelector","useDispatch","useParams","useHistory","Helmet","ProcessingInstructionsStepsView","AccessControl","enqueueNotification","getUsersInRoles","getFacilityTypes","getDepartments","selectProcessingInstructionById","getProcessingInstruction","storeResetAllState","selectUser","selectPiProducingBrokers","selectPiAccountExecutives","selectPiFacilityTypes","selectPiDepartmentList","resetProcessingInstruction","constants","utils","config","ProcessingInstructionsSteps","dispatch","history","id","step","tab","steps","setSteps","activeStep","setActiveStep","fetchInstruction","setFetchInstruction","fetchDepartments","setFetchDepartments","fetchUsersInRoles","setFetchUsersInRoles","fetchFacilityTypes","setFetchFacilityTypes","user","producingBrokers","accountExecutives","facilityTypes","departmentList","instruction","brand","state","ui","isClosing","processingInstructions","processTypeId","isFdo","isFeeAndAmendment","isBordereau","isEndorsement","isDraft","status","statusId","isRejectedDraft","isReopened","isSubmittedAuthorisedSignatory","isSubmittedProcessing","processTypeName","getProcessTypeName","userHasWritePermission","app","access","feature","userHasApproverAccess","isEditAllowed","isReadOnly","isPageReady","done","stepsMap","closing","checklist","authorisations","endorsement","fdo","bordereau","feeAmendment","generic","isInvalidOrEmptyArray","loading","then","res","isValidArray","PRODUCING_BROKER","ACCOUNT_EXECUTIVE","notificationParams","data","keepAfterUrlChange","json","message","replace","routes","root","currentSteps","slug","label","string","t","map","item","includes","handleNext","push","handleBack","getAppName","parseInt","back","next"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { useParams, useHistory } from 'react-router';\r\nimport { Helmet } from 'react-helmet';\r\n\r\n//app\r\nimport { ProcessingInstructionsStepsView } from './ProcessingInstructionsSteps.view';\r\nimport { AccessControl } from 'components';\r\nimport {\r\n  enqueueNotification,\r\n  getUsersInRoles,\r\n  getFacilityTypes,\r\n  getDepartments,\r\n  selectProcessingInstructionById,\r\n  getProcessingInstruction,\r\n  storeResetAllState,\r\n  selectUser,\r\n  selectPiProducingBrokers,\r\n  selectPiAccountExecutives,\r\n  selectPiFacilityTypes,\r\n  selectPiDepartmentList,\r\n  resetProcessingInstruction,\r\n} from 'stores';\r\nimport * as constants from 'consts';\r\nimport * as utils from 'utils';\r\nimport config from 'config';\r\n\r\nconst ProcessingInstructionsSteps = () => {\r\n  const dispatch = useDispatch();\r\n  const history = useHistory();\r\n  const { id, step, tab } = useParams();\r\n\r\n  const [steps, setSteps] = useState([]);\r\n  const [activeStep, setActiveStep] = useState(0);\r\n  const [fetchInstruction, setFetchInstruction] = useState({});\r\n  const [fetchDepartments, setFetchDepartments] = useState({});\r\n  const [fetchUsersInRoles, setFetchUsersInRoles] = useState({});\r\n  const [fetchFacilityTypes, setFetchFacilityTypes] = useState({});\r\n\r\n  const user = useSelector(selectUser);\r\n  const producingBrokers = useSelector(selectPiProducingBrokers);\r\n  const accountExecutives = useSelector(selectPiAccountExecutives);\r\n  const facilityTypes = useSelector(selectPiFacilityTypes);\r\n  const departmentList = useSelector(selectPiDepartmentList);\r\n  const instruction = useSelector(selectProcessingInstructionById(id));\r\n  const brand = useSelector((state) => state.ui.brand);\r\n\r\n  const isClosing = utils.processingInstructions.isClosing(instruction?.processTypeId);\r\n  const isFdo = utils.processingInstructions.isFdo(instruction?.processTypeId);\r\n  const isFeeAndAmendment = utils.processingInstructions.isFeeAndAmendment(instruction?.processTypeId);\r\n  const isBordereau = utils.processingInstructions.isBordereau(instruction?.processTypeId);\r\n  const isEndorsement = utils.processingInstructions.isEndorsement(instruction?.processTypeId);\r\n\r\n  const isDraft = utils.processingInstructions.status.isDraft(instruction?.statusId);\r\n  const isRejectedDraft = utils.processingInstructions.status.isRejectedDraft(instruction?.statusId);\r\n  const isReopened = utils.processingInstructions.status.isReopened(instruction?.statusId);\r\n  const isSubmittedAuthorisedSignatory = utils.processingInstructions.status.isSubmittedAuthorisedSignatory(instruction?.statusId);\r\n  const isSubmittedProcessing = utils.processingInstructions.status.isSubmittedProcessing(instruction?.statusId);\r\n  const processTypeName = utils.processingInstructions.getProcessTypeName(instruction?.processTypeId);\r\n\r\n  const userHasWritePermission = utils.app.access.feature('processingInstructions.processingInstructions', ['create', 'update'], user);\r\n  const userHasApproverAccess = utils.app.access.feature('processingInstructions.approverChecklist', ['create', 'update'], user);\r\n  const isEditAllowed = userHasWritePermission && (isDraft || isRejectedDraft || isReopened);\r\n  const isReadOnly = !isEditAllowed;\r\n  const isPageReady = fetchInstruction.done && fetchDepartments.done && fetchUsersInRoles.done && fetchFacilityTypes.done;\r\n\r\n  const stepsMap = {\r\n    closing: {\r\n      'add-risk-reference': 0,\r\n      checklist: 1,\r\n      'processing-instruction': 2,\r\n      authorisations: 3,\r\n    },\r\n    endorsement: {\r\n      'add-risk-reference': 0,\r\n      'processing-instruction': 1,\r\n    },\r\n    fdo: {\r\n      'add-risk-reference': 0,\r\n      checklist: 1,\r\n      'processing-instruction': 2,\r\n      authorisations: 3,\r\n    },\r\n    bordereau: {\r\n      'add-risk-reference': 0,\r\n      'processing-instruction': 1,\r\n    },\r\n    feeAmendment: {\r\n      'add-risk-reference': 0,\r\n      'processing-instruction': 1,\r\n    },\r\n  };\r\n\r\n  useEffect(() => {\r\n    // fetch departments\r\n    if (utils.generic.isInvalidOrEmptyArray(departmentList) && !fetchDepartments.loading) {\r\n      setFetchDepartments({ done: false, loading: true });\r\n\r\n      dispatch(getDepartments()).then((res) => {\r\n        if (utils.generic.isValidArray(res)) {\r\n          setFetchDepartments({ done: true, loading: false });\r\n        }\r\n      });\r\n    } else {\r\n      setFetchDepartments({ done: true, loading: false });\r\n    }\r\n\r\n    // fetch users in roles\r\n    if (\r\n      (utils.generic.isInvalidOrEmptyArray(producingBrokers) || utils.generic.isInvalidOrEmptyArray(accountExecutives)) &&\r\n      !fetchUsersInRoles.loading\r\n    ) {\r\n      setFetchUsersInRoles({ done: false, loading: true });\r\n\r\n      dispatch(getUsersInRoles([constants.PRODUCING_BROKER, constants.ACCOUNT_EXECUTIVE])).then((res) => {\r\n        if (utils.generic.isValidArray(res)) {\r\n          setFetchUsersInRoles({ done: true, loading: false });\r\n        }\r\n      });\r\n    } else {\r\n      setFetchUsersInRoles({ done: true, loading: false });\r\n    }\r\n\r\n    // cleanup\r\n    return () => {\r\n      dispatch(resetProcessingInstruction());\r\n    };\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    // fetch processing instruction by ID if not loaded\r\n    if (!instruction?.id && !fetchInstruction.loading) {\r\n      setFetchInstruction({ done: false, loading: true });\r\n\r\n      dispatch(getProcessingInstruction(id)).then((res) => {\r\n        setFetchInstruction({ done: true, loading: false });\r\n\r\n        const notificationParams = {\r\n          data: { id },\r\n          keepAfterUrlChange: true,\r\n        };\r\n\r\n        if (!res?.id) {\r\n          // if user is Assigned Signatory and status is not submitted authorised/processing\r\n          if (res?.json?.message === 'pi.status.not.allowed') {\r\n            dispatch(enqueueNotification('processingInstructions.notifications.statusNotAllowed', 'warning', notificationParams));\r\n            // if user doesn't have access to the instances and/or departments\r\n          } else if (res?.json?.message === 'pi.instance.dept.unauthorised') {\r\n            dispatch(enqueueNotification('processingInstructions.notifications.instanceDeptUnauthorised', 'warning', notificationParams));\r\n            // status was meanwhile changed to rejected draft\r\n          } else if (res?.json?.message === 'pi.status.rejected.draft') {\r\n            dispatch(enqueueNotification('processingInstructions.notifications.statusChangedToRejected', 'warning', notificationParams));\r\n            // if PI not found\r\n          } else {\r\n            dispatch(enqueueNotification('processingInstructions.notifications.notFound', 'warning', notificationParams));\r\n          }\r\n\r\n          history.replace(config.routes.processingInstructions.root);\r\n        }\r\n      });\r\n    }\r\n\r\n    // fetch facility types\r\n    if (isFdo && utils.generic.isInvalidOrEmptyArray(facilityTypes) && !fetchFacilityTypes.loading) {\r\n      setFetchFacilityTypes({ done: false, loading: true });\r\n\r\n      dispatch(getFacilityTypes()).then((res) => {\r\n        if (utils.generic.isValidArray(res)) {\r\n          setFetchFacilityTypes({ done: true, loading: false });\r\n        }\r\n      });\r\n    } else {\r\n      setFetchFacilityTypes({ done: true, loading: false });\r\n    }\r\n  }, [instruction?.id]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    dispatch(storeResetAllState(isEditAllowed));\r\n  }, [isReadOnly, isSubmittedAuthorisedSignatory]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    if (isPageReady) {\r\n      // set the available steps for different process types\r\n      let currentSteps = [];\r\n      if (isClosing || isFdo) {\r\n        currentSteps = [\r\n          { slug: 'add-risk-reference', label: utils.string.t('processingInstructions.steps.addRiskRefs') },\r\n          { slug: 'checklist', label: utils.string.t('processingInstructions.steps.checklist') },\r\n          { slug: 'processing-instruction', label: utils.string.t('processingInstructions.steps.details') },\r\n          { slug: 'authorisations', label: utils.string.t('processingInstructions.steps.authorisations') },\r\n        ];\r\n      } else {\r\n        currentSteps = [\r\n          { slug: 'add-risk-reference', label: utils.string.t('processingInstructions.steps.addRiskRefs') },\r\n          { slug: 'processing-instruction', label: utils.string.t('processingInstructions.steps.details') },\r\n        ];\r\n      }\r\n      setSteps(currentSteps);\r\n\r\n      // redirection logic\r\n      // if step is defined in URL route params\r\n      if (step) {\r\n        // if URL step param is not a valid step slug\r\n        if (!currentSteps.map((item) => item.slug).includes(step)) {\r\n          history.replace(`${config.routes.processingInstructions.steps}/${id}/${currentSteps[0].slug}`);\r\n        }\r\n      } else {\r\n        // if user is Assigned Signatory\r\n        // AND type is closing OR fdo\r\n        // AND status is submittedToAuthorisedSignatory OR submittedForProcessing\r\n        if (userHasApproverAccess && (isClosing || isFdo) && (isSubmittedAuthorisedSignatory || isSubmittedProcessing)) {\r\n          history.replace(`${config.routes.processingInstructions.steps}/${id}/checklist`);\r\n\r\n          // if type is closing OR fdo\r\n          // AND status is reopened\r\n        } else if (isReopened && (isClosing || isFdo)) {\r\n          history.replace(`${config.routes.processingInstructions.steps}/${id}/checklist`);\r\n        } else if (isReopened && (isFeeAndAmendment || isBordereau || isEndorsement)) {\r\n          history.replace(`${config.routes.processingInstructions.steps}/${id}/processing-instruction`);\r\n        } else {\r\n          history.replace(`${config.routes.processingInstructions.steps}/${id}/${currentSteps[0].slug}`);\r\n        }\r\n      }\r\n\r\n      // set the active step based on URL params or fallback to override custom logic if any applies\r\n      if (processTypeName) {\r\n        setActiveStep(step ? stepsMap[processTypeName]?.[step] : 0);\r\n      }\r\n    }\r\n  }, [isPageReady, processTypeName, step]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  const handleNext = (step) => {\r\n    history.push(`${config.routes.processingInstructions.steps}/${id}${step ? `/${step}` : ''}`);\r\n  };\r\n\r\n  const handleBack = (step) => {\r\n    history.push(`${config.routes.processingInstructions.steps}/${id}${step ? `/${step}` : ''}`);\r\n  };\r\n\r\n  // abort\r\n  if (!isPageReady || !instruction || !id || !processTypeName) return null;\r\n\r\n  return (\r\n    <>\r\n      <Helmet>\r\n        <title>{`${utils.string.t('processingInstructions.edit.title')} (${id}) - ${utils.app.getAppName(brand)}`}</title>\r\n      </Helmet>\r\n      <AccessControl feature=\"processingInstructions.processingInstructions\" permissions=\"read\">\r\n        <ProcessingInstructionsStepsView\r\n          instruction={instruction}\r\n          urlParams={{ id: parseInt(id), step, tab }}\r\n          type={processTypeName}\r\n          steps={steps}\r\n          stepsMap={stepsMap}\r\n          activeStep={activeStep}\r\n          departmentList={departmentList}\r\n          handlers={{\r\n            back: handleBack,\r\n            next: handleNext,\r\n          }}\r\n        />\r\n      </AccessControl>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ProcessingInstructionsSteps;\r\n"]},"metadata":{},"sourceType":"module"}